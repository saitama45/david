import{f as Me,T as R,r as u,o as k,c as se,w as o,g as c,a as t,b as n,u as s,s as G,t as m,i as Y,d as L,e as re,F as ue,h as de}from"./app-p8ycGfai.js";import{u as Qe}from"./useBackButton-DYna6UI2.js";import{u as z}from"./useSelectOptions-Ci2WUICq.js";import{u as je}from"./useToast-BAk2IYqi.js";import{u as He}from"./useEditQuantity-BAxrcitu.js";const Ne={class:"grid sm:grid-cols-3 gap-5 grid-cols-1"},$e={class:"grid gap-5"},Ae={class:"flex flex-col space-y-1"},Re={class:"flex flex-col space-y-1"},Ge={class:"flex flex-col space-y-1"},Ye={class:"flex flex-col space-y-1"},ze={class:"flex flex-col space-y-1"},he={class:"flex flex-col space-y-1"},Je={class:"flex flex-col space-y-1"},Ke=["onClick"],We=["onClick"],Xe=["onClick"],Ze=["onClick"],et={key:0},tt={class:"space-y-5"},ot={class:"flex flex-col space-y-1"},lt={class:"flex flex-col space-y-1"},nt={key:0},it={__name:"Create",props:{products:{type:Object,required:!1},branches:{type:Object,required:!0},suppliers:{type:Object,required:!0},previousOrder:{type:Object,required:!1}},setup(ie){const{backButton:ce}=Qe(route("store-orders.index")),M=Me(),{toast:g}=je(),v=ref(null);onBeforeMount(()=>{const a=localStorage.getItem("storeStoreOrderDraft");a&&(v.value=JSON.parse(a))}),onMounted(()=>{console.log(v.value),v.value!=null&&M.require({message:"You have an unfinished draft. Would you like to continue where you left off or discard the draft?",header:"Unfinished Draft Detected",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Discard",severity:"danger"},acceptProps:{label:"Continue",severity:"primary"},accept:()=>{l.supplier_id=v.value.supplier_id,l.branch_id=v.value.branch_id,l.order_date=v.value.order_date,l.orders=v.value.orders}})});const P=ie,D=P.previousOrder,{options:pe}=z(P.branches),{options:me}=z(P.products),{options:h}=z(P.suppliers),w=ref(null),F=ref(!1),b=ref(!1);watch(F,a=>{a||(C.reset(),C.clearErrors())});const d=reactive({id:null,inventory_code:null,name:null,unit_of_measurement:null,quantity:null,cost:null,total_cost:null,uom:null}),C=R({orders_file:null}),l=R({branch_id:(D==null?void 0:D.store_branch_id)+"",supplier_id:(D==null?void 0:D.supplier_id)+"",order_date:null,orders:[],variant:"emergency_order"}),fe=computed(()=>l.orders.reduce((a,e)=>a+parseFloat(e.total_cost),0).toFixed(2)),x=R({item:null}),_e=()=>{if(l.orders.length<1){g.add({severity:"error",summary:"Error",detail:"Please select at least one item before proceeding.",life:5e3});return}if(!l.order_date){l.setError("order_date","Order date is required.");return}const a=e=>{const i=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${e.getFullYear()}-${i}-${p}`};l.order_date=a(new Date(l.order_date)),M.require({message:"Are you sure you want to place this order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{l.post(route("emergency-orders.store"),{onSuccess:()=>{g.add({severity:"success",summary:"Success",detail:"Order Created Successfully.",life:5e3}),localStorage.removeItem("storeStoreOrderDraft")},onError:e=>{g.add({severity:"error",summary:"Error",detail:"Can't place the order.",life:5e3})}})}})};watch(w,a=>{a&&(b.value=!0,x.item=a,axios.get(route("product.show",a)).then(e=>e.data).then(e=>{d.id=e.id,d.name=e.name,d.inventory_code=e.inventory_code,d.unit_of_measurement=e.unit_of_measurement,d.cost=e.cost,d.uom=e.uom}).catch(e=>console.log(e)).finally(()=>b.value=!1))});const ye=()=>{F.value=!0},xe=()=>{if(x.clearErrors(),!x.item){x.setError("item","Item field is required");return}if(Number(d.quantity)<.1){x.setError("quantity","Quantity must be at least 0.1");return}if(!d.inventory_code||!d.name||!d.unit_of_measurement||!d.quantity)return;const a=l.orders.findIndex(e=>e.id===d.id);if(a!==-1){const e=l.orders[a].quantity+=Number(d.quantity);l.orders[a].total_cost=parseFloat(d.cost*e).toFixed(2)}else d.total_cost=parseFloat(d.cost*d.quantity).toFixed(2),l.orders.push({...d});Object.keys(d).forEach(e=>{d[e]=null}),w.value=null,g.add({severity:"success",summary:"Success",detail:"Item added successfully.",life:5e3}),x.item=null,x.clearErrors()},De=()=>{b.value=!0;const a=new FormData;a.append("orders_file",C.orders_file),axios.post(route("store-orders.imported-file"),a,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e.data.orders.forEach(i=>{const p=l.orders.findIndex(f=>f.id===i.id);if(p!==-1){const f=l.orders[p].quantity+Number(i.quantity);l.orders[p].quantity=f,l.orders[p].total_cost=parseFloat(f*l.orders[p].cost).toFixed(2)}else l.orders.push({...i,total_cost:parseFloat(i.quantity*i.cost).toFixed(2)})}),F.value=!1,g.add({severity:"success",summary:"Success",detail:"Items added successfully.",life:5e3}),C.orders_file=null}).catch(e=>{g.add({severity:"error",summary:"Error",detail:"An error occured while trying to get the imported orders. Please make sure that you are using the correct format.",life:5e3}),C.setError("orders_file",e.response.data.message),console.log(e)}).finally(()=>b.value=!1)},be=a=>{const e=l.orders.findIndex(i=>i.id===a);l.orders[e].quantity=parseFloat((l.orders[e].quantity+.1).toFixed(2)),l.orders[e].total_cost=parseFloat(l.orders[e].quantity*l.orders[e].cost).toFixed(2)},ge=a=>{const e=l.orders.findIndex(i=>i.id===a);if(l.orders[e].quantity=parseFloat((l.orders[e].quantity-.1).toFixed(2)),l.orders[e].quantity<.1){l.orders=l.orders.filter(i=>i.id!==a);return}l.orders[e].total_cost=parseFloat(l.orders[e].quantity*l.orders[e].cost).toFixed(2)},J=a=>{M.require({message:"Are you sure you want to remove this item from your orders?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Remove",severity:"danger"},accept:()=>{l.orders=l.orders.filter(e=>e.id!==a),g.add({severity:"success",summary:"Confirmed",detail:"Item Removed",life:3e3})}})},_=reactive({minDate:null,maxDate:null}),ve=()=>{const a=new Date,e=new Date(a);e.setDate(a.getDate()+(7-a.getDay()));const i=new Date(e);i.setDate(e.getDate()+6),_.minDate=e,_.maxDate=i},Ce=()=>{const a=new Date,e=new Date(a);e.setDate(a.getDate()+(7-a.getDay()));const i=new Date(e);i.setDate(e.getDate()+3);const p=new Date(a);p.setDate(a.getDate()+(7-a.getDay()));const f=new Date(p);f.setDate(p.getDate()+4);const I=new Date(p);I.setDate(p.getDate()+6);const y=a.getDay(),N=a.getHours();console.log(I),console.log(f),y===0||y===1||y===2||y===3&&N<7?(_.minDate=p,_.maxDate=i):(_.minDate=f,_.maxDate=I)},T=new Date,Q=new Date(T);if(Q.setDate(T.getDate()+1),T.getHours()>=7?(_.minDate=Q,_.maxDate=Q):(_.minDate=T,_.maxDate=T),D){D.store_order_items.forEach(e=>{const i={id:e.product_inventory.id,inventory_code:e.product_inventory.inventory_code,name:e.product_inventory.name,unit_of_measurement:e.product_inventory.unit_of_measurement.name,quantity:e.quantity_ordered,cost:e.product_inventory.cost,total_cost:parseFloat(e.quantity_ordered*e.product_inventory.cost).toFixed(2)};l.orders.push(i)});const a=Object.values(h.value).find(e=>e.value===l.supplier_id+"");a.label==="GSI OT-BAKERY"||a.label==="GSI OT-PR"?Ce():a.label==="PUL OT-DG"&&ve()}const{isEditQuantityModalOpen:j,formQuantity:H,openEditQuantityModal:Ie,editQuantity:qe}=He(l);return watch(l,a=>{localStorage.setItem("storeStoreOrderDraft",JSON.stringify(a))}),(a,e)=>{const i=u("CardTitle"),p=u("CardDescription"),f=u("CardHeader"),I=u("InputLabel"),y=u("FormError"),N=u("DatePicker"),$=u("CardContent"),A=u("Card"),O=u("Label"),V=u("Input"),B=u("Button"),K=u("CardFooter"),E=u("LabelXS"),Se=u("SpanBold"),W=u("DivFlexCenter"),q=u("TH"),ke=u("TableHead"),S=u("TD"),Fe=u("LinkButton"),X=u("Trash2"),Oe=u("TableBody"),we=u("Table"),Te=u("Minus"),Ve=u("Plus"),Be=u("MobileTableHeading"),Ee=u("MobileTableRow"),Le=u("MobileTableContainer"),Z=u("DialogTitle"),ee=u("DialogDescription"),te=u("DialogHeader"),Pe=u("InputContainer"),oe=u("Loading"),le=u("DialogFooter"),ne=u("DialogContent"),ae=u("Dialog"),Ue=u("Layout");return k(),se(Ue,{heading:"Emergency Store Order > Create",hasButton:!0,buttonName:"Import Orders",handleClick:ye},{default:o(()=>[c("div",Ne,[c("section",$e,[t(A,null,{default:o(()=>[t(f,null,{default:o(()=>[t(i,null,{default:o(()=>e[11]||(e[11]=[n("Order Details")])),_:1}),t(p,null,{default:o(()=>e[12]||(e[12]=[n("Please input all the fields")])),_:1})]),_:1}),t($,{class:"space-y-3"},{default:o(()=>[c("div",Ae,[t(I,{label:"Supplier"}),t(s(G),{filter:"",placeholder:"Select a Supplier",modelValue:s(l).supplier_id,"onUpdate:modelValue":e[0]||(e[0]=r=>s(l).supplier_id=r),options:s(h),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(y,null,{default:o(()=>[n(m(s(l).errors.supplier_id),1)]),_:1})]),c("div",Re,[t(I,{label:"Store Branch"}),t(s(G),{filter:"",placeholder:"Select a Store",modelValue:s(l).branch_id,"onUpdate:modelValue":e[1]||(e[1]=r=>s(l).branch_id=r),options:s(pe),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(y,null,{default:o(()=>[n(m(s(l).errors.branch_id),1)]),_:1})]),c("div",Ge,[t(I,{label:"Order Date"}),t(N,{showIcon:"",fluid:"",dateFormat:"yy/mm/dd",modelValue:s(l).order_date,"onUpdate:modelValue":e[2]||(e[2]=r=>s(l).order_date=r),showOnFocus:!1,manualInput:!0,minDate:s(_).minDate,maxDate:s(_).maxDate},null,8,["modelValue","minDate","maxDate"]),t(y,null,{default:o(()=>[n(m(s(l).errors.order_date),1)]),_:1})])]),_:1})]),_:1}),t(A,null,{default:o(()=>[t(f,null,{default:o(()=>[t(i,null,{default:o(()=>e[13]||(e[13]=[n("Add Item")])),_:1}),t(p,null,{default:o(()=>e[14]||(e[14]=[n("Please input all the fields")])),_:1})]),_:1}),t($,{class:"space-y-3"},{default:o(()=>[c("div",Ye,[t(O,null,{default:o(()=>e[15]||(e[15]=[n("Item")])),_:1}),t(s(G),{filter:"",placeholder:"Select an Item",modelValue:s(w),"onUpdate:modelValue":e[3]||(e[3]=r=>Y(w)?w.value=r:null),options:s(me),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(y,null,{default:o(()=>[n(m(s(x).errors.item),1)]),_:1})]),c("div",ze,[t(O,null,{default:o(()=>e[16]||(e[16]=[n("Unit Of Measurement (UOM)")])),_:1}),t(V,{type:"text",disabled:"",modelValue:s(d).unit_of_measurement,"onUpdate:modelValue":e[4]||(e[4]=r=>s(d).unit_of_measurement=r)},null,8,["modelValue"])]),c("div",he,[t(O,null,{default:o(()=>e[17]||(e[17]=[n("Cost")])),_:1}),t(V,{type:"text",disabled:"",modelValue:s(d).cost,"onUpdate:modelValue":e[5]||(e[5]=r=>s(d).cost=r)},null,8,["modelValue"])]),c("div",Je,[t(O,null,{default:o(()=>e[18]||(e[18]=[n("Quantity")])),_:1}),t(V,{type:"number",modelValue:s(d).quantity,"onUpdate:modelValue":e[6]||(e[6]=r=>s(d).quantity=r)},null,8,["modelValue"]),t(y,null,{default:o(()=>[n(m(s(x).errors.quantity),1)]),_:1})])]),_:1}),t(K,{class:"flex justify-end"},{default:o(()=>[t(B,{onClick:xe},{default:o(()=>e[19]||(e[19]=[n(" Add to Orders ")])),_:1})]),_:1})]),_:1})]),t(A,{class:"col-span-2 flex flex-col"},{default:o(()=>[t(f,{class:"flex justify-between"},{default:o(()=>[t(W,{class:"justify-between"},{default:o(()=>[t(i,null,{default:o(()=>e[20]||(e[20]=[n("Items List")])),_:1}),t(W,{class:"gap-2"},{default:o(()=>[t(E,null,{default:o(()=>e[21]||(e[21]=[n(" Overall Total:")])),_:1}),t(Se,null,{default:o(()=>[n(m(s(fe)),1)]),_:1})]),_:1})]),_:1})]),_:1}),t($,{class:"flex-1"},{default:o(()=>[t(we,null,{default:o(()=>[t(ke,null,{default:o(()=>[t(q,null,{default:o(()=>e[22]||(e[22]=[n(" Name ")])),_:1}),t(q,null,{default:o(()=>e[23]||(e[23]=[n(" Code ")])),_:1}),t(q,null,{default:o(()=>e[24]||(e[24]=[n(" Quantity ")])),_:1}),t(q,null,{default:o(()=>e[25]||(e[25]=[n(" Unit ")])),_:1}),t(q,null,{default:o(()=>e[26]||(e[26]=[n(" Cost ")])),_:1}),t(q,null,{default:o(()=>e[27]||(e[27]=[n(" Total Cost ")])),_:1}),t(q,null,{default:o(()=>e[28]||(e[28]=[n(" Action ")])),_:1})]),_:1}),t(Oe,null,{default:o(()=>[(k(!0),L(ue,null,re(s(l).orders,r=>(k(),L("tr",{key:r.item_code},[t(S,null,{default:o(()=>[n(m(r.name),1)]),_:2},1024),t(S,null,{default:o(()=>[n(m(r.inventory_code),1)]),_:2},1024),t(S,null,{default:o(()=>[n(m(r.quantity),1)]),_:2},1024),t(S,null,{default:o(()=>[n(m(r.unit_of_measurement),1)]),_:2},1024),t(S,null,{default:o(()=>[n(m(r.cost),1)]),_:2},1024),t(S,null,{default:o(()=>[n(m(r.total_cost),1)]),_:2},1024),t(S,{class:"flex gap-3"},{default:o(()=>[t(Fe,{onClick:U=>s(Ie)(r.id,r.quantity)},{default:o(()=>e[29]||(e[29]=[n(" Edit Quantity ")])),_:2},1032,["onClick"]),c("button",{onClick:U=>J(r.id),variant:"outline",class:"text-red-500"},[t(X)],8,Ke)]),_:2},1024)]))),128))]),_:1})]),_:1}),t(Le,null,{default:o(()=>[(k(!0),L(ue,null,re(s(l).orders,r=>(k(),se(Ee,{key:r.item_code},{default:o(()=>[t(Be,{title:`${r.name} (${r.inventory_code})`},{default:o(()=>[c("button",{class:"text-red-500 size-5",onClick:U=>ge(r.id)},[t(Te)],8,We),c("button",{class:"text-green-500 size-5",onClick:U=>be(r.id)},[t(Ve)],8,Xe),c("button",{onClick:U=>J(r.id),variant:"outline",class:"text-red-500 size-5"},[t(X)],8,Ze)]),_:2},1032,["title"]),t(E,null,{default:o(()=>[n("UOM: "+m(r.unit_of_measurement),1)]),_:2},1024),t(E,null,{default:o(()=>[n("Quantity: "+m(r.quantity),1)]),_:2},1024),t(E,null,{default:o(()=>[n("Cost: "+m(r.cost),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(K,{class:"flex justify-end"},{default:o(()=>[t(B,{onClick:_e},{default:o(()=>e[30]||(e[30]=[n("Place Order")])),_:1})]),_:1})]),_:1})]),t(ae,{open:s(j),"onUpdate:open":e[8]||(e[8]=r=>Y(j)?j.value=r:null)},{default:o(()=>[t(ne,{class:"sm:max-w-[600px]"},{default:o(()=>[t(te,null,{default:o(()=>[t(Z,null,{default:o(()=>e[31]||(e[31]=[n("Edit Quantity")])),_:1}),t(ee,null,{default:o(()=>e[32]||(e[32]=[n(" Please input all the required fields. ")])),_:1})]),_:1}),t(Pe,null,{default:o(()=>[t(E,null,{default:o(()=>e[33]||(e[33]=[n("Quantity")])),_:1}),t(V,{type:"number",modelValue:s(H).quantity,"onUpdate:modelValue":e[7]||(e[7]=r=>s(H).quantity=r)},null,8,["modelValue"]),t(y,null,{default:o(()=>[n(m(s(H).errors.quantity),1)]),_:1})]),_:1}),t(le,null,{default:o(()=>[t(B,{onClick:s(qe),disabled:s(b),type:"submit",class:"gap-2"},{default:o(()=>[e[34]||(e[34]=n(" Confirm ")),s(b)?(k(),L("span",et,[t(oe)])):de("",!0)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(ae,{open:s(F),"onUpdate:open":e[10]||(e[10]=r=>Y(F)?F.value=r:null)},{default:o(()=>[t(ne,{class:"sm:max-w-[600px]"},{default:o(()=>[t(te,null,{default:o(()=>[t(Z,null,{default:o(()=>e[35]||(e[35]=[n("Import Orders")])),_:1}),t(ee,null,{default:o(()=>e[36]||(e[36]=[n(" Import the excel file of your orders. ")])),_:1})]),_:1}),c("div",tt,[c("div",ot,[t(O,null,{default:o(()=>e[37]||(e[37]=[n("Orders")])),_:1}),t(V,{type:"file",onInput:e[9]||(e[9]=r=>s(C).orders_file=r.target.files[0])}),t(y,null,{default:o(()=>[n(m(s(C).errors.orders_file),1)]),_:1})]),c("div",lt,[t(O,{class:"text-xs"},{default:o(()=>e[38]||(e[38]=[n("Order Templates")])),_:1}),e[39]||(e[39]=c("ul",null,[c("li",{class:"text-xs"},[n(" GSI BAKERY: "),c("a",{class:"text-blue-500 underline",href:"/excel/gsi-bakery-template"},"Click to download")]),c("li",{class:"text-xs"},[n(" GSI OT: "),c("a",{class:"text-blue-500 underline",href:"/excel/gsi-pr-template"},"Click to download")]),c("li",{class:"text-xs"},[n(" PUL: "),c("a",{class:"text-blue-500 underline",href:"/excel/pul-template"},"Click to download")])],-1))])]),t(le,null,{default:o(()=>[t(B,{disabled:s(b),onClick:De,type:"submit",class:"gap-2"},{default:o(()=>[e[40]||(e[40]=n(" Proceed ")),s(b)?(k(),L("span",nt,[t(oe)])):de("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(B,{variant:"outline",class:"text-lg px-7",onClick:s(ce)},{default:o(()=>e[41]||(e[41]=[n(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{it as default};
