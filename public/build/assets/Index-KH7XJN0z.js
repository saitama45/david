import{f as re,x as S,y as le,N as j,l as b,r as _,o as l,c as U,w as d,a as n,g as r,u as k,b as T,h as H,d as o,e as y,t as g,F as h,C as oe,n as M,m as ae,A as G,X as ne}from"./app-DZB5krWT.js";import{l as ie}from"./lodash-gd7BEsaJ.js";import{u as P}from"./useSelectOptions-BNQxcMe3.js";import{u as ue}from"./useToast-D0DYAlSU.js";import{C as ce}from"./check-CkbaCn4Y.js";const de={class:"flex items-center gap-4"},pe={class:"flex items-center gap-4"},me={class:"flex items-center gap-4"},fe={class:"p-2"},ve={class:"flex items-center gap-2 ml-auto"},be={class:"bg-white border rounded-md shadow-sm"},ye={class:"overflow-x-auto max-h-[75vh] overflow-y-auto"},ge={class:"min-w-full"},he={class:"bg-slate-100 sticky top-0 z-10 text-slate-800 shadow-sm"},xe={class:"text-sm"},we=["colspan"],_e={class:"flex justify-center items-center gap-2 font-bold text-blue-800"},Ce={key:0,class:"text-xs font-normal mt-1"},Se={key:0},ke=["colspan"],Ee={key:0,class:"flex items-center justify-end gap-1"},Ve=["onClick"],Fe={__name:"Index",props:{report:{type:Array,required:!0},dynamicHeaders:{type:Array,required:!0},branches:{type:Object,required:!0},suppliers:{type:Object,required:!0},filters:{type:Object,required:!0},totalBranches:{type:Number,required:!0},branchStatuses:{type:Object,required:!0},permissions:{type:Object,required:!0},availableCategories:{type:Array,required:!0}},setup(E){const a=E,{toast:p}=ue(),z=re();P(a.branches);const{options:Q}=P(a.suppliers),u=S(a.filters.order_date||new Date().toISOString().slice(0,10)),m=S(a.filters.supplier_id||"all"),x=S(a.filters.category||"all"),f=S(null),C=S(""),$={mounted:s=>{const e=s.querySelector("input");e?(e.focus(),e.select()):typeof s.focus=="function"&&(s.focus(),typeof s.select=="function"&&s.select())}},V=s=>{var c;const e=(c=a.branchStatuses[s])==null?void 0:c.toLowerCase();return e==="received"||e==="incomplete"},O=s=>s.category==="FINISHED GOOD"?a.permissions.canEditFinishedGood:a.permissions.canEditOther,K=(s,e,c)=>{if(V(e)){p.add({severity:"warn",summary:"Editing Disabled",detail:"Cannot edit commits for this branch as its order has already been processed.",life:4e3});return}if(!O(s)){p.add({severity:"warn",summary:"Permission Denied",detail:"You do not have permission to edit items in this category.",life:4e3});return}f.value={rowIndex:c,field:e},C.value=s[e]},A=()=>{f.value=null,C.value=""},B=()=>{if(!f.value)return;const{rowIndex:s,field:e}=f.value,c=a.report[s],w=parseFloat(C.value);if(isNaN(w)||w<0){p.add({severity:"error",summary:"Invalid Input",detail:"Quantity must be a non-negative number.",life:3e3});return}j.post(route("cs-mass-commits.update-commit"),{order_date:u.value,item_code:c.item_code,brand_code:e,new_quantity:w},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.add({severity:"success",summary:"Success",detail:"Commit quantity updated.",life:3e3}),A()},onError:v=>{const F=Object.values(v)[0]||"An unknown error occurred.";p.add({severity:"error",summary:"Update Failed",detail:F,life:5e3})}})},J=()=>{z.require({message:`Are you sure you want to commit all orders for ${u.value}? This action cannot be undone.`,header:"Confirm All Commits",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-success",rejectClass:"p-button-danger",accept:()=>{j.post(route("cs-mass-commits.confirm-all"),{order_date:u.value,supplier_id:m.value},{onSuccess:()=>{p.add({severity:"success",summary:"Success",detail:"All orders have been committed.",life:3e3})},onError:s=>{const e=Object.values(s)[0]||"An unknown error occurred during the commit process.";p.add({severity:"error",summary:"Commit Failed",detail:e,life:5e3})}})}})},X=s=>{switch(s==null?void 0:s.toUpperCase()){case"RECEIVED":return"bg-green-500 text-white";case"APPROVED":return"bg-teal-500 text-white";case"INCOMPLETE":return"bg-orange-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMMITED":return"bg-blue-500 text-white";case"REJECTED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}};le([u,m,x],ie.throttle(()=>{j.get(route("cs-mass-commits.index"),{order_date:u.value,supplier_id:m.value,category:x.value},{preserveState:!0,preserveScroll:!0,replace:!0})},300));const Y=()=>{u.value=new Date().toISOString().slice(0,10),m.value="all",x.value="all"},W=b(()=>{const s=Object.values(a.branchStatuses);return s.length===0?!1:s.some(e=>(e==null?void 0:e.toLowerCase())!=="received"&&(e==null?void 0:e.toLowerCase())!=="incomplete")}),Z=b(()=>route("cs-mass-commits.export",{order_date:u.value,supplier_id:m.value})),D=b(()=>a.dynamicHeaders.slice(0,4)),I=b(()=>a.dynamicHeaders.slice(4,-2)),N=b(()=>a.dynamicHeaders.slice(-2)),L=b(()=>I.value.length),ee=b(()=>D.value.length+L.value+N.value.length);return(s,e)=>{const c=_("Input"),w=_("Select"),v=_("Button"),F=_("TableHeader"),te=_("TableContainer"),se=_("Layout");return l(),U(se,{heading:"CS Mass Commits",hasExcelDownload:!0,exportRoute:Z.value},{default:d(()=>[n(te,null,{default:d(()=>[n(F,{class:"flex-wrap"},{default:d(()=>[r("div",de,[e[5]||(e[5]=r("label",{for:"order_date",class:"text-sm font-medium text-gray-700"},"Date:",-1)),n(c,{id:"order_date",type:"date",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),class:"w-48"},null,8,["modelValue"])]),r("div",pe,[e[6]||(e[6]=r("label",{for:"supplier_filter",class:"text-sm font-medium text-gray-700"},"Supplier:",-1)),n(w,{id:"supplier_filter",filter:"",placeholder:"Select a Supplier",modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),options:k(Q),optionLabel:"label",optionValue:"value",class:"w-64"},null,8,["modelValue","options"])]),r("div",me,[e[8]||(e[8]=r("label",{for:"category_filter",class:"text-sm font-medium text-gray-700"},"Category:",-1)),n(w,{id:"category_filter",filter:"",placeholder:"All Categories",modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),options:a.availableCategories.map(t=>({label:t,value:t})),optionLabel:"label",optionValue:"value",class:"w-64"},{header:d(()=>[r("div",fe,[n(v,{text:"",onClick:e[2]||(e[2]=t=>x.value="all"),class:"w-full text-left"},{default:d(()=>e[7]||(e[7]=[T("All Categories")])),_:1})])]),_:1},8,["modelValue","options"])]),r("div",ve,[n(v,{onClick:Y,variant:"outline"},{default:d(()=>e[9]||(e[9]=[T(" Reset Filters ")])),_:1}),W.value?(l(),U(v,{key:0,onClick:J,variant:"destructive"},{default:d(()=>e[10]||(e[10]=[T(" Confirm All Commits ")])),_:1})):H("",!0)])]),_:1}),r("div",be,[r("div",ye,[r("table",ge,[r("thead",he,[r("tr",xe,[(l(!0),o(h,null,y(D.value,t=>(l(),o("th",{key:t.field,rowspan:"2",class:"px-4 py-3 text-left whitespace-nowrap font-bold border-b-2 border-slate-200 bg-slate-200"},g(t.label),1))),128)),r("th",{colspan:L.value,class:"px-4 py-4 text-center bg-blue-100 border-b-2 border-slate-200"},[r("div",_e,[e[11]||(e[11]=r("span",null,"BRANCH QUANTITIES",-1)),n(k(oe),{class:"w-4 h-4"})])],8,we),(l(!0),o(h,null,y(N.value,t=>(l(),o("th",{key:t.field,rowspan:"2",class:"px-4 py-3 text-right whitespace-nowrap font-bold border-b-2 border-slate-200 bg-slate-200"},g(t.label),1))),128))]),r("tr",null,[(l(!0),o(h,null,y(I.value,t=>(l(),o("th",{key:t.field,class:"px-4 py-2 text-center whitespace-nowrap font-semibold border-b-2 border-slate-200 bg-blue-50"},[r("div",null,g(t.label.replace(" Qty","")),1),a.branchStatuses[t.field]?(l(),o("div",Ce,[r("span",{class:M([X(a.branchStatuses[t.field]),"px-2 py-1 rounded-full shadow-sm"])},g(a.branchStatuses[t.field].toUpperCase()),3)])):H("",!0)]))),128))])]),r("tbody",null,[E.report.length===0?(l(),o("tr",Se,[r("td",{colspan:ee.value,class:"text-center p-4"},"No data available for the selected filters.",8,ke)])):H("",!0),(l(!0),o(h,null,y(E.report,(t,q)=>(l(),o("tr",{key:q,class:"border-t"},[(l(!0),o(h,null,y(D.value,i=>(l(),o("td",{key:i.field,class:"px-4 py-3 text-left whitespace-nowrap"},g(t[i.field]),1))),128)),(l(!0),o(h,null,y(I.value,i=>(l(),o("td",{key:i.field,class:"px-4 py-3 text-right whitespace-nowrap"},[f.value&&f.value.rowIndex===q&&f.value.field===i.field?(l(),o("div",Ee,[ae(n(c,{type:"number",modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=R=>C.value=R),class:"w-24 text-right py-1",onKeyup:[G(B,["enter"]),G(A,["esc"])]},null,8,["modelValue"]),[[$]]),n(v,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:B},{default:d(()=>[n(k(ce),{class:"h-4 w-4"})]),_:1}),n(v,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:A},{default:d(()=>[n(k(ne),{class:"h-4 w-4"})]),_:1})])):(l(),o("div",{key:1,onClick:R=>K(t,i.field,q),class:M(["p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400":!V(i.field)&&O(t),"cursor-not-allowed bg-gray-50 text-gray-500":V(i.field)||!O(t)}])},g(t[i.field]),11,Ve))]))),128)),(l(!0),o(h,null,y(N.value,i=>(l(),o("td",{key:i.field,class:"px-4 py-3 text-right whitespace-nowrap"},g(t[i.field]),1))),128))]))),128))])])])])]),_:1})]),_:1},8,["exportRoute"])}}};export{Fe as default};
