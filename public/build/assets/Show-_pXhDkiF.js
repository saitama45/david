import{u as fe}from"./useBackButton-DYna6UI2.js";import{f as _e,x as D,T as P,y as ce,r as a,o as m,c as v,w as o,a as t,g as _,b as l,t as d,n as ye,h as b,d as q,e as z,F as X,u as i,M as ve,P as be,i as xe}from"./app-p8ycGfai.js";import{u as ge}from"./useToast-BAk2IYqi.js";import{u as Ce}from"./useEditQuantity-BAxrcitu.js";const ke={class:"flex flex-col gap-5"},Te={class:"sm:flex-row flex flex-col gap-5"},De={class:"text-gray-700 text-sm"},qe={class:"font-bold"},Oe={class:"text-gray-700 text-sm"},Fe={class:"font-bold"},Ie={class:"text-gray-700 text-sm"},we=["onClick"],Be=["onClick"],Ee={key:0},Ve={key:0},Ue={__name:"Show",props:{order:{type:Object},orderedItems:{type:Object}},setup(u){_e();const{toast:S}=ge(),{backButton:J}=fe(route("orders-approval.index")),H=u;D(null);const G=s=>{switch(console.log(s.toUpperCase()),s.toUpperCase()){case"APPROVED":return"bg-green-500 text-white";case"REJECTED":return"bg-red-400 text-white";case"COMMITED":return"bg-blue-400 text-white";default:return"bg-yellow-500 text-white"}};P({remarks:null});const p=D(!1),O=D(!1),j=D(!1);ce(O,s=>{s||(p.value=!1,f.reset(),f.clearErrors())});const f=P({id:null,remarks:null,updatedOrderedItemDetails:null}),K=s=>{O.value=!0,f.id=s},W=()=>{p.value=!0,f.updatedOrderedItemDetails=c.value,f.post(route("cs-approvals.approve"),{onSuccess:()=>{S.add({severity:"success",summary:"Success",detail:"Order Confirmed Successfully.",life:3e3}),p.value=!1},onError:()=>{p.value=!1}})},Y=()=>{p.value=!0,f.post(route("cs-approvals.reject"),{onSuccess:()=>{S.add({severity:"success",summary:"Success",detail:"Order Reject Successfully.",life:3e3}),p.value=!1},onError:()=>{p.value=!1}})},c=D([]);H.orderedItems.forEach(s=>c.value.push({id:s.id,quantity_ordered:s.quantity_ordered,quantity_approved:s.quantity_approved,item_cost:s.cost_per_quantity,total_cost:s.total_cost}));const Z=s=>{const e=c.value.findIndex(r=>r.id===s);if(e!==-1){const r=c.value[e];r.quantity_approved>0&&(r.quantity_approved=Number(parseFloat(r.quantity_approved-.1).toFixed(2)),r.total_cost=parseFloat(r.item_cost*r.quantity_approved).toFixed(2))}},h=s=>{const e=c.value.findIndex(r=>r.id===s);if(e!==-1){const r=c.value[e];r.quantity_approved=Number(parseFloat(r.quantity_approved+.1).toFixed(2)),r.total_cost=parseFloat(r.item_cost*r.quantity_approved).toFixed(2)}},{isEditQuantityModalOpen:F,formQuantity:k,editOrderQuantity:ee}=Ce(null,c,H.order),te=(s,e)=>{k.id=s,k.quantity=e,F.value=!0};return(s,e)=>{const r=a("Badge"),T=a("Button"),N=a("DivFlexCenter"),oe=a("TableHeader"),x=a("TH"),le=a("TableHead"),g=a("TD"),ne=a("LinkButton"),ae=a("TableBody"),se=a("Table"),re=a("MobileTableHeading"),I=a("LabelXS"),ue=a("MobileTableRow"),de=a("MobileTableContainer"),ie=a("TableContainer"),w=a("DialogTitle"),B=a("DialogDescription"),E=a("DialogHeader"),$=a("Label"),A=a("Textarea"),V=a("FormError"),M=a("InputContainer"),L=a("Loading"),Q=a("DialogFooter"),R=a("DialogContent"),U=a("Dialog"),pe=a("Input"),me=a("Layout");return m(),v(me,{heading:"Order Details"},{default:o(()=>[t(ie,null,{default:o(()=>[_("section",ke,[_("section",Te,[_("span",De,[e[7]||(e[7]=l(" Order Number: ")),_("span",qe,d(u.order.order_number),1)]),_("span",Oe,[e[8]||(e[8]=l(" Order Date: ")),_("span",Fe,d(u.order.order_date),1)]),_("span",Ie,[e[9]||(e[9]=l(" Status: ")),t(r,{class:ye(G(u.order.order_status.toUpperCase()))},{default:o(()=>[l(d(u.order.order_status.toUpperCase()),1)]),_:1},8,["class"])])]),t(N,{class:"gap-5"},{default:o(()=>[u.order.order_status==="approved"?(m(),v(T,{key:0,class:"bg-green-500 hover:bg-green-300",onClick:e[0]||(e[0]=n=>K(u.order.id))},{default:o(()=>e[10]||(e[10]=[l(" Confirm Order ")])),_:1})):b("",!0)]),_:1})]),t(oe),t(se,null,{default:o(()=>[t(le,null,{default:o(()=>[t(x,null,{default:o(()=>e[11]||(e[11]=[l(" Item Code ")])),_:1}),t(x,null,{default:o(()=>e[12]||(e[12]=[l(" Name ")])),_:1}),t(x,null,{default:o(()=>e[13]||(e[13]=[l(" Unit ")])),_:1}),t(x,null,{default:o(()=>e[14]||(e[14]=[l(" Quantity ")])),_:1}),u.order.order_status==="committed"?(m(),v(x,{key:0},{default:o(()=>e[15]||(e[15]=[l("Commited")])),_:1})):b("",!0),t(x,null,{default:o(()=>e[16]||(e[16]=[l(" Cost ")])),_:1}),t(x,null,{default:o(()=>e[17]||(e[17]=[l(" Total Cost ")])),_:1})]),_:1}),t(ae,null,{default:o(()=>[(m(!0),q(X,null,z(u.orderedItems,n=>(m(),q("tr",{key:u.order.id},[t(g,null,{default:o(()=>[l(d(n.supplier_item.ItemCode),1)]),_:2},1024),t(g,null,{default:o(()=>[l(d(n.supplier_item.item_name),1)]),_:2},1024),t(g,null,{default:o(()=>[l(d(n.supplier_item.uom),1)]),_:2},1024),t(g,{class:"flex items-center gap-3"},{default:o(()=>{var y;return[l(d(((y=c.value.find(C=>C.id===n.id))==null?void 0:y.quantity_approved)||0)+" ",1),u.order.order_status==="approved"?(m(),v(ne,{key:0,onClick:C=>te(n.id,n.quantity_approved)},{default:o(()=>e[18]||(e[18]=[l(" Edit Quantity ")])),_:2},1032,["onClick"])):b("",!0)]}),_:2},1024),u.order.order_status==="committed"?(m(),v(g,{key:0},{default:o(()=>[l(d(n.quantity_commited),1)]),_:2},1024)):b("",!0),t(g,null,{default:o(()=>[l(d(parseFloat(n.cost_per_quantity).toFixed(2)),1)]),_:2},1024),t(g,null,{default:o(()=>{var y;return[l(d(((y=c.value.find(C=>C.id===n.id))==null?void 0:y.total_cost)||0),1)]}),_:2},1024)]))),128))]),_:1})]),_:1}),t(de,null,{default:o(()=>[(m(!0),q(X,null,z(u.orderedItems,n=>(m(),v(ue,{key:u.order.id},{default:o(()=>[t(re,{title:`${n.supplier_item.item_name} (${n.supplier_item.ItemCode})`},{default:o(()=>[u.order.order_status==="pending"?(m(),v(N,{key:0,class:"gap-2"},{default:o(()=>[_("button",{onClick:y=>Z(n.id)},[t(i(ve),{class:"size-4 text-red-500"})],8,we),_("button",{onClick:y=>h(n.id)},[t(i(be),{class:"size-4 text-green-500"})],8,Be)]),_:2},1024)):b("",!0)]),_:2},1032,["title"]),t(I,null,{default:o(()=>[l("UOM: "+d(n.supplier_item.uom),1)]),_:2},1024),t(I,null,{default:o(()=>{var y;return[l("Quantity: "+d(((y=c.value.find(C=>C.id===n.id))==null?void 0:y.quantity_approved)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(T,{variant:"outline",class:"text-lg px-7",onClick:i(J)},{default:o(()=>e[19]||(e[19]=[l(" Back ")])),_:1},8,["onClick"]),t(U,{open:O.value,"onUpdate:open":e[2]||(e[2]=n=>O.value=n)},{default:o(()=>[t(R,{class:"sm:max-w-[600px]"},{default:o(()=>[t(E,null,{default:o(()=>[t(w,null,{default:o(()=>e[20]||(e[20]=[l("Confirm Order")])),_:1}),t(B)]),_:1}),t(M,null,{default:o(()=>[t($,{class:"text-xs"},{default:o(()=>e[21]||(e[21]=[l("Remarks")])),_:1}),t(A,{modelValue:i(f).remarks,"onUpdate:modelValue":e[1]||(e[1]=n=>i(f).remarks=n)},null,8,["modelValue"]),t(V,null,{default:o(()=>[l(d(i(f).errors.remarks),1)]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(T,{disabled:p.value,onClick:W,type:"submit",class:"gap-2"},{default:o(()=>[e[22]||(e[22]=l(" Commit ")),p.value?(m(),q("span",Ee,[t(L)])):b("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1}),e[23]||(e[23]=_("div",{class:"space-y-5"},null,-1))]),_:1},8,["open"]),t(U,{open:j.value,"onUpdate:open":e[4]||(e[4]=n=>j.value=n)},{default:o(()=>[t(R,{class:"sm:max-w-[600px]"},{default:o(()=>[t(E,null,{default:o(()=>[t(w,null,{default:o(()=>e[24]||(e[24]=[l("Reject Order")])),_:1}),t(B)]),_:1}),t(M,null,{default:o(()=>[t($,{class:"text-xs"},{default:o(()=>e[25]||(e[25]=[l("Remarks")])),_:1}),t(A,{modelValue:i(f).remarks,"onUpdate:modelValue":e[3]||(e[3]=n=>i(f).remarks=n)},null,8,["modelValue"]),t(V,null,{default:o(()=>[l(d(i(f).errors.remarks),1)]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(T,{disabled:p.value,onClick:Y,type:"submit",class:"gap-2"},{default:o(()=>[e[26]||(e[26]=l(" Reject ")),_("span",null,[p.value?(m(),v(L,{key:0})):b("",!0)])]),_:1},8,["disabled"])]),_:1})]),_:1}),e[27]||(e[27]=_("div",{class:"space-y-5"},null,-1))]),_:1},8,["open"]),t(U,{open:i(F),"onUpdate:open":e[6]||(e[6]=n=>xe(F)?F.value=n:null)},{default:o(()=>[t(R,{class:"sm:max-w-[600px]"},{default:o(()=>[t(E,null,{default:o(()=>[t(w,null,{default:o(()=>e[28]||(e[28]=[l("Edit Quantity")])),_:1}),t(B,null,{default:o(()=>e[29]||(e[29]=[l(" Please input all the required fields. ")])),_:1})]),_:1}),t(M,null,{default:o(()=>[t(I,null,{default:o(()=>e[30]||(e[30]=[l("Quantity")])),_:1}),t(pe,{type:"number",modelValue:i(k).quantity,"onUpdate:modelValue":e[5]||(e[5]=n=>i(k).quantity=n)},null,8,["modelValue"]),t(V,null,{default:o(()=>[l(d(i(k).errors.quantity),1)]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(T,{onClick:i(ee),disabled:p.value,type:"submit",class:"gap-2"},{default:o(()=>[e[31]||(e[31]=l(" Confirm ")),p.value?(m(),q("span",Ve,[t(L)])):b("",!0)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}};export{Ue as default};
