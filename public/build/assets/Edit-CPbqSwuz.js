import{f as Y,T as Z,x as W,l as k,r as w,o as n,d as i,a as _,u as X,Z as j,w as T,b as ee,g as t,t as l,F as b,e as g,h,m as O,z as U,A as L,N as te}from"./app-Drfr7wPO.js";import{u as re}from"./useToast-Blb7EynO.js";const se={class:"bg-white border rounded-md shadow-sm p-6"},oe={class:"space-y-4"},ae={class:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4"},de={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},le={class:"text-lg font-bold text-blue-700"},ne={class:"text-lg font-bold text-blue-600"},ie={class:"text-sm font-medium text-gray-700"},ue={key:0,class:"mt-6 overflow-x-auto"},ce={class:"min-w-full border-collapse border border-gray-300 text-sm"},pe={class:"bg-gray-100"},ye=["colspan"],be={class:"text-xs font-bold"},ge={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},me={key:1,class:"text-xs text-gray-500 mt-1"},xe={class:"bg-gray-200"},fe={class:"text-xs"},_e={class:"text-xs"},he={class:"border border-gray-300 px-3 py-2"},ve={class:"border border-gray-300 px-3 py-2"},Ee={class:"border border-gray-300 px-3 py-2 text-center"},we={class:"border border-gray-300 px-3 py-2 text-right"},Te=["onUpdate:modelValue"],ke={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ae={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ne={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ce={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-green-50"},Ie={class:"bg-gray-700 text-white font-bold"},Se=["colspan"],De={class:"border border-gray-300 px-3 py-2 text-right"},Fe={key:1,class:"mt-6 overflow-x-auto"},Re={class:"min-w-full border-collapse border border-gray-300 text-sm"},Be={class:"bg-white"},Me={class:"border border-gray-300 px-3 py-2"},Oe={class:"border border-gray-300 px-3 py-2"},Ue={class:"border border-gray-300 px-3 py-2 text-center font-semibold"},Le={key:0},Ve={class:"bg-gray-200"},$e={class:"border border-gray-300 px-3 py-2 font-bold text-base",colspan:"3"},Pe={class:"border border-gray-300 px-3 py-2",colspan:"2"},Ge={class:"font-bold"},qe={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},Ke={key:1,class:"text-xs text-gray-500 mt-1"},Qe={class:"border border-gray-300 px-2 py-1"},Je=["onUpdate:modelValue","min","placeholder","onBlur"],He={class:"bg-blue-50 font-semibold"},ze={class:"border border-gray-300 px-3 py-2 text-center"},Ye={class:"bg-gray-700 text-white font-bold"},Ze={class:"border border-gray-300 px-3 py-2 text-center"},je={__name:"Edit",props:{batch_number:{type:String,required:!0},variant:{type:String,default:null},date_from:{type:String,default:null},date_to:{type:String,default:null},stores:{type:Array,default:()=>[]},dates:{type:Array,default:()=>[]},sap_item:{type:Object,default:null},existing_orders:{type:Object,default:()=>({})},status:{type:String,default:null},supplier_items:{type:Array,default:()=>[]}},setup(p){const a=p,{toast:v}=re(),V=Y(),A=()=>{te.get(route("dts-mass-orders.index"))},$=()=>{let r=!1;if(a.variant==="FRUITS AND VEGETABLES")for(const e in d.value){for(const o in d.value[e]){for(const u in d.value[e][o])if(d.value[e][o][u]&&parseFloat(d.value[e][o][u])>0){r=!0;break}if(r)break}if(r)break}else for(const e in d.value){for(const o in d.value[e])if(d.value[e][o]&&parseFloat(d.value[e][o])>0){r=!0;break}if(r)break}if(!r){v.add({severity:"warn",summary:"No Orders",detail:"Please enter at least one order quantity before updating orders.",life:3e3});return}V.require({message:"Are you sure you want to update these orders? This will replace all existing orders in this batch.",header:"Confirm Order Update",icon:"pi pi-exclamation-triangle",accept:()=>{P()},reject:()=>{},acceptClass:"p-button-success",rejectClass:"p-button-danger"})},m=Z({variant:a.variant,orders:{},sap_item:a.sap_item,supplier_items:a.supplier_items||[]}),P=()=>{a.variant==="FRUITS AND VEGETABLES"?(m.orders=d.value,m.supplier_items=a.supplier_items,m.sap_item=null):(m.orders=d.value,m.sap_item=a.sap_item),m.variant=a.variant,m.put(route("dts-mass-orders.update",a.batch_number),{onSuccess:()=>{v.add({severity:"success",summary:"Orders Updated",detail:"Your mass orders have been successfully updated.",life:3e3})},onError:r=>{v.add({severity:"error",summary:"Error",detail:r.error||"Failed to update orders. Please try again.",life:5e3})}})},N=r=>{if(!r)return"Not Selected";try{const[e,o,u]=r.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o,10)-1]} ${parseInt(u,10)}, ${e}`}catch{return r}},d=W({}),C=(r,e)=>!r.delivery_schedule_ids||!e.delivery_schedule_id?!1:r.delivery_schedule_ids.includes(e.delivery_schedule_id);a.variant==="FRUITS AND VEGETABLES"?a.supplier_items.forEach(r=>{d.value[r.id]={},a.dates.forEach(e=>{d.value[r.id][e.date]={},a.stores.forEach(o=>{var y,f;const u=((f=(y=a.existing_orders[r.id])==null?void 0:y[e.date])==null?void 0:f[o.id])||"";d.value[r.id][e.date][o.id]=u})})}):a.dates.forEach(r=>{d.value[r.date]={},a.stores.forEach(e=>{var u;const o=((u=a.existing_orders[r.date])==null?void 0:u[e.id])||"";d.value[r.date][e.id]=o})});const I=r=>{let e=0;return a.stores.forEach(o=>{var y;const u=parseFloat(((y=d.value[r])==null?void 0:y[o.id])||0);e+=isNaN(u)?0:u}),e},G=k(()=>{let r=0;return a.dates.forEach(e=>{r+=I(e.date)}),r}),q=r=>a.stores.filter(e=>C(e,r)),E=r=>a.variant==="FRUITS AND VEGETABLES"?a.dates.filter(e=>a.supplier_items.some(o=>{var u,y;return((y=(u=a.existing_orders[o.id])==null?void 0:u[e.date])==null?void 0:y[r.id])!==void 0})):a.dates.filter(e=>C(r,e)),K=k(()=>{let r=0;return a.stores.forEach(e=>{r+=E(e).length}),r}),S=r=>{let e=0;return d.value[r]?(Object.keys(d.value[r]).forEach(o=>{Object.keys(d.value[r][o]).forEach(u=>{const y=parseFloat(d.value[r][o][u]||0);e+=isNaN(y)?0:y})}),e):0},Q=()=>10,D=r=>S(r)*1.1,F=(r,e)=>D(r)*e,J=k(()=>{let r=0;return a.supplier_items.forEach(e=>{r+=F(e.id,e.price)}),r}),R=r=>{const e=Array.from(document.querySelectorAll('input[type="number"]')),o=e.indexOf(r.target);o>-1&&o<e.length-1&&(r.preventDefault(),e[o+1].focus(),e[o+1].select())},H=(r,e,o)=>{if(a.variant==="ICE CREAM"){const u=parseFloat(o);if(o!==""&&o!==null&&!isNaN(u)&&u>0&&u<5)return v.add({severity:"warn",summary:"Invalid Quantity",detail:"ICE CREAM orders must be at least 5 gallons (GAL 3.8)",life:4e3}),d.value[r][e]="",!1}return!0};return(r,e)=>{const o=w("Button"),u=w("TableHeader"),y=w("TableContainer"),f=w("Layout");return n(),i(b,null,[_(X(j),{title:"Edit DTS Mass Order"}),_(f,{heading:"Edit DTS Mass Order"},{default:T(()=>[_(y,null,{default:T(()=>{var B,M;return[_(u,null,{default:T(()=>[_(o,{onClick:A,variant:"outline",class:"text-black border-black hover:bg-gray-100"},{default:T(()=>e[0]||(e[0]=[ee(" Back ")])),_:1})]),_:1}),t("div",se,[t("div",oe,[t("div",ae,[t("div",de,[t("div",null,[e[1]||(e[1]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Batch Number",-1)),t("p",le,l(p.batch_number),1)]),t("div",null,[e[2]||(e[2]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Variant",-1)),t("p",ne,l(p.variant),1)]),t("div",null,[e[3]||(e[3]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Date Range",-1)),t("p",ie,l(N(p.date_from))+" - "+l(N(p.date_to)),1)])])]),p.variant==="FRUITS AND VEGETABLES"?(n(),i("div",ue,[t("table",ce,[t("thead",null,[t("tr",pe,[e[4]||(e[4]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"100px"}},"ITEM CODE",-1)),e[5]||(e[5]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"200px"}},"ITEM NAME",-1)),e[6]||(e[6]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"UOM",-1)),e[7]||(e[7]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"PRICE",-1)),(n(!0),i(b,null,g(p.stores,s=>(n(),i("th",{key:`store-${s.id}`,colspan:E(s).length,class:"border border-gray-300 px-2 py-2 font-semibold text-center bg-blue-50",style:{"min-width":"120px"}},[t("div",be,l(s.name),1),s.brand_code?(n(),i("div",ge,l(s.brand_code),1)):h("",!0),s.complete_address?(n(),i("div",me,l(s.complete_address),1)):h("",!0)],8,ye))),128)),e[8]||(e[8]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL ORDER",-1)),e[9]||(e[9]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"BUFFER",-1)),e[10]||(e[10]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL PO",-1)),e[11]||(e[11]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-green-100 align-middle"},"TOTAL PRICE",-1))]),t("tr",xe,[(n(!0),i(b,null,g(p.stores,s=>(n(),i(b,{key:`dates-${s.id}`},[(n(!0),i(b,null,g(E(s),c=>(n(),i("th",{key:`date-${s.id}-${c.date}`,class:"border border-gray-300 px-2 py-2 font-semibold text-center"},[t("div",fe,l(c.day_of_week),1),t("div",_e,l(c.display.split("- ")[1]),1)]))),128))],64))),128))])]),t("tbody",null,[(n(!0),i(b,null,g(p.supplier_items,s=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",he,l(s.item_code),1),t("td",ve,l(s.item_name),1),t("td",Ee,l(s.uom),1),t("td",we,l(s.price.toFixed(2)),1),(n(!0),i(b,null,g(p.stores,c=>(n(),i(b,{key:`body-${c.id}`},[(n(!0),i(b,null,g(E(c),x=>(n(),i("td",{key:`${s.id}-${c.id}-${x.date}`,class:"border border-gray-300 px-1 py-1"},[O(t("input",{"onUpdate:modelValue":z=>d.value[s.id][x.date][c.id]=z,type:"number",step:"0.01",min:"0",class:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",onKeydown:L(R,["enter"])},null,40,Te),[[U,d.value[s.id][x.date][c.id]]])]))),128))],64))),128)),t("td",ke,l(S(s.id).toFixed(2)),1),t("td",Ae,l(Q())+"% ",1),t("td",Ne,l(D(s.id).toFixed(2)),1),t("td",Ce,l(F(s.id,s.price).toFixed(2)),1)]))),128)),t("tr",Ie,[e[12]||(e[12]=t("td",{colspan:"4",class:"border border-gray-300 px-3 py-2 text-right"},"TOTAL PRICE",-1)),t("td",{colspan:K.value+3,class:"border border-gray-300 px-3 py-2"},null,8,Se),t("td",De,l(J.value.toFixed(2)),1)])])])])):(n(),i("div",Fe,[t("table",Re,[t("thead",null,[e[13]||(e[13]=t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"120px"}}," ITEM CODE "),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"200px"}}," ITEM DESCRIPTION "),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-center",style:{"min-width":"100px"}}," UOM ")],-1)),t("tr",Be,[t("td",Me,l(((B=p.sap_item)==null?void 0:B.item_code)||""),1),t("td",Oe,l(((M=p.sap_item)==null?void 0:M.item_description)||""),1),t("td",Ue,[p.sap_item?(n(),i("span",Le,l(p.sap_item.alt_uom),1)):h("",!0)])])]),t("tbody",null,[(n(!0),i(b,null,g(p.dates,s=>(n(),i(b,{key:s.date},[t("tr",Ve,[t("td",$e,l(s.display),1)]),e[15]||(e[15]=t("tr",{class:"bg-gray-50"},[t("td",{class:"border border-gray-300 px-3 py-2 font-semibold",colspan:"2"}," Store Name "),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"}," Quantity ")],-1)),(n(!0),i(b,null,g(q(s),c=>(n(),i("tr",{key:`${s.date}-${c.id}`,class:"hover:bg-gray-50"},[t("td",Pe,[t("div",null,[t("div",Ge,l(c.name),1),c.brand_code?(n(),i("div",qe,l(c.brand_code),1)):h("",!0),c.complete_address?(n(),i("div",Ke,l(c.complete_address),1)):h("",!0)])]),t("td",Qe,[O(t("input",{"onUpdate:modelValue":x=>d.value[s.date][c.id]=x,type:"number",step:"0.01",min:p.variant==="ICE CREAM"?"5":"0",class:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",placeholder:p.variant==="ICE CREAM"?"Min: 5":"0",onBlur:x=>H(s.date,c.id,d.value[s.date][c.id]),onKeydown:L(R,["enter"])},null,40,Je),[[U,d.value[s.date][c.id]]])])]))),128)),t("tr",He,[e[14]||(e[14]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"}," TOTAL ",-1)),t("td",ze,l(I(s.date)),1)])],64))),128)),t("tr",Ye,[e[16]||(e[16]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"}," GRAND TOTAL ",-1)),t("td",Ze,l(G.value),1)])])])])),t("div",{class:"flex justify-end gap-3 mt-6"},[t("button",{onClick:A,class:"px-4 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"}," Cancel "),t("button",{onClick:$,class:"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"}," Update Orders ")])])])]}),_:1})]),_:1})],64)}}};export{je as default};
