import{u as de}from"./useSelectOptions-BWAyP7Dg.js";import{f as Fe,x as U,Q as G,y as L,N as X,T as ie,l as qe,r as s,o as m,d as C,a as l,w as t,b as o,u as a,F as B,e as Q,t as d,g as z,h as T,i as Ie,c as v}from"./app-Drfr7wPO.js";import{l as Oe}from"./lodash-IPPPM5x9.js";import{u as Ee}from"./useToast-Blb7EynO.js";import{u as Me}from"./useAuth-CGUY0YG2.js";const Ae=["href"],Be=["href"],He=["href"],$e={key:0,class:"ml-1"},Ge={__name:"Index",props:{products:{type:Object,required:!0},branches:{type:Object,required:!0},costCenters:{type:Object,required:!0}},setup(F){Fe();const{toast:g}=Ee(),{options:q}=de(F.branches),{options:me}=de(F.costCenters),p=U(G().props.filters.branchId||q.value[0].value);let S=U(G().props.filters.search);L(p,r=>{console.log(G()),X.get(route("stock-management.index"),{branchId:r,search:S.value,page:1},{preserveScroll:!0,preserveState:!0,replace:!0})}),L(S,Oe.throttle(function(r){X.get(route("stock-management.index"),{search:r,branchId:p.value,page:1},{preserveScroll:!0,preserveState:!0,replace:!0})},500));const I=U(!1),O=U(!1),u=ie({id:null,store_branch_id:null,cost_center_id:null,quantity:null,unit_cost:null,transaction_date:null,remarks:null});L(I,r=>{r||(u.reset(),u.clearErrors())}),L(O,r=>{r||(u.reset(),u.clearErrors())});const J=r=>{u.id=r,u.store_branch_id=p.value,I.value=!0},K=r=>{u.id=r,u.store_branch_id=p.value,O.value=!0},fe=()=>{u.post(route("stock-management.log-usage"),{onSuccess:()=>{g.add({severity:"success",summary:"Success",detail:"Usage logged Successfully.",life:5e3}),I.value=!1},onError:()=>{g.add({severity:"error",summary:"Error",detail:"An error occurred while trying to log the usage.",life:5e3})}})},pe=()=>{u.post(route("stock-management.add-quantity"),{onSuccess:()=>{g.add({severity:"success",summary:"Success",detail:"Quantity added Successfully.",life:1e4}),O.value=!1},onError:()=>{g.add({severity:"error",summary:"Error",detail:"An error occurred while trying to add quantity.",life:1e4})}})},W=(r,e)=>{X.get(route("stock-management.show",r),{branchId:e},{})},{hasAccess:D}=Me(),_e=qe(()=>route("stock-management.export",{search:S.value,branchId:p.value})),E=U(!1),ce=()=>{E.value=!0},ge=[{label:"Add Quantity",value:"add-quantity"},{label:"Log Usage",value:"log-usage"},{label:"SOH Update",value:"soh-update"}],_=ie({action:null,branch:p.value,file:null});U(null),L(()=>_.action,r=>{console.log(r)});const H=U(!1),ye=()=>{const r=_.action=="add-quantity"?"stock-management.import-add":_.action=="log-usage"?"stock-management.import-log-usage":"stock-management.import-soh-update";_.branch=p.value,H.value=!0,axios.post(route(r),_,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e),e.data.errors&&e.data.errors.length>0?(e.data.errors.forEach(y=>{g.add({severity:"error",summary:"Import Error",detail:y,life:5e3})}),e.data.imported&&e.data.imported.length>0&&g.add({severity:"warning",summary:"Partial Import",detail:`Successfully imported ${e.data.imported.length} rows`,life:3e3})):g.add({severity:"success",summary:"Success",detail:"Stock Updated Successfully.",life:3e3})}).catch(e=>{var y,w;console.log(e),g.add({severity:"error",summary:"Error",detail:((w=(y=e.response)==null?void 0:y.data)==null?void 0:w.message)||"An unexpected error occurred during import.",life:3e3})}).finally(()=>{E.value=!1,H.value=!1})};L(E,r=>{r||(_.reset(),_.clearErrors())});const Y=r=>(console.log(`Product ID: ${r.id}, SOH: ${r.stock_on_hand}, Name: ${r.name}`),parseFloat(r.stock_on_hand).toFixed(2)),Z=r=>(console.log(`Product ID: ${r.id}, Recorded Used: ${r.recorded_used}, Name: ${r.name}`),parseFloat(r.recorded_used).toFixed(2));return(r,e)=>{const y=s("DialogTitle"),w=s("DialogDescription"),R=s("DialogHeader"),N=s("Label"),h=s("SelectValue"),ee=s("SelectTrigger"),be=s("SelectLabel"),le=s("SelectItem"),te=s("SelectGroup"),ne=s("SelectContent"),oe=s("SelectShad"),f=s("InputContainer"),$=s("Select"),k=s("Input"),i=s("LabelXS"),ve=s("Loading"),b=s("Button"),M=s("DivFlexCenter"),P=s("DialogContent"),j=s("Dialog"),Se=s("SearchBar"),x=s("TH"),ke=s("TableHead"),V=s("TD"),ae=s("ShowButton"),xe=s("TableBody"),Ve=s("Table"),Ue=s("MobileTableHeading"),Ce=s("MobileTableRow"),Te=s("MobileTableContainer"),De=s("Pagination"),we=s("TableContainer"),c=s("FormError"),ue=s("Textarea"),se=s("DivFlexCol"),re=s("DialogFooter"),Le=s("Layout");return m(),C(B,null,[l(j,{open:E.value,"onUpdate:open":e[3]||(e[3]=n=>E.value=n)},{default:t(()=>[l(P,{class:"sm:max-w-[600px]"},{default:t(()=>[l(R,null,{default:t(()=>[l(y,null,{default:t(()=>e[18]||(e[18]=[o("Update Stock")])),_:1}),l(w,null,{default:t(()=>e[19]||(e[19]=[o(" Please input all the required fields. ")])),_:1})]),_:1}),l(f,null,{default:t(()=>[l(N,null,{default:t(()=>e[20]||(e[20]=[o("Action")])),_:1}),l(oe,{modelValue:a(_).action,"onUpdate:modelValue":e[0]||(e[0]=n=>a(_).action=n)},{default:t(()=>[l(ee,null,{default:t(()=>[l(h,{placeholder:"Select from options"})]),_:1}),l(ne,null,{default:t(()=>[l(te,null,{default:t(()=>[l(be,null,{default:t(()=>e[21]||(e[21]=[o("Options")])),_:1}),(m(),C(B,null,Q(ge,n=>l(le,{value:n.value},{default:t(()=>[o(d(n.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(N,null,{default:t(()=>e[22]||(e[22]=[o("Store Branch")])),_:1}),l($,{filter:"",class:"min-w-72",placeholder:"Select a Supplier",options:a(q),optionLabel:"label",optionValue:"value",modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=n=>p.value=n),disabled:""},null,8,["options","modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(N,null,{default:t(()=>e[23]||(e[23]=[o("Excel File")])),_:1}),l(k,{type:"file",onInput:e[2]||(e[2]=n=>a(_).file=n.target.files[0])})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[24]||(e[24]=[o("Accepted Excel File Format: ")])),_:1}),z("a",{href:r.route("stock-management.export-add"),class:"text-xs text-blue-500 underline"},"Add Quantity",8,Ae),z("a",{href:r.route("stock-management.export-log"),class:"text-xs text-blue-500 underline"},"Log Usage",8,Be),z("a",{href:r.route("stock-management.export-soh"),class:"text-xs text-blue-500 underline"},"SOH Update",8,He)]),_:1}),l(M,{class:"justify-end"},{default:t(()=>[l(b,{disabled:H.value,onClick:ye},{default:t(()=>[e[25]||(e[25]=o("Submit ")),H.value?(m(),C("span",$e,[l(ve)])):T("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),l(Le,{heading:"Stock Management",hasExcelDownload:!0,exportRoute:_e.value},{default:t(()=>[l(we,null,{default:t(()=>[l(M,{class:"justify-between sm:flex-row flex-col gap-3"},{default:t(()=>[l(Se,null,{default:t(()=>[l(k,{class:"pl-10",placeholder:"Search...",modelValue:a(S),"onUpdate:modelValue":e[4]||(e[4]=n=>Ie(S)?S.value=n:S=n)},null,8,["modelValue"])]),_:1}),l(M,{class:"gap-3"},{default:t(()=>[l($,{filter:"",class:"min-w-72",placeholder:"Select a Supplier",options:a(q),optionLabel:"label",optionValue:"value",modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=n=>p.value=n)},null,8,["options","modelValue"]),l(b,{onClick:ce},{default:t(()=>e[26]||(e[26]=[o("Update Stock")])),_:1})]),_:1})]),_:1}),l(Ve,null,{default:t(()=>[l(ke,null,{default:t(()=>[l(x,null,{default:t(()=>e[27]||(e[27]=[o("Name")])),_:1}),l(x,null,{default:t(()=>e[28]||(e[28]=[o("Code")])),_:1}),l(x,null,{default:t(()=>e[29]||(e[29]=[o("UOM")])),_:1}),l(x,null,{default:t(()=>e[30]||(e[30]=[o("Alt UOM")])),_:1}),l(x,null,{default:t(()=>e[31]||(e[31]=[o("SOH")])),_:1}),l(x,null,{default:t(()=>e[32]||(e[32]=[o("Recorded Used")])),_:1}),l(x,null,{default:t(()=>e[33]||(e[33]=[o("Actions")])),_:1})]),_:1}),l(xe,null,{default:t(()=>[(m(!0),C(B,null,Q(F.products.data,n=>(m(),C("tr",{key:n.id},[l(V,null,{default:t(()=>[o(d(n.name),1)]),_:2},1024),l(V,null,{default:t(()=>[o(d(n.inventory_code),1)]),_:2},1024),l(V,null,{default:t(()=>[o(d(n.uom),1)]),_:2},1024),l(V,null,{default:t(()=>[o(d(n.alt_uom),1)]),_:2},1024),l(V,null,{default:t(()=>[o(d(Y(n)),1)]),_:2},1024),l(V,null,{default:t(()=>[o(d(Z(n)),1)]),_:2},1024),l(V,null,{default:t(()=>[l(M,{class:"gap-3"},{default:t(()=>[a(D)("view stock management history")?(m(),v(ae,{key:0,onClick:A=>W(n.id,p.value)},null,8,["onClick"])):T("",!0),a(D)("log stock usage")?(m(),v(b,{key:1,onClick:A=>J(n.id),variant:"link",class:"text-xs text-orange-500"},{default:t(()=>e[34]||(e[34]=[o("Log Usage")])),_:2},1032,["onClick"])):T("",!0),a(D)("add stock quantity")?(m(),v(b,{key:2,onClick:A=>K(n.id),variant:"link",class:"text-xs text-green-500"},{default:t(()=>e[35]||(e[35]=[o("Add Quantity")])),_:2},1032,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1}),l(Te,null,{default:t(()=>[(m(!0),C(B,null,Q(F.products.data,n=>(m(),v(Ce,{key:n.id},{default:t(()=>[l(Ue,{title:`${n.name} (${n.inventory_code})`},{default:t(()=>[a(D)("view stock management history")?(m(),v(ae,{key:0,onClick:A=>W(n.id,p.value)},null,8,["onClick"])):T("",!0)]),_:2},1032,["title"]),l(i,null,{default:t(()=>[o("UOM: "+d(n.uom),1)]),_:2},1024),l(i,null,{default:t(()=>[o("Alt UOM: "+d(n.alt_uom),1)]),_:2},1024),l(i,null,{default:t(()=>[o("SOH: "+d(Y(n)),1)]),_:2},1024),l(i,null,{default:t(()=>[o("Estimated Used: "+d(n.estimated_used)+" "+d(n.ingredient_units),1)]),_:2},1024),l(i,null,{default:t(()=>[o("Recorded Used: "+d(Z(n)),1)]),_:2},1024),l(M,{class:"gap-3"},{default:t(()=>[a(D)("log stock usage")?(m(),v(b,{key:0,onClick:A=>J(n.id),variant:"link",class:"text-xs text-orange-500 p-0"},{default:t(()=>e[36]||(e[36]=[o("Log Usage")])),_:2},1032,["onClick"])):T("",!0),a(D)("add stock quantity")?(m(),v(b,{key:1,onClick:A=>K(n.id),variant:"link",class:"text-xs teMNaxt-green-500 p-0"},{default:t(()=>e[37]||(e[37]=[o("Add Quantity")])),_:2},1032,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(De,{data:F.products},null,8,["data"])]),_:1}),l(j,{open:I.value,"onUpdate:open":e[11]||(e[11]=n=>I.value=n)},{default:t(()=>[l(P,{class:"sm:max-w-[600px]"},{default:t(()=>[l(R,null,{default:t(()=>[l(y,null,{default:t(()=>e[38]||(e[38]=[o("Log Usage")])),_:1}),l(w,null,{default:t(()=>e[39]||(e[39]=[o(" Please input all the required fields. ")])),_:1})]),_:1}),l(se,{class:"gap-3"},{default:t(()=>[l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[40]||(e[40]=[o("Store Branch")])),_:1}),l($,{disabled:"",filter:"",class:"min-w-72",placeholder:"Select a Supplier",options:a(q),optionLabel:"label",optionValue:"value",modelValue:a(u).store_branch_id,"onUpdate:modelValue":e[6]||(e[6]=n=>a(u).store_branch_id=n)},null,8,["options","modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.store_branch_id),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[41]||(e[41]=[o("Cost Center")])),_:1}),l(oe,{modelValue:a(u).cost_center_id,"onUpdate:modelValue":e[7]||(e[7]=n=>a(u).cost_center_id=n)},{default:t(()=>[l(ee,null,{default:t(()=>[l(h,{placeholder:"Select from choices"})]),_:1}),l(ne,null,{default:t(()=>[l(te,null,{default:t(()=>[(m(!0),C(B,null,Q(a(me),n=>(m(),v(le,{value:n.value},{default:t(()=>[o(d(n.label),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.cost_center_id),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[42]||(e[42]=[o("Quantity Used")])),_:1}),l(k,{type:"number",modelValue:a(u).quantity,"onUpdate:modelValue":e[8]||(e[8]=n=>a(u).quantity=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.quantity),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[43]||(e[43]=[o("Transaction Date")])),_:1}),l(k,{type:"date",modelValue:a(u).transaction_date,"onUpdate:modelValue":e[9]||(e[9]=n=>a(u).transaction_date=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.transaction_date),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[44]||(e[44]=[o("Remarks")])),_:1}),l(ue,{type:"number",modelValue:a(u).remarks,"onUpdate:modelValue":e[10]||(e[10]=n=>a(u).remarks=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.remarks),1)]),_:1})]),_:1})]),_:1}),l(re,{class:"justify-end"},{default:t(()=>[l(b,{onClick:fe},{default:t(()=>e[45]||(e[45]=[o("Submit")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),l(j,{open:O.value,"onUpdate:open":e[17]||(e[17]=n=>O.value=n)},{default:t(()=>[l(P,{class:"sm:max-w-[600px]"},{default:t(()=>[l(R,null,{default:t(()=>[l(y,null,{default:t(()=>e[46]||(e[46]=[o("Add Quantity")])),_:1}),l(w,null,{default:t(()=>e[47]||(e[47]=[o(" Please input all the required fields. ")])),_:1})]),_:1}),l(se,{class:"gap-3"},{default:t(()=>[l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[48]||(e[48]=[o("Store Branch")])),_:1}),l($,{disabled:"",filter:"",class:"min-w-72",placeholder:"Select a Supplier",options:a(q),optionLabel:"label",optionValue:"value",modelValue:a(u).store_branch_id,"onUpdate:modelValue":e[12]||(e[12]=n=>a(u).store_branch_id=n)},null,8,["options","modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.store_branch_id),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[49]||(e[49]=[o("Quantity")])),_:1}),l(k,{type:"number",modelValue:a(u).quantity,"onUpdate:modelValue":e[13]||(e[13]=n=>a(u).quantity=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.quantity),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[50]||(e[50]=[o("Unit Cost")])),_:1}),l(k,{type:"number",modelValue:a(u).unit_cost,"onUpdate:modelValue":e[14]||(e[14]=n=>a(u).unit_cost=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.unit_cost),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[51]||(e[51]=[o("Transaction Date")])),_:1}),l(k,{type:"date",modelValue:a(u).transaction_date,"onUpdate:modelValue":e[15]||(e[15]=n=>a(u).transaction_date=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.transaction_date),1)]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(i,null,{default:t(()=>e[52]||(e[52]=[o("Remarks")])),_:1}),l(ue,{type:"number",modelValue:a(u).remarks,"onUpdate:modelValue":e[16]||(e[16]=n=>a(u).remarks=n)},null,8,["modelValue"]),l(c,null,{default:t(()=>[o(d(a(u).errors.remarks),1)]),_:1})]),_:1})]),_:1}),l(re,{class:"justify-end"},{default:t(()=>[l(b,{onClick:pe},{default:t(()=>e[53]||(e[53]=[o("Submit")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["exportRoute"])],64)}}};export{Ge as default};
