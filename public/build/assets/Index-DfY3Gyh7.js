import{l as le,Q as z,x,y as Q,T as _e,az as je,N as de,r as a,o as c,d as f,a as l,u as o,Z as ze,w as n,n as G,g as r,t as b,F as L,e as Z,b as u,h as T,j as Le,s as qe,m as Ye,O as Je,k as ce,bw as Qe,bx as ve,i as P,c as ye,E as xe,B as we}from"./app-p8ycGfai.js";import{l as Ge}from"./lodash-Z9yJD-f9.js";import{u as Ze}from"./useAuth-CsB0rIGq.js";import{u as Xe}from"./useSelectOptions-Ci2WUICq.js";import{C as We}from"./calendar-BgyW0Gx5.js";import{U as Ke}from"./upload-DTUN6lfo.js";const et={class:"font-semibold"},tt={key:0,class:"mt-2 list-disc list-inside text-sm"},lt={class:"w-full p-4 sm:p-6 lg:p-8"},st={class:"bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-200"},rt={class:"space-y-6"},nt={class:"relative"},ot=["value","disabled"],at={key:0,class:"mt-2 text-sm text-gray-500"},ut={class:"font-semibold"},it={class:"flex justify-between items-center mb-4"},dt={class:"text-lg font-semibold"},ct={class:"grid grid-cols-7 gap-2"},pt=["onClick"],ft={key:0,class:"space-y-8 transition-opacity duration-500"},mt={class:"bg-white p-6 rounded-xl shadow-lg border border-gray-200"},bt=["href"],gt={key:0,class:"bg-white p-6 rounded-xl shadow-lg border border-gray-200"},_t={key:0,class:"mt-2 text-sm text-red-600"},vt={class:"flex justify-end"},yt={class:"flex justify-end"},xt={class:"hidden md:block"},wt={key:0},ht=["onClick"],Dt=["onClick"],Ct=["onClick"],Tt=["onClick"],$t={__name:"Index",props:{massOrders:{type:Object,required:!0},suppliers:{type:Array,required:!0},ordersCutoff:{type:Array,required:!0},currentDate:{type:String,required:!0},branches:{type:Object},filters:{type:Object}},setup(E){const B=E,{hasAccess:se}=Ze();Xe(B.branches);const pe=s=>{var C;if(!((s.order_status==="pending"||s.order_status==="approved")&&se("edit mass orders")))return!1;const i=(C=s.supplier)==null?void 0:C.supplier_code;if(!i)return!0;const d=B.ordersCutoff.find(g=>g.ordering_template===i);if(!d)return!0;if(!s.created_at)return!1;const y=s.created_at.replace(" ","T")+"Z",A=new Date(y),w=[];if(d.cutoff_1_day!==null&&d.cutoff_1_time){const[g,v]=d.cutoff_1_time.split(":").map(Number);w.push({day:d.cutoff_1_day,timeInMinutes:g*60+v})}if(d.cutoff_2_day!==null&&d.cutoff_2_time){const[g,v]=d.cutoff_2_time.split(":").map(Number);w.push({day:d.cutoff_2_day,timeInMinutes:g*60+v})}if(w.length===0)return!0;w.sort((g,v)=>g.day!==v.day?g.day-v.day:g.timeInMinutes-v.timeInMinutes);const _=8*60*60*1e3,D=new Date(A.getTime()+_),U=D.getUTCDay(),ae=D.getUTCHours()*60+D.getUTCMinutes();let V=w.find(g=>g.day>U||g.day===U&&g.timeInMinutes>ae),J;V?J=(V.day-U+7)%7:(V=w[0],J=7-U+V.day);const j=new Date(D);j.setUTCDate(j.getUTCDate()+J);const ue=Math.floor(V.timeInMinutes/60),ie=V.timeInMinutes%60;j.setUTCHours(ue,ie,0,0);const K=new Date(j.getTime()-_);let ee;{if(!B.currentDate)return!1;const g=B.currentDate.replace(" ","T")+"Z";ee=new Date(g)}return ee<K},S=le(()=>z().props.flash),re=le(()=>{var s,e;return(s=S.value)!=null&&s.message?S.value.success===!1?"error":((e=S.value.skipped_stores)==null?void 0:e.length)>0?"warning":S.value.success?"success":"warning":null}),q=x(!1),he=()=>{q.value=!0},De=()=>{p.reset(),k.reset(),X.value=!1,R.value=!0,W.value=[]};Q(q,s=>{s===!1&&setTimeout(()=>De(),200)});const p=_e({supplier_code:null,order_date:null}),k=_e({mass_order_file:null,supplier_code:null,order_date:null}),X=x(!1),Ce=()=>{if(!p.supplier_code||!p.order_date){alert("Please select a supplier and a delivery date first.");return}k.supplier_code=p.supplier_code,k.order_date=p.order_date,k.post(route("mass-orders.upload"),{onSuccess:()=>{q.value=!1}})},Te=le(()=>{if(!p.order_date)return"";const s=new Date(p.order_date+"T00:00:00"),e=s.toLocaleDateString("en-US",{weekday:"long"}),i=s.getDay();return`${e} = ${i}`}),R=x(!0),W=x([]),Y=x(!1),$=x(new Date(B.currentDate+"T00:00:00")),ne=x(null),oe=x("top-full mt-2");Q(Y,s=>{const e=document.querySelector(".mass-order-dialog .p-dialog-content");if(e&&(e.style.overflow=s?"visible":"auto"),s&&ne.value){const i=ne.value.getBoundingClientRect(),d=400;window.innerHeight-i.bottom<d&&i.top>d?oe.value="bottom-full mb-2":oe.value="top-full mt-2"}});const Se=()=>{const s=[],e=$.value||new Date,i=e.getFullYear(),d=e.getMonth(),y=new Date(i,d,1).getDay(),A=new Date(i,d+1,0).getDate(),w=new Set(W.value);for(let h=0;h<y;h++)s.push(null);for(let h=1;h<=A;h++){const _=new Date(i,d,h),D=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`,U=!w.has(D);s.push({day:h,date:_,isDisabled:U})}return s},ke=()=>$.value=new Date($.value.getFullYear(),$.value.getMonth()-1,1),Me=()=>$.value=new Date($.value.getFullYear(),$.value.getMonth()+1,1),Fe=s=>{if(s&&!s.isDisabled){const e=s.date,i=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0");p.order_date=`${i}-${d}-${y}`,Y.value=!1}};Q(()=>p.supplier_code,async s=>{if(p.order_date=null,W.value=[],s){R.value=!0;try{const e=await je.get(route("mass-orders.available-dates",{supplier_code:s}));W.value=e.data,R.value=!1}catch(e){console.error("Error fetching available dates:",e),R.value=!0}}else R.value=!0}),Q(()=>p.order_date,()=>{X.value=!1});let M=x((z().props.filters.filterQuery||"all").toString()),F=x(z().props.filters.from),O=x(z().props.filters.to),I=x(z().props.filters.branchId),N=x(z().props.filters.search);const Oe=Ge.throttle(()=>{de.get(route("mass-orders.index"),{search:N.value,filterQuery:M.value,from:F.value,to:O.value,branchId:I.value},{preserveState:!0,preserveScroll:!0,replace:!0})},500);Q([F,O,I,N,M],Oe);const H=s=>{M.value=s},fe=s=>{switch(s==null?void 0:s.toUpperCase()){case"RECEIVED":return"bg-green-500 text-white";case"APPROVED":return"bg-teal-500 text-white";case"INCOMPLETE":return"bg-orange-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMMITTED":return"bg-blue-500 text-white";case"REJECTED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},me=s=>{if(!s||!s.includes("-"))return"N/A";try{const[e,i,d]=s.substring(0,10).split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(i,10)-1]} ${parseInt(d,10)}, ${e}`}catch{return s}},Ie=s=>{if(!s)return"N/A";try{const[e,i]=s.split(" "),[d,y,A]=e.split("-"),[w,h]=i.split(":");let _=parseInt(w,10),D="A.M.";return _>=12&&(D="P.M.",_>12&&(_-=12)),_===0&&(_=12),`${parseInt(y,10)}/${parseInt(A,10)}/${d} ${_}:${h} ${D}`}catch{return s}},be=s=>de.get(route("mass-orders.show",s)),ge=s=>de.get(route("mass-orders.edit",s)),Ne=le(()=>B.suppliers.filter(s=>s.value!=="DROPS"));return(s,e)=>{const i=a("FilterTabButton"),d=a("FilterTab"),y=a("Input"),A=a("SearchBar"),w=a("Filter"),h=a("PopoverTrigger"),_=a("SelectValue"),D=a("SelectTrigger"),U=a("SelectLabel"),ae=a("SelectItem"),V=a("SelectGroup"),J=a("SelectContent"),j=a("SelectShad"),ue=a("PopoverContent"),ie=a("Popover"),K=a("DivFlexCenter"),ee=a("TableHeader"),C=a("TH"),g=a("TableHead"),v=a("TD"),$e=a("Badge"),Ae=a("TableBody"),Ue=a("Table"),Ve=a("MobileTableHeading"),te=a("LabelXS"),Pe=a("MobileTableRow"),Ee=a("MobileTableContainer"),Be=a("Pagination"),Re=a("TableContainer"),He=a("Layout");return c(),f(L,null,[l(o(ze),{title:"Mass Orders"}),l(He,{heading:"Mass Orders",hasButton:!0,buttonName:"Create New Mass Order",handleClick:he},{default:n(()=>[S.value.message?(c(),f("div",{key:0,class:G(["mb-4 p-4 rounded-md",{"bg-green-100 text-green-800":re.value==="success","bg-yellow-100 text-yellow-800":re.value==="warning","bg-red-100 text-red-800":re.value==="error"}])},[r("p",et,b(S.value.message),1),S.value.skipped_stores&&S.value.skipped_stores.length?(c(),f("ul",tt,[(c(!0),f(L,null,Z(S.value.skipped_stores,t=>(c(),f("li",{key:t.brand_code},[r("strong",null,b(t.brand_code)+":",1),u(" "+b(t.reason),1)]))),128))])):T("",!0)],2)):T("",!0),l(o(Le),{visible:q.value,"onUpdate:visible":e[6]||(e[6]=t=>q.value=t),modal:"",header:"Create New Mass Order",style:{width:"65rem",height:"90vh"},class:"mass-order-dialog"},{default:n(()=>[r("div",lt,[r("div",st,[e[22]||(e[22]=r("div",{class:"flex items-center mb-4"},[r("span",{class:"flex items-center justify-center size-8 rounded-full bg-blue-600 text-white font-bold text-lg mr-4"},"1"),r("h2",{class:"text-xl font-semibold text-gray-800"},"Select Order Details")],-1)),r("div",rt,[r("div",null,[e[18]||(e[18]=r("label",{for:"supplier",class:"block text-sm font-medium text-gray-700 mb-1"},"Ordering Template",-1)),l(o(qe),{modelValue:o(p).supplier_code,"onUpdate:modelValue":e[0]||(e[0]=t=>o(p).supplier_code=t),filter:"",options:Ne.value,optionLabel:"label",optionValue:"value",placeholder:"Select an Ordering Template",class:"w-full"},null,8,["modelValue","options"])]),r("div",{class:"relative",ref_key:"dateInputRef",ref:ne},[e[21]||(e[21]=r("label",{for:"order_date",class:"block text-sm font-medium text-gray-700 mb-1"},"Delivery Date",-1)),r("div",nt,[r("input",{id:"order_date",type:"text",readonly:"",value:o(p).order_date,onClick:e[1]||(e[1]=t=>Y.value=!Y.value),disabled:R.value,class:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm shadow-sm transition-colors placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-400 disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",placeholder:"Select a date"},null,8,ot),l(o(We),{class:"absolute right-3 top-1/2 -translate-y-1/2 size-4 text-gray-500 pointer-events-none"})]),o(p).order_date?(c(),f("div",at,[e[19]||(e[19]=u(" Selected Day: ")),r("span",ut,b(Te.value),1)])):T("",!0),Ye(r("div",{class:G(["absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-full min-w-[300px]",oe.value])},[r("div",it,[r("button",{type:"button",onClick:e[2]||(e[2]=ce(t=>ke(),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},"<"),r("h2",dt,b(($.value||new Date).toLocaleString("default",{month:"long",year:"numeric"})),1),r("button",{type:"button",onClick:e[3]||(e[3]=ce(t=>Me(),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},">")]),e[20]||(e[20]=r("div",{class:"grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 mb-2"},[r("span",null,"Su"),r("span",null,"Mo"),r("span",null,"Tu"),r("span",null,"We"),r("span",null,"Th"),r("span",null,"Fr"),r("span",null,"Sa")],-1)),r("div",ct,[(c(!0),f(L,null,Z(Se(),(t,m)=>(c(),f("div",{key:m,class:G(["text-center py-1.5 rounded-full text-sm",[t?t.isDisabled?"text-gray-300 line-through cursor-not-allowed":o(p).order_date&&t.date.toDateString()===new Date(o(p).order_date+"T00:00:00").toDateString()?"bg-blue-600 text-white font-bold shadow-md":"bg-gray-100 text-gray-800 font-semibold cursor-pointer hover:bg-blue-100":""]]),onClick:St=>Fe(t)},b(t?t.day:""),11,pt))),128))])],2),[[Je,Y.value]])],512)])]),o(p).order_date&&o(p).supplier_code?(c(),f("div",ft,[r("div",mt,[e[24]||(e[24]=r("div",{class:"flex items-center mb-4"},[r("span",{class:"flex items-center justify-center size-8 rounded-full bg-blue-600 text-white font-bold text-lg mr-4"},"2"),r("h2",{class:"text-xl font-semibold text-gray-800"},"Download Template")],-1)),e[25]||(e[25]=r("p",{class:"text-gray-600 mb-5"},"Download the Excel template for the selected supplier. This file is pre-filled with the correct items and store columns for your order.",-1)),r("a",{onClick:e[4]||(e[4]=t=>X.value=!0),href:s.route("mass-orders.download-template",{supplier_code:o(p).supplier_code,order_date:o(p).order_date}),class:"inline-flex items-center justify-center w-full px-4 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all transform hover:scale-105"},[l(o(Qe),{class:"mr-2 size-5"}),e[23]||(e[23]=u(" Download Order Template "))],8,bt)]),X.value?(c(),f("div",gt,[e[28]||(e[28]=r("div",{class:"flex items-center mb-4"},[r("span",{class:"flex items-center justify-center size-8 rounded-full bg-blue-600 text-white font-bold text-lg mr-4"},"3"),r("h2",{class:"text-xl font-semibold text-gray-800"},"Upload Completed File")],-1)),r("form",{onSubmit:ce(Ce,["prevent"]),class:"mt-4 space-y-4"},[r("div",null,[e[26]||(e[26]=r("label",{for:"mass_order_file",class:"block text-sm font-medium text-gray-700"},"Excel File",-1)),r("input",{type:"file",onInput:e[5]||(e[5]=t=>o(k).mass_order_file=t.target.files[0]),id:"mass_order_file",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"},null,32),o(k).errors.mass_order_file?(c(),f("p",_t,b(o(k).errors.mass_order_file),1)):T("",!0)]),r("div",vt,[l(o(ve),{type:"submit",disabled:!o(k).mass_order_file||o(k).processing},{default:n(()=>[l(o(Ke),{class:"mr-2 size-5"}),e[27]||(e[27]=u(" Upload and Process "))]),_:1},8,["disabled"])])],32)])):T("",!0)])):T("",!0)])]),_:1},8,["visible"]),l(d,null,{default:n(()=>[l(i,{label:"All",filter:"all",currentFilter:o(M),onClick:e[7]||(e[7]=t=>H("all"))},null,8,["currentFilter"]),l(i,{label:"Pending",filter:"pending",currentFilter:o(M),onClick:e[8]||(e[8]=t=>H("pending"))},null,8,["currentFilter"]),l(i,{label:"Approved",filter:"approved",currentFilter:o(M),onClick:e[9]||(e[9]=t=>H("approved"))},null,8,["currentFilter"]),l(i,{label:"Commited",filter:"committed",currentFilter:o(M),onClick:e[10]||(e[10]=t=>H("committed"))},null,8,["currentFilter"]),l(i,{label:"Received",filter:"received",currentFilter:o(M),onClick:e[11]||(e[11]=t=>H("received"))},null,8,["currentFilter"]),l(i,{label:"Rejected",filter:"rejected",currentFilter:o(M),onClick:e[12]||(e[12]=t=>H("rejected"))},null,8,["currentFilter"])]),_:1}),l(Re,null,{default:n(()=>[l(ee,null,{default:n(()=>[l(A,null,{default:n(()=>[l(y,{modelValue:o(N),"onUpdate:modelValue":e[13]||(e[13]=t=>P(N)?N.value=t:N=t),id:"search",type:"text",placeholder:"Search for order number",class:"pl-10 sm:max-w-full max-w-64"},null,8,["modelValue"])]),_:1}),l(K,{class:"gap-5"},{default:n(()=>[l(ie,null,{default:n(()=>[l(h,null,{default:n(()=>[l(w)]),_:1}),l(ue,null,{default:n(()=>[r("div",yt,[l(o(ve),{onClick:e[14]||(e[14]=()=>{P(F)?F.value=null:F=null,P(O)?O.value=null:O=null,P(I)?I.value=null:I=null,P(N)?N.value=null:N=null}),variant:"link",class:"text-end text-red-500 text-xs"},{default:n(()=>e[29]||(e[29]=[u(" Reset Filter ")])),_:1})]),e[31]||(e[31]=r("label",{class:"text-xs"},"From",-1)),l(y,{type:"date",modelValue:o(F),"onUpdate:modelValue":e[15]||(e[15]=t=>P(F)?F.value=t:F=t)},null,8,["modelValue"]),e[32]||(e[32]=r("label",{class:"text-xs"},"To",-1)),l(y,{type:"date",modelValue:o(O),"onUpdate:modelValue":e[16]||(e[16]=t=>P(O)?O.value=t:O=t)},null,8,["modelValue"]),e[33]||(e[33]=r("label",{class:"text-xs"},"Store",-1)),l(j,{modelValue:o(I),"onUpdate:modelValue":e[17]||(e[17]=t=>P(I)?I.value=t:I=t)},{default:n(()=>[l(D,null,{default:n(()=>[l(_,{placeholder:"Select a store"})]),_:1}),l(J,null,{default:n(()=>[l(V,null,{default:n(()=>[l(U,null,{default:n(()=>e[30]||(e[30]=[u("Stores")])),_:1}),(c(!0),f(L,null,Z(E.branches,(t,m)=>(c(),ye(ae,{value:m},{default:n(()=>[u(b(t),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),r("div",xt,[l(Ue,null,{default:n(()=>[l(g,null,{default:n(()=>[l(C,null,{default:n(()=>e[34]||(e[34]=[u("Id")])),_:1}),l(C,null,{default:n(()=>e[35]||(e[35]=[u("Supplier")])),_:1}),l(C,null,{default:n(()=>e[36]||(e[36]=[u("Store")])),_:1}),l(C,null,{default:n(()=>e[37]||(e[37]=[u("Order #")])),_:1}),l(C,null,{default:n(()=>e[38]||(e[38]=[u("Delivery Date")])),_:1}),l(C,null,{default:n(()=>e[39]||(e[39]=[u("Order Placed Date")])),_:1}),l(C,null,{default:n(()=>e[40]||(e[40]=[u("Order Status")])),_:1}),l(C,null,{default:n(()=>e[41]||(e[41]=[u("Actions")])),_:1})]),_:1}),l(Ae,null,{default:n(()=>[!E.massOrders.data||E.massOrders.data.length===0?(c(),f("tr",wt,e[42]||(e[42]=[r("td",{colspan:"8",class:"text-center py-4"},"No orders found.",-1)]))):T("",!0),(c(!0),f(L,null,Z(E.massOrders.data,t=>(c(),f("tr",{key:t.id},[l(v,null,{default:n(()=>[u(b(t.id),1)]),_:2},1024),l(v,null,{default:n(()=>{var m;return[u(b(((m=t.supplier)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(v,null,{default:n(()=>{var m;return[u(b(((m=t.store_branch)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(v,null,{default:n(()=>[u(b(t.order_number),1)]),_:2},1024),l(v,null,{default:n(()=>[u(b(me(t.order_date)),1)]),_:2},1024),l(v,null,{default:n(()=>[u(b(Ie(t.created_at)),1)]),_:2},1024),l(v,null,{default:n(()=>[l($e,{class:G([fe(t.order_status),"font-bold"])},{default:n(()=>[u(b(t.order_status?t.order_status.toUpperCase():"N/A"),1)]),_:2},1032,["class"])]),_:2},1024),l(v,null,{default:n(()=>[l(K,{class:"gap-3"},{default:n(()=>[o(se)("show mass orders")?(c(),f("button",{key:0,onClick:m=>be(t.order_number)},[l(o(xe),{class:"size-5"})],8,ht)):T("",!0),pe(t)?(c(),f("button",{key:1,class:"text-blue-500",onClick:m=>ge(t.order_number)},[l(o(we),{class:"size-5"})],8,Dt)):T("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),l(Ee,{class:"md:hidden"},{default:n(()=>[(c(!0),f(L,null,Z(E.massOrders.data,t=>(c(),ye(Pe,{key:t.id},{default:n(()=>[l(Ve,{title:t.order_number},{default:n(()=>[o(se)("show mass orders")?(c(),f("button",{key:0,onClick:m=>be(t.order_number)},[l(o(xe),{class:"size-5"})],8,Ct)):T("",!0),pe(t)?(c(),f("button",{key:1,class:"text-blue-500",onClick:m=>ge(t.order_number)},[l(o(we),{class:"size-5"})],8,Tt)):T("",!0)]),_:2},1032,["title"]),l(te,null,{default:n(()=>[e[43]||(e[43]=u("Status: ")),r("span",{class:G([fe(t.order_status),"font-semibold p-1 rounded text-white"])},b(t.order_status?t.order_status.toUpperCase():"N/A"),3)]),_:2},1024),l(te,null,{default:n(()=>{var m;return[u("Store: "+b(((m=t.store_branch)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(te,null,{default:n(()=>{var m;return[u("Supplier: "+b(((m=t.supplier)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(te,null,{default:n(()=>[u("Delivery Date: "+b(me(t.order_date)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(Be,{data:E.massOrders},null,8,["data"])]),_:1})]),_:1})],64)}}};export{$t as default};
