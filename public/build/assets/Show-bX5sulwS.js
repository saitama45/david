import{f as ce,x as q,y as pe,T as fe,r as i,o as c,c as m,w as o,a as r,g as a,b as n,t as d,n as ve,u as p,h as P,d as b,e as z,m as L,A as V,F as R,N as me}from"./app-Bw_fMWAP.js";import{u as ye}from"./useBackButton-CVjDC3AL.js";import{u as _e}from"./useToast-CgNL_wIh.js";import{u as ge}from"./useAuth-CBAjI_yz.js";import{S as Q}from"./save-D1-8COpm.js";import{X as $}from"./x-CdvG2xaQ.js";import{S as j}from"./square-pen-9SUWVdac.js";const be={class:"flex flex-col gap-5"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm"},ke={class:"flex flex-col"},Ce={class:"font-bold text-gray-900"},qe={class:"flex flex-col"},Se={class:"font-bold text-gray-900"},Te={class:"flex flex-col"},we={class:"font-bold text-gray-900"},Ne={class:"flex flex-col"},De={class:"font-bold text-gray-900"},he={class:"flex flex-col"},Ae={class:"flex flex-col"},Oe={class:"font-bold text-gray-900"},Be={class:"flex flex-col"},Pe={class:"font-bold text-gray-900"},Ve={key:0},Ee={key:1,class:"flex items-center gap-2"},Ie={key:0},Fe={key:0},He={key:1},je={__name:"Show",props:{order:{type:Object,required:!0},items:{type:Object,required:!0}},setup(l){const F=ce(),{toast:N}=_e(),{hasAccess:h}=ge(),{backButton:K}=ye(route("interco-approval.index")),E=l,X=t=>t?new Date(t).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"}):"N/A",G=t=>{var e,u,_;return t.from_store_name||((e=t.sending_store)==null?void 0:e.name)||((u=t.sending_store)==null?void 0:u.branch_name)||((_=t.sending_store)==null?void 0:_.brand_name)||"Unknown Sending Store"},J=t=>{var e,u;return t.to_store_name||((e=t.receiving_store)==null?void 0:e.name)||((u=t.receiving_store)==null?void 0:u.branch_name)||"Unknown Receiving Store"},W=t=>{switch(t.toUpperCase()){case"APPROVED":return"bg-green-500 text-white";case"OPEN":return"bg-blue-500 text-white";case"DISAPPROVED":return"bg-red-500 text-white";default:return"bg-yellow-500 text-white"}},v=q(!1),Y=q(!1);q(!1);const f=q(null),y=q("");q(null);const H={mounted:t=>{const e=t.tagName==="INPUT"?t:t.querySelector("input");e&&(e.focus(),e.select())}};pe(Y,t=>{t||(v.value=!1,S.reset(),S.clearErrors())});const S=fe({order_id:null,remarks:null}),Z=t=>{F.require({message:"Are you sure you want to approve this interco order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{v.value=!0,S.order_id=t,S.post(route("interco-approval.approve"),{onSuccess:()=>{N.add({severity:"success",summary:"Success",detail:"Interco Order Approved Successfully.",life:3e3}),v.value=!1},onError:()=>{v.value=!1}})}})},ee=t=>{F.require({message:"Are you sure you want to disapprove this interco order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"danger"},accept:()=>{v.value=!0,S.order_id=t,S.post(route("interco-approval.disapprove"),{onSuccess:()=>{N.add({severity:"success",summary:"Success",detail:"Interco Order Disapproved Successfully.",life:3e3}),v.value=!1},onError:()=>{v.value=!1}})}})},T=q([]);E.items.forEach(t=>T.value.push({id:t.id,quantity_ordered:t.quantity_ordered,quantity_approved:t.quantity_approved||t.quantity_ordered,quantity_commited:t.quantity_commited||t.quantity_approved||t.quantity_ordered,item_code:t.item_code,description:t.description,soh_stock:t.soh_stock,uom:t.uom}));const U=t=>{const e=T.value.find(u=>u.id===t);e&&(f.value={id:t,originalValue:e.quantity_approved},y.value=e.quantity_approved.toString())},A=()=>{if(!f.value)return;const t=parseFloat(y.value);if(isNaN(t)||t<0){N.add({severity:"error",summary:"Error",detail:"Please enter a valid quantity.",life:3e3});return}const e=Number(t.toFixed(2)),u=f.value.id;f.value.originalValue;const _=T.value.find(x=>x.id===u);_&&(_.quantity_approved=e,_.quantity_commited=e);const D=E.items.find(x=>x.id===u);D&&(D.quantity_approved=e,D.quantity_commited=e),te(u,e),f.value=null,y.value=""},O=()=>{f.value=null,y.value=""},te=(t,e)=>{me.post(route("interco-approval.update-quantity",t),{quantity_approved:e,quantity_commited:e},{preserveScroll:!0,onSuccess:()=>{N.add({severity:"success",summary:"Success",detail:"Quantity updated successfully.",life:2e3})},onError:()=>{T.value.find(u=>u.id===t),E.items.find(u=>u.id===t),N.add({severity:"error",summary:"Error",detail:"Failed to update quantity. Please refresh the page.",life:3e3})}})};return(t,e)=>{const u=i("CardTitle"),_=i("Badge"),D=i("Card"),x=i("Button"),I=i("DivFlexCenter"),oe=i("TableHeader"),k=i("TH"),re=i("TableHead"),C=i("TD"),M=i("Input"),se=i("TableBody"),ne=i("Table"),ae=i("MobileTableHeading"),B=i("LabelXS"),le=i("MobileTableRow"),ie=i("MobileTableContainer"),de=i("TableContainer"),ue=i("Layout");return c(),m(ue,{heading:"Interco Order Details"},{default:o(()=>[r(de,null,{default:o(()=>[a("section",be,[r(D,{class:"p-4 sm:p-6 bg-white shadow-sm rounded-lg"},{default:o(()=>[r(u,{class:"text-lg font-semibold mb-4"},{default:o(()=>e[4]||(e[4]=[n("Interco Transfer Details")])),_:1}),a("div",xe,[a("div",ke,[e[5]||(e[5]=a("span",{class:"text-gray-500"},"Interco Number:",-1)),a("span",Ce,d(l.order.interco_number),1)]),a("div",qe,[e[6]||(e[6]=a("span",{class:"text-gray-500"},"From Store:",-1)),a("span",Se,d(G(l.order)),1)]),a("div",Te,[e[7]||(e[7]=a("span",{class:"text-gray-500"},"To Store:",-1)),a("span",we,d(J(l.order)),1)]),a("div",Ne,[e[8]||(e[8]=a("span",{class:"text-gray-500"},"Transfer Date:",-1)),a("span",De,d(X(l.order.transfer_date||l.order.order_date)),1)]),a("div",he,[e[9]||(e[9]=a("span",{class:"text-gray-500"},"Status:",-1)),r(_,{class:ve([W(l.order.interco_status),"font-bold w-fit"])},{default:o(()=>{var s;return[n(d(((s=l.order.interco_status)==null?void 0:s.toUpperCase())??"N/A"),1)]}),_:1},8,["class"])]),a("div",Ae,[e[10]||(e[10]=a("span",{class:"text-gray-500"},"Reason:",-1)),a("span",Oe,d(l.order.interco_reason??"N/A"),1)]),a("div",Be,[e[11]||(e[11]=a("span",{class:"text-gray-500"},"Remarks:",-1)),a("span",Pe,d(l.order.remarks??"N/A"),1)])])]),_:1}),r(I,{class:"gap-5"},{default:o(()=>[l.order.interco_status==="open"&&p(h)("approve interco requests")?(c(),m(x,{key:0,variant:"destructive",onClick:e[0]||(e[0]=s=>ee(l.order.id)),disabled:v.value},{default:o(()=>e[12]||(e[12]=[n(" Disapprove Order ")])),_:1},8,["disabled"])):P("",!0),l.order.interco_status==="open"&&p(h)("approve interco requests")?(c(),m(x,{key:1,class:"bg-green-500 hover:bg-green-300",onClick:e[1]||(e[1]=s=>Z(l.order.id)),disabled:v.value},{default:o(()=>e[13]||(e[13]=[n(" Approve Order ")])),_:1},8,["disabled"])):P("",!0)]),_:1})]),r(oe),r(ne,null,{default:o(()=>[r(re,null,{default:o(()=>[r(k,null,{default:o(()=>e[14]||(e[14]=[n(" Item Code ")])),_:1}),r(k,null,{default:o(()=>e[15]||(e[15]=[n(" Description ")])),_:1}),r(k,null,{default:o(()=>e[16]||(e[16]=[n(" UOM ")])),_:1}),r(k,null,{default:o(()=>e[17]||(e[17]=[n(" Ordered Qty ")])),_:1}),r(k,null,{default:o(()=>e[18]||(e[18]=[n(" SOH Stock ")])),_:1}),l.order.interco_status==="open"?(c(),m(k,{key:0},{default:o(()=>e[19]||(e[19]=[n("Approved Qty")])),_:1})):(c(),m(k,{key:1},{default:o(()=>e[20]||(e[20]=[n("Approved Qty")])),_:1}))]),_:1}),r(se,null,{default:o(()=>[(c(!0),b(R,null,z(l.items,s=>(c(),b("tr",{key:s.id},[r(C,null,{default:o(()=>[n(d(s.item_code),1)]),_:2},1024),r(C,null,{default:o(()=>[n(d(s.description),1)]),_:2},1024),r(C,null,{default:o(()=>[n(d(s.uom??"N/A"),1)]),_:2},1024),r(C,null,{default:o(()=>[n(d(s.quantity_ordered),1)]),_:2},1024),r(C,null,{default:o(()=>[n(d(s.soh_stock??0),1)]),_:2},1024),l.order.interco_status==="open"?(c(),m(C,{key:0,class:"flex items-center gap-3"},{default:o(()=>{var g;return[f.value&&f.value.id===s.id?(c(),b("div",Ve,[L(r(M,{type:"number",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=w=>y.value=w),class:"w-20 text-right",onKeyup:[V(A,["enter"]),V(O,["esc"])]},null,8,["modelValue"]),[[H]]),r(I,{class:"gap-1 ml-2"},{default:o(()=>[r(p(Q),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:A}),r(p($),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:O})]),_:1})])):(c(),b("div",Ee,[n(d(((g=T.value.find(w=>w.id===s.id))==null?void 0:g.quantity_approved)||0)+" ",1),p(h)("approve interco requests")?(c(),m(p(j),{key:0,class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:w=>U(s.id)},null,8,["onClick"])):P("",!0)]))]}),_:2},1024)):(c(),m(C,{key:1},{default:o(()=>[n(d(s.quantity_approved),1)]),_:2},1024))]))),128))]),_:1})]),_:1}),r(ie,null,{default:o(()=>[(c(!0),b(R,null,z(l.items,s=>(c(),m(le,{key:s.id},{default:o(()=>[r(ae,{title:`${s.description} (${s.item_code})`},{default:o(()=>[l.order.interco_status==="open"&&p(h)("approve interco requests")?(c(),b("div",Ie,[f.value&&f.value.id===s.id?(c(),b("div",Fe,[L(r(M,{type:"number",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=g=>y.value=g),class:"w-20 text-right",onKeyup:[V(A,["enter"]),V(O,["esc"])]},null,8,["modelValue"]),[[H]]),r(I,{class:"gap-1 ml-2"},{default:o(()=>[r(p(Q),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:A}),r(p($),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:O})]),_:1})])):(c(),b("div",He,[r(p(j),{class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:g=>U(s.id)},null,8,["onClick"])]))])):P("",!0)]),_:2},1032,["title"]),r(B,null,{default:o(()=>[n("UOM: "+d(s.uom??"N/A"),1)]),_:2},1024),r(B,null,{default:o(()=>[n("Ordered: "+d(s.quantity_ordered),1)]),_:2},1024),r(B,null,{default:o(()=>[n("SOH Stock: "+d(s.soh_stock??0),1)]),_:2},1024),r(B,null,{default:o(()=>{var g;return[n(" Approved: "+d(((g=T.value.find(w=>w.id===s.id))==null?void 0:g.quantity_approved)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),r(x,{variant:"outline",class:"text-lg px-7",onClick:p(K)},{default:o(()=>e[21]||(e[21]=[n(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{je as default};
