import{f as W,T as X,x as j,l as A,r as w,o as n,d as i,a as h,u as ee,Z as te,w as T,b as re,g as t,t as d,F as b,e as m,h as _,n as U,m as L,z as O,A as $,N as se}from"./app-DPA7xop8.js";import{u as oe}from"./useToast-CL68v_82.js";const ae={class:"bg-white border rounded-md shadow-sm p-6"},de={class:"space-y-4"},le={class:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ie={class:"text-lg font-bold text-blue-700"},ue={class:"text-lg font-bold text-blue-600"},ce={class:"text-sm font-medium text-gray-700"},ye={key:0,class:"mt-6 overflow-x-auto"},pe={class:"min-w-full border-collapse border border-gray-300 text-sm"},be={class:"bg-gray-100"},ge=["colspan"],me={class:"text-xs font-bold"},xe={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},fe={key:1,class:"text-xs text-gray-500 mt-1"},he={class:"bg-gray-200"},_e={class:"text-xs"},ve={class:"text-xs"},Ee={class:"border border-gray-300 px-3 py-2"},we={class:"border border-gray-300 px-3 py-2"},Te={class:"border border-gray-300 px-3 py-2 text-center"},ke={class:"border border-gray-300 px-3 py-2 text-right"},Ae=["onUpdate:modelValue","readonly"],Ce={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ne={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ie={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Se={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-green-50"},De={class:"bg-gray-700 text-white font-bold"},Fe=["colspan"],Re={class:"border border-gray-300 px-3 py-2 text-right"},Me={key:1,class:"mt-6 overflow-x-auto"},Be={class:"min-w-full border-collapse border border-gray-300 text-sm"},Ue={class:"bg-white"},Le={class:"border border-gray-300 px-3 py-2"},Oe={class:"border border-gray-300 px-3 py-2"},$e={class:"border border-gray-300 px-3 py-2 text-center font-semibold"},Ve={key:0},Pe={class:"bg-gray-200"},Ge={class:"border border-gray-300 px-3 py-2 font-bold text-base",colspan:"3"},qe={class:"border border-gray-300 px-3 py-2",colspan:"2"},Ke={class:"font-bold"},Qe={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},Je={key:1,class:"text-xs text-gray-500 mt-1"},ze={class:"border border-gray-300 px-2 py-1"},He=["onUpdate:modelValue","min","placeholder","onBlur"],Ye={class:"bg-blue-50 font-semibold"},Ze={class:"border border-gray-300 px-3 py-2 text-center"},We={class:"bg-gray-700 text-white font-bold"},Xe={class:"border border-gray-300 px-3 py-2 text-center"},tt={__name:"Edit",props:{batch_number:{type:String,required:!0},variant:{type:String,default:null},date_from:{type:String,default:null},date_to:{type:String,default:null},stores:{type:Array,default:()=>[]},dates:{type:Array,default:()=>[]},sap_item:{type:Object,default:null},existing_orders:{type:Object,default:()=>({})},status:{type:String,default:null},supplier_items:{type:Array,default:()=>[]}},setup(y){const l=y,{toast:v}=oe(),V=W(),C=()=>{se.get(route("dts-mass-orders.index"))},P=()=>{let r=!1;if(l.variant==="FRUITS AND VEGETABLES")for(const e in a.value){for(const o in a.value[e]){for(const u in a.value[e][o])if(a.value[e][o][u]&&parseFloat(a.value[e][o][u])>0){r=!0;break}if(r)break}if(r)break}else for(const e in a.value){for(const o in a.value[e])if(a.value[e][o]&&parseFloat(a.value[e][o])>0){r=!0;break}if(r)break}if(!r){v.add({severity:"warn",summary:"No Orders",detail:"Please enter at least one order quantity before updating orders.",life:3e3});return}V.require({message:"Are you sure you want to update these orders? This will replace all existing orders in this batch.",header:"Confirm Order Update",icon:"pi pi-exclamation-triangle",accept:()=>{G()},reject:()=>{},acceptClass:"p-button-success",rejectClass:"p-button-danger"})},x=X({variant:l.variant,orders:{},sap_item:l.sap_item,supplier_items:l.supplier_items||[]}),G=()=>{l.variant==="FRUITS AND VEGETABLES"?(x.orders=a.value,x.supplier_items=l.supplier_items,x.sap_item=null):(x.orders=a.value,x.sap_item=l.sap_item),x.variant=l.variant,x.put(route("dts-mass-orders.update",l.batch_number),{onSuccess:()=>{v.add({severity:"success",summary:"Orders Updated",detail:"Your mass orders have been successfully updated.",life:3e3})},onError:r=>{v.add({severity:"error",summary:"Error",detail:r.error||"Failed to update orders. Please try again.",life:5e3})}})},N=r=>{if(!r)return"Not Selected";try{const[e,o,u]=r.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o,10)-1]} ${parseInt(u,10)}, ${e}`}catch{return r}},a=j({}),q=(r,e)=>!r.delivery_schedule_ids||!e.delivery_schedule_id?!1:r.delivery_schedule_ids.includes(e.delivery_schedule_id);l.variant==="FRUITS AND VEGETABLES"?l.supplier_items.forEach(r=>{a.value[r.id]={},l.dates.forEach(e=>{a.value[r.id][e.date]={},l.stores.forEach(o=>{var p,f;const u=((f=(p=l.existing_orders[r.id])==null?void 0:p[e.date])==null?void 0:f[o.id])||"";a.value[r.id][e.date][o.id]=u})})}):l.dates.forEach(r=>{a.value[r.date]={},l.stores.forEach(e=>{var u;const o=((u=l.existing_orders[r.date])==null?void 0:u[e.id])||"";a.value[r.date][e.id]=o})});const I=r=>{let e=0;return l.stores.forEach(o=>{var p;const u=parseFloat(((p=a.value[r])==null?void 0:p[o.id])||0);e+=isNaN(u)?0:u}),e},K=A(()=>{let r=0;return l.dates.forEach(e=>{r+=I(e.date)}),r}),Q=r=>l.stores.filter(e=>q(e,r)),E=r=>l.dates,k=(r,e,o)=>{var u,p;return((p=(u=l.existing_orders[r])==null?void 0:u[o])==null?void 0:p[e])!==void 0},J=A(()=>{let r=0;return l.stores.forEach(e=>{r+=E().length}),r}),S=r=>{let e=0;return a.value[r]?(Object.keys(a.value[r]).forEach(o=>{Object.keys(a.value[r][o]).forEach(u=>{const p=parseFloat(a.value[r][o][u]||0);e+=isNaN(p)?0:p})}),e):0},z=()=>10,D=r=>S(r)*1.1,F=(r,e)=>D(r)*e,H=A(()=>{let r=0;return l.supplier_items.forEach(e=>{r+=F(e.id,e.price)}),r}),R=r=>{const e=Array.from(document.querySelectorAll('input[type="number"]')),o=e.indexOf(r.target);o>-1&&o<e.length-1&&(r.preventDefault(),e[o+1].focus(),e[o+1].select())},Y=(r,e,o)=>{if(l.variant==="ICE CREAM"){const u=parseFloat(o);if(o!==""&&o!==null&&!isNaN(u)&&u>0&&u<5)return v.add({severity:"warn",summary:"Invalid Quantity",detail:"ICE CREAM orders must be at least 5 gallons (GAL 3.8)",life:4e3}),a.value[r][e]="",!1}return!0};return(r,e)=>{const o=w("Button"),u=w("TableHeader"),p=w("TableContainer"),f=w("Layout");return n(),i(b,null,[h(ee(te),{title:"Edit DTS Mass Order"}),h(f,{heading:"Edit DTS Mass Order"},{default:T(()=>[h(p,null,{default:T(()=>{var M,B;return[h(u,null,{default:T(()=>[h(o,{onClick:C,variant:"outline",class:"text-black border-black hover:bg-gray-100"},{default:T(()=>e[0]||(e[0]=[re(" Back ")])),_:1})]),_:1}),t("div",ae,[t("div",de,[t("div",le,[t("div",ne,[t("div",null,[e[1]||(e[1]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Batch Number",-1)),t("p",ie,d(y.batch_number),1)]),t("div",null,[e[2]||(e[2]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Variant",-1)),t("p",ue,d(y.variant),1)]),t("div",null,[e[3]||(e[3]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Date Range",-1)),t("p",ce,d(N(y.date_from))+" - "+d(N(y.date_to)),1)])])]),y.variant==="FRUITS AND VEGETABLES"?(n(),i("div",ye,[t("table",pe,[t("thead",null,[t("tr",be,[e[4]||(e[4]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"100px"}},"ITEM CODE",-1)),e[5]||(e[5]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"200px"}},"ITEM NAME",-1)),e[6]||(e[6]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"UOM",-1)),e[7]||(e[7]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"PRICE",-1)),(n(!0),i(b,null,m(y.stores,s=>(n(),i("th",{key:`store-${s.id}`,colspan:E(s).length,class:"border border-gray-300 px-2 py-2 font-semibold text-center bg-blue-50",style:{"min-width":"120px"}},[t("div",me,d(s.name),1),s.brand_code?(n(),i("div",xe,d(s.brand_code),1)):_("",!0),s.complete_address?(n(),i("div",fe,d(s.complete_address),1)):_("",!0)],8,ge))),128)),e[8]||(e[8]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL ORDER",-1)),e[9]||(e[9]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"BUFFER",-1)),e[10]||(e[10]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL PO",-1)),e[11]||(e[11]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-green-100 align-middle"},"TOTAL PRICE",-1))]),t("tr",he,[(n(!0),i(b,null,m(y.stores,s=>(n(),i(b,{key:`dates-${s.id}`},[(n(!0),i(b,null,m(E(s),c=>(n(),i("th",{key:`date-${s.id}-${c.date}`,class:"border border-gray-300 px-2 py-2 font-semibold text-center"},[t("div",_e,d(c.day_of_week),1),t("div",ve,d(c.display.split("- ")[1]),1)]))),128))],64))),128))])]),t("tbody",null,[(n(!0),i(b,null,m(y.supplier_items,s=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Ee,d(s.item_code),1),t("td",we,d(s.item_name),1),t("td",Te,d(s.uom),1),t("td",ke,d(s.price.toFixed(2)),1),(n(!0),i(b,null,m(y.stores,c=>(n(),i(b,{key:`body-${c.id}`},[(n(!0),i(b,null,m(E(c),g=>(n(),i("td",{key:`${s.id}-${c.id}-${g.date}`,class:U(["border border-gray-300 px-1 py-1",k(s.id,c.id,g.date)?"":"bg-gray-100"])},[L(t("input",{"onUpdate:modelValue":Z=>a.value[s.id][g.date][c.id]=Z,type:"number",step:"0.01",min:"0",readonly:!k(s.id,c.id,g.date),class:U(["w-full px-2 py-1 border rounded text-center",k(s.id,c.id,g.date)?"border-gray-300 focus:ring-1 focus:ring-blue-500":"border-gray-200 bg-gray-100 cursor-not-allowed text-gray-400"]),onKeydown:$(R,["enter"])},null,42,Ae),[[O,a.value[s.id][g.date][c.id]]])],2))),128))],64))),128)),t("td",Ce,d(S(s.id).toFixed(2)),1),t("td",Ne,d(z())+"% ",1),t("td",Ie,d(D(s.id).toFixed(2)),1),t("td",Se,d(F(s.id,s.price).toFixed(2)),1)]))),128)),t("tr",De,[e[12]||(e[12]=t("td",{colspan:"4",class:"border border-gray-300 px-3 py-2 text-right"},"TOTAL PRICE",-1)),t("td",{colspan:J.value+3,class:"border border-gray-300 px-3 py-2"},null,8,Fe),t("td",Re,d(H.value.toFixed(2)),1)])])])])):(n(),i("div",Me,[t("table",Be,[t("thead",null,[e[13]||(e[13]=t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"120px"}}," ITEM CODE "),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"200px"}}," ITEM DESCRIPTION "),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-center",style:{"min-width":"100px"}}," UOM ")],-1)),t("tr",Ue,[t("td",Le,d(((M=y.sap_item)==null?void 0:M.item_code)||""),1),t("td",Oe,d(((B=y.sap_item)==null?void 0:B.item_description)||""),1),t("td",$e,[y.sap_item?(n(),i("span",Ve,d(y.sap_item.alt_uom),1)):_("",!0)])])]),t("tbody",null,[(n(!0),i(b,null,m(y.dates,s=>(n(),i(b,{key:s.date},[t("tr",Pe,[t("td",Ge,d(s.display),1)]),e[15]||(e[15]=t("tr",{class:"bg-gray-50"},[t("td",{class:"border border-gray-300 px-3 py-2 font-semibold",colspan:"2"}," Store Name "),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"}," Quantity ")],-1)),(n(!0),i(b,null,m(Q(s),c=>(n(),i("tr",{key:`${s.date}-${c.id}`,class:"hover:bg-gray-50"},[t("td",qe,[t("div",null,[t("div",Ke,d(c.name),1),c.brand_code?(n(),i("div",Qe,d(c.brand_code),1)):_("",!0),c.complete_address?(n(),i("div",Je,d(c.complete_address),1)):_("",!0)])]),t("td",ze,[L(t("input",{"onUpdate:modelValue":g=>a.value[s.date][c.id]=g,type:"number",step:"0.01",min:y.variant==="ICE CREAM"?"5":"0",class:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",placeholder:y.variant==="ICE CREAM"?"Min: 5":"0",onBlur:g=>Y(s.date,c.id,a.value[s.date][c.id]),onKeydown:$(R,["enter"])},null,40,He),[[O,a.value[s.date][c.id]]])])]))),128)),t("tr",Ye,[e[14]||(e[14]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"}," TOTAL ",-1)),t("td",Ze,d(I(s.date)),1)])],64))),128)),t("tr",We,[e[16]||(e[16]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"}," GRAND TOTAL ",-1)),t("td",Xe,d(K.value),1)])])])])),t("div",{class:"flex justify-end gap-3 mt-6"},[t("button",{onClick:C,class:"px-4 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"}," Cancel "),t("button",{onClick:P,class:"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"}," Update Orders ")])])])]}),_:1})]),_:1})],64)}}};export{tt as default};
