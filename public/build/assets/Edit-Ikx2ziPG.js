import{f as Y,T as Z,x as W,l as C,r as w,o as n,d as i,a as h,u as X,Z as j,w as T,b as ee,g as t,t as d,F as b,e as m,h as _,m as B,z as L,A as $,N as te}from"./app-DZB5krWT.js";import{u as re}from"./useToast-D0DYAlSU.js";const se={class:"bg-white border rounded-md shadow-sm p-6"},oe={class:"space-y-4"},ae={class:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4"},de={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},le={class:"text-lg font-bold text-blue-700"},ne={class:"text-lg font-bold text-blue-600"},ie={class:"text-sm font-medium text-gray-700"},ce={key:0,class:"mt-6 overflow-x-auto"},ue={class:"min-w-full border-collapse border border-gray-300 text-sm"},ye={class:"bg-gray-100"},be=["colspan"],pe={class:"text-xs font-bold"},me={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},ge={key:1,class:"text-xs text-gray-500 mt-1"},xe={class:"bg-gray-200"},fe={class:"text-xs"},he={class:"text-xs"},_e={class:"border border-gray-300 px-3 py-2"},ve={class:"border border-gray-300 px-3 py-2"},Ee={class:"border border-gray-300 px-3 py-2 text-center"},we={class:"border border-gray-300 px-3 py-2 text-right"},Te=["onUpdate:modelValue"],Ce={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},ke={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ae={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ne={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-green-50"},Ie={class:"bg-gray-700 text-white font-bold"},Se=["colspan"],De={class:"border border-gray-300 px-3 py-2 text-right"},Fe={key:1,class:"mt-6 overflow-x-auto"},Me={class:"min-w-full border-collapse border border-gray-300 text-sm"},Re={class:"bg-white"},Oe={class:"border border-gray-300 px-3 py-2"},Be={class:"border border-gray-300 px-3 py-2"},Le={class:"border border-gray-300 px-3 py-2 text-center font-semibold"},$e={key:0},Ve={class:"bg-gray-200"},Pe={class:"border border-gray-300 px-3 py-2 font-bold text-base",colspan:"3"},Ue={class:"border border-gray-300 px-3 py-2",colspan:"2"},qe={class:"font-bold"},Ge={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},Ke={key:1,class:"text-xs text-gray-500 mt-1"},Qe={class:"border border-gray-300 px-2 py-1"},Je=["onUpdate:modelValue","min","placeholder","onBlur"],ze={class:"bg-blue-50 font-semibold"},He={class:"border border-gray-300 px-3 py-2 text-center"},Ye={class:"bg-gray-700 text-white font-bold"},Ze={class:"border border-gray-300 px-3 py-2 text-center"},je={__name:"Edit",props:{batch_number:{type:String,required:!0},variant:{type:String,default:null},date_from:{type:String,default:null},date_to:{type:String,default:null},stores:{type:Array,default:()=>[]},dates:{type:Array,default:()=>[]},sap_item:{type:Object,default:null},existing_orders:{type:Object,default:()=>({})},status:{type:String,default:null},supplier_items:{type:Array,default:()=>[]}},setup(y){const l=y,{toast:v}=re(),V=Y(),k=()=>{te.get(route("cs-dts-mass-commits.index"))},P=()=>{let r=!1;if(l.variant==="FRUITS AND VEGETABLES")for(const e in a.value){for(const o in a.value[e]){for(const c in a.value[e][o])if(a.value[e][o][c]&&parseFloat(a.value[e][o][c])>0){r=!0;break}if(r)break}if(r)break}else for(const e in a.value){for(const o in a.value[e])if(a.value[e][o]&&parseFloat(a.value[e][o])>0){r=!0;break}if(r)break}if(!r){v.add({severity:"warn",summary:"No Orders",detail:"Please enter at least one order quantity before committing.",life:3e3});return}V.require({message:"Are you sure you want to commit these orders? This will finalize the quantities and update the status.",header:"Confirm Order Commit",icon:"pi pi-exclamation-triangle",accept:()=>{U()},reject:()=>{},acceptClass:"p-button-success",rejectClass:"p-button-danger"})},g=Z({variant:l.variant,orders:{},sap_item:l.sap_item,supplier_items:l.supplier_items||[]}),U=()=>{l.variant==="FRUITS AND VEGETABLES"?(g.orders=a.value,g.supplier_items=l.supplier_items,g.sap_item=null):(g.orders=a.value,g.sap_item=l.sap_item),g.variant=l.variant,g.put(route("cs-dts-mass-commits.update",l.batch_number),{onSuccess:()=>{v.add({severity:"success",summary:"Orders Committed",detail:"Your mass orders have been successfully committed.",life:3e3})},onError:r=>{v.add({severity:"error",summary:"Error",detail:r.error||"Failed to commit orders. Please try again.",life:5e3})}})},A=r=>{if(!r)return"Not Selected";try{const[e,o,c]=r.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o,10)-1]} ${parseInt(c,10)}, ${e}`}catch{return r}},a=W({});l.variant==="FRUITS AND VEGETABLES"?l.supplier_items.forEach(r=>{a.value[r.id]={},l.dates.forEach(e=>{a.value[r.id][e.date]={},l.stores.forEach(o=>{var p,f;const c=((f=(p=l.existing_orders[r.id])==null?void 0:p[e.date])==null?void 0:f[o.id])||"";a.value[r.id][e.date][o.id]=c})})}):l.dates.forEach(r=>{a.value[r.date]={},l.stores.forEach(e=>{var c;const o=((c=l.existing_orders[r.date])==null?void 0:c[e.id])||"";a.value[r.date][e.id]=o})});const N=r=>{let e=0;return l.stores.forEach(o=>{var p;const c=parseFloat(((p=a.value[r])==null?void 0:p[o.id])||0);e+=isNaN(c)?0:c}),e},q=C(()=>{let r=0;return l.dates.forEach(e=>{r+=N(e.date)}),r}),I=(r,e)=>!r.delivery_schedule_ids||!e.delivery_schedule_id?!1:r.delivery_schedule_ids.includes(e.delivery_schedule_id),G=r=>l.stores.filter(e=>I(e,r)),E=r=>l.dates.filter(e=>I(r,e)),K=C(()=>{let r=0;return l.stores.forEach(e=>{r+=E(e).length}),r}),S=r=>{let e=0;return a.value[r]?(Object.keys(a.value[r]).forEach(o=>{Object.keys(a.value[r][o]).forEach(c=>{const p=parseFloat(a.value[r][o][c]||0);e+=isNaN(p)?0:p})}),e):0},Q=()=>10,D=r=>S(r)*1.1,F=(r,e)=>D(r)*e,J=C(()=>{let r=0;return l.supplier_items.forEach(e=>{r+=F(e.id,e.price)}),r}),M=r=>{const e=Array.from(document.querySelectorAll('input[type="number"]')),o=e.indexOf(r.target);o>-1&&o<e.length-1&&(r.preventDefault(),e[o+1].focus(),e[o+1].select())},z=(r,e,o)=>{if(l.variant==="ICE CREAM"){const c=parseFloat(o);if(o!==""&&o!==null&&!isNaN(c)&&c>0&&c<5)return v.add({severity:"warn",summary:"Invalid Quantity",detail:"ICE CREAM orders must be at least 5 gallons (GAL 3.8)",life:4e3}),a.value[r][e]="",!1}return!0};return(r,e)=>{const o=w("Button"),c=w("TableHeader"),p=w("TableContainer"),f=w("Layout");return n(),i(b,null,[h(X(j),{title:"Commit DTS Mass Order"}),h(f,{heading:`Commit DTS Mass Order: ${y.batch_number}`},{default:T(()=>[h(p,null,{default:T(()=>{var R,O;return[h(c,null,{default:T(()=>[h(o,{onClick:k,variant:"outline",class:"text-black border-black hover:bg-gray-100"},{default:T(()=>e[0]||(e[0]=[ee(" Back ")])),_:1})]),_:1}),t("div",se,[t("div",oe,[t("div",ae,[t("div",de,[t("div",null,[e[1]||(e[1]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Batch Number",-1)),t("p",le,d(y.batch_number),1)]),t("div",null,[e[2]||(e[2]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Variant",-1)),t("p",ne,d(y.variant),1)]),t("div",null,[e[3]||(e[3]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Date Range",-1)),t("p",ie,d(A(y.date_from))+" - "+d(A(y.date_to)),1)])])]),y.variant==="FRUITS AND VEGETABLES"?(n(),i("div",ce,[t("table",ue,[t("thead",null,[t("tr",ye,[e[4]||(e[4]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"100px"}},"ITEM CODE",-1)),e[5]||(e[5]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"200px"}},"ITEM NAME",-1)),e[6]||(e[6]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"UOM",-1)),e[7]||(e[7]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"PRICE",-1)),(n(!0),i(b,null,m(y.stores,s=>(n(),i("th",{key:`store-${s.id}`,colspan:E(s).length,class:"border border-gray-300 px-2 py-2 font-semibold text-center bg-blue-50",style:{"min-width":"120px"}},[t("div",pe,d(s.name),1),s.brand_code?(n(),i("div",me,d(s.brand_code),1)):_("",!0),s.complete_address?(n(),i("div",ge,d(s.complete_address),1)):_("",!0)],8,be))),128)),e[8]||(e[8]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL ORDER",-1)),e[9]||(e[9]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"BUFFER",-1)),e[10]||(e[10]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL PO",-1)),e[11]||(e[11]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-green-100 align-middle"},"TOTAL PRICE",-1))]),t("tr",xe,[(n(!0),i(b,null,m(y.stores,s=>(n(),i(b,{key:`dates-${s.id}`},[(n(!0),i(b,null,m(E(s),u=>(n(),i("th",{key:`date-${s.id}-${u.date}`,class:"border border-gray-300 px-2 py-2 font-semibold text-center"},[t("div",fe,d(u.day_of_week),1),t("div",he,d(u.display.split("- ")[1]),1)]))),128))],64))),128))])]),t("tbody",null,[(n(!0),i(b,null,m(y.supplier_items,s=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",_e,d(s.item_code),1),t("td",ve,d(s.item_name),1),t("td",Ee,d(s.uom),1),t("td",we,d(s.price.toFixed(2)),1),(n(!0),i(b,null,m(y.stores,u=>(n(),i(b,{key:`body-${u.id}`},[(n(!0),i(b,null,m(E(u),x=>(n(),i("td",{key:`${s.id}-${u.id}-${x.date}`,class:"border border-gray-300 px-1 py-1"},[B(t("input",{"onUpdate:modelValue":H=>a.value[s.id][x.date][u.id]=H,type:"number",step:"0.01",min:"0",class:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",onKeydown:$(M,["enter"])},null,40,Te),[[L,a.value[s.id][x.date][u.id]]])]))),128))],64))),128)),t("td",Ce,d(S(s.id).toFixed(2)),1),t("td",ke,d(Q())+"% ",1),t("td",Ae,d(D(s.id).toFixed(2)),1),t("td",Ne,d(F(s.id,s.price).toFixed(2)),1)]))),128)),t("tr",Ie,[e[12]||(e[12]=t("td",{colspan:"4",class:"border border-gray-300 px-3 py-2 text-right"},"TOTAL PRICE",-1)),t("td",{colspan:K.value+3,class:"border border-gray-300 px-3 py-2"},null,8,Se),t("td",De,d(J.value.toFixed(2)),1)])])])])):(n(),i("div",Fe,[t("table",Me,[t("thead",null,[e[13]||(e[13]=t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"120px"}},"ITEM CODE"),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"200px"}},"ITEM DESCRIPTION"),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-center",style:{"min-width":"100px"}},"UOM")],-1)),t("tr",Re,[t("td",Oe,d(((R=y.sap_item)==null?void 0:R.item_code)||""),1),t("td",Be,d(((O=y.sap_item)==null?void 0:O.item_description)||""),1),t("td",Le,[y.sap_item?(n(),i("span",$e,d(y.sap_item.alt_uom),1)):_("",!0)])])]),t("tbody",null,[(n(!0),i(b,null,m(y.dates,s=>(n(),i(b,{key:s.date},[t("tr",Ve,[t("td",Pe,d(s.display),1)]),e[15]||(e[15]=t("tr",{class:"bg-gray-50"},[t("td",{class:"border border-gray-300 px-3 py-2 font-semibold",colspan:"2"},"Store Name"),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"},"Quantity")],-1)),(n(!0),i(b,null,m(G(s),u=>(n(),i("tr",{key:`${s.date}-${u.id}`,class:"hover:bg-gray-50"},[t("td",Ue,[t("div",null,[t("div",qe,d(u.name),1),u.brand_code?(n(),i("div",Ge,d(u.brand_code),1)):_("",!0),u.complete_address?(n(),i("div",Ke,d(u.complete_address),1)):_("",!0)])]),t("td",Qe,[B(t("input",{"onUpdate:modelValue":x=>a.value[s.date][u.id]=x,type:"number",step:"0.01",min:y.variant==="ICE CREAM"?"5":"0",class:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",placeholder:y.variant==="ICE CREAM"?"Min: 5":"0",onBlur:x=>z(s.date,u.id,a.value[s.date][u.id]),onKeydown:$(M,["enter"])},null,40,Je),[[L,a.value[s.date][u.id]]])])]))),128)),t("tr",ze,[e[14]||(e[14]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"},"TOTAL",-1)),t("td",He,d(N(s.date)),1)])],64))),128)),t("tr",Ye,[e[16]||(e[16]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"},"GRAND TOTAL",-1)),t("td",Ze,d(q.value),1)])])])])),t("div",{class:"flex justify-end gap-3 mt-6"},[t("button",{onClick:k,class:"px-4 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"}," Cancel "),t("button",{onClick:P,class:"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"}," COMMIT ALL ")])])])]}),_:1})]),_:1},8,["heading"])],64)}}};export{je as default};
