import{l as p,o as m,c as A,w as o,d as _,n as H,u as a,a2 as R,t as n,h as x,a1 as re,bs as ne,X as ie,x as q,r as de,g as r,a as l,b as f,N as ce,aj as ue,aw as k,az as $,au as C,av as I,e as O,A as W,k as z,F as E}from"./app-Bw_fMWAP.js";import{_ as fe,a as me,b as F,c as b,d as ge,e as y}from"./TableHeader-CuUfzgBx.js";import _e from"./WastageStatusBadge-DMiarsGv.js";import{A as ve}from"./arrow-left-D4hae3WF.js";import{P as G}from"./package-B7IKRS5Q.js";import{C as pe}from"./calendar-DBmwDqo5.js";import{P as xe}from"./paperclip-Dg3LWnPx.js";import{L as ye}from"./loader-circle-CrDwNvR8.js";import{C as we}from"./circle-alert-CKZC4SuZ.js";import{U as V}from"./user-DRUPNnu4.js";import{C as Q}from"./circle-x-Bf0oHHlB.js";import{T as he}from"./triangle-alert-Dth29Wrv.js";import"./TooltipTrigger-Ddsvj8Ve.js";import"./clock-DsuBE0vk.js";const be={__name:"Separator",props:{orientation:{type:String,required:!1},decorative:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},class:{type:null,required:!1},label:{type:String,required:!1}},setup(g){const u=g,M=p(()=>{const{class:j,...N}=u;return N});return(j,N)=>(m(),A(a(ne),re(M.value,{class:a(R)("shrink-0 bg-border relative",u.orientation==="vertical"?"w-px h-full":"h-px w-full",u.class)}),{default:o(()=>[u.label?(m(),_("span",{key:0,class:H(a(R)("text-xs text-muted-foreground bg-background absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex justify-center items-center",u.orientation==="vertical"?"w-[1px] px-1 py-2":"h-[1px] py-1 px-2"))},n(u.label),3)):x("",!0)]),_:1},16,["class"]))}},ke={class:"flex items-center gap-2"},$e={class:"space-y-6"},Ce={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ie={class:"flex items-center gap-4"},Ae={class:"p-3 bg-blue-100 rounded-lg"},Ne={class:"text-2xl font-bold text-gray-900"},De={class:"flex items-center gap-2 mt-1"},Le={class:"text-sm text-gray-600"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ue={class:"text-lg font-semibold"},Fe={class:"text-gray-900"},Me={class:"flex justify-between items-center"},je={class:"text-2xl font-bold"},Be={class:"flex justify-between items-center"},qe={class:"text-2xl font-bold text-green-600"},Ge={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},Pe=["onClick","onKeydown","aria-label"],Te={class:"aspect-w-1 aspect-h-1"},Re={key:0,class:"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center"},Oe={key:1,class:"absolute inset-0 bg-red-50 rounded-lg flex flex-col items-center justify-center p-4"},We={class:"text-xs text-red-700 text-center mb-2"},ze={key:0,class:"text-xs text-gray-600 mb-2"},Ee={class:"flex gap-2"},Ve=["onClick"],Qe={key:0,class:"text-xs text-gray-500"},He=["src","alt","onLoad","onError","onLoadstart"],Ke={key:0,class:"absolute bottom-1 left-1 bg-black bg-opacity-75 text-white text-xs p-1 rounded max-w-full truncate pointer-events-none"},Ze={key:0,class:"block text-yellow-300"},Xe={key:1,class:"absolute top-1 left-1 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"},Ye={class:"font-medium"},Je={class:"text-sm text-gray-500"},et={key:0},tt={class:"space-y-4"},st={class:"flex items-center gap-3"},at={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},lt={class:"font-medium"},ot={class:"text-sm text-gray-500"},rt={key:0,class:"flex items-center gap-3"},nt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},it={class:"font-medium"},dt={class:"text-sm text-gray-500"},ct={key:1,class:"flex items-center gap-3"},ut={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},ft={class:"font-medium"},mt={class:"text-sm text-gray-500"},gt={key:2,class:"flex items-center gap-3"},_t={class:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center"},vt={class:"font-medium"},pt={class:"text-sm text-gray-500"},xt={__name:"Show",props:{wastage:Object,permissions:Object,statusTransitions:Array},setup(g){const u=g,M=p(()=>u.wastage.wastage_no||"N/A"),j=p(()=>u.wastage.wastage_status||"pending"),N=p(()=>{var s,e;return((s=u.wastage.storeBranch)==null?void 0:s.name)||((e=u.wastage.storeBranch)==null?void 0:e.branch_name)||"Unknown Store"}),K=p(()=>new Date(u.wastage.created_at).toLocaleDateString()),Z=p(()=>u.wastage.remarks||"No remarks provided"),D=s=>{if(!s)return"N/A";const e=new Date(s),d=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),i=e.getFullYear();let c=e.getHours();const U=String(e.getMinutes()).padStart(2,"0"),oe=c>=12?"P.M.":"A.M.";return c=c%12,c=c||12,`${d}/${t}/${i} ${String(c).padStart(2,"0")}:${U} ${oe}`},L=s=>s?s.name&&s.name!==s.email?s.name:s.first_name||s.last_name?`${s.first_name||""} ${s.last_name||""}`.trim():s.email?s.email.split("@")[0].replace(/[._]/g," ").replace(/\b\w/g,d=>d.toUpperCase()):"Unknown User":"Unknown User",X=p(()=>{var e;if(!((e=u.wastage)!=null&&e.items)||!Array.isArray(u.wastage.items))return 0;const s=u.wastage.items.reduce((d,t)=>d+(Number(t.wastage_qty)||0),0);return Number(s)||0}),P=p(()=>{var e;if(!((e=u.wastage)!=null&&e.items)||!Array.isArray(u.wastage.items))return 0;const s=u.wastage.items.reduce((d,t)=>{const i=Number(t.wastage_qty)||0,c=Number(t.cost)||0;return d+i*c},0);return Number(s)||0}),w=q({}),v=q({}),h=q({}),Y=(s,e=0)=>{if(!s)return{url:"",isGoogleDrive:!1,hasMoreFallbacks:!1};if(s.includes("drive.google.com"))try{let d=null;if(s.includes("/file/d/")){const t=s.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);t&&(d=t[1])}else if(s.includes("open?id=")){const t=s.match(/[?&]id=([a-zA-Z0-9_-]+)/);t&&(d=t[1])}if(d){const t=[`/proxy/google-drive/${d}`,`https://drive.google.com/thumbnail?id=${d}&sz=s400`,`https://drive.google.com/uc?export=view&id=${d}`,`https://drive.google.com/uc?export=download&id=${d}`,`https://docs.google.com/uc?export=view&id=${d}`,`https://lh3.googleusercontent.com/d/${d}=s400`];return e<t.length?{url:t[e],isGoogleDrive:!0,hasMoreFallbacks:e<t.length-1,fileId:d,attemptIndex:e,totalFormats:t.length,allFormats:t}:{url:"",isGoogleDrive:!0,hasMoreFallbacks:!1,fileId:d}}}catch(d){console.error("Error transforming Google Drive URL:",d,"URL:",s)}return{url:s,isGoogleDrive:!1,hasMoreFallbacks:!1}},T=p(()=>{var d,t;let s=[];return(d=u.wastage)!=null&&d.image_urls&&Array.isArray(u.wastage.image_urls)&&u.wastage.image_urls.length>0?s=u.wastage.image_urls:(t=u.wastage)!=null&&t.image_url&&(s=[u.wastage.image_url]),s.map(i=>{h.value[i]===void 0&&(h.value[i]=0);const c=h.value[i],U=Y(i,c);return{type:"existing",url:U.url,id:i,originalUrl:i,urlInfo:U,attemptIndex:c}})}),J=p(()=>T.value.length>0),ee=p(()=>{try{return!1}catch(s){return console.warn("Could not determine development mode:",s),!1}}),te=s=>{w.value[s]=!1,v.value[s]=null,h.value[s]=0},se=(s,e)=>{if(e.urlInfo&&e.urlInfo.isGoogleDrive&&e.urlInfo.hasMoreFallbacks){const d=(h.value[s]||0)+1;h.value[s]=d;return}w.value[s]=!1,e.urlInfo&&e.urlInfo.isGoogleDrive?v.value[s]=`Failed to load image after trying ${e.urlInfo.totalFormats} different URL formats. The Google Drive file may not be publicly accessible or may have been deleted.`:v.value[s]="Failed to load image. The URL may be invalid or the image may not be accessible."},ae=s=>{const e=s.id;w.value[e]=!0,v.value[e]=null},le=s=>{s.urlInfo&&s.urlInfo.isGoogleDrive&&s.urlInfo.hasMoreFallbacks?(h.value[s.id]=(h.value[s.id]||0)+1,v.value[s.id]=null,w.value[s.id]=!0):(h.value[s.id]=0,v.value[s.id]=null,w.value[s.id]=!0)},B=(s,e)=>{w.value[s.id]||v.value[s.id]||window.open(s.url,"_blank")},S=s=>s?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s):"â‚±0.00";return(s,e)=>{const d=de("Layout");return m(),A(d,{heading:"Wastage Record Details"},{"header-actions":o(()=>[r("div",ke,[l(a(ue),{variant:"outline",onClick:e[0]||(e[0]=t=>a(ce).get(s.route("wastage.index")))},{default:o(()=>[l(a(ve),{class:"w-4 h-4 mr-2"}),e[1]||(e[1]=f(" Back to Wastage Records "))]),_:1})])]),default:o(()=>[r("div",$e,[l(a($),null,{default:o(()=>[l(a(k),{class:"p-6"},{default:o(()=>[r("div",Ce,[r("div",Ie,[r("div",Ae,[l(a(G),{class:"w-6 h-6 text-blue-600"})]),r("div",null,[r("h1",Ne,"Wastage Record #"+n(M.value),1),r("div",De,[l(a(pe),{class:"w-4 h-4 text-gray-500"}),r("span",Le,"Created on "+n(K.value),1)])])]),l(_e,{status:j.value},null,8,["status"])])]),_:1})]),_:1}),r("div",Se,[l(a($),null,{default:o(()=>[l(a(C),null,{default:o(()=>[l(a(I),{class:"flex items-center gap-2"},{default:o(()=>[l(a(G),{class:"w-5 h-5"}),e[2]||(e[2]=f(" Store Information "))]),_:1})]),_:1}),l(a(k),{class:"space-y-4"},{default:o(()=>[r("div",null,[e[3]||(e[3]=r("label",{class:"text-sm font-medium text-gray-500"},"Store Branch",-1)),r("p",Ue,n(N.value),1)]),r("div",null,[e[4]||(e[4]=r("label",{class:"text-sm font-medium text-gray-500"},"Remarks",-1)),r("p",Fe,n(Z.value),1)])]),_:1})]),_:1}),l(a($),null,{default:o(()=>[l(a(C),null,{default:o(()=>[l(a(I),{class:"flex items-center gap-2"},{default:o(()=>[l(a(G),{class:"w-5 h-5"}),e[5]||(e[5]=f(" Wastage Summary "))]),_:1})]),_:1}),l(a(k),{class:"space-y-4"},{default:o(()=>[r("div",Me,[e[6]||(e[6]=r("span",{class:"text-gray-600"},"Total Items",-1)),r("span",je,n(X.value),1)]),l(a(be)),r("div",Be,[e[7]||(e[7]=r("span",{class:"text-gray-600"},"Total Cost",-1)),r("span",qe,n(S(P.value)),1)])]),_:1})]),_:1})]),J.value?(m(),A(a($),{key:0},{default:o(()=>[l(a(C),null,{default:o(()=>[l(a(I),{class:"flex items-center gap-2"},{default:o(()=>[l(a(xe),{class:"w-5 h-5"}),e[8]||(e[8]=f(" Attached Images "))]),_:1})]),_:1}),l(a(k),null,{default:o(()=>[r("div",Ge,[(m(!0),_(E,null,O(T.value,(t,i)=>(m(),_("div",{key:t.id,class:H(["relative group cursor-pointer",{"cursor-zoom-in":!w.value[t.id]&&!v.value[t.id]}]),onClick:c=>B(t,i),onKeydown:[W(c=>B(t,i),["enter"]),W(z(c=>B(t,i),["prevent"]),["space"])],tabindex:"0",role:"button","aria-label":`View image ${i+1} in new tab`},[r("div",Te,[w.value[t.id]?(m(),_("div",Re,[l(a(ye),{class:"w-8 h-8 text-blue-600 animate-spin"})])):v.value[t.id]?(m(),_("div",Oe,[l(a(we),{class:"w-8 h-8 text-red-500 mb-2"}),r("p",We,n(v.value[t.id]),1),t.urlInfo&&t.urlInfo.isGoogleDrive?(m(),_("p",ze," Tried "+n(t.urlInfo.totalFormats)+" URL formats ",1)):x("",!0),r("div",Ee,[r("button",{onClick:z(c=>le(t),["stop"]),class:"text-xs text-blue-600 hover:text-blue-800 underline"},n(t.urlInfo&&t.urlInfo.isGoogleDrive&&t.urlInfo.hasMoreFallbacks?"Try Next URL":"Retry"),9,Ve),t.urlInfo&&t.urlInfo.isGoogleDrive&&t.urlInfo.hasMoreFallbacks?(m(),_("span",Qe," ("+n(t.urlInfo.totalFormats-(t.attemptIndex+1))+" left) ",1)):x("",!0)])])):(m(),_("img",{key:2,src:t.url,alt:`Wastage Image ${i+1}`,class:"object-cover shadow-lg rounded-lg w-full h-full hover:opacity-90 transition-opacity",onLoad:()=>te(t.id),onError:()=>se(t.id,t),onLoadstart:()=>ae(t)},null,40,He))]),ee.value?(m(),_("div",Ke,[f(n(t.type==="existing"?"Existing":"New")+" ",1),t.type==="existing"?(m(),_("span",Ze,"ID: "+n(t.id.substring(0,10))+"...",1)):x("",!0)])):x("",!0),!w.value[t.id]&&!v.value[t.id]?(m(),_("div",Xe," Click to view ")):x("",!0)],42,Pe))),128))])]),_:1})]),_:1})):x("",!0),l(a($),null,{default:o(()=>[l(a(C),null,{default:o(()=>[l(a(I),null,{default:o(()=>e[9]||(e[9]=[f("Wastage Items")])),_:1})]),_:1}),l(a(k),null,{default:o(()=>[l(a(fe),null,{default:o(()=>[l(a(me),null,{default:o(()=>[l(a(F),null,{default:o(()=>[l(a(b),null,{default:o(()=>e[10]||(e[10]=[f("Item")])),_:1}),l(a(b),null,{default:o(()=>e[11]||(e[11]=[f("Reason")])),_:1}),l(a(b),{class:"text-center"},{default:o(()=>e[12]||(e[12]=[f("Quantity")])),_:1}),l(a(b),{class:"text-center"},{default:o(()=>e[13]||(e[13]=[f("Approved Lvl1 Qty")])),_:1}),l(a(b),{class:"text-center"},{default:o(()=>e[14]||(e[14]=[f("Approved Lvl2 Qty")])),_:1}),l(a(b),{class:"text-right"},{default:o(()=>e[15]||(e[15]=[f("Cost")])),_:1}),l(a(b),{class:"text-right"},{default:o(()=>e[16]||(e[16]=[f("Total")])),_:1})]),_:1})]),_:1}),l(a(ge),null,{default:o(()=>[g.wastage.items&&g.wastage.items.length>0?(m(!0),_(E,{key:0},O(g.wastage.items,t=>(m(),A(a(F),{key:t.id},{default:o(()=>[l(a(y),null,{default:o(()=>{var i,c;return[r("div",null,[r("div",Ye,n(((i=t.sap_masterfile)==null?void 0:i.ItemCode)||"N/A"),1),r("div",Je,n(((c=t.sap_masterfile)==null?void 0:c.ItemDescription)||"No description"),1)])]}),_:2},1024),l(a(y),{class:"text-sm"},{default:o(()=>[f(n(t.reason||"No reason specified"),1)]),_:2},1024),l(a(y),{class:"text-center"},{default:o(()=>{var i,c;return[f(n(t.wastage_qty)+" "+n((((i=t.sap_masterfile)==null?void 0:i.AltUOM)||((c=t.sap_masterfile)==null?void 0:c.BaseUOM))??"PCS"),1)]}),_:2},1024),l(a(y),{class:"text-center"},{default:o(()=>{var i,c;return[f(n(t.approverlvl1_qty??0)+" "+n((((i=t.sap_masterfile)==null?void 0:i.AltUOM)||((c=t.sap_masterfile)==null?void 0:c.BaseUOM))??"PCS"),1)]}),_:2},1024),l(a(y),{class:"text-center"},{default:o(()=>{var i,c;return[f(n(t.approverlvl2_qty??0)+" "+n((((i=t.sap_masterfile)==null?void 0:i.AltUOM)||((c=t.sap_masterfile)==null?void 0:c.BaseUOM))??"PCS"),1)]}),_:2},1024),l(a(y),{class:"text-right"},{default:o(()=>[f(n(S(t.cost)),1)]),_:2},1024),l(a(y),{class:"text-right font-semibold"},{default:o(()=>[f(n(S(t.wastage_qty*t.cost)),1)]),_:2},1024)]),_:2},1024))),128)):(m(),A(a(F),{key:1},{default:o(()=>[l(a(y),{colspan:"7",class:"text-center py-8 text-gray-500"},{default:o(()=>e[17]||(e[17]=[f(" No items found ")])),_:1})]),_:1}))]),_:1}),g.wastage.items&&g.wastage.items.length>0?(m(),_("tfoot",et,[l(a(F),null,{default:o(()=>[l(a(y),{colspan:"6",class:"text-right font-bold"},{default:o(()=>e[18]||(e[18]=[f("Total:")])),_:1}),l(a(y),{class:"text-right font-bold text-green-600"},{default:o(()=>[f(n(S(P.value)),1)]),_:1})]),_:1})])):x("",!0)]),_:1})]),_:1})]),_:1}),l(a($),null,{default:o(()=>[l(a(C),null,{default:o(()=>[l(a(I),{class:"flex items-center gap-2"},{default:o(()=>[l(a(V),{class:"w-5 h-5"}),e[19]||(e[19]=f(" Approval Workflow "))]),_:1})]),_:1}),l(a(k),null,{default:o(()=>[r("div",tt,[r("div",st,[r("div",at,[l(a(V),{class:"w-4 h-4 text-blue-600"})]),r("div",null,[r("div",lt,n(L(g.wastage.encoder)),1),r("div",ot,"Created on "+n(D(g.wastage.created_at)),1)])]),g.wastage.approver1?(m(),_("div",rt,[r("div",nt,[l(a(Q),{class:"w-4 h-4 text-green-600"})]),r("div",null,[r("div",it,n(L(g.wastage.approver1)),1),r("div",dt,"Approved Level 1 on "+n(D(g.wastage.approved_level1_date)),1)])])):x("",!0),g.wastage.approver2?(m(),_("div",ct,[r("div",ut,[l(a(Q),{class:"w-4 h-4 text-green-600"})]),r("div",null,[r("div",ft,n(L(g.wastage.approver2)),1),r("div",mt,"Approved Level 2 on "+n(D(g.wastage.approved_level2_date)),1)])])):x("",!0),g.wastage.canceller?(m(),_("div",gt,[r("div",_t,[l(a(he),{class:"w-4 h-4 text-red-600"})]),r("div",null,[r("div",vt,n(L(g.wastage.canceller)),1),r("div",pt,"Cancelled on "+n(D(g.wastage.cancelled_date)),1)])])):x("",!0)])]),_:1})]),_:1})])]),_:1})}}},Ft=ie(xt,[["__scopeId","data-v-d84f3997"]]);export{Ft as default};
