import{D as N,f as U,T as W,r as w,o as m,d as F,g as f,n as O,a as g,w as h,b as p,t as P,u as v,c as M,F as R,h as q}from"./app-DPA7xop8.js";import{u as z}from"./useToast-CL68v_82.js";/**
 * @license lucide-vue-next v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=N("CameraIcon",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),j={class:"flex flex-col items-center space-y-4"},G={class:"flex space-x-4"},Q={__name:"Camera",props:{store_order_id:null,isModalOpen:{type:Boolean,default:!1}},emits:["uploadSuccess"],setup(y,{emit:S}){U();const{toast:k}=z(),t=ref(null),a=ref(null),o=ref(null),s=ref(!0),u=ref(null),i=ref(null),B=S,C=ref(!1),c=ref(!1);onMounted(async()=>{y.isModalOpen&&await _()}),watch(()=>y.isModalOpen,async e=>{e?await _():x()}),onUnmounted(()=>{x()});const n=W({store_order_id:y.store_order_id,image:null}),D={audio:!1,video:{width:{ideal:1920},height:{ideal:1080}}};async function _(){var e;if(!a.value||!t.value){console.error("Video or canvas element not found");return}if(o.value=t.value.getContext("2d"),!((e=navigator.mediaDevices)!=null&&e.getUserMedia)){k.add({severity:"error",summary:"Error",detail:"Session is not secured, could not open camera.",life:5e3}),C.value=!0;return}await b()}function x(){i.value&&(i.value.getTracks().forEach(e=>e.stop()),i.value=null),s.value=!1,o.value&&t.value&&o.value.clearRect(0,0,t.value.width,t.value.height)}async function b(){try{const e=await navigator.mediaDevices.getUserMedia(D);i.value=e,await T(e)}catch(e){console.error("Error accessing camera:",e),C.value=!0}}async function T(e){if(a.value){a.value.srcObject=e,s.value=!0,u.value=null,n.image=null;try{await a.value.play(),requestAnimationFrame(E)}catch(r){console.error("Error playing video:",r)}}}function E(){if(!o.value||!a.value||!t.value||!s.value)return;const e=Math.min(t.value.width/a.value.videoWidth,t.value.height/a.value.videoHeight),r=(t.value.width-a.value.videoWidth*e)/2,l=(t.value.height-a.value.videoHeight*e)/2;o.value.drawImage(a.value,r,l,a.value.videoWidth*e,a.value.videoHeight*e),requestAnimationFrame(E)}function H(){if(!a.value)return;s.value=!1,i.value&&i.value.getTracks().forEach(l=>l.stop());const e=document.createElement("canvas");e.width=a.value.videoWidth,e.height=a.value.videoHeight,e.getContext("2d").drawImage(a.value,0,0,a.value.videoWidth,a.value.videoHeight),u.value=e.toDataURL("image/png",1),fetch(u.value).then(l=>l.blob()).then(l=>{const d=new File([l],"camera-capture.png",{type:"image/png"});n.image=d})}async function I(){n.clearErrors(),o.value&&t.value&&o.value.clearRect(0,0,t.value.width,t.value.height),s.value=!0,u.value=null,n.image=null,await b()}function L(){if(!n.image){console.error("No image captured");return}c.value=!0,n.post(route("upload-image"),{onSuccess:()=>{k.add({severity:"success",summary:"Success",detail:"Image attached successfully.",life:5e3}),B("uploadSuccess"),c.value=!1},onError:e=>{c.value=!1,console.log(e)}})}return(e,r)=>{const l=w("FormError"),d=w("Button"),V=w("Loading");return m(),F("div",j,[f("video",{ref_key:"video",ref:a,width:"500",height:"320",autoplay:"",playsinline:"","webkit-playsinline":"",muted:"",class:O({hidden:!0})},null,512),f("canvas",{ref_key:"canvas",ref:t,width:"500",height:"320",class:"border border-gray-300 rounded-lg bg-black"},null,512),g(l,null,{default:h(()=>[p(P(v(n).errors.image),1)]),_:1}),f("div",G,[v(u)?(m(),F(R,{key:1},[g(d,{variant:"outline",onClick:I},{default:h(()=>r[1]||(r[1]=[p(" Retake Picture ")])),_:1}),g(d,{disabled:v(c),onClick:L,class:"gap-2"},{default:h(()=>[r[2]||(r[2]=p(" Upload Picture ")),f("span",null,[v(c)?(m(),M(V,{key:0})):q("",!0)])]),_:1},8,["disabled"])],64)):(m(),M(d,{key:0,onClick:H},{default:h(()=>[g(v(A),{class:"mr-2"}),r[0]||(r[0]=p(" Take Picture "))]),_:1}))])])}}};export{Q as default};
