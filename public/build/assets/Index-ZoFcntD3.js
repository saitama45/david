import{x as O,T as X,y as ee,N as q,l as le,r as y,o as t,d as r,a,u,Z as te,w as s,g as n,t as i,b as m,b0 as ae,h as c,k as S,F as C,e as $,E as F,c as f,n as z}from"./app-rjK1ng7o.js";import{l as ne}from"./lodash-DqVvdaAw.js";import{_ as I}from"./InputError-DsYJsK4l.js";import{u as oe}from"./useToast-DBCD-RTl.js";import{U as se}from"./upload-CiN_PamT.js";import{A as V,a as U}from"./arrow-up-7v0uQaPG.js";const de={class:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md"},ue={key:0,class:"mb-6 p-4 border border-blue-300 bg-blue-50 rounded-md text-blue-800"},re={key:0,class:"font-medium"},ie={key:1,class:"font-medium"},ce={class:"text-sm mt-1"},me={key:2},pe={class:"mt-4"},fe=["href"],be={key:1,class:"mt-4 text-sm text-gray-600"},ve={key:1,class:"mb-6 p-4 border border-green-300 bg-green-50 rounded-md text-green-800"},he={key:0,class:"font-medium"},ye={key:1,class:"font-medium"},we={key:2,class:"text-sm mt-1"},ge={class:"flex justify-end"},_e={key:2,class:"mt-6 p-4 border border-purple-300 bg-purple-50 rounded-md text-purple-800"},xe={class:"list-disc pl-5 space-y-1"},ke={class:"mt-8"},Se={class:"hidden md:block"},Ce={key:0},Ve=["colspan"],Ue={class:"flex flex-wrap gap-1"},Te={class:"md:hidden grid grid-cols-1 gap-4"},Be={key:0,class:"text-center py-4 text-gray-500"},De={class:"flex justify-between items-start"},Ae={class:"font-semibold text-gray-800"},$e={class:"text-sm text-gray-600"},je={class:"text-xs text-gray-500"},Me={class:"mt-4 pt-4 border-t"},Oe={class:"text-sm mb-2"},Ee={class:"font-medium text-gray-800"},Ne={class:"text-sm"},Fe={class:"flex flex-wrap gap-1 mt-1"},He={__name:"Index",props:{downloadSchedule:{type:Object,default:null},uploadSchedule:{type:Object,default:null},message:{type:String,required:!0},userBranches:{type:Object,required:!0},branchesAwaitingUpload:{type:Object,required:!0},uploadedCountsAwaitingSubmission:{type:Array,required:!0},transactions:{type:Object,required:!0},filters:{type:Object,default:()=>({})},can:{type:Object,required:!0}},setup(o){const g=o,{toast:E}=oe(),T=O(null),w=X({schedule_id:g.uploadSchedule?g.uploadSchedule.id:null,branch_id:null,file:null}),b=O(g.filters.sort||"calculated_date"),p=O(g.filters.direction||"desc"),h=O({year:g.filters.year||null,month:g.filters.month||null,calculated_date:g.filters.calculated_date||null,status:g.filters.status||null,uploader_name:g.filters.uploader_name||null,branch_name:g.filters.branch_name||null}),k=v=>{b.value===v?p.value=p.value==="asc"?"desc":"asc":(b.value=v,p.value="asc")};ee([h,b,p],ne.throttle(()=>{q.get(route("month-end-count.index"),{...h.value,sort:b.value,direction:p.value},{preserveState:!0,replace:!0})},300),{deep:!0});const K=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],P=v=>{if(!v)return"N/A";const e=new Date(v);if(isNaN(e.getTime()))return v;const j=e.getTimezoneOffset()*6e4,D=new Date(e.getTime()+j);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(D)},H=()=>{if(!w.branch_id){E.add({severity:"warn",summary:"Validation Error",detail:"Please select a branch.",life:3e3});return}if(!w.file){E.add({severity:"warn",summary:"Validation Error",detail:"Please select a file to upload.",life:3e3});return}w.post(route("month-end-count.upload"),{onSuccess:()=>{w.reset(),T.value=null},onError:v=>{const e=v.error||v.file||v.branch_id||"Upload failed. Please try again.";E.add({severity:"error",summary:"Upload Failed",detail:e,life:5e3})}})},B=v=>{const e=new Date;return e.setMonth(v-1),e.toLocaleString("en-US",{month:"long"})},J=le(()=>Object.keys(g.branchesAwaitingUpload).length>0),N=(v,e)=>{q.get(route("month-end-count.review",{schedule:v,branch:e}))};return(v,e)=>{const j=y("Label"),D=y("Select"),M=y("Button"),A=y("Input"),_=y("TH"),R=y("TableHead"),x=y("TD"),L=y("Badge"),Y=y("TableBody"),Z=y("Table"),G=y("Pagination"),Q=y("TableContainer"),W=y("Layout");return t(),r(C,null,[a(u(te),{title:"Month End Count"}),a(W,{heading:"Month End Count"},{default:s(()=>[n("div",de,[e[27]||(e[27]=n("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Month End Count Process",-1)),o.downloadSchedule?(t(),r("div",ue,[o.can.download_month_end_count_template?(t(),r("p",re,i(o.message),1)):(t(),r("p",ie,"A month end count is scheduled. Please contact your administrator to get the required permissions to download the template.")),n("p",ce,"Scheduled for: "+i(B(o.downloadSchedule.month))+" "+i(o.downloadSchedule.year)+" (MEC Schedule Date: "+i(o.downloadSchedule.calculated_date)+")",1),o.can.download_month_end_count_template?(t(),r("div",me,[n("div",pe,[a(j,{for:"download_branch"},{default:s(()=>e[20]||(e[20]=[m("Select Branch for Download")])),_:1}),a(D,{id:"download_branch",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=l=>T.value=l),options:Object.entries(o.userBranches).map(([l,d])=>({value:l,label:d})),optionLabel:"label",optionValue:"value",placeholder:"Select a Branch",filter:"",class:"w-full"},null,8,["modelValue","options"])]),T.value?(t(),r("a",{key:0,href:v.route("month-end-count.download",{branch_id:T.value}),class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[a(u(ae),{class:"-ml-1 mr-2 h-5 w-5"}),e[21]||(e[21]=m(" Download Count Template "))],8,fe)):(t(),r("p",be,"Please select a branch to enable download."))])):c("",!0)])):J.value?(t(),r("div",ve,[o.can.upload_month_end_count_transaction?(t(),r("p",he,i(o.message),1)):(t(),r("p",ye,"A month end count is pending upload. Please contact your administrator to get the required permissions to upload the count sheet.")),o.uploadSchedule?(t(),r("p",we,"Scheduled for: "+i(B(o.uploadSchedule.month))+" "+i(o.uploadSchedule.year)+" (MEC Schedule Date: "+i(o.uploadSchedule.calculated_date)+")",1)):c("",!0),o.can.upload_month_end_count_transaction?(t(),r("form",{key:3,onSubmit:S(H,["prevent"]),class:"mt-4 space-y-4"},[n("div",null,[a(j,{for:"upload_branch"},{default:s(()=>e[22]||(e[22]=[m("Select Branch for Upload")])),_:1}),a(D,{id:"upload_branch",modelValue:u(w).branch_id,"onUpdate:modelValue":e[1]||(e[1]=l=>u(w).branch_id=l),options:Object.entries(o.branchesAwaitingUpload).map(([l,d])=>({value:l,label:d})),optionLabel:"label",optionValue:"value",placeholder:"Select a Branch",filter:"",class:"w-full"},null,8,["modelValue","options"]),a(I,{message:u(w).errors.branch_id},null,8,["message"])]),n("div",null,[e[23]||(e[23]=n("label",{for:"file",class:"block text-sm font-medium text-gray-700"},"Upload Completed Count Sheet",-1)),n("input",{type:"file",onInput:e[2]||(e[2]=l=>u(w).file=l.target.files[0]),id:"file",class:"mt-1 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"},null,32),a(I,{message:u(w).errors.file},null,8,["message"])]),n("div",ge,[a(M,{type:"submit",disabled:u(w).processing||!u(w).file||!u(w).branch_id},{default:s(()=>[a(u(se),{class:"-ml-1 mr-2 h-5 w-5"}),e[24]||(e[24]=m(" Upload and Process Count "))]),_:1},8,["disabled"])])],32)):c("",!0)])):c("",!0),o.can.upload_month_end_count_transaction&&o.uploadedCountsAwaitingSubmission.length?(t(),r("div",_e,[e[26]||(e[26]=n("p",{class:"font-medium mb-2"},"Your Uploaded Counts Awaiting Submission:",-1)),n("ul",xe,[(t(!0),r(C,null,$(o.uploadedCountsAwaitingSubmission,l=>(t(),r("li",{key:`${l.schedule_id}-${l.branch_id}`},[m(" Count for "+i(B(l.schedule_month))+" "+i(l.schedule_year)+" (Branch: "+i(l.branch_name)+") ",1),a(M,{onClick:d=>N(l.schedule_id,l.branch_id),variant:"link",size:"sm",class:"ml-2 p-0 h-auto"},{default:s(()=>[a(u(F),{class:"h-4 w-4 mr-1"}),e[25]||(e[25]=m(" Review "))]),_:2},1032,["onClick"])]))),128))])])):c("",!0)]),n("div",ke,[e[37]||(e[37]=n("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Transaction History",-1)),a(Q,null,{default:s(()=>[n("div",Se,[a(Z,null,{default:s(()=>[a(R,null,{default:s(()=>[a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[3]||(e[3]=l=>k("year"))},[e[28]||(e[28]=m(" Year ")),b.value==="year"&&p.value==="asc"?(t(),f(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),b.value==="year"&&p.value==="desc"?(t(),f(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:h.value.year,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value.year=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[5]||(e[5]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[6]||(e[6]=l=>k("month"))},[e[29]||(e[29]=m(" Month ")),b.value==="month"&&p.value==="asc"?(t(),f(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),b.value==="month"&&p.value==="desc"?(t(),f(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(D,{modelValue:h.value.month,"onUpdate:modelValue":e[7]||(e[7]=l=>h.value.month=l),options:K,optionLabel:"label",optionValue:"value",placeholder:"Select Month",class:"mt-1 w-full text-sm",showClear:""},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[8]||(e[8]=l=>k("calculated_date"))},[e[30]||(e[30]=m(" MEC Schedule Date ")),b.value==="calculated_date"&&p.value==="asc"?(t(),f(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),b.value==="calculated_date"&&p.value==="desc"?(t(),f(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"date",modelValue:h.value.calculated_date,"onUpdate:modelValue":e[9]||(e[9]=l=>h.value.calculated_date=l),class:"mt-1 w-full text-sm",onKeydown:e[10]||(e[10]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[11]||(e[11]=l=>k("branch_name"))},[e[31]||(e[31]=m(" Branch ")),b.value==="branch_name"&&p.value==="asc"?(t(),f(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),b.value==="branch_name"&&p.value==="desc"?(t(),f(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:h.value.branch_name,"onUpdate:modelValue":e[12]||(e[12]=l=>h.value.branch_name=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[13]||(e[13]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[14]||(e[14]=l=>k("uploader_name"))},[e[32]||(e[32]=m(" Uploader ")),b.value==="uploader_name"&&p.value==="asc"?(t(),f(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),b.value==="uploader_name"&&p.value==="desc"?(t(),f(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:h.value.uploader_name,"onUpdate:modelValue":e[15]||(e[15]=l=>h.value.uploader_name=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[16]||(e[16]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[17]||(e[17]=l=>k("statuses"))},[e[33]||(e[33]=m(" Status ")),b.value==="statuses"&&p.value==="asc"?(t(),f(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),b.value==="statuses"&&p.value==="desc"?(t(),f(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:h.value.status,"onUpdate:modelValue":e[18]||(e[18]=l=>h.value.status=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[19]||(e[19]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),o.can.view_transaction?(t(),f(_,{key:0},{default:s(()=>e[34]||(e[34]=[m("Actions")])),_:1})):c("",!0)]),_:1}),a(Y,null,{default:s(()=>[o.transactions.data.length?c("",!0):(t(),r("tr",Ce,[n("td",{colspan:o.can.view_transaction?7:6,class:"text-center py-4"},"No transactions found.",8,Ve)])),(t(!0),r(C,null,$(o.transactions.data,l=>(t(),r("tr",{key:`${l.schedule_id}-${l.branch_id}`},[a(x,null,{default:s(()=>[m(i(l.year),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(B(l.month)),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(P(l.calculated_date)),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(l.branch_name),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(l.uploader_name),1)]),_:2},1024),a(x,null,{default:s(()=>[n("div",Ue,[(t(!0),r(C,null,$([...new Set(l.statuses.split(", "))],d=>(t(),f(L,{key:d,class:z(["capitalize",{"bg-yellow-500 text-white":d==="pending"||d==="uploaded","bg-blue-500 text-white":d==="level1_approved","bg-green-500 text-white":d==="level2_approved","bg-red-500 text-white":d==="rejected"||d==="expired","bg-purple-500 text-white":d==="pending_level1_approval"}])},{default:s(()=>[m(i(d.replace(/_/g," ")),1)]),_:2},1032,["class"]))),128))])]),_:2},1024),o.can.view_transaction?(t(),f(x,{key:0},{default:s(()=>[a(M,{onClick:d=>N(l.schedule_id,l.branch_id),variant:"outline",size:"icon"},{default:s(()=>[a(u(F),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)):c("",!0)]))),128))]),_:1})]),_:1})]),n("div",Te,[o.transactions.data.length?c("",!0):(t(),r("div",Be," No transactions found. ")),(t(!0),r(C,null,$(o.transactions.data,l=>(t(),r("div",{key:`${l.schedule_id}-${l.branch_id}`,class:"bg-white p-4 rounded-lg shadow"},[n("div",De,[n("div",null,[n("p",Ae,i(l.branch_name),1),n("p",$e,i(B(l.month))+" "+i(l.year),1),n("p",je,"Date: "+i(P(l.calculated_date)),1)]),o.can.view_transaction?(t(),f(M,{key:0,onClick:d=>N(l.schedule_id,l.branch_id),variant:"outline",size:"icon"},{default:s(()=>[a(u(F),{class:"h-5 w-5"})]),_:2},1032,["onClick"])):c("",!0)]),n("div",Me,[n("div",Oe,[e[35]||(e[35]=n("span",{class:"text-gray-500"},"Uploader: ",-1)),n("span",Ee,i(l.uploader_name),1)]),n("div",Ne,[e[36]||(e[36]=n("span",{class:"text-gray-500"},"Status: ",-1)),n("div",Fe,[(t(!0),r(C,null,$([...new Set(l.statuses.split(", "))],d=>(t(),f(L,{key:d,class:z(["capitalize",{"bg-yellow-500 text-white":d==="pending"||d==="uploaded","bg-blue-500 text-white":d==="level1_approved","bg-green-500 text-white":d==="level2_approved","bg-red-500 text-white":d==="rejected"||d==="expired","bg-purple-500 text-white":d==="pending_level1_approval"}])},{default:s(()=>[m(i(d.replace(/_/g," ")),1)]),_:2},1032,["class"]))),128))])])])]))),128))]),a(G,{data:o.transactions},null,8,["data"])]),_:1})])]),_:1})],64)}}};export{He as default};
