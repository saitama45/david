import{a1 as Y,l as v,o as _,c as I,w as o,q as Z,a5 as J,u as a,a6 as de,ak as ue,al as ce,d as m,n as X,as as z,t as n,h as x,Y as fe,x as R,r as pe,g as r,a as l,b as p,N as _e,aA as me,aN as S,aQ as N,aL as D,aM as q,e as E,A as W,k as V,F as Q}from"./app-p8ycGfai.js";import{_ as ve,a as ge,b as F,c as $,d as xe,e as h}from"./TableHeader-a0F1Zfhh.js";import ye from"./WastageStatusBadge-BnbcxD1q.js";import{A as he}from"./arrow-left-Cc6FcHnL.js";import{P as j}from"./package-WwDcP9-w.js";import{C as we}from"./calendar-BgyW0Gx5.js";import{P as be}from"./paperclip--9WRFhz4.js";import{L as ke}from"./loader-circle-PEkmcZqs.js";import{C as Ce}from"./circle-alert-DTQS8jZO.js";import{U as H}from"./user-DThGBxUr.js";import{C as K}from"./circle-x-BrjzfYpA.js";import{T as $e}from"./triangle-alert-CiTeIGGu.js";import"./TooltipTrigger-Cad37LXI.js";import"./VisuallyHidden-Bjfqgrx1.js";import"./clock-DPi-gFdQ.js";var Ie=Y({__name:"BaseSeparator",props:{orientation:{type:String,required:!1,default:"horizontal"},decorative:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(f){const i=f,k=["horizontal","vertical"];function A(y){return k.includes(y)}const C=v(()=>A(i.orientation)?i.orientation:"horizontal"),M=v(()=>C.value==="vertical"?i.orientation:void 0),P=v(()=>i.decorative?{role:"none"}:{"aria-orientation":M.value,role:"separator"});return(y,L)=>(_(),I(a(de),J({as:y.as,"as-child":y.asChild,"data-orientation":C.value},P.value),{default:o(()=>[Z(y.$slots,"default")]),_:3},16,["as","as-child","data-orientation"]))}}),Ae=Ie,Se=Y({__name:"Separator",props:{orientation:{type:String,required:!1,default:"horizontal"},decorative:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(f){const i=f;return(k,A)=>(_(),I(Ae,ue(ce(i)),{default:o(()=>[Z(k.$slots,"default")]),_:3},16))}}),Ne=Se;const Le={__name:"Separator",props:{orientation:{type:String,required:!1},decorative:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},class:{type:null,required:!1},label:{type:String,required:!1}},setup(f){const i=f,k=v(()=>{const{class:A,...C}=i;return C});return(A,C)=>(_(),I(a(Ne),J(k.value,{class:a(z)("shrink-0 bg-border relative",i.orientation==="vertical"?"w-px h-full":"h-px w-full",i.class)}),{default:o(()=>[i.label?(_(),m("span",{key:0,class:X(a(z)("text-xs text-muted-foreground bg-background absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex justify-center items-center",i.orientation==="vertical"?"w-[1px] px-1 py-2":"h-[1px] py-1 px-2"))},n(i.label),3)):x("",!0)]),_:1},16,["class"]))}},De={class:"flex items-center gap-2"},qe={class:"space-y-6"},Be={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ue={class:"flex items-center gap-4"},Fe={class:"p-3 bg-blue-100 rounded-lg"},Me={class:"text-2xl font-bold text-gray-900"},Pe={class:"flex items-center gap-2 mt-1"},Te={class:"text-sm text-gray-600"},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},je={class:"text-lg font-semibold"},Ge={class:"text-gray-900"},Oe={class:"flex justify-between items-center"},ze={class:"text-2xl font-bold"},Ee={class:"flex justify-between items-center"},We={class:"text-2xl font-bold text-green-600"},Ve={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},Qe=["onClick","onKeydown","aria-label"],He={class:"aspect-w-1 aspect-h-1"},Ke={key:0,class:"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center"},Ye={key:1,class:"absolute inset-0 bg-red-50 rounded-lg flex flex-col items-center justify-center p-4"},Ze={class:"text-xs text-red-700 text-center mb-2"},Je={key:0,class:"text-xs text-gray-600 mb-2"},Xe={class:"flex gap-2"},et=["onClick"],tt={key:0,class:"text-xs text-gray-500"},st=["src","alt","onLoad","onError","onLoadstart"],at={key:0,class:"absolute bottom-1 left-1 bg-black bg-opacity-75 text-white text-xs p-1 rounded max-w-full truncate pointer-events-none"},lt={key:0,class:"block text-yellow-300"},ot={key:1,class:"absolute top-1 left-1 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"},rt={class:"font-medium"},nt={class:"text-sm text-gray-500"},it={key:0},dt={class:"space-y-4"},ut={class:"flex items-center gap-3"},ct={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},ft={class:"font-medium"},pt={class:"text-sm text-gray-500"},_t={key:0,class:"flex items-center gap-3"},mt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},vt={class:"font-medium"},gt={class:"text-sm text-gray-500"},xt={key:1,class:"flex items-center gap-3"},yt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},ht={class:"font-medium"},wt={class:"text-sm text-gray-500"},bt={key:2,class:"flex items-center gap-3"},kt={class:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center"},Ct={class:"font-medium"},$t={class:"text-sm text-gray-500"},It={__name:"Show",props:{wastage:Object,permissions:Object,statusTransitions:Array},setup(f){const i=f,k=v(()=>i.wastage.wastage_no||"N/A"),A=v(()=>i.wastage.wastage_status||"pending"),C=v(()=>{var s,e;return((s=i.wastage.storeBranch)==null?void 0:s.name)||((e=i.wastage.storeBranch)==null?void 0:e.branch_name)||"Unknown Store"}),M=v(()=>new Date(i.wastage.created_at).toLocaleDateString()),P=v(()=>i.wastage.remarks||"No remarks provided"),y=s=>{if(!s)return"N/A";const e=new Date(s),u=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),d=e.getFullYear();let c=e.getHours();const U=String(e.getMinutes()).padStart(2,"0"),ie=c>=12?"P.M.":"A.M.";return c=c%12,c=c||12,`${u}/${t}/${d} ${String(c).padStart(2,"0")}:${U} ${ie}`},L=s=>s?s.name&&s.name!==s.email?s.name:s.first_name||s.last_name?`${s.first_name||""} ${s.last_name||""}`.trim():s.email?s.email.split("@")[0].replace(/[._]/g," ").replace(/\b\w/g,u=>u.toUpperCase()):"Unknown User":"Unknown User",ee=v(()=>{var e;if(!((e=i.wastage)!=null&&e.items)||!Array.isArray(i.wastage.items))return 0;const s=i.wastage.items.reduce((u,t)=>u+(Number(t.wastage_qty)||0),0);return Number(s)||0}),G=v(()=>{var e;if(!((e=i.wastage)!=null&&e.items)||!Array.isArray(i.wastage.items))return 0;const s=i.wastage.items.reduce((u,t)=>{const d=Number(t.wastage_qty)||0,c=Number(t.cost)||0;return u+d*c},0);return Number(s)||0}),w=R({}),g=R({}),b=R({}),te=(s,e=0)=>{if(!s)return{url:"",isGoogleDrive:!1,hasMoreFallbacks:!1};if(s.includes("drive.google.com"))try{let u=null;if(s.includes("/file/d/")){const t=s.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);t&&(u=t[1])}else if(s.includes("open?id=")){const t=s.match(/[?&]id=([a-zA-Z0-9_-]+)/);t&&(u=t[1])}if(u){const t=[`/proxy/google-drive/${u}`,`https://drive.google.com/thumbnail?id=${u}&sz=s400`,`https://drive.google.com/uc?export=view&id=${u}`,`https://drive.google.com/uc?export=download&id=${u}`,`https://docs.google.com/uc?export=view&id=${u}`,`https://lh3.googleusercontent.com/d/${u}=s400`];return e<t.length?{url:t[e],isGoogleDrive:!0,hasMoreFallbacks:e<t.length-1,fileId:u,attemptIndex:e,totalFormats:t.length,allFormats:t}:{url:"",isGoogleDrive:!0,hasMoreFallbacks:!1,fileId:u}}}catch(u){console.error("Error transforming Google Drive URL:",u,"URL:",s)}return{url:s,isGoogleDrive:!1,hasMoreFallbacks:!1}},O=v(()=>{var u,t;let s=[];return(u=i.wastage)!=null&&u.image_urls&&Array.isArray(i.wastage.image_urls)&&i.wastage.image_urls.length>0?s=i.wastage.image_urls:(t=i.wastage)!=null&&t.image_url&&(s=[i.wastage.image_url]),s.map(d=>{b.value[d]===void 0&&(b.value[d]=0);const c=b.value[d],U=te(d,c);return{type:"existing",url:U.url,id:d,originalUrl:d,urlInfo:U,attemptIndex:c}})}),se=v(()=>O.value.length>0),ae=v(()=>{try{return!1}catch(s){return console.warn("Could not determine development mode:",s),!1}}),le=s=>{w.value[s]=!1,g.value[s]=null,b.value[s]=0},oe=(s,e)=>{if(e.urlInfo&&e.urlInfo.isGoogleDrive&&e.urlInfo.hasMoreFallbacks){const u=(b.value[s]||0)+1;b.value[s]=u;return}w.value[s]=!1,e.urlInfo&&e.urlInfo.isGoogleDrive?g.value[s]=`Failed to load image after trying ${e.urlInfo.totalFormats} different URL formats. The Google Drive file may not be publicly accessible or may have been deleted.`:g.value[s]="Failed to load image. The URL may be invalid or the image may not be accessible."},re=s=>{const e=s.id;w.value[e]=!0,g.value[e]=null},ne=s=>{s.urlInfo&&s.urlInfo.isGoogleDrive&&s.urlInfo.hasMoreFallbacks?(b.value[s.id]=(b.value[s.id]||0)+1,g.value[s.id]=null,w.value[s.id]=!0):(b.value[s.id]=0,g.value[s.id]=null,w.value[s.id]=!0)},T=(s,e)=>{w.value[s.id]||g.value[s.id]||window.open(s.url,"_blank")},B=s=>s?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s):"â‚±0.00";return(s,e)=>{const u=pe("Layout");return _(),I(u,{heading:"Wastage Record Details"},{"header-actions":o(()=>[r("div",De,[l(a(me),{variant:"outline",onClick:e[0]||(e[0]=t=>a(_e).get(s.route("wastage.index")))},{default:o(()=>[l(a(he),{class:"w-4 h-4 mr-2"}),e[1]||(e[1]=p(" Back to Wastage Records "))]),_:1})])]),default:o(()=>[r("div",qe,[l(a(N),null,{default:o(()=>[l(a(S),{class:"p-6"},{default:o(()=>[r("div",Be,[r("div",Ue,[r("div",Fe,[l(a(j),{class:"w-6 h-6 text-blue-600"})]),r("div",null,[r("h1",Me,"Wastage Record #"+n(k.value),1),r("div",Pe,[l(a(we),{class:"w-4 h-4 text-gray-500"}),r("span",Te,"Created on "+n(M.value),1)])])]),l(ye,{status:A.value},null,8,["status"])])]),_:1})]),_:1}),r("div",Re,[l(a(N),null,{default:o(()=>[l(a(D),null,{default:o(()=>[l(a(q),{class:"flex items-center gap-2"},{default:o(()=>[l(a(j),{class:"w-5 h-5"}),e[2]||(e[2]=p(" Store Information "))]),_:1})]),_:1}),l(a(S),{class:"space-y-4"},{default:o(()=>[r("div",null,[e[3]||(e[3]=r("label",{class:"text-sm font-medium text-gray-500"},"Store Branch",-1)),r("p",je,n(C.value),1)]),r("div",null,[e[4]||(e[4]=r("label",{class:"text-sm font-medium text-gray-500"},"Remarks",-1)),r("p",Ge,n(P.value),1)])]),_:1})]),_:1}),l(a(N),null,{default:o(()=>[l(a(D),null,{default:o(()=>[l(a(q),{class:"flex items-center gap-2"},{default:o(()=>[l(a(j),{class:"w-5 h-5"}),e[5]||(e[5]=p(" Wastage Summary "))]),_:1})]),_:1}),l(a(S),{class:"space-y-4"},{default:o(()=>[r("div",Oe,[e[6]||(e[6]=r("span",{class:"text-gray-600"},"Total Items",-1)),r("span",ze,n(ee.value),1)]),l(a(Le)),r("div",Ee,[e[7]||(e[7]=r("span",{class:"text-gray-600"},"Total Cost",-1)),r("span",We,n(B(G.value)),1)])]),_:1})]),_:1})]),se.value?(_(),I(a(N),{key:0},{default:o(()=>[l(a(D),null,{default:o(()=>[l(a(q),{class:"flex items-center gap-2"},{default:o(()=>[l(a(be),{class:"w-5 h-5"}),e[8]||(e[8]=p(" Attached Images "))]),_:1})]),_:1}),l(a(S),null,{default:o(()=>[r("div",Ve,[(_(!0),m(Q,null,E(O.value,(t,d)=>(_(),m("div",{key:t.id,class:X(["relative group cursor-pointer",{"cursor-zoom-in":!w.value[t.id]&&!g.value[t.id]}]),onClick:c=>T(t,d),onKeydown:[W(c=>T(t,d),["enter"]),W(V(c=>T(t,d),["prevent"]),["space"])],tabindex:"0",role:"button","aria-label":`View image ${d+1} in new tab`},[r("div",He,[w.value[t.id]?(_(),m("div",Ke,[l(a(ke),{class:"w-8 h-8 text-blue-600 animate-spin"})])):g.value[t.id]?(_(),m("div",Ye,[l(a(Ce),{class:"w-8 h-8 text-red-500 mb-2"}),r("p",Ze,n(g.value[t.id]),1),t.urlInfo&&t.urlInfo.isGoogleDrive?(_(),m("p",Je," Tried "+n(t.urlInfo.totalFormats)+" URL formats ",1)):x("",!0),r("div",Xe,[r("button",{onClick:V(c=>ne(t),["stop"]),class:"text-xs text-blue-600 hover:text-blue-800 underline"},n(t.urlInfo&&t.urlInfo.isGoogleDrive&&t.urlInfo.hasMoreFallbacks?"Try Next URL":"Retry"),9,et),t.urlInfo&&t.urlInfo.isGoogleDrive&&t.urlInfo.hasMoreFallbacks?(_(),m("span",tt," ("+n(t.urlInfo.totalFormats-(t.attemptIndex+1))+" left) ",1)):x("",!0)])])):(_(),m("img",{key:2,src:t.url,alt:`Wastage Image ${d+1}`,class:"object-cover shadow-lg rounded-lg w-full h-full hover:opacity-90 transition-opacity",onLoad:()=>le(t.id),onError:()=>oe(t.id,t),onLoadstart:()=>re(t)},null,40,st))]),ae.value?(_(),m("div",at,[p(n(t.type==="existing"?"Existing":"New")+" ",1),t.type==="existing"?(_(),m("span",lt,"ID: "+n(t.id.substring(0,10))+"...",1)):x("",!0)])):x("",!0),!w.value[t.id]&&!g.value[t.id]?(_(),m("div",ot," Click to view ")):x("",!0)],42,Qe))),128))])]),_:1})]),_:1})):x("",!0),l(a(N),null,{default:o(()=>[l(a(D),null,{default:o(()=>[l(a(q),null,{default:o(()=>e[9]||(e[9]=[p("Wastage Items")])),_:1})]),_:1}),l(a(S),null,{default:o(()=>[l(a(ve),null,{default:o(()=>[l(a(ge),null,{default:o(()=>[l(a(F),null,{default:o(()=>[l(a($),null,{default:o(()=>e[10]||(e[10]=[p("Item")])),_:1}),l(a($),null,{default:o(()=>e[11]||(e[11]=[p("Reason")])),_:1}),l(a($),{class:"text-center"},{default:o(()=>e[12]||(e[12]=[p("Quantity")])),_:1}),l(a($),{class:"text-center"},{default:o(()=>e[13]||(e[13]=[p("Approved Lvl1 Qty")])),_:1}),l(a($),{class:"text-center"},{default:o(()=>e[14]||(e[14]=[p("Approved Lvl2 Qty")])),_:1}),l(a($),{class:"text-right"},{default:o(()=>e[15]||(e[15]=[p("Cost")])),_:1}),l(a($),{class:"text-right"},{default:o(()=>e[16]||(e[16]=[p("Total")])),_:1})]),_:1})]),_:1}),l(a(xe),null,{default:o(()=>[f.wastage.items&&f.wastage.items.length>0?(_(!0),m(Q,{key:0},E(f.wastage.items,t=>(_(),I(a(F),{key:t.id},{default:o(()=>[l(a(h),null,{default:o(()=>{var d,c;return[r("div",null,[r("div",rt,n(((d=t.sap_masterfile)==null?void 0:d.ItemCode)||"N/A"),1),r("div",nt,n(((c=t.sap_masterfile)==null?void 0:c.ItemDescription)||"No description"),1)])]}),_:2},1024),l(a(h),{class:"text-sm"},{default:o(()=>[p(n(t.reason||"No reason specified"),1)]),_:2},1024),l(a(h),{class:"text-center"},{default:o(()=>{var d,c;return[p(n(t.wastage_qty)+" "+n((((d=t.sap_masterfile)==null?void 0:d.AltUOM)||((c=t.sap_masterfile)==null?void 0:c.BaseUOM))??"PCS"),1)]}),_:2},1024),l(a(h),{class:"text-center"},{default:o(()=>{var d,c;return[p(n(t.approverlvl1_qty??0)+" "+n((((d=t.sap_masterfile)==null?void 0:d.AltUOM)||((c=t.sap_masterfile)==null?void 0:c.BaseUOM))??"PCS"),1)]}),_:2},1024),l(a(h),{class:"text-center"},{default:o(()=>{var d,c;return[p(n(t.approverlvl2_qty??0)+" "+n((((d=t.sap_masterfile)==null?void 0:d.AltUOM)||((c=t.sap_masterfile)==null?void 0:c.BaseUOM))??"PCS"),1)]}),_:2},1024),l(a(h),{class:"text-right"},{default:o(()=>[p(n(B(t.cost)),1)]),_:2},1024),l(a(h),{class:"text-right font-semibold"},{default:o(()=>[p(n(B(t.wastage_qty*t.cost)),1)]),_:2},1024)]),_:2},1024))),128)):(_(),I(a(F),{key:1},{default:o(()=>[l(a(h),{colspan:"7",class:"text-center py-8 text-gray-500"},{default:o(()=>e[17]||(e[17]=[p(" No items found ")])),_:1})]),_:1}))]),_:1}),f.wastage.items&&f.wastage.items.length>0?(_(),m("tfoot",it,[l(a(F),null,{default:o(()=>[l(a(h),{colspan:"6",class:"text-right font-bold"},{default:o(()=>e[18]||(e[18]=[p("Total:")])),_:1}),l(a(h),{class:"text-right font-bold text-green-600"},{default:o(()=>[p(n(B(G.value)),1)]),_:1})]),_:1})])):x("",!0)]),_:1})]),_:1})]),_:1}),l(a(N),null,{default:o(()=>[l(a(D),null,{default:o(()=>[l(a(q),{class:"flex items-center gap-2"},{default:o(()=>[l(a(H),{class:"w-5 h-5"}),e[19]||(e[19]=p(" Approval Workflow "))]),_:1})]),_:1}),l(a(S),null,{default:o(()=>[r("div",dt,[r("div",ut,[r("div",ct,[l(a(H),{class:"w-4 h-4 text-blue-600"})]),r("div",null,[r("div",ft,n(L(f.wastage.encoder)),1),r("div",pt,"Created on "+n(y(f.wastage.created_at)),1)])]),f.wastage.approver1?(_(),m("div",_t,[r("div",mt,[l(a(K),{class:"w-4 h-4 text-green-600"})]),r("div",null,[r("div",vt,n(L(f.wastage.approver1)),1),r("div",gt,"Approved Level 1 on "+n(y(f.wastage.approved_level1_date)),1)])])):x("",!0),f.wastage.approver2?(_(),m("div",xt,[r("div",yt,[l(a(K),{class:"w-4 h-4 text-green-600"})]),r("div",null,[r("div",ht,n(L(f.wastage.approver2)),1),r("div",wt,"Approved Level 2 on "+n(y(f.wastage.approved_level2_date)),1)])])):x("",!0),f.wastage.canceller?(_(),m("div",bt,[r("div",kt,[l(a($e),{class:"w-4 h-4 text-red-600"})]),r("div",null,[r("div",Ct,n(L(f.wastage.canceller)),1),r("div",$t,"Cancelled on "+n(y(f.wastage.cancelled_date)),1)])])):x("",!0)])]),_:1})]),_:1})])]),_:1})}}},Ot=fe(It,[["__scopeId","data-v-d84f3997"]]);export{Ot as default};
