import{l as ie,Q as z,x,y as Q,T as _e,az as He,N as de,r as a,o as c,d as f,a as l,u as o,Z as je,w as n,n as G,g as s,t as b,F as L,e as Z,b as u,h as S,j as ze,s as Le,m as qe,O as Ye,k as ce,bw as Je,bx as ve,i as P,c as ye,E as xe,B as we}from"./app-DPA7xop8.js";import{l as Qe}from"./lodash-But43GHr.js";import{u as Ge}from"./useAuth-C8QnpB8L.js";import{u as Ze}from"./useSelectOptions-DqOryH05.js";import{C as Xe}from"./calendar-CbGbSceW.js";import{U as We}from"./upload-DsP_KZvQ.js";const Ke={class:"font-semibold"},et={key:0,class:"mt-2 list-disc list-inside text-sm"},tt={class:"w-full p-4 sm:p-6 lg:p-8"},lt={class:"bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-200"},st={class:"space-y-6"},rt={class:"relative"},nt=["value","disabled"],ot={key:0,class:"mt-2 text-sm text-gray-500"},at={class:"font-semibold"},ut={class:"flex justify-between items-center mb-4"},it={class:"text-lg font-semibold"},dt={class:"grid grid-cols-7 gap-2"},ct=["onClick"],pt={key:0,class:"space-y-8 transition-opacity duration-500"},ft={class:"bg-white p-6 rounded-xl shadow-lg border border-gray-200"},mt=["href"],bt={key:0,class:"bg-white p-6 rounded-xl shadow-lg border border-gray-200"},gt={key:0,class:"mt-2 text-sm text-red-600"},_t={class:"flex justify-end"},vt={class:"flex justify-end"},yt={class:"hidden md:block"},xt={key:0},wt=["onClick"],ht=["onClick"],Dt=["onClick"],Ct=["onClick"],Nt={__name:"Index",props:{massOrders:{type:Object,required:!0},suppliers:{type:Array,required:!0},ordersCutoff:{type:Array,required:!0},currentDate:{type:String,required:!0},branches:{type:Object},filters:{type:Object}},setup(E){const B=E,{hasAccess:le}=Ge();Ze(B.branches);const pe=r=>{var C;if(!((r.order_status==="pending"||r.order_status==="approved")&&le("edit mass orders")))return!1;const i=(C=r.supplier)==null?void 0:C.supplier_code;if(!i)return!0;const d=B.ordersCutoff.find(g=>g.ordering_template===i);if(!d)return!0;if(!r.created_at)return!1;const y=r.created_at.replace(" ","T")+"Z",A=new Date(y),w=[];if(d.cutoff_1_day!==null&&d.cutoff_1_time){const[g,v]=d.cutoff_1_time.split(":").map(Number);w.push({day:d.cutoff_1_day,timeInMinutes:g*60+v})}if(d.cutoff_2_day!==null&&d.cutoff_2_time){const[g,v]=d.cutoff_2_time.split(":").map(Number);w.push({day:d.cutoff_2_day,timeInMinutes:g*60+v})}if(w.length===0)return!0;w.sort((g,v)=>g.day!==v.day?g.day-v.day:g.timeInMinutes-v.timeInMinutes);const _=8*60*60*1e3,D=new Date(A.getTime()+_),U=D.getUTCDay(),oe=D.getUTCHours()*60+D.getUTCMinutes();let V=w.find(g=>g.day>U||g.day===U&&g.timeInMinutes>oe),J;V?J=(V.day-U+7)%7:(V=w[0],J=7-U+V.day);const j=new Date(D);j.setUTCDate(j.getUTCDate()+J);const ae=Math.floor(V.timeInMinutes/60),ue=V.timeInMinutes%60;j.setUTCHours(ae,ue,0,0);const K=new Date(j.getTime()-_);let ee;{if(!B.currentDate)return!1;const g=B.currentDate.replace(" ","T")+"Z";ee=new Date(g)}return ee<K},T=ie(()=>z().props.flash),se=ie(()=>{var r,e;return(r=T.value)!=null&&r.message?T.value.success===!1?"error":((e=T.value.skipped_stores)==null?void 0:e.length)>0?"warning":T.value.success?"success":"warning":null}),q=x(!1),he=()=>{q.value=!0},De=()=>{p.reset(),k.reset(),X.value=!1,R.value=!0,W.value=[]};Q(q,r=>{r===!1&&setTimeout(()=>De(),200)});const p=_e({supplier_code:null,order_date:null}),k=_e({mass_order_file:null,supplier_code:null,order_date:null}),X=x(!1),Ce=()=>{if(!p.supplier_code||!p.order_date){alert("Please select a supplier and a delivery date first.");return}k.supplier_code=p.supplier_code,k.order_date=p.order_date,k.post(route("mass-orders.upload"),{onSuccess:()=>{q.value=!1}})},Se=ie(()=>{if(!p.order_date)return"";const r=new Date(p.order_date+"T00:00:00"),e=r.toLocaleDateString("en-US",{weekday:"long"}),i=r.getDay();return`${e} = ${i}`}),R=x(!0),W=x([]),Y=x(!1),$=x(new Date(B.currentDate+"T00:00:00")),re=x(null),ne=x("top-full mt-2");Q(Y,r=>{const e=document.querySelector(".mass-order-dialog .p-dialog-content");if(e&&(e.style.overflow=r?"visible":"auto"),r&&re.value){const i=re.value.getBoundingClientRect(),d=400;window.innerHeight-i.bottom<d&&i.top>d?ne.value="bottom-full mb-2":ne.value="top-full mt-2"}});const Te=()=>{const r=[],e=$.value||new Date,i=e.getFullYear(),d=e.getMonth(),y=new Date(i,d,1).getDay(),A=new Date(i,d+1,0).getDate(),w=new Set(W.value);for(let h=0;h<y;h++)r.push(null);for(let h=1;h<=A;h++){const _=new Date(i,d,h),D=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`,U=!w.has(D);r.push({day:h,date:_,isDisabled:U})}return r},ke=()=>$.value=new Date($.value.getFullYear(),$.value.getMonth()-1,1),Me=()=>$.value=new Date($.value.getFullYear(),$.value.getMonth()+1,1),Fe=r=>{if(r&&!r.isDisabled){const e=r.date,i=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0");p.order_date=`${i}-${d}-${y}`,Y.value=!1}};Q(()=>p.supplier_code,async r=>{if(p.order_date=null,W.value=[],r){R.value=!0;try{const e=await He.get(route("mass-orders.available-dates",{supplier_code:r}));W.value=e.data,R.value=!1}catch(e){console.error("Error fetching available dates:",e),R.value=!0}}else R.value=!0}),Q(()=>p.order_date,()=>{X.value=!1});let M=x((z().props.filters.filterQuery||"all").toString()),F=x(z().props.filters.from),I=x(z().props.filters.to),O=x(z().props.filters.branchId),N=x(z().props.filters.search);const Ie=Qe.throttle(()=>{de.get(route("mass-orders.index"),{search:N.value,filterQuery:M.value,from:F.value,to:I.value,branchId:O.value},{preserveState:!0,preserveScroll:!0,replace:!0})},500);Q([F,I,O,N,M],Ie);const H=r=>{M.value=r},fe=r=>{switch(r==null?void 0:r.toUpperCase()){case"RECEIVED":return"bg-green-500 text-white";case"APPROVED":return"bg-teal-500 text-white";case"INCOMPLETE":return"bg-orange-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMMITED":return"bg-blue-500 text-white";case"REJECTED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},me=r=>{if(!r||!r.includes("-"))return"N/A";try{const[e,i,d]=r.substring(0,10).split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(i,10)-1]} ${parseInt(d,10)}, ${e}`}catch{return r}},Oe=r=>{if(!r)return"N/A";try{const[e,i]=r.split(" "),[d,y,A]=e.split("-"),[w,h]=i.split(":");let _=parseInt(w,10),D="A.M.";return _>=12&&(D="P.M.",_>12&&(_-=12)),_===0&&(_=12),`${parseInt(y,10)}/${parseInt(A,10)}/${d} ${_}:${h} ${D}`}catch{return r}},be=r=>de.get(route("mass-orders.show",r)),ge=r=>de.get(route("mass-orders.edit",r));return(r,e)=>{const i=a("FilterTabButton"),d=a("FilterTab"),y=a("Input"),A=a("SearchBar"),w=a("Filter"),h=a("PopoverTrigger"),_=a("SelectValue"),D=a("SelectTrigger"),U=a("SelectLabel"),oe=a("SelectItem"),V=a("SelectGroup"),J=a("SelectContent"),j=a("SelectShad"),ae=a("PopoverContent"),ue=a("Popover"),K=a("DivFlexCenter"),ee=a("TableHeader"),C=a("TH"),g=a("TableHead"),v=a("TD"),Ne=a("Badge"),$e=a("TableBody"),Ae=a("Table"),Ue=a("MobileTableHeading"),te=a("LabelXS"),Ve=a("MobileTableRow"),Pe=a("MobileTableContainer"),Ee=a("Pagination"),Be=a("TableContainer"),Re=a("Layout");return c(),f(L,null,[l(o(je),{title:"Mass Orders"}),l(Re,{heading:"Mass Orders",hasButton:!0,buttonName:"Create New Mass Order",handleClick:he},{default:n(()=>[T.value.message?(c(),f("div",{key:0,class:G(["mb-4 p-4 rounded-md",{"bg-green-100 text-green-800":se.value==="success","bg-yellow-100 text-yellow-800":se.value==="warning","bg-red-100 text-red-800":se.value==="error"}])},[s("p",Ke,b(T.value.message),1),T.value.skipped_stores&&T.value.skipped_stores.length?(c(),f("ul",et,[(c(!0),f(L,null,Z(T.value.skipped_stores,t=>(c(),f("li",{key:t.brand_code},[s("strong",null,b(t.brand_code)+":",1),u(" "+b(t.reason),1)]))),128))])):S("",!0)],2)):S("",!0),l(o(ze),{visible:q.value,"onUpdate:visible":e[6]||(e[6]=t=>q.value=t),modal:"",header:"Create New Mass Order",style:{width:"65rem",height:"90vh"},class:"mass-order-dialog"},{default:n(()=>[s("div",tt,[s("div",lt,[e[22]||(e[22]=s("div",{class:"flex items-center mb-4"},[s("span",{class:"flex items-center justify-center size-8 rounded-full bg-blue-600 text-white font-bold text-lg mr-4"},"1"),s("h2",{class:"text-xl font-semibold text-gray-800"},"Select Order Details")],-1)),s("div",st,[s("div",null,[e[18]||(e[18]=s("label",{for:"supplier",class:"block text-sm font-medium text-gray-700 mb-1"},"Supplier",-1)),l(o(Le),{modelValue:o(p).supplier_code,"onUpdate:modelValue":e[0]||(e[0]=t=>o(p).supplier_code=t),filter:"",options:B.suppliers,optionLabel:"label",optionValue:"value",placeholder:"Select a Supplier",class:"w-full"},null,8,["modelValue","options"])]),s("div",{class:"relative",ref_key:"dateInputRef",ref:re},[e[21]||(e[21]=s("label",{for:"order_date",class:"block text-sm font-medium text-gray-700 mb-1"},"Delivery Date",-1)),s("div",rt,[s("input",{id:"order_date",type:"text",readonly:"",value:o(p).order_date,onClick:e[1]||(e[1]=t=>Y.value=!Y.value),disabled:R.value,class:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm shadow-sm transition-colors placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-400 disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",placeholder:"Select a date"},null,8,nt),l(o(Xe),{class:"absolute right-3 top-1/2 -translate-y-1/2 size-4 text-gray-500 pointer-events-none"})]),o(p).order_date?(c(),f("div",ot,[e[19]||(e[19]=u(" Selected Day: ")),s("span",at,b(Se.value),1)])):S("",!0),qe(s("div",{class:G(["absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-full min-w-[300px]",ne.value])},[s("div",ut,[s("button",{type:"button",onClick:e[2]||(e[2]=ce(t=>ke(),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},"<"),s("h2",it,b(($.value||new Date).toLocaleString("default",{month:"long",year:"numeric"})),1),s("button",{type:"button",onClick:e[3]||(e[3]=ce(t=>Me(),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},">")]),e[20]||(e[20]=s("div",{class:"grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 mb-2"},[s("span",null,"Su"),s("span",null,"Mo"),s("span",null,"Tu"),s("span",null,"We"),s("span",null,"Th"),s("span",null,"Fr"),s("span",null,"Sa")],-1)),s("div",dt,[(c(!0),f(L,null,Z(Te(),(t,m)=>(c(),f("div",{key:m,class:G(["text-center py-1.5 rounded-full text-sm",[t?t.isDisabled?"text-gray-300 line-through cursor-not-allowed":o(p).order_date&&t.date.toDateString()===new Date(o(p).order_date+"T00:00:00").toDateString()?"bg-blue-600 text-white font-bold shadow-md":"bg-gray-100 text-gray-800 font-semibold cursor-pointer hover:bg-blue-100":""]]),onClick:St=>Fe(t)},b(t?t.day:""),11,ct))),128))])],2),[[Ye,Y.value]])],512)])]),o(p).order_date&&o(p).supplier_code?(c(),f("div",pt,[s("div",ft,[e[24]||(e[24]=s("div",{class:"flex items-center mb-4"},[s("span",{class:"flex items-center justify-center size-8 rounded-full bg-blue-600 text-white font-bold text-lg mr-4"},"2"),s("h2",{class:"text-xl font-semibold text-gray-800"},"Download Template")],-1)),e[25]||(e[25]=s("p",{class:"text-gray-600 mb-5"},"Download the Excel template for the selected supplier. This file is pre-filled with the correct items and store columns for your order.",-1)),s("a",{onClick:e[4]||(e[4]=t=>X.value=!0),href:r.route("mass-orders.download-template",{supplier_code:o(p).supplier_code,order_date:o(p).order_date}),class:"inline-flex items-center justify-center w-full px-4 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all transform hover:scale-105"},[l(o(Je),{class:"mr-2 size-5"}),e[23]||(e[23]=u(" Download Order Template "))],8,mt)]),X.value?(c(),f("div",bt,[e[28]||(e[28]=s("div",{class:"flex items-center mb-4"},[s("span",{class:"flex items-center justify-center size-8 rounded-full bg-blue-600 text-white font-bold text-lg mr-4"},"3"),s("h2",{class:"text-xl font-semibold text-gray-800"},"Upload Completed File")],-1)),s("form",{onSubmit:ce(Ce,["prevent"]),class:"mt-4 space-y-4"},[s("div",null,[e[26]||(e[26]=s("label",{for:"mass_order_file",class:"block text-sm font-medium text-gray-700"},"Excel File",-1)),s("input",{type:"file",onInput:e[5]||(e[5]=t=>o(k).mass_order_file=t.target.files[0]),id:"mass_order_file",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"},null,32),o(k).errors.mass_order_file?(c(),f("p",gt,b(o(k).errors.mass_order_file),1)):S("",!0)]),s("div",_t,[l(o(ve),{type:"submit",disabled:!o(k).mass_order_file||o(k).processing},{default:n(()=>[l(o(We),{class:"mr-2 size-5"}),e[27]||(e[27]=u(" Upload and Process "))]),_:1},8,["disabled"])])],32)])):S("",!0)])):S("",!0)])]),_:1},8,["visible"]),l(d,null,{default:n(()=>[l(i,{label:"All",filter:"all",currentFilter:o(M),onClick:e[7]||(e[7]=t=>H("all"))},null,8,["currentFilter"]),l(i,{label:"Pending",filter:"pending",currentFilter:o(M),onClick:e[8]||(e[8]=t=>H("pending"))},null,8,["currentFilter"]),l(i,{label:"Approved",filter:"approved",currentFilter:o(M),onClick:e[9]||(e[9]=t=>H("approved"))},null,8,["currentFilter"]),l(i,{label:"Commited",filter:"committed",currentFilter:o(M),onClick:e[10]||(e[10]=t=>H("committed"))},null,8,["currentFilter"]),l(i,{label:"Received",filter:"received",currentFilter:o(M),onClick:e[11]||(e[11]=t=>H("received"))},null,8,["currentFilter"]),l(i,{label:"Rejected",filter:"rejected",currentFilter:o(M),onClick:e[12]||(e[12]=t=>H("rejected"))},null,8,["currentFilter"])]),_:1}),l(Be,null,{default:n(()=>[l(ee,null,{default:n(()=>[l(A,null,{default:n(()=>[l(y,{modelValue:o(N),"onUpdate:modelValue":e[13]||(e[13]=t=>P(N)?N.value=t:N=t),id:"search",type:"text",placeholder:"Search for order number",class:"pl-10 sm:max-w-full max-w-64"},null,8,["modelValue"])]),_:1}),l(K,{class:"gap-5"},{default:n(()=>[l(ue,null,{default:n(()=>[l(h,null,{default:n(()=>[l(w)]),_:1}),l(ae,null,{default:n(()=>[s("div",vt,[l(o(ve),{onClick:e[14]||(e[14]=()=>{P(F)?F.value=null:F=null,P(I)?I.value=null:I=null,P(O)?O.value=null:O=null,P(N)?N.value=null:N=null}),variant:"link",class:"text-end text-red-500 text-xs"},{default:n(()=>e[29]||(e[29]=[u(" Reset Filter ")])),_:1})]),e[31]||(e[31]=s("label",{class:"text-xs"},"From",-1)),l(y,{type:"date",modelValue:o(F),"onUpdate:modelValue":e[15]||(e[15]=t=>P(F)?F.value=t:F=t)},null,8,["modelValue"]),e[32]||(e[32]=s("label",{class:"text-xs"},"To",-1)),l(y,{type:"date",modelValue:o(I),"onUpdate:modelValue":e[16]||(e[16]=t=>P(I)?I.value=t:I=t)},null,8,["modelValue"]),e[33]||(e[33]=s("label",{class:"text-xs"},"Store",-1)),l(j,{modelValue:o(O),"onUpdate:modelValue":e[17]||(e[17]=t=>P(O)?O.value=t:O=t)},{default:n(()=>[l(D,null,{default:n(()=>[l(_,{placeholder:"Select a store"})]),_:1}),l(J,null,{default:n(()=>[l(V,null,{default:n(()=>[l(U,null,{default:n(()=>e[30]||(e[30]=[u("Stores")])),_:1}),(c(!0),f(L,null,Z(E.branches,(t,m)=>(c(),ye(oe,{value:m},{default:n(()=>[u(b(t),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s("div",yt,[l(Ae,null,{default:n(()=>[l(g,null,{default:n(()=>[l(C,null,{default:n(()=>e[34]||(e[34]=[u("Id")])),_:1}),l(C,null,{default:n(()=>e[35]||(e[35]=[u("Supplier")])),_:1}),l(C,null,{default:n(()=>e[36]||(e[36]=[u("Store")])),_:1}),l(C,null,{default:n(()=>e[37]||(e[37]=[u("Order #")])),_:1}),l(C,null,{default:n(()=>e[38]||(e[38]=[u("Delivery Date")])),_:1}),l(C,null,{default:n(()=>e[39]||(e[39]=[u("Order Placed Date")])),_:1}),l(C,null,{default:n(()=>e[40]||(e[40]=[u("Order Status")])),_:1}),l(C,null,{default:n(()=>e[41]||(e[41]=[u("Actions")])),_:1})]),_:1}),l($e,null,{default:n(()=>[!E.massOrders.data||E.massOrders.data.length===0?(c(),f("tr",xt,e[42]||(e[42]=[s("td",{colspan:"8",class:"text-center py-4"},"No orders found.",-1)]))):S("",!0),(c(!0),f(L,null,Z(E.massOrders.data,t=>(c(),f("tr",{key:t.id},[l(v,null,{default:n(()=>[u(b(t.id),1)]),_:2},1024),l(v,null,{default:n(()=>{var m;return[u(b(((m=t.supplier)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(v,null,{default:n(()=>{var m;return[u(b(((m=t.store_branch)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(v,null,{default:n(()=>[u(b(t.order_number),1)]),_:2},1024),l(v,null,{default:n(()=>[u(b(me(t.order_date)),1)]),_:2},1024),l(v,null,{default:n(()=>[u(b(Oe(t.created_at)),1)]),_:2},1024),l(v,null,{default:n(()=>[l(Ne,{class:G([fe(t.order_status),"font-bold"])},{default:n(()=>[u(b(t.order_status?t.order_status.toUpperCase():"N/A"),1)]),_:2},1032,["class"])]),_:2},1024),l(v,null,{default:n(()=>[l(K,{class:"gap-3"},{default:n(()=>[o(le)("show mass orders")?(c(),f("button",{key:0,onClick:m=>be(t.order_number)},[l(o(xe),{class:"size-5"})],8,wt)):S("",!0),pe(t)?(c(),f("button",{key:1,class:"text-blue-500",onClick:m=>ge(t.order_number)},[l(o(we),{class:"size-5"})],8,ht)):S("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),l(Pe,{class:"md:hidden"},{default:n(()=>[(c(!0),f(L,null,Z(E.massOrders.data,t=>(c(),ye(Ve,{key:t.id},{default:n(()=>[l(Ue,{title:t.order_number},{default:n(()=>[o(le)("show mass orders")?(c(),f("button",{key:0,onClick:m=>be(t.order_number)},[l(o(xe),{class:"size-5"})],8,Dt)):S("",!0),pe(t)?(c(),f("button",{key:1,class:"text-blue-500",onClick:m=>ge(t.order_number)},[l(o(we),{class:"size-5"})],8,Ct)):S("",!0)]),_:2},1032,["title"]),l(te,null,{default:n(()=>[e[43]||(e[43]=u("Status: ")),s("span",{class:G([fe(t.order_status),"font-semibold p-1 rounded text-white"])},b(t.order_status?t.order_status.toUpperCase():"N/A"),3)]),_:2},1024),l(te,null,{default:n(()=>{var m;return[u("Store: "+b(((m=t.store_branch)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(te,null,{default:n(()=>{var m;return[u("Supplier: "+b(((m=t.supplier)==null?void 0:m.name)??"N/A"),1)]}),_:2},1024),l(te,null,{default:n(()=>[u("Delivery Date: "+b(me(t.order_date)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(Ee,{data:E.massOrders},null,8,["data"])]),_:1})]),_:1})],64)}}};export{Nt as default};
