import{f as me,x as T,y as fe,T as pe,r as u,o as d,c as y,w as o,a as s,g as a,b as l,t as i,u as m,aG as L,n as _e,h as A,d as b,e as Q,m as z,A as V,F as R,N as ye}from"./app-Bw_fMWAP.js";import{u as ve}from"./useBackButton-CVjDC3AL.js";import{u as ge}from"./useToast-CgNL_wIh.js";import{u as be}from"./useAuth-CBAjI_yz.js";import{S as $}from"./save-D1-8COpm.js";import{X as j}from"./x-CdvG2xaQ.js";import{S as K}from"./square-pen-9SUWVdac.js";const xe={class:"flex flex-col gap-5"},ke={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm"},Ce={class:"flex flex-col"},Te={class:"font-bold text-gray-900"},Se={class:"flex flex-col"},we={class:"font-bold text-gray-900"},he={class:"flex flex-col"},Ne={class:"font-bold text-gray-900"},De={class:"flex flex-col"},qe={class:"font-bold text-gray-900"},Ie={class:"flex flex-col"},Ee={class:"flex flex-col"},Oe={class:"font-bold text-gray-900"},Ae={class:"flex flex-col"},Ve={class:"font-bold text-gray-900"},Me={class:"font-medium"},Be={key:0},Fe={key:1,class:"flex items-center gap-2"},Pe={key:0},Ue={key:0},He={key:1},Xe={__name:"Show",props:{order:{type:Object,required:!0},items:{type:Object,required:!0}},setup(c){const X=me(),{toast:D}=ge(),{hasAccess:M}=be(),{backButton:G}=ve(route("store-commits.index")),B=c,J=t=>t?new Date(t).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"}):"N/A",W=t=>{var e,r,_;return t.from_store_name||((e=t.sending_store)==null?void 0:e.name)||((r=t.sending_store)==null?void 0:r.branch_name)||((_=t.sending_store)==null?void 0:_.brand_name)||"Unknown From Store"},Y=t=>{var e,r;return t.to_store_name||((e=t.store_branch)==null?void 0:e.name)||((r=t.store_branch)==null?void 0:r.branch_name)||"Unknown To Store"},Z=t=>{switch(t==null?void 0:t.toUpperCase()){case"APPROVED":return"bg-blue-500 text-white";case"COMMITTED":return"bg-yellow-500 text-white";case"PENDING":return"bg-gray-500 text-white";case"DECLINED":return"bg-red-500 text-white";case"OPEN":return"bg-gray-500 text-white";case"IN_TRANSIT":return"bg-purple-500 text-white";case"RECEIVED":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}},F=t=>{var e,r;return t.item_description||((e=t.sapMasterfile)==null?void 0:e.ItemDescription)||((r=t.sapMasterfile)==null?void 0:r.ItemName)||t.description||"Description not available"},q=t=>t.item_uom||t.uom||"",w=T(!1),ee=T(!1);T(!1);const p=T(null),v=T("");T(null);const P={mounted:t=>{const e=t.tagName==="INPUT"?t:t.querySelector("input");e&&(e.focus(),e.select())}};fe(ee,t=>{t||(w.value=!1,h.reset(),h.clearErrors())});const h=pe({order_id:null,action:"commit",remarks:null}),te=t=>{X.require({message:"Are you sure you want to transit this store order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{w.value=!0,h.order_id=t,h.action="commit",h.post(route("store-commits.commit"),{onSuccess:()=>{D.add({severity:"success",summary:"Success",detail:"Store Order Transited Successfully.",life:3e3}),w.value=!1},onError:()=>{w.value=!1}})}})},N=T([]);B.items.forEach(t=>N.value.push({id:t.id,quantity_approved:t.quantity_approved,quantity_commited:t.quantity_commited||t.quantity_approved,item_code:t.item_code,description:t.description,soh_stock:t.soh_stock,uom:t.uom}));const U=t=>{const e=N.value.find(r=>r.id===t);e&&(p.value={id:t,originalValue:e.quantity_commited},v.value=e.quantity_commited.toString())},I=()=>{if(!p.value)return;const t=parseFloat(v.value);if(isNaN(t)||t<0){D.add({severity:"error",summary:"Error",detail:"Please enter a valid quantity.",life:3e3});return}const e=Number(t.toFixed(2)),r=p.value.id;p.value.originalValue;const _=N.value.find(x=>x.id===r);_&&(_.quantity_commited=e);const f=B.items.find(x=>x.id===r);f&&(f.quantity_commited=e),oe(r,e),p.value=null,v.value=""},E=()=>{p.value=null,v.value=""},oe=(t,e)=>{console.log("Updating quantity for item:",t,"quantity:",e),ye.post(route("store-commits.update-quantity",t),{quantity_commited:e},{preserveScroll:!0,onSuccess:r=>{console.log("Quantity update successful"),D.add({severity:"success",summary:"Success",detail:"Quantity updated successfully.",life:2e3})},onError:r=>{console.log("Quantity update failed with errors:",r);let _="Failed to update quantity. Please refresh the page.";if(r&&typeof r=="object"){const f=Object.values(r);f.length>0&&f[0]&&(_=Array.isArray(f[0])?f[0][0]:f[0])}console.error("Detailed error information:",{errors:r,itemId:t,quantity:e,timestamp:new Date().toISOString()}),D.add({severity:"error",summary:"Update Failed",detail:_,life:5e3})}})};return(t,e)=>{const r=u("CardTitle"),_=u("Card"),f=u("Button"),x=u("DivFlexCenter"),se=u("TableHeader"),k=u("TH"),ne=u("TableHead"),C=u("TD"),H=u("Input"),ae=u("TableBody"),re=u("Table"),le=u("MobileTableHeading"),O=u("LabelXS"),ie=u("MobileTableRow"),ue=u("MobileTableContainer"),de=u("TableContainer"),ce=u("Layout");return d(),y(ce,{heading:"Store Order Details"},{default:o(()=>[s(de,null,{default:o(()=>[a("section",xe,[s(_,{class:"p-4 sm:p-6 bg-white shadow-sm rounded-lg"},{default:o(()=>[s(r,{class:"text-lg font-semibold mb-4"},{default:o(()=>e[3]||(e[3]=[l("Store Transfer Details")])),_:1}),a("div",ke,[a("div",Ce,[e[4]||(e[4]=a("span",{class:"text-gray-500"},"Transfer Number:",-1)),a("span",Te,i(c.order.order_number),1)]),a("div",Se,[e[5]||(e[5]=a("span",{class:"text-gray-500"},"From Store:",-1)),a("span",we,i(W(c.order)),1)]),a("div",he,[e[6]||(e[6]=a("span",{class:"text-gray-500"},"To Store:",-1)),a("span",Ne,i(Y(c.order)),1)]),a("div",De,[e[7]||(e[7]=a("span",{class:"text-gray-500"},"Transfer Date:",-1)),a("span",qe,i(J(c.order.order_date)),1)]),a("div",Ie,[e[8]||(e[8]=a("span",{class:"text-gray-500"},"Interco Status:",-1)),s(m(L),{class:_e([Z(c.order.interco_status),"font-bold w-fit"])},{default:o(()=>{var n;return[l(i(((n=c.order.interco_status)==null?void 0:n.toUpperCase())??"N/A"),1)]}),_:1},8,["class"])]),a("div",Ee,[e[9]||(e[9]=a("span",{class:"text-gray-500"},"Interco Reason:",-1)),a("span",Oe,i(c.order.interco_reason??"N/A"),1)]),a("div",Ae,[e[10]||(e[10]=a("span",{class:"text-gray-500"},"Remarks:",-1)),a("span",Ve,i(c.order.remarks??"N/A"),1)])])]),_:1}),s(x,{class:"gap-5"},{default:o(()=>[c.order.interco_status==="approved"&&m(M)("commit store orders")?(d(),y(f,{key:0,class:"bg-green-500 hover:bg-green-300",onClick:e[0]||(e[0]=n=>te(c.order.id)),disabled:w.value},{default:o(()=>e[11]||(e[11]=[l(" Transit Orders ")])),_:1},8,["disabled"])):A("",!0)]),_:1})]),s(se),s(re,null,{default:o(()=>[s(ne,null,{default:o(()=>[s(k,null,{default:o(()=>e[12]||(e[12]=[l(" Item Code ")])),_:1}),s(k,null,{default:o(()=>e[13]||(e[13]=[l(" Description ")])),_:1}),s(k,null,{default:o(()=>e[14]||(e[14]=[l(" UOM ")])),_:1}),s(k,null,{default:o(()=>e[15]||(e[15]=[l(" Approved Qty ")])),_:1}),s(k,null,{default:o(()=>e[16]||(e[16]=[l(" SOH Stock ")])),_:1}),c.order.interco_status==="approved"?(d(),y(k,{key:0},{default:o(()=>e[17]||(e[17]=[l("Committed Qty")])),_:1})):(d(),y(k,{key:1},{default:o(()=>e[18]||(e[18]=[l("Committed Qty")])),_:1}))]),_:1}),s(ae,null,{default:o(()=>[(d(!0),b(R,null,Q(c.items,n=>(d(),b("tr",{key:n.id},[s(C,null,{default:o(()=>[l(i(n.item_code),1)]),_:2},1024),s(C,null,{default:o(()=>[a("div",null,[a("p",Me,i(F(n)),1),q(n)?(d(),y(m(L),{key:0,variant:"outline",class:"text-xs mt-1"},{default:o(()=>[l(i(q(n)),1)]),_:2},1024)):A("",!0)])]),_:2},1024),s(C,null,{default:o(()=>[l(i(q(n)??"N/A"),1)]),_:2},1024),s(C,null,{default:o(()=>[l(i(n.quantity_approved),1)]),_:2},1024),s(C,null,{default:o(()=>[l(i(n.soh_stock??0),1)]),_:2},1024),c.order.interco_status==="approved"?(d(),y(C,{key:0,class:"flex items-center gap-3"},{default:o(()=>{var g;return[p.value&&p.value.id===n.id?(d(),b("div",Be,[z(s(H,{type:"number",modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=S=>v.value=S),class:"w-20 text-right",onKeyup:[V(I,["enter"]),V(E,["esc"])]},null,8,["modelValue"]),[[P]]),s(x,{class:"gap-1 ml-2"},{default:o(()=>[s(m($),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:I}),s(m(j),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:E})]),_:1})])):(d(),b("div",Fe,[l(i(((g=N.value.find(S=>S.id===n.id))==null?void 0:g.quantity_commited)||0)+" ",1),m(M)("commit store orders")?(d(),y(m(K),{key:0,class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:S=>U(n.id)},null,8,["onClick"])):A("",!0)]))]}),_:2},1024)):(d(),y(C,{key:1},{default:o(()=>[l(i(n.quantity_commited),1)]),_:2},1024))]))),128))]),_:1})]),_:1}),s(ue,null,{default:o(()=>[(d(!0),b(R,null,Q(c.items,n=>(d(),y(ie,{key:n.id},{default:o(()=>[s(le,{title:`${F(n)} (${n.item_code})`},{default:o(()=>[c.order.interco_status==="approved"&&m(M)("commit store orders")?(d(),b("div",Pe,[p.value&&p.value.id===n.id?(d(),b("div",Ue,[z(s(H,{type:"number",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=g=>v.value=g),class:"w-20 text-right",onKeyup:[V(I,["enter"]),V(E,["esc"])]},null,8,["modelValue"]),[[P]]),s(x,{class:"gap-1 ml-2"},{default:o(()=>[s(m($),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:I}),s(m(j),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:E})]),_:1})])):(d(),b("div",He,[s(m(K),{class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:g=>U(n.id)},null,8,["onClick"])]))])):A("",!0)]),_:2},1032,["title"]),s(O,null,{default:o(()=>[l("UOM: "+i(q(n)??"N/A"),1)]),_:2},1024),s(O,null,{default:o(()=>[l("Approved: "+i(n.quantity_approved),1)]),_:2},1024),s(O,null,{default:o(()=>[l("SOH Stock: "+i(n.soh_stock??0),1)]),_:2},1024),s(O,null,{default:o(()=>{var g;return[l(" Committed: "+i(((g=N.value.find(S=>S.id===n.id))==null?void 0:g.quantity_commited)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(f,{variant:"outline",class:"text-lg px-7",onClick:m(G)},{default:o(()=>e[19]||(e[19]=[l(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{Xe as default};
