import{u as j}from"./useSelectOptions-Ci2WUICq.js";import{u as ot}from"./useToast-BAk2IYqi.js";import{f as at,T as w,r as s,o as D,c as ut,w as l,a as e,b as o,u as a,t as i,d as I,e as rt,F as st,h as dt,i as it}from"./app-p8ycGfai.js";const mt={key:0},yt={__name:"Edit",props:{transaction:{type:Object,required:!0},menus:{type:Object,required:!0},branches:{type:Object,required:!0}},setup(_){const{toast:b}=ot(),x=at(),{options:H}=j(_.menus),{options:O}=j(_.branches),T=w({store_transactions_file:null}),V=ref(!1),C=ref(!1);watch(C,d=>{d||(V.value=!1)});const A=()=>{V.value=!0,T.post(route("store-transactions.import"),{onSuccess:()=>{V.value=!1,C.value=!1,b.add({severity:"success",summary:"Success",detail:"Store transactions created successfully",life:3e3})},onError:d=>{b.add({severity:"error",summary:"Error",detail:d,life:3e3})}})},n=w({id:null,product_id:null,name:null,quantity:null,discount:0,price:null,line_total:null,net_total:null}),r=w({order_date:_.transaction.order_date,lot_serial:_.transaction.lot_serial,posted:_.transaction.posted,tim_number:_.transaction.tim_number,receipt_number:_.transaction.receipt_number,store_branch_id:_.transaction.store_branch_id.toString(),customer_id:_.transaction.customer_id,customer:_.transaction.customer,items:[]});_.transaction.store_transaction_items.forEach(d=>{const t={id:d.menu.id,product_id:d.product_id,name:d.menu.name,quantity:d.quantity,discount:d.discount,price:d.price,line_total:d.line_total,net_total:d.net_total};r.items.push(t)}),watch(()=>n.id,d=>{d!=null&&(n.clearErrors(),axios.get(route("menu-item.show",d)).then(t=>t.data).then(t=>{console.log(t),n.name=t.name,n.price=t.price,n.product_id=t.product_id}).catch(t=>console.log(t)))});const N=()=>{if(n.id===null){n.setError("id","Item field is required");return}if(n.quantity<1){n.setError("quantity","Quantity must be atleast 1");return}console.log(n);const d=r.items.findIndex(t=>t.id===n.id);if(d===-1)n.line_total=parseFloat(n.quantity*n.price),n.net_total=parseFloat(n.quantity*n.price),r.items.push({...n});else{const t=r.items[d];t.quantity+=n.quantity,n.line_total=parseFloat(n.quantity*n.price),n.net_total=parseFloat(n.quantity*n.price)}n.reset(),n.clearErrors()};watch(()=>n.quantity,d=>{if(d&&n.price){n.line_total=parseFloat(d*n.price);const t=n.discount/100*n.line_total;n.net_total=parseFloat(n.line_total-t)}}),watch(()=>n.discount,d=>{if(n.line_total){const t=d/100*n.line_total;n.net_total=parseFloat(n.line_total-t)}});const R=()=>{if(r.items.length<1){b.add({severity:"error",summary:"Error",detail:"Please select at least one item before proceeding.",life:5e3});return}x.require({message:"Are you sure you want to update this store transaction?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{r.put(route("store-transactions.update",_.transaction.id),{onSuccess:()=>{b.add({severity:"success",summary:"Success",detail:"Store transaction Updated Successfully.",life:5e3})},onError:d=>{b.add({severity:"error",summary:"Error",detail:"Something went wrong while trying to update the store transaction.",life:5e3})}})}})},M=d=>{x.require({message:"Are you sure you want to remove this item from your orders?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Remove",severity:"danger"},accept:()=>{r.items=r.items.filter(t=>t.id!==d),b.add({severity:"success",summary:"Confirmed",detail:"Item Removed",life:3e3})}})};return(d,t)=>{const L=s("CardTitle"),U=s("CardDescription"),E=s("CardHeader"),m=s("LabelXS"),Q=s("DatePicker"),f=s("FormError"),p=s("InputContainer"),c=s("Input"),P=s("Select"),v=s("DivFlexCol"),B=s("CardContent"),S=s("Card"),q=s("Button"),X=s("CardFooter"),k=s("SpanBold"),F=s("DivFlexCenter"),y=s("TH"),$=s("TableHead"),g=s("TD"),z=s("DeleteButton"),G=s("TableBody"),J=s("Table"),K=s("TableContainer"),W=s("DialogTitle"),Y=s("DialogDescription"),Z=s("DialogHeader"),h=s("Loading"),tt=s("DialogFooter"),et=s("DialogContent"),lt=s("Dialog"),nt=s("Layout");return D(),ut(nt,{heading:"Edit Store Transaction"},{default:l(()=>[e(S,{class:"grid grid-cols-3 gap-3 p-5"},{default:l(()=>[e(S,null,{default:l(()=>[e(E,null,{default:l(()=>[e(L,null,{default:l(()=>t[16]||(t[16]=[o("Transaction Details")])),_:1}),e(U,null,{default:l(()=>t[17]||(t[17]=[o("Please input all the information required.")])),_:1})]),_:1}),e(B,null,{default:l(()=>[e(v,{class:"gap-3"},{default:l(()=>[e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[18]||(t[18]=[o("Date")])),_:1}),e(Q,{modelValue:a(r).order_date,"onUpdate:modelValue":t[0]||(t[0]=u=>a(r).order_date=u),showIcon:""},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.order_date),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[19]||(t[19]=[o("Lot/Serial")])),_:1}),e(c,{modelValue:a(r).lot_serial,"onUpdate:modelValue":t[1]||(t[1]=u=>a(r).lot_serial=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.lot_serial),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[20]||(t[20]=[o("Posted")])),_:1}),e(c,{modelValue:a(r).posted,"onUpdate:modelValue":t[2]||(t[2]=u=>a(r).posted=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.posted),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[21]||(t[21]=[o("TM#")])),_:1}),e(c,{modelValue:a(r).tim_number,"onUpdate:modelValue":t[3]||(t[3]=u=>a(r).tim_number=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.tim_number),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[22]||(t[22]=[o("Receipt No.")])),_:1}),e(c,{modelValue:a(r).receipt_number,"onUpdate:modelValue":t[4]||(t[4]=u=>a(r).receipt_number=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.receipt_number),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[23]||(t[23]=[o("Branch")])),_:1}),e(P,{modelValue:a(r).store_branch_id,"onUpdate:modelValue":t[5]||(t[5]=u=>a(r).store_branch_id=u),filter:"",placeholder:"Select a branch",options:a(O),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),e(f,null,{default:l(()=>[o(i(a(r).errors.store_branch_id),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[24]||(t[24]=[o("Customer ID")])),_:1}),e(c,{modelValue:a(r).customer_id,"onUpdate:modelValue":t[6]||(t[6]=u=>a(r).customer_id=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.customer_id),1)]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[25]||(t[25]=[o("Customer")])),_:1}),e(c,{modelValue:a(r).customer,"onUpdate:modelValue":t[7]||(t[7]=u=>a(r).customer=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(r).errors.customer),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{class:"gap-5 col-span-2"},{default:l(()=>[e(S,null,{default:l(()=>[e(E,null,{default:l(()=>[e(L,null,{default:l(()=>t[26]||(t[26]=[o("Menu List")])),_:1}),e(U,null,{default:l(()=>t[27]||(t[27]=[o("Please input all the required fields.")])),_:1})]),_:1}),e(B,{class:"space-y-3 w-full"},{default:l(()=>[e(v,{class:"grid grid-cols-2 gap-3 sm:items-center"},{default:l(()=>[e(p,{class:"w-full col-span-2"},{default:l(()=>[e(m,null,{default:l(()=>t[28]||(t[28]=[o("Item")])),_:1}),e(P,{filter:"",placeholder:"Select a Store",options:a(H),optionLabel:"label",optionValue:"value",modelValue:a(n).id,"onUpdate:modelValue":t[8]||(t[8]=u=>a(n).id=u)},null,8,["options","modelValue"]),e(f,null,{default:l(()=>[o(i(a(n).errors.id),1)]),_:1})]),_:1}),e(p,{class:"w-full"},{default:l(()=>[e(m,null,{default:l(()=>t[29]||(t[29]=[o("Price")])),_:1}),e(c,{disabled:"",type:"number",modelValue:a(n).price,"onUpdate:modelValue":t[9]||(t[9]=u=>a(n).price=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(n).errors.price),1)]),_:1})]),_:1}),e(p,{class:"w-full"},{default:l(()=>[e(m,null,{default:l(()=>t[30]||(t[30]=[o("Quantity")])),_:1}),e(c,{type:"number",modelValue:a(n).quantity,"onUpdate:modelValue":t[10]||(t[10]=u=>a(n).quantity=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(n).errors.quantity),1)]),_:1})]),_:1}),e(p,{class:"w-full"},{default:l(()=>[e(m,null,{default:l(()=>t[31]||(t[31]=[o("Discount")])),_:1}),e(c,{type:"number",modelValue:a(n).discount,"onUpdate:modelValue":t[11]||(t[11]=u=>a(n).discount=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(n).errors.discount),1)]),_:1})]),_:1}),e(p,{class:"w-full"},{default:l(()=>[e(m,null,{default:l(()=>t[32]||(t[32]=[o("Line Total")])),_:1}),e(c,{type:"number",modelValue:a(n).line_total,"onUpdate:modelValue":t[12]||(t[12]=u=>a(n).line_total=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(n).errors.line_total),1)]),_:1})]),_:1}),e(p,{class:"w-full"},{default:l(()=>[e(m,null,{default:l(()=>t[33]||(t[33]=[o("Net Total")])),_:1}),e(c,{type:"number",modelValue:a(n).net_total,"onUpdate:modelValue":t[13]||(t[13]=u=>a(n).net_total=u)},null,8,["modelValue"]),e(f,null,{default:l(()=>[o(i(a(n).errors.net_total),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(X,{class:"justify-end"},{default:l(()=>[e(q,{onClick:N},{default:l(()=>t[34]||(t[34]=[o("Add")])),_:1})]),_:1})]),_:1}),e(K,null,{default:l(()=>[e(F,{class:"flex justify-between"},{default:l(()=>[e(k,null,{default:l(()=>t[35]||(t[35]=[o("Items Sold")])),_:1}),e(F,{class:"gap-2"},{default:l(()=>[e(m,null,{default:l(()=>t[36]||(t[36]=[o(" Overall Total:")])),_:1}),e(k)]),_:1})]),_:1}),e(J,null,{default:l(()=>[e($,null,{default:l(()=>[e(y,null,{default:l(()=>t[37]||(t[37]=[o("Item")])),_:1}),e(y,null,{default:l(()=>t[38]||(t[38]=[o("Price")])),_:1}),e(y,null,{default:l(()=>t[39]||(t[39]=[o("Quantity")])),_:1}),e(y,null,{default:l(()=>t[40]||(t[40]=[o("Discount")])),_:1}),e(y,null,{default:l(()=>t[41]||(t[41]=[o("Line Total")])),_:1}),e(y,null,{default:l(()=>t[42]||(t[42]=[o("Net Total")])),_:1}),e(y,null,{default:l(()=>t[43]||(t[43]=[o("Actions")])),_:1})]),_:1}),e(G,null,{default:l(()=>[(D(!0),I(st,null,rt(a(r).items,u=>(D(),I("tr",null,[e(g,null,{default:l(()=>[o(i(u.name),1)]),_:2},1024),e(g,null,{default:l(()=>[o(i(u.price),1)]),_:2},1024),e(g,null,{default:l(()=>[o(i(u.quantity),1)]),_:2},1024),e(g,null,{default:l(()=>[o(i(u.discount),1)]),_:2},1024),e(g,null,{default:l(()=>[o(i(u.line_total),1)]),_:2},1024),e(g,null,{default:l(()=>[o(i(u.net_total),1)]),_:2},1024),e(z,{onClick:ft=>M(u.id)},null,8,["onClick"])]))),256))]),_:1})]),_:1}),e(F,{class:"justify-end"},{default:l(()=>[e(q,{onClick:R},{default:l(()=>t[44]||(t[44]=[o("Proceed")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(lt,{open:a(C),"onUpdate:open":t[15]||(t[15]=u=>it(C)?C.value=u:null)},{default:l(()=>[e(et,{class:"sm:max-w-[600px]"},{default:l(()=>[e(Z,null,{default:l(()=>[e(W,null,{default:l(()=>t[45]||(t[45]=[o("Import Store Transactions List")])),_:1}),e(Y,null,{default:l(()=>t[46]||(t[46]=[o(" Import the excel file here. ")])),_:1})]),_:1}),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>t[47]||(t[47]=[o(" Store Transactions List ")])),_:1}),e(c,{disabled:a(V),type:"file",onInput:t[14]||(t[14]=u=>a(T).store_transactions_file=u.target.files[0])},null,8,["disabled"]),e(f,null,{default:l(()=>[o(i(a(T).errors.store_transactions_file),1)]),_:1})]),_:1}),e(tt,null,{default:l(()=>[e(q,{disabled:a(V),onClick:A,class:"gap-2"},{default:l(()=>[t[48]||(t[48]=o(" Proceed ")),a(V)?(D(),I("span",mt,[e(h)])):dt("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}};export{yt as default};
