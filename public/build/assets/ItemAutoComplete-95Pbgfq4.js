import{X as F,x as c,ai as N,y as D,V as U,aB as W,o as d,d as i,g as l,m as H,z as T,h,t as m,S as L,F as X,e as K,n as z,W as Y}from"./app-rjK1ng7o.js";import{l as q}from"./lodash-DqVvdaAw.js";const G={class:"relative"},J=["placeholder","disabled"],Q={key:1,class:"absolute right-2 top-1/2 transform -translate-y-1/2"},Z={key:0,class:"mt-1 text-sm text-red-600"},ee=["onClick","onMouseenter"],te={class:"flex justify-between items-start"},oe={class:"flex-1"},ae={class:"font-medium text-sm text-gray-900"},se={class:"text-sm text-gray-600"},le={class:"text-xs text-gray-500"},ne={class:"ml-2 text-right"},re={key:0,class:"text-xs text-green-500"},de={key:1,class:"text-xs text-red-500"},ie={key:3,class:"mt-1 text-xs text-gray-500"},ue={__name:"ItemAutoComplete",props:{modelValue:{type:[String,Object],default:""},sendingStoreId:{type:[Number,null],default:null},placeholder:{type:String,default:"Type at least 3 characters to search..."},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","item-selected"],setup(g,{emit:B}){const v=g,x=B,s=c(""),o=c(!1),r=c([]),y=c(!1),f=c(""),n=c(-1),b=c(null),I=c(null),p=c({top:"0px",left:"0px",width:"0px"}),_=async()=>{if(!b.value||!o.value)return;await Y();const e=b.value.getBoundingClientRect(),a=window.pageYOffset||document.documentElement.scrollTop,t=window.pageXOffset||document.documentElement.scrollLeft,u=240,C=window.innerHeight-e.bottom,j=e.top;let $=e.bottom+a;C<u&&j>u&&($=e.top+a-u);const P=320;let w=e.left+t,E=Math.min(e.width,P);w+E>window.innerWidth+t&&(w=window.innerWidth+t-E-8),w<t&&(w=t+8),p.value={top:`${$}px`,left:`${w}px`,width:`${E}px`}},k=()=>{o.value&&_()},A=q.debounce(async e=>{var a,t;if(!e||e.length<3){r.value=[],o.value=!1;return}if(!v.sendingStoreId){f.value="Please select a sending store first";return}y.value=!0,f.value="";try{const u=await N.get(route("interco.items.search"),{params:{sending_store_id:v.sendingStoreId,search:e}});r.value=u.data.items||[],o.value=r.value.length>0,n.value=-1,o.value&&await _()}catch(u){f.value=((t=(a=u.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to search items",r.value=[],o.value=!1}finally{y.value=!1}},300);D(()=>v.modelValue,e=>{e&&typeof e=="object"?s.value=`${e.item_code} - ${e.description}`:s.value=""}),D(s,e=>{A(e)});const M=e=>{s.value=`${e.item_code} - ${e.description}`,x("update:modelValue",e),x("item-selected",e),o.value=!1,n.value=-1},S=async()=>{(r.value.length>0||s.value.length>=3)&&(o.value=!0,await _())},O=e=>{if(o.value)switch(e.key){case"ArrowDown":e.preventDefault(),n.value=Math.min(n.value+1,r.value.length-1);break;case"ArrowUp":e.preventDefault(),n.value=Math.max(n.value-1,-1);break;case"Enter":e.preventDefault(),n.value>=0&&r.value[n.value]&&M(r.value[n.value]);break;case"Escape":o.value=!1,n.value=-1;break}},V=e=>{var a,t;!((a=I.value)!=null&&a.contains(e.target))&&!((t=b.value)!=null&&t.contains(e.target))&&(o.value=!1,n.value=-1)},R=()=>{s.value="",x("update:modelValue",""),x("item-selected",null),r.value=[],o.value=!1};return U(()=>{document.addEventListener("click",V),window.addEventListener("resize",k),window.addEventListener("scroll",k)}),W(()=>{document.removeEventListener("click",V),window.removeEventListener("resize",k),window.removeEventListener("scroll",k)}),v.modelValue&&typeof v.modelValue=="object"&&(s.value=`${v.modelValue.item_code} - ${v.modelValue.description}`),(e,a)=>(d(),i("div",{class:"relative dropdown-container",ref_key:"dropdownRef",ref:I},[l("div",G,[H(l("input",{ref_key:"inputRef",ref:b,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value=t),type:"text",placeholder:g.sendingStoreId?g.placeholder:"Please select a sending store first",disabled:g.disabled,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10",onClick:S,onKeydown:O,onFocus:S},null,40,J),[[T,s.value]]),s.value&&!g.disabled?(d(),i("button",{key:0,type:"button",class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:R},a[1]||(a[1]=[l("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):h("",!0),y.value?(d(),i("div",Q,a[2]||(a[2]=[l("svg",{class:"animate-spin h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):h("",!0)]),f.value?(d(),i("div",Z,m(f.value),1)):h("",!0),o.value&&r.value.length>0?(d(),i("div",{key:1,class:"fixed z-dropdown bg-white border border-gray-300 rounded-md shadow-2xl max-h-60 overflow-y-auto",style:L({top:p.value.top,left:p.value.left,width:p.value.width})},[(d(!0),i(X,null,K(r.value,(t,u)=>(d(),i("div",{key:t.id,class:z(["px-3 py-2 cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0",{"bg-blue-50":n.value===u}]),onClick:C=>M(t),onMouseenter:C=>n.value=u},[l("div",te,[l("div",oe,[l("div",ae,m(t.item_code),1),l("div",se,m(t.description),1),l("div",le," UOM: "+m(t.alt_uom||t.uom),1)]),l("div",ne,[l("div",{class:z(["text-sm font-medium",t.stock>0?"text-green-600":"text-red-600"])}," Stock: "+m(t.stock),3),t.stock>0?(d(),i("div",re," Available ")):(d(),i("div",de," Out of stock "))])])],42,ee))),128))],4)):h("",!0),o.value&&!y.value&&s.value.length>=3&&r.value.length===0&&!f.value?(d(),i("div",{key:2,class:"fixed z-dropdown bg-white border border-gray-300 rounded-md shadow-2xl px-3 py-2 text-sm text-gray-500",style:L({top:p.value.top,left:p.value.left,width:p.value.width})},' No items found matching "'+m(s.value)+'" ',5)):h("",!0),!o.value&&s.value.length<3&&s.value.length>0?(d(),i("div",ie," Type at least 3 characters to search ")):h("",!0)],512))}},pe=F(ue,[["__scopeId","data-v-d67e96eb"]]);export{pe as I};
