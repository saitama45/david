import{f as ee,x as j,l as K,r as x,o as i,d as y,a as t,u as v,Z as te,w as n,g as m,b as a,t as r,n as V,c as B,h as _,F as L,e as le,m as S,A as C,X as z,B as D,W as ne,N as U}from"./app-Drfr7wPO.js";import{u as ae}from"./useToast-Blb7EynO.js";import{A as oe}from"./arrow-left-CLdca343.js";import{C as se}from"./check-C1FxZ_zR.js";import{S as N}from"./save-B8A773kG.js";const ue={class:"mb-6 p-4 bg-white rounded-lg shadow-md"},re={class:"flex justify-between items-center mb-4"},de={key:0,class:"flex gap-4"},ie={class:"overflow-y-auto max-h-[75vh]"},ce={key:0},ge={key:0,class:"flex items-center gap-1"},ve=["onClick"],pe={key:0,class:"flex items-center gap-1"},fe=["onClick"],ye={key:0,class:"flex items-center gap-1"},me=["onClick"],be={key:0,class:"flex items-center gap-1"},he=["onClick"],ke={key:0,class:"flex items-center gap-1"},we=["onClick"],Te={__name:"Show",props:{schedule:{type:Object,required:!0},branch:{type:Object,required:!0},countItems:{type:Array,required:!0},canEditItems:{type:Boolean,required:!0},canApproveLevel1:{type:Boolean,required:!0},canApproveLevel2:{type:Boolean,required:!0}},setup(s){const E=s,M=ee(),{toast:T}=ae(),c=j(null),h=j(""),F=j(null),$={mounted:o=>{const e=o.tagName==="INPUT"?o:o.querySelector("input");e&&(e.focus(),e.select())}},O=o=>{if(!o)return"";const e=new Date;return e.setMonth(o-1),e.toLocaleString("en-US",{month:"long"})},H=o=>{if(!o)return"N/A";const e=new Date(o),b=e.getTimezoneOffset()*6e4,d=new Date(e.getTime()+b);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(d)},f=o=>o==="pending_level1_approval",P=o=>{const e=parseFloat(o.bulk_qty)||0,b=parseFloat(o.loose_qty)||0,d=parseFloat(o.config)||1;return d===0?e+b:(e+b/d).toFixed(4)},q=(o,e)=>{if(!E.canEditItems||!f(o.status)){T.add({severity:"warn",summary:"Editing Disabled",detail:"You do not have permission or the item status prevents editing.",life:3e3});return}if(e!=="total_qty"){if(e==="config"&&o.packaging_config){T.add({severity:"warn",summary:"Editing Disabled",detail:"Config cannot be edited when Packaging Config has a value.",life:4e3});return}c.value={itemId:o.id,field:e},h.value=o[e],ne(()=>{F.value&&F.value.select()})}},k=()=>{c.value=null,h.value=""},w=o=>{if(!c.value)return;const{field:e}=c.value;let b=h.value;if(["bulk_qty","loose_qty","config"].includes(e)&&(b=parseFloat(b),isNaN(b)||e==="config"&&b<=0||e!=="config"&&b<0)){const d=e==="config"?"Config must be a positive number.":`${e} must be a non-negative number.`;T.add({severity:"error",summary:"Invalid Input",detail:d,life:3e3});return}U.put(route("month-end-count-approvals.update-item",o.id),{[e]:b},{preserveScroll:!0,onSuccess:()=>{T.add({severity:"success",summary:"Success",detail:"Item updated successfully.",life:3e3}),k()},onError:d=>{const g=Object.values(d)[0]||"An unknown error occurred.";T.add({severity:"error",summary:"Update Failed",detail:g,life:5e3})}})},Q=()=>{M.require({message:"Are you sure you want to approve this count?",header:"Confirm Approval",icon:"pi pi-check-circle",rejectClass:"p-button-danger",accept:()=>{U.post(route("month-end-count-approvals.approve-level1",{schedule_id:E.schedule.id,branch_id:E.branch.id}),{},{onSuccess:()=>{T.add({severity:"success",summary:"Approved",detail:"Count has been approved.",life:3e3})},onError:o=>{const e=Object.values(o)[0]||"An unknown error occurred.";T.add({severity:"error",summary:"Approval Failed",detail:e,life:5e3})}})}})},Y=()=>{U.get(route("month-end-count-approvals.index"))},R=K(()=>E.countItems.some(o=>o.status==="pending_level1_approval")),I=K(()=>E.countItems.length>0?E.countItems[0].status:E.schedule.status);return(o,e)=>{const b=x("Badge"),d=x("Button"),g=x("TH"),W=x("TableHead"),p=x("TD"),A=x("Input"),X=x("TableBody"),Z=x("Table"),G=x("TableContainer"),J=x("Layout");return i(),y(L,null,[t(v(te),{title:`Month End Approval - ${s.branch.name}`},null,8,["title"]),t(J,{heading:`Month End Approval - ${s.branch.name}`},{default:n(()=>[m("div",ue,[e[10]||(e[10]=m("h3",{class:"text-lg font-semibold mb-2"},"Schedule Details",-1)),m("p",null,[e[5]||(e[5]=m("strong",null,"Year:",-1)),a(" "+r(s.schedule.year),1)]),m("p",null,[e[6]||(e[6]=m("strong",null,"Month:",-1)),a(" "+r(O(s.schedule.month)),1)]),m("p",null,[e[7]||(e[7]=m("strong",null,"MEC Schedule Date:",-1)),a(" "+r(H(s.schedule.calculated_date)),1)]),m("p",null,[e[8]||(e[8]=m("strong",null,"Branch:",-1)),a(" "+r(s.branch.name),1)]),m("p",null,[e[9]||(e[9]=m("strong",null,"Current Status:",-1)),t(b,{class:V(["capitalize",{"bg-yellow-500 text-white":I.value==="pending"||I.value==="uploaded","bg-purple-500 text-white":I.value==="pending_level1_approval","bg-blue-500 text-white":I.value==="level1_approved","bg-green-500 text-white":I.value==="level2_approved","bg-red-500 text-white":I.value==="rejected"||I.value==="expired"}])},{default:n(()=>[a(r(I.value?I.value.replace(/_/g," "):""),1)]),_:1},8,["class"])])]),m("div",re,[t(d,{onClick:Y,variant:"outline"},{default:n(()=>[t(v(oe),{class:"h-4 w-4 mr-2"}),e[11]||(e[11]=a(" Back "))]),_:1}),R.value?(i(),y("div",de,[s.canApproveLevel1?(i(),B(d,{key:0,onClick:Q,variant:"success",class:"bg-green-600 hover:bg-green-700 text-white"},{default:n(()=>[t(v(se),{class:"h-4 w-4 mr-2"}),e[12]||(e[12]=a(" Approve "))]),_:1})):_("",!0)])):_("",!0)]),t(G,null,{default:n(()=>[m("div",ie,[t(Z,null,{default:n(()=>[t(W,{class:"sticky top-0 z-10 bg-gray-100"},{default:n(()=>[t(g,null,{default:n(()=>e[13]||(e[13]=[a("Item Code")])),_:1}),t(g,null,{default:n(()=>e[14]||(e[14]=[a("Item Name")])),_:1}),t(g,null,{default:n(()=>e[15]||(e[15]=[a("Area")])),_:1}),t(g,null,{default:n(()=>e[16]||(e[16]=[a("Category 2")])),_:1}),t(g,null,{default:n(()=>e[17]||(e[17]=[a("Category")])),_:1}),t(g,null,{default:n(()=>e[18]||(e[18]=[a("Brand")])),_:1}),t(g,null,{default:n(()=>e[19]||(e[19]=[a("Packaging Config")])),_:1}),t(g,null,{default:n(()=>e[20]||(e[20]=[a("Config")])),_:1}),t(g,null,{default:n(()=>e[21]||(e[21]=[a("UOM")])),_:1}),t(g,null,{default:n(()=>e[22]||(e[22]=[a("Current SOH")])),_:1}),t(g,null,{default:n(()=>e[23]||(e[23]=[a("Bulk Qty")])),_:1}),t(g,null,{default:n(()=>e[24]||(e[24]=[a("Loose Qty")])),_:1}),t(g,null,{default:n(()=>e[25]||(e[25]=[a("Loose UOM")])),_:1}),t(g,null,{default:n(()=>e[26]||(e[26]=[a("Remarks")])),_:1}),t(g,null,{default:n(()=>e[27]||(e[27]=[a("Total Qty")])),_:1}),t(g,null,{default:n(()=>e[28]||(e[28]=[a("Status")])),_:1}),t(g,null,{default:n(()=>e[29]||(e[29]=[a("Uploaded By")])),_:1})]),_:1}),t(X,null,{default:n(()=>[s.countItems.length?_("",!0):(i(),y("tr",ce,e[30]||(e[30]=[m("td",{colspan:"17",class:"text-center py-4"},"No items awaiting approval found for this count.",-1)]))),(i(!0),y(L,null,le(s.countItems,l=>(i(),y("tr",{key:l.id},[t(p,null,{default:n(()=>[a(r(l.item_code),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.item_name),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.area),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.category2),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.category),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.brand),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.packaging_config),1)]),_:2},1024),t(p,null,{default:n(()=>[c.value&&c.value.itemId===l.id&&c.value.field==="config"?(i(),y("div",ge,[S(t(A,{type:"number",modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=u=>h.value=u),class:"w-24 text-right py-1",onKeyup:[C(u=>w(l),["enter"]),C(k,["esc"])]},null,8,["modelValue","onKeyup"]),[[$]]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:u=>w(l)},{default:n(()=>[t(v(N),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:k},{default:n(()=>[t(v(z),{class:"h-4 w-4"})]),_:1})])):(i(),y("div",{key:1,onClick:u=>q(l,"config"),class:V(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":s.canEditItems&&f(l.status)&&!l.packaging_config,"cursor-not-allowed bg-gray-50 text-gray-500":!s.canEditItems||!f(l.status)||l.packaging_config}])},[a(r(l.config)+" ",1),s.canEditItems&&f(l.status)&&!l.packaging_config?(i(),B(v(D),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):_("",!0)],10,ve))]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.uom),1)]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.current_soh),1)]),_:2},1024),t(p,null,{default:n(()=>[c.value&&c.value.itemId===l.id&&c.value.field==="bulk_qty"?(i(),y("div",pe,[S(t(A,{type:"number",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=u=>h.value=u),class:"w-24 text-right py-1",onKeyup:[C(u=>w(l),["enter"]),C(k,["esc"])]},null,8,["modelValue","onKeyup"]),[[$]]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:u=>w(l)},{default:n(()=>[t(v(N),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:k},{default:n(()=>[t(v(z),{class:"h-4 w-4"})]),_:1})])):(i(),y("div",{key:1,onClick:u=>q(l,"bulk_qty"),class:V(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":s.canEditItems&&f(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!s.canEditItems||!f(l.status)}])},[a(r(l.bulk_qty)+" ",1),s.canEditItems&&f(l.status)?(i(),B(v(D),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):_("",!0)],10,fe))]),_:2},1024),t(p,null,{default:n(()=>[c.value&&c.value.itemId===l.id&&c.value.field==="loose_qty"?(i(),y("div",ye,[S(t(A,{type:"number",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=u=>h.value=u),class:"w-24 text-right py-1",onKeyup:[C(u=>w(l),["enter"]),C(k,["esc"])]},null,8,["modelValue","onKeyup"]),[[$]]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:u=>w(l)},{default:n(()=>[t(v(N),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:k},{default:n(()=>[t(v(z),{class:"h-4 w-4"})]),_:1})])):(i(),y("div",{key:1,onClick:u=>q(l,"loose_qty"),class:V(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":s.canEditItems&&f(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!s.canEditItems||!f(l.status)}])},[a(r(l.loose_qty)+" ",1),s.canEditItems&&f(l.status)?(i(),B(v(D),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):_("",!0)],10,me))]),_:2},1024),t(p,null,{default:n(()=>[c.value&&c.value.itemId===l.id&&c.value.field==="loose_uom"?(i(),y("div",be,[S(t(A,{type:"text",modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=u=>h.value=u),class:"w-24 text-right py-1",onKeyup:[C(u=>w(l),["enter"]),C(k,["esc"])]},null,8,["modelValue","onKeyup"]),[[$]]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:u=>w(l)},{default:n(()=>[t(v(N),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:k},{default:n(()=>[t(v(z),{class:"h-4 w-4"})]),_:1})])):(i(),y("div",{key:1,onClick:u=>q(l,"loose_uom"),class:V(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":s.canEditItems&&f(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!s.canEditItems||!f(l.status)}])},[a(r(l.loose_uom)+" ",1),s.canEditItems&&f(l.status)?(i(),B(v(D),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):_("",!0)],10,he))]),_:2},1024),t(p,null,{default:n(()=>[c.value&&c.value.itemId===l.id&&c.value.field==="remarks"?(i(),y("div",ke,[S(t(A,{type:"text",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=u=>h.value=u),class:"w-24 text-right py-1",onKeyup:[C(u=>w(l),["enter"]),C(k,["esc"])]},null,8,["modelValue","onKeyup"]),[[$]]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:u=>w(l)},{default:n(()=>[t(v(N),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:k},{default:n(()=>[t(v(z),{class:"h-4 w-4"})]),_:1})])):(i(),y("div",{key:1,onClick:u=>q(l,"remarks"),class:V(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":s.canEditItems&&f(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!s.canEditItems||!f(l.status)}])},[a(r(l.remarks)+" ",1),s.canEditItems&&f(l.status)?(i(),B(v(D),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):_("",!0)],10,we))]),_:2},1024),t(p,null,{default:n(()=>[a(r(P(l)),1)]),_:2},1024),t(p,null,{default:n(()=>[t(b,{class:V(["capitalize",{"bg-yellow-500 text-white":l.status==="pending"||l.status==="uploaded","bg-purple-500 text-white":l.status==="pending_level1_approval","bg-blue-500 text-white":l.status==="level1_approved","bg-green-500 text-white":l.status==="level2_approved","bg-red-500 text-white":l.status==="rejected"||l.status==="expired"}])},{default:n(()=>[a(r(l.status?l.status.replace(/_/g," "):""),1)]),_:2},1032,["class"])]),_:2},1024),t(p,null,{default:n(()=>[a(r(l.uploader?`${l.uploader.first_name} ${l.uploader.last_name}`:"N/A"),1)]),_:2},1024)]))),128))]),_:1})]),_:1})])]),_:1})]),_:1},8,["heading"])],64)}}};export{Te as default};
