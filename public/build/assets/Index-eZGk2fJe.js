import{x as w,Q as h,y as B,N as S,l as X,T as he,r as n,o as b,c as N,w as l,a as t,b as a,u,t as i,g as $,j as Be,i as A,d as k,e as j,F as L,n as Ne,h as R}from"./app-p8ycGfai.js";import{u as $e}from"./useSelectOptions-Ci2WUICq.js";import{l as Oe}from"./lodash-Z9yJD-f9.js";import{u as Me}from"./useAuth-CsB0rIGq.js";const Ae={class:"flex justify-center mt-3"},Re={class:"flex justify-end"},Ue=["onClick"],je=["onClick"],Je={__name:"Index",props:{orders:{type:Object},branches:{type:Object}},setup(V){const K=()=>{S.get("/store-orders/create")},Q=V,{options:H}=$e(Q.branches);console.log(H);let d=w((h().props.filters.filterQuery||"pending").toString());const z=o=>{S.get(`/store-orders/show/${o}`)},J=o=>{S.get(`/store-orders/edit/${o}`)};let c=w(h().props.from??null),p=w(h().props.to??null),m=w(h().props.filters.branchId),f=w(h().props.filters.search);B(c,o=>{S.get(route("store-orders.index"),{search:f.value,filterQuery:d.value,from:o,to:p.value,branchId:m.value},{preserveState:!0,preserveScroll:!0})}),B(p,o=>{S.get(route("store-orders.index"),{search:f.value,filterQuery:d.value,from:c.value,to:o,branchId:m.value},{preserveState:!0,preserveScroll:!0})}),B(m,o=>{S.get(route("store-orders.index"),{search:f.value,filterQuery:d.value,from:c.value,to:p.value,branchId:o},{preserveState:!0,preserveScroll:!0})}),B(f,Oe.throttle(function(o){S.get(route("store-orders.index"),{search:o,filterQuery:d.value,from:c.value,to:p.value,branchId:m.value},{preserveState:!0,replace:!0})},500));const W=o=>{switch(o==null?void 0:o.toUpperCase()){case"RECEIVED":return"bg-green-500 text-white";case"APPROVED":return"bg-teal-500 text-white";case"INCOMPLETE":return"bg-orange-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMMITTED":return"bg-blue-500 text-white";case"REJECTED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},Y=()=>{c.value=null,p.value=null,m.value=null,f.value=null};B(d,function(o){S.get(route("store-orders.index"),{search:f.value,filterQuery:o,from:c.value,to:p.value,branchId:m.value},{preserveState:!0,replace:!0})});const D=o=>{d.value=o},{hasAccess:E}=Me(),Z=X(()=>route("store-orders.export",{search:f.value,branchId:m.value,filterQuery:d.value,from:c.value,to:p.value})),s=he({branch:null,start_date:null,end_date:null}),O=w(!1),ee=()=>{O.value=!0},te=X(()=>route("pdf-export.store-orders",{branch:s.branch,start_date:s.start_date,end_date:s.end_date})),le=()=>{if(s.clearErrors(),s.branch||(s.errors.branch="Branch is required"),s.start_date||(s.errors.start_date="Start date is required"),s.end_date||(s.errors.end_date="End date is required"),s.start_date&&s.end_date){const o=new Date(s.start_date);new Date(s.end_date)<o&&(s.errors.end_date="End date cannot be earlier than start date")}Object.keys(s.errors).length>0||(window.open(te.value,"_blank"),O.value=!1)},re=o=>{if(!o||!o.includes("-"))return"N/A";try{const[e,v,I]=o.substring(0,10).split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(v,10)-1]} ${parseInt(I,10)}, ${e}`}catch(e){return console.error("Error manually formatting date:",o,e),o}},q=o=>{if(!o)return"N/A";try{const[e,v]=o.split(" "),[I,T,F]=e.split("-"),[M,P]=v.split(":");let g=parseInt(M,10),x="A.M.";return g>=12&&(x="P.M.",g>12&&(g-=12)),g===0&&(g=12),`${parseInt(T,10)}/${parseInt(F,10)}/${I} ${g}:${P} ${x}`}catch(e){return console.error("Error manually formatting datetime:",o,e),o}};return console.log(Q.branches),(o,e)=>{const v=n("LabelXS"),I=n("Select"),T=n("FormError"),F=n("InputContainer"),M=n("DatePicker"),P=n("Button"),g=n("DivFlexCol"),x=n("FilterTabButton"),ne=n("FilterTab"),U=n("Input"),oe=n("SearchBar"),ae=n("Filter"),ue=n("PopoverTrigger"),se=n("SelectValue"),de=n("SelectTrigger"),ie=n("SelectLabel"),ce=n("SelectItem"),pe=n("SelectGroup"),me=n("SelectContent"),fe=n("SelectShad"),_e=n("PopoverContent"),be=n("Popover"),G=n("DivFlexCenter"),ve=n("TableHeader"),C=n("TH"),xe=n("TableHead"),y=n("TD"),ge=n("Badge"),Ce=n("Eye"),ye=n("Pencil"),Se=n("TableBody"),De=n("Table"),Te=n("ShowButton"),Fe=n("EditButton"),we=n("MobileTableHeading"),ke=n("MobileTableRow"),Ve=n("MobileTableContainer"),Ee=n("Pagination"),Ie=n("TableContainer"),Pe=n("Layout");return b(),N(Pe,{heading:"Store Orders",hasButton:u(E)("create store orders"),buttonName:"Create New Order",handleClick:K,hasExcelDownload:!0,exportRoute:Z.value},{default:l(()=>[t(u(Be),{visible:O.value,"onUpdate:visible":e[3]||(e[3]=r=>O.value=r),modal:"",header:"Export to PDF",style:{width:"25rem"}},{default:l(()=>[t(g,null,{default:l(()=>[t(F,null,{default:l(()=>[t(v,null,{default:l(()=>e[14]||(e[14]=[a("Branch")])),_:1}),t(I,{modelValue:u(s).branch,"onUpdate:modelValue":e[0]||(e[0]=r=>u(s).branch=r),filter:"",class:"w-full",placeholder:"Select a branch",options:u(H),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(T,null,{default:l(()=>[a(i(u(s).errors.branch),1)]),_:1})]),_:1}),t(F,null,{default:l(()=>[t(v,null,{default:l(()=>e[15]||(e[15]=[a("Start Date")])),_:1}),t(M,{showIcon:"",modelValue:u(s).start_date,"onUpdate:modelValue":e[1]||(e[1]=r=>u(s).start_date=r)},null,8,["modelValue"]),t(T,null,{default:l(()=>[a(i(u(s).errors.start_date),1)]),_:1})]),_:1}),t(F,null,{default:l(()=>[t(v,null,{default:l(()=>e[16]||(e[16]=[a("End Date")])),_:1}),t(M,{showIcon:"",modelValue:u(s).end_date,"onUpdate:modelValue":e[2]||(e[2]=r=>u(s).end_date=r)},null,8,["modelValue"]),t(T,null,{default:l(()=>[a(i(u(s).errors.end_date),1)]),_:1})]),_:1}),$("div",Ae,[t(P,{onClick:le,class:"w-full"},{default:l(()=>e[17]||(e[17]=[a("Export")])),_:1})])]),_:1})]),_:1},8,["visible"]),t(ne,null,{default:l(()=>[t(x,{label:"All",filter:"all",currentFilter:u(d),onClick:e[4]||(e[4]=r=>D("all"))},null,8,["currentFilter"]),t(x,{label:"Pending",filter:"pending",currentFilter:u(d),onClick:e[5]||(e[5]=r=>D("pending"))},null,8,["currentFilter"]),t(x,{label:"Approved",filter:"approved",currentFilter:u(d),onClick:e[6]||(e[6]=r=>D("approved"))},null,8,["currentFilter"]),t(x,{label:"Commited",filter:"committed",currentFilter:u(d),onClick:e[7]||(e[7]=r=>D("committed"))},null,8,["currentFilter"]),t(x,{label:"Received",filter:"received",currentFilter:u(d),onClick:e[8]||(e[8]=r=>D("received"))},null,8,["currentFilter"]),t(x,{label:"Rejected",filter:"rejected",currentFilter:u(d),onClick:e[9]||(e[9]=r=>D("rejected"))},null,8,["currentFilter"])]),_:1}),t(Ie,null,{default:l(()=>[t(ve,null,{default:l(()=>[t(oe,null,{default:l(()=>[t(U,{modelValue:u(f),"onUpdate:modelValue":e[10]||(e[10]=r=>A(f)?f.value=r:f=r),id:"search",type:"text",placeholder:"Search for order number",class:"pl-10 sm:max-w-full max-w-64"},null,8,["modelValue"])]),_:1}),t(G,{class:"gap-5"},{default:l(()=>[t(P,{onClick:ee},{default:l(()=>e[18]||(e[18]=[a("Export To PDF")])),_:1}),t(be,null,{default:l(()=>[t(ue,null,{default:l(()=>[t(ae)]),_:1}),t(_e,null,{default:l(()=>[$("div",Re,[t(P,{onClick:Y,variant:"link",class:"text-end text-red-500 text-xs"},{default:l(()=>e[19]||(e[19]=[a(" Reset Filter ")])),_:1})]),e[21]||(e[21]=$("label",{class:"text-xs"},"From",-1)),t(U,{type:"date",modelValue:u(c),"onUpdate:modelValue":e[11]||(e[11]=r=>A(c)?c.value=r:c=r)},null,8,["modelValue"]),e[22]||(e[22]=$("label",{class:"text-xs"},"To",-1)),t(U,{type:"date",modelValue:u(p),"onUpdate:modelValue":e[12]||(e[12]=r=>A(p)?p.value=r:p=r)},null,8,["modelValue"]),e[23]||(e[23]=$("label",{class:"text-xs"},"Store",-1)),t(fe,{modelValue:u(m),"onUpdate:modelValue":e[13]||(e[13]=r=>A(m)?m.value=r:m=r)},{default:l(()=>[t(de,null,{default:l(()=>[t(se,{placeholder:"Select a store"})]),_:1}),t(me,null,{default:l(()=>[t(pe,null,{default:l(()=>[t(ie,null,{default:l(()=>e[20]||(e[20]=[a("Stores")])),_:1}),(b(!0),k(L,null,j(V.branches,(r,_)=>(b(),N(ce,{value:_},{default:l(()=>[a(i(r),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(De,null,{default:l(()=>[t(xe,null,{default:l(()=>[t(C,null,{default:l(()=>e[24]||(e[24]=[a("Id")])),_:1}),t(C,null,{default:l(()=>e[25]||(e[25]=[a("Supplier")])),_:1}),t(C,null,{default:l(()=>e[26]||(e[26]=[a("Store")])),_:1}),t(C,null,{default:l(()=>e[27]||(e[27]=[a("Order #")])),_:1}),t(C,null,{default:l(()=>e[28]||(e[28]=[a("Delivery Date")])),_:1}),t(C,null,{default:l(()=>e[29]||(e[29]=[a("Order Placed Date")])),_:1}),t(C,null,{default:l(()=>e[30]||(e[30]=[a("Order Status")])),_:1}),t(C,null,{default:l(()=>e[31]||(e[31]=[a("Actions")])),_:1})]),_:1}),t(Se,null,{default:l(()=>[(b(!0),k(L,null,j(V.orders.data,r=>(b(),k("tr",{key:r.id},[t(y,null,{default:l(()=>[a(i(r.id),1)]),_:2},1024),t(y,null,{default:l(()=>{var _;return[a(i(((_=r.supplier)==null?void 0:_.name)??"N/A"),1)]}),_:2},1024),t(y,null,{default:l(()=>{var _;return[a(i(((_=r.store_branch)==null?void 0:_.name)??"N/A"),1)]}),_:2},1024),t(y,null,{default:l(()=>[a(i(r.order_number),1)]),_:2},1024),t(y,null,{default:l(()=>[a(i(re(r.order_date)),1)]),_:2},1024),t(y,null,{default:l(()=>[a(i(q(r.created_at)),1)]),_:2},1024),t(y,null,{default:l(()=>[t(ge,{class:Ne([W(r.order_status),"font-bold"])},{default:l(()=>[a(i(r.order_status.toUpperCase()),1)]),_:2},1032,["class"])]),_:2},1024),t(y,null,{default:l(()=>[t(G,{class:"gap-3"},{default:l(()=>[u(E)("view store order")?(b(),k("button",{key:0,onClick:_=>z(r.order_number)},[t(Ce,{class:"size-5"})],8,Ue)):R("",!0),r.order_status==="pending"&&u(E)("edit store orders")?(b(),k("button",{key:1,class:"text-blue-500",onClick:_=>J(r.order_number)},[t(ye,{class:"size-5"})],8,je)):R("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1}),t(Ve,null,{default:l(()=>[(b(!0),k(L,null,j(V.orders.data,r=>(b(),N(ke,null,{default:l(()=>[t(we,{title:r.order_number},{default:l(()=>[u(E)("view store order")?(b(),N(Te,{key:0,class:"size-5",onClick:_=>z(r.order_number)},null,8,["onClick"])):R("",!0),r.order_status==="pending"&&u(E)("edit store orders")?(b(),N(Fe,{key:1,class:"size-5",onClick:_=>J(r.order_number)},null,8,["onClick"])):R("",!0)]),_:2},1032,["title"]),t(v,null,{default:l(()=>[a(" Status: "+i(r.order_status.toUpperCase()),1)]),_:2},1024),t(v,null,{default:l(()=>[a(" Delivery Date: "+i(q(r.order_date)),1)]),_:2},1024)]),_:2},1024))),256))]),_:1}),t(Ee,{data:V.orders},null,8,["data"])]),_:1})]),_:1},8,["hasButton","exportRoute"])}}};export{Je as default};
