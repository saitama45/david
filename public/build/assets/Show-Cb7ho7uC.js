import{l as A,r as D,o as l,d as n,a as m,u as st,Z as ot,w as h,g as t,b as P,t as s,n as dt,F as p,e as x,h as $,N as at}from"./app-Drfr7wPO.js";const lt={class:"flex justify-between w-full"},nt={class:"bg-white border rounded-md shadow-sm p-6"},it={class:"space-y-4"},ct={class:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4"},bt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},yt={class:"text-lg font-bold text-blue-700"},pt={class:"text-lg font-bold text-blue-600"},ut={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-3"},xt={class:"text-sm font-medium text-gray-700"},gt={class:"text-sm font-medium text-gray-700"},mt={class:"text-sm font-medium text-gray-700"},ft={key:0,class:"mt-6 overflow-x-auto"},ht={class:"min-w-full border-collapse border border-gray-300 text-sm"},_t={class:"bg-gray-100"},vt=["colspan"],wt={class:"text-xs font-bold"},Tt={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},Et={key:1,class:"text-xs text-gray-500 mt-1"},Nt={class:"bg-gray-200"},kt={class:"text-xs"},Ct={class:"text-xs"},At={class:"bg-gray-300"},Dt={class:"border border-gray-300 px-3 py-2"},$t={class:"border border-gray-300 px-3 py-2"},Ft={class:"border border-gray-300 px-3 py-2 text-center"},It={class:"border border-gray-300 px-3 py-2 text-right"},St={class:"border border-gray-300 px-3 py-2 text-center"},Mt={class:"font-semibold text-blue-700"},Ot={class:"border border-gray-300 px-3 py-2 text-center"},Pt={class:"font-semibold text-green-700"},Bt={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Rt={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Vt={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Lt={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-green-50"},Ut={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-red-50"},Gt={class:"bg-gray-700 text-white font-bold"},qt=["colspan"],Jt={class:"border border-gray-300 px-3 py-2 text-right"},Ht={class:"border border-gray-300 px-3 py-2 text-right"},Qt={key:1,class:"mt-6 overflow-x-auto"},zt={class:"min-w-full border-collapse border border-gray-300 text-sm"},Yt={class:"bg-white"},Zt={class:"border border-gray-300 px-3 py-2"},Kt={class:"border border-gray-300 px-3 py-2"},Wt={class:"border border-gray-300 px-3 py-2 text-center font-semibold"},Xt={key:0},jt={class:"bg-gray-200"},te={class:"border border-gray-300 px-3 py-2 font-bold text-base",colspan:"4"},ee={class:"border border-gray-300 px-3 py-2",colspan:"1"},re={class:"font-bold"},se={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},oe={key:1,class:"text-xs text-gray-500 mt-1"},de={class:"border border-gray-300 px-3 py-2 text-center"},ae={class:"font-semibold text-blue-700"},le={class:"border border-gray-300 px-3 py-2 text-center"},ne={class:"font-semibold text-green-700"},ie={class:"border border-gray-300 px-3 py-2 text-center"},ce={class:"font-semibold text-red-700"},be={class:"bg-blue-50 font-semibold"},ye={class:"border border-gray-300 px-3 py-2 text-center"},pe={class:"border border-gray-300 px-3 py-2 text-center"},ue={class:"border border-gray-300 px-3 py-2 text-center"},xe={class:"bg-gray-700 text-white font-bold"},ge={class:"border border-gray-300 px-3 py-2 text-center"},me={class:"border border-gray-300 px-3 py-2 text-center"},fe={class:"border border-gray-300 px-3 py-2 text-center"},_e={__name:"Show",props:{batch_number:{type:String,required:!0},variant:{type:String,default:null},date_from:{type:String,default:null},date_to:{type:String,default:null},stores:{type:Array,default:()=>[]},dates:{type:Array,default:()=>[]},sap_item:{type:Object,default:null},supplier_items:{type:Array,default:()=>[]},orders:{type:Object,default:()=>({})},status:{type:String,default:null},created_at:{type:String,default:null},encoder:{type:Object,default:null}},setup(a){const d=a,H=()=>{at.get(route("dts-mass-orders.index"))},B=r=>{if(!r)return"Not Selected";try{const[e,i,y]=r.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(i,10)-1]} ${parseInt(y,10)}, ${e}`}catch{return r}},Q=r=>{if(!r)return"N/A";try{const[e,i]=r.split(" "),[y,b,u]=e.split("-"),[O,F]=i.split(":");let g=parseInt(O,10),v="A.M.";return g>=12&&(v="P.M.",g>12&&(g-=12)),g===0&&(g=12),`${parseInt(b,10)}/${parseInt(u,10)}/${y} ${g}:${F} ${v}`}catch{return r}},I=r=>{let e=0;return d.stores.forEach(i=>{var b,u;const y=parseFloat(((u=(b=d.orders[r])==null?void 0:b[i.id])==null?void 0:u.approved)||0);e+=isNaN(y)?0:y}),e},S=r=>{if(d.status==="approved")return 0;let e=0;return d.stores.forEach(i=>{var b,u;const y=parseFloat(((u=(b=d.orders[r])==null?void 0:b[i.id])==null?void 0:u.committed)||0);e+=isNaN(y)?0:y}),e},z=r=>S(r)-I(r),R=A(()=>{let r=0;return d.dates.forEach(e=>{r+=I(e.date)}),r}),V=A(()=>{let r=0;return d.dates.forEach(e=>{r+=S(e.date)}),r}),L=A(()=>R.value-V.value),Y=(r,e)=>!r.delivery_schedule_ids||!e.delivery_schedule_id?!1:r.delivery_schedule_ids.includes(e.delivery_schedule_id),Z=r=>d.stores.filter(e=>Y(e,r)),K=r=>{switch(r==null?void 0:r.toUpperCase()){case"APPROVED":return"bg-teal-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMPLETED":return"bg-green-500 text-white";case"CANCELLED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},W=()=>{window.open(route("dts-mass-orders.export",d.batch_number),"_blank")},_=r=>d.variant==="FRUITS AND VEGETABLES"?d.dates.filter(e=>d.supplier_items.some(i=>{var y,b;return((b=(y=d.orders[i.id])==null?void 0:y[e.date])==null?void 0:b[r.id])!==void 0})):d.dates.filter(e=>{var i;return((i=d.orders[e.date])==null?void 0:i[r.id])!==void 0}),X=A(()=>d.stores.reduce((r,e)=>r+_(e).length,0)),M=r=>{let e=0;return d.orders[r]?(Object.keys(d.orders[r]).forEach(i=>{Object.keys(d.orders[r][i]).forEach(y=>{var u;const b=parseFloat(((u=d.orders[r][i][y])==null?void 0:u.approved)||0);e+=isNaN(b)?0:b})}),e):0},j=r=>{if(d.status==="approved")return 0;let e=0;return d.orders[r]?(Object.keys(d.orders[r]).forEach(i=>{Object.keys(d.orders[r][i]).forEach(y=>{var u;const b=parseFloat(((u=d.orders[r][i][y])==null?void 0:u.committed)||0);e+=isNaN(b)?0:b})}),e):0},tt=r=>j(r)-M(r),et=()=>10,U=r=>M(r)*1.1,G=(r,e)=>U(r)*e,rt=A(()=>{let r=0;return d.supplier_items.forEach(e=>{r+=G(e.id,e.price)}),r});return(r,e)=>{const i=D("Button"),y=D("TableHeader"),b=D("Badge"),u=D("TableContainer"),O=D("Layout");return l(),n(p,null,[m(st(ot),{title:"View DTS Mass Order"}),m(O,{heading:"View DTS Mass Order"},{default:h(()=>[m(u,null,{default:h(()=>{var F,g,v,q;return[m(y,null,{default:h(()=>[t("div",lt,[m(i,{onClick:H,variant:"outline",class:"text-black border-black hover:bg-gray-100"},{default:h(()=>e[0]||(e[0]=[P(" Back ")])),_:1}),m(i,{onClick:W,class:"bg-green-600 hover:bg-green-700 text-white"},{default:h(()=>e[1]||(e[1]=[P(" Export to Excel ")])),_:1})])]),_:1}),t("div",nt,[t("div",it,[t("div",ct,[t("div",bt,[t("div",null,[e[2]||(e[2]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Batch Number",-1)),t("p",yt,s(a.batch_number),1)]),t("div",null,[e[3]||(e[3]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Variant",-1)),t("p",pt,s(a.variant),1)]),t("div",null,[e[4]||(e[4]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase block mb-2"},"Status",-1)),m(b,{class:dt([K(a.status),"font-bold text-sm"])},{default:h(()=>[P(s(a.status?a.status.toUpperCase():"N/A"),1)]),_:1},8,["class"])])]),t("div",ut,[t("div",null,[e[5]||(e[5]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Date Range",-1)),t("p",xt,s(B(a.date_from))+" - "+s(B(a.date_to)),1)]),t("div",null,[e[6]||(e[6]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Created By",-1)),t("p",gt,s((F=a.encoder)==null?void 0:F.first_name)+" "+s((g=a.encoder)==null?void 0:g.last_name),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Created At",-1)),t("p",mt,s(Q(a.created_at)),1)])])]),a.variant==="FRUITS AND VEGETABLES"?(l(),n("div",ft,[t("table",ht,[t("thead",null,[t("tr",_t,[e[8]||(e[8]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"100px"}},"ITEM CODE",-1)),e[9]||(e[9]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"200px"}},"ITEM NAME",-1)),e[10]||(e[10]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"UOM",-1)),e[11]||(e[11]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"PRICE",-1)),(l(!0),n(p,null,x(a.stores,o=>(l(),n("th",{key:`store-${o.id}`,colspan:_(o).length*2,class:"border border-gray-300 px-2 py-2 font-semibold text-center bg-blue-50",style:{"min-width":"120px"}},[t("div",wt,s(o.name),1),o.brand_code?(l(),n("div",Tt,s(o.brand_code),1)):$("",!0),o.complete_address?(l(),n("div",Et,s(o.complete_address),1)):$("",!0)],8,vt))),128)),e[12]||(e[12]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL ORDER",-1)),e[13]||(e[13]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"BUFFER",-1)),e[14]||(e[14]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL PO",-1)),e[15]||(e[15]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-green-100 align-middle"},"TOTAL PRICE",-1)),e[16]||(e[16]=t("th",{rowspan:"3",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-red-100 align-middle"},"Variance",-1))]),t("tr",Nt,[(l(!0),n(p,null,x(a.stores,o=>(l(),n(p,{key:`dates-${o.id}`},[(l(!0),n(p,null,x(_(o),c=>(l(),n("th",{key:`date-${o.id}-${c.date}`,colspan:2,class:"border border-gray-300 px-2 py-2 font-semibold text-center"},[t("div",kt,s(c.day_of_week),1),t("div",Ct,s(c.display.split("- ")[1]),1)]))),128))],64))),128))]),t("tr",At,[(l(!0),n(p,null,x(a.stores,o=>(l(),n(p,{key:`sub-dates-${o.id}`},[(l(!0),n(p,null,x(_(o),c=>(l(),n(p,{key:`sub-date-${o.id}-${c.date}`},[e[17]||(e[17]=t("th",{class:"border border-gray-300 px-2 py-1 font-semibold text-center text-xs"},"QTY",-1)),e[18]||(e[18]=t("th",{class:"border border-gray-300 px-2 py-1 font-semibold text-center text-xs"},"COMMITTED",-1))],64))),128))],64))),128))])]),t("tbody",null,[(l(!0),n(p,null,x(a.supplier_items,o=>(l(),n("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",Dt,s(o.item_code),1),t("td",$t,s(o.item_name),1),t("td",Ft,s(o.uom),1),t("td",It,s(o.price.toFixed(2)),1),(l(!0),n(p,null,x(a.stores,c=>(l(),n(p,{key:`body-${c.id}`},[(l(!0),n(p,null,x(_(c),f=>{var w,T,E,N,k,C;return l(),n(p,{key:`${o.id}-${c.id}-${f.date}`},[t("td",St,[t("span",Mt,s(((E=(T=(w=a.orders[o.id])==null?void 0:w[f.date])==null?void 0:T[c.id])==null?void 0:E.approved)||0),1)]),t("td",Ot,[t("span",Pt,s(d.status==="approved"?0:((C=(k=(N=a.orders[o.id])==null?void 0:N[f.date])==null?void 0:k[c.id])==null?void 0:C.committed)||0),1)])],64)}),128))],64))),128)),t("td",Bt,s(M(o.id).toFixed(2)),1),t("td",Rt,s(et())+"% ",1),t("td",Vt,s(U(o.id).toFixed(2)),1),t("td",Lt,s(G(o.id,o.price).toFixed(2)),1),t("td",Ut,s(tt(o.id).toFixed(2)),1)]))),128)),t("tr",Gt,[e[19]||(e[19]=t("td",{colspan:"4",class:"border border-gray-300 px-3 py-2 text-right"},"TOTAL PRICE & VARIANCE",-1)),t("td",{colspan:X.value*2+3,class:"border border-gray-300 px-3 py-2"},null,8,qt),t("td",Jt,s(rt.value.toFixed(2)),1),t("td",Ht,s(L.value.toFixed(2)),1)])])])])):(l(),n("div",Qt,[t("table",zt,[t("thead",null,[e[20]||(e[20]=t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"120px"}}," ITEM CODE "),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"200px"}}," ITEM DESCRIPTION "),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-center",style:{"min-width":"100px"}}," UOM ")],-1)),t("tr",Yt,[t("td",Zt,s(((v=a.sap_item)==null?void 0:v.item_code)||""),1),t("td",Kt,s(((q=a.sap_item)==null?void 0:q.item_description)||""),1),t("td",Wt,[a.sap_item?(l(),n("span",Xt,s(a.sap_item.alt_uom),1)):$("",!0)])])]),t("tbody",null,[(l(!0),n(p,null,x(a.dates,o=>(l(),n(p,{key:o.date},[t("tr",jt,[t("td",te,s(o.display),1)]),e[22]||(e[22]=t("tr",{class:"bg-gray-50"},[t("td",{class:"border border-gray-300 px-3 py-2 font-semibold"}," Store Name "),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"}," Quantity "),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"}," COMMITTED "),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"}," Variance (Ordered vs Committed) ")],-1)),(l(!0),n(p,null,x(Z(o),c=>{var f,w,T,E,N,k,C,J;return l(),n("tr",{key:`${o.date}-${c.id}`,class:"hover:bg-gray-50"},[t("td",ee,[t("div",null,[t("div",re,s(c.name),1),c.brand_code?(l(),n("div",se,s(c.brand_code),1)):$("",!0),c.complete_address?(l(),n("div",oe,s(c.complete_address),1)):$("",!0)])]),t("td",de,[t("span",ae,s(((w=(f=a.orders[o.date])==null?void 0:f[c.id])==null?void 0:w.approved)||0),1)]),t("td",le,[t("span",ne,s(d.status==="approved"?0:((E=(T=a.orders[o.date])==null?void 0:T[c.id])==null?void 0:E.committed)||0),1)]),t("td",ie,[t("span",ce,s((d.status==="approved"?0:((k=(N=a.orders[o.date])==null?void 0:N[c.id])==null?void 0:k.committed)||0)-(((J=(C=a.orders[o.date])==null?void 0:C[c.id])==null?void 0:J.approved)||0)),1)])])}),128)),t("tr",be,[e[21]||(e[21]=t("td",{class:"border border-gray-300 px-3 py-2"}," TOTAL ",-1)),t("td",ye,s(I(o.date)),1),t("td",pe,s(S(o.date)),1),t("td",ue,s(z(o.date)),1)])],64))),128)),t("tr",xe,[e[23]||(e[23]=t("td",{class:"border border-gray-300 px-3 py-2"}," GRAND TOTAL ",-1)),t("td",ge,s(R.value),1),t("td",me,s(V.value),1),t("td",fe,s(L.value),1)])])])]))])])]}),_:1})]),_:1})],64)}}};export{_e as default};
