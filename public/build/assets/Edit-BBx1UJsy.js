import{X as xe,f as ye,x as b,T as be,aW as he,l as h,V as we,r as ke,o as f,c as F,w as u,a as l,u as s,b as v,aj as S,g as e,n as V,aX as P,m as A,O as T,ay as B,s as H,d as x,t as m,h as w,aY as Ce,P as Y,F as Ie,e as Se,_ as G,ah as Ve,b7 as Q,W as X,N as Ne}from"./app-rjK1ng7o.js";import{u as qe}from"./useToast-DBCD-RTl.js";import{a as j,_ as D}from"./AlertDescription-B6smwBW-.js";import{I as Ue}from"./ItemAutoComplete-95Pbgfq4.js";import{I as Fe}from"./ImageUpload-CpHSdbke.js";import{u as Pe}from"./useSelectOptions-C8yZk_6t.js";import{A as Ae}from"./arrow-left-CawIyKRQ.js";import{P as J}from"./package-Dr2_9bTP.js";import{T as $}from"./triangle-alert-wjSEt5KL.js";import"./lodash-DqVvdaAw.js";import"./loader-circle-9bq-iArU.js";import"./circle-alert-D5cL6bJ-.js";import"./x-DY7ygrlY.js";import"./upload-CiN_PamT.js";const Te={class:"space-y-4"},Be={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},je={class:"flex items-center gap-3"},De={class:"p-2 bg-blue-600 rounded-lg"},$e={class:"px-4 sm:px-6 py-4"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"space-y-2"},Le={key:0,class:"text-sm text-red-600"},Me={class:"space-y-2 md:col-span-2"},Oe={key:0,class:"text-sm text-red-600"},Re={class:"space-y-2 md:col-span-2"},ze={key:0,class:"text-sm text-red-600"},He={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ye={class:"flex items-center gap-3"},Ge={class:"p-2 bg-green-600 rounded-lg"},Qe={class:"text-sm text-gray-600"},Xe={class:"px-4 sm:px-6 py-4"},Je={key:0,class:"mb-4"},Ke={class:"grid grid-cols-1 md:grid-cols-12 gap-4 mb-6"},Ze={class:"space-y-2 md:col-span-8"},et={class:"space-y-2 md:col-span-4 flex items-end"},tt={key:1,class:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm bg-blue-50 p-3 rounded-lg"},st={class:"font-medium"},at={class:"font-medium"},ot={class:"font-medium"},rt={key:2,class:"space-y-4"},lt={class:"flex items-center justify-between"},nt={class:"border rounded-lg overflow-hidden"},it={class:"w-full"},dt={class:"divide-y divide-gray-200"},ct={class:"px-4 py-4"},ut={class:"font-medium text-gray-900"},mt={class:"text-sm text-gray-500"},pt={class:"px-4 py-4",style:{"min-width":"170px"}},gt={class:"px-4 py-4"},_t={class:"text-sm text-gray-900"},ft={class:"px-4 py-4"},vt={class:"px-4 py-4"},xt={class:"px-4 py-4"},yt={class:"text-sm font-medium text-gray-900"},bt={class:"px-4 py-4 text-center"},ht={class:"bg-gray-50"},wt={colspan:"2",class:"px-4 py-3 font-bold text-green-600"},kt={key:3,class:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg"},Ct={class:"text-gray-500"},It={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},St={class:"flex items-center gap-3"},Vt={class:"p-2 bg-purple-600 rounded-lg"},Nt={class:"px-4 sm:px-6 py-4"},qt={key:0,class:"bg-blue-50 p-4 rounded-lg mb-4"},Ut={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ft={class:"text-center"},Pt={class:"text-2xl font-bold text-blue-600"},At={class:"text-center"},Tt={class:"text-2xl font-bold text-green-600"},Bt={class:"text-center"},jt={class:"text-lg font-semibold text-purple-600"},Dt={class:"flex flex-col sm:flex-row gap-3"},$t={__name:"Edit",props:{wastage:Object,branches:Array,items:Array},setup(W){var M,O,R,z;const n=W,{toast:C}=qe(),K=ye(),{options:Z}=Pe(n.branches),ee=b(["Spoilage","Wastage","Scrap"]),i=be({store_branch_id:(M=n.wastage)!=null&&M.store_branch_id?Number(n.wastage.store_branch_id):"",remarks:((O=n.wastage)==null?void 0:O.remarks)||"",items:[],images:[]}),g=b(null),te=b(!1),d=b([]),k=b([]),I=b((R=n.wastage)!=null&&R.image_urls&&Array.isArray(n.wastage.image_urls)?n.wastage.image_urls:(z=n.wastage)!=null&&z.image_url?[n.wastage.image_url]:[]),p=he({id:null,inventory_code:null,name:null,description:null,unit_of_measurement:null,base_uom:null,base_qty:null,quantity:null,cost:null,total_cost:null,uom:null,stock:0}),y=b({wastageDetails:!0,itemSelection:!0,summary:!0}),N=a=>{y.value[a]=!y.value[a]},se=h(()=>n.branches.find(a=>a.value===i.store_branch_id)),ae=h(()=>d.value.reduce((a,t)=>a+parseFloat(t.quantity||0)*parseFloat(t.cost||0),0)),E=h(()=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(ae.value)),q=h(()=>i.store_branch_id&&i.remarks&&i.remarks.trim()!==""&&(k.value.length>0||I.value.length>0)&&d.value.length>0&&d.value.every(a=>a.sap_masterfile_id&&parseFloat(a.quantity)>0&&parseFloat(a.cost)>=0&&a.reason)),oe=h(()=>i.store_branch_id),L=h(()=>d.value.length),U=h(()=>d.value.length===0),re=()=>{var a,t;n.wastage&&Array.isArray(n.wastage.items)&&n.wastage.items.length>0&&((a=n.items)==null?void 0:a.length)>0?X(()=>{i.store_branch_id=Number(n.wastage.store_branch_id),i.remarks=n.wastage.remarks||"",d.value=n.wastage.items.map(o=>{const c=Number(o.sap_masterfile_id),r=n.items.find(_=>Number(_.id)===c);return r?{id:o.id,sap_masterfile_id:r.id,item_code:r.item_code,description:r.description||"No description",quantity:o.wastage_qty,cost:o.cost,uom:r.alt_uom||r.uom,total_cost:o.wastage_qty*o.cost,reason:o.reason||"Spoilage"}:null}).filter(Boolean)}):n.wastage&&((t=n.items)==null?void 0:t.length)>0?X(()=>{i.store_branch_id=Number(n.wastage.store_branch_id),i.remarks=n.wastage.remarks||"";const o=Number(n.wastage.sap_masterfile_id),c=n.items.find(r=>Number(r.id)===o);if(c){const r={id:n.wastage.id,sap_masterfile_id:c.id,item_code:c.item_code,description:c.description||"No description",quantity:n.wastage.wastage_qty,cost:n.wastage.cost,uom:c.alt_uom||c.uom,total_cost:n.wastage.wastage_qty*n.wastage.cost,reason:n.wastage.reason||"Spoilage"};d.value=[r]}else d.value=[]}):d.value=[]};we(()=>{re()});const le=a=>{if(!a){Object.keys(p).forEach(t=>{p[t]=null}),g.value=null;return}p.id=a.id,p.inventory_code=String(a.item_code),p.description=a.description||"No description",p.unit_of_measurement=a.alt_uom||a.uom,p.cost=Number(a.cost_per_quantity||1),p.uom=a.uom,p.stock=a.stock||0,g.value=a},ne=()=>{if(!g.value)return;if(d.value.find(o=>o.sap_masterfile_id===g.value.id)){alert("This item is already in the cart. You can update the quantity there.");return}const t={id:-Date.now(),sap_masterfile_id:g.value.id,item_code:g.value.item_code,description:g.value.description||"No description",quantity:1,cost:p.cost||0,uom:p.unit_of_measurement,total_cost:p.cost||0,reason:"Spoilage"};d.value.push(t),g.value=null,Object.keys(p).forEach(o=>{p[o]=null})},ie=a=>{const t=d.value.findIndex(o=>o.id===a);t>-1&&d.value.splice(t,1)},de=(a,t)=>{const o=d.value.find(c=>c.id===a);o&&(o.quantity=parseFloat(t)||0,o.total_cost=o.quantity*o.cost)},ce=(a,t)=>{const o=d.value.find(c=>c.id===a);o&&(o.cost=parseFloat(t)||0,o.total_cost=o.quantity*o.cost)},ue=()=>{d.value=[]},me=()=>{if(!q.value){C.add({severity:"warn",summary:"Invalid Form",detail:"Please fill in all required fields.",life:5e3});return}d.value.length>0?K.require({message:"Are you sure you want to update this wastage record?",header:"Confirm Wastage Record Update",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-danger",rejectLabel:"No",acceptLabel:"Yes",acceptClass:"p-button-success",accept:()=>{pe()},reject:()=>{C.add({severity:"info",summary:"Cancelled",detail:"Wastage record update was cancelled.",life:3e3})}}):C.add({severity:"warn",summary:"No Items",detail:"There are no items to update.",life:5e3})},pe=()=>{const a=d.value.map(o=>({id:o.id,sap_masterfile_id:o.sap_masterfile_id,wastage_qty:parseFloat(o.quantity),cost:parseFloat(o.cost),reason:o.reason}));i.items=a,i.images=k.value||[],i.existing_image_urls=I.value,console.log("Submitting wastage update:",{wastageId:n.wastage.id,itemCount:d.value.length,items:a,hasNewImage:!!(k.value&&k.value.length>0),existingImageUrls:I.value});const t=n.wastage.id;i.post(route("wastage.update",t),{onSuccess:o=>{var r;const c=((r=o.props.flash)==null?void 0:r.success)||"Wastage record updated successfully!";C.add({severity:"success",summary:"Success",detail:c,life:3e3})},onError:o=>{console.error("Form validation errors:",o);let c=Object.values(o).join("; ");o.error&&(c=o.error),C.add({severity:"error",summary:"Update Failed",detail:c||"An unknown error occurred. Please check the console for details.",life:8e3})}})},ge=()=>{Ne.get(route("wastage.index"))},_e=()=>{var a;return((a=se.value)==null?void 0:a.label)||"Select a store"},fe=a=>a?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(a):"â‚±0.00",ve=a=>{(!a.reason||a.reason.trim()==="")&&(a.reason="Spoilage")};return(a,t)=>{var c;const o=ke("Layout");return f(),F(o,{heading:`Edit Wastage Record #${(c=W.wastage)==null?void 0:c.wastage_no}`},{"header-actions":u(()=>[l(s(S),{variant:"outline",onClick:ge},{default:u(()=>[l(s(Ae),{class:"w-4 h-4 mr-2"}),t[8]||(t[8]=v(" Back to Record "))]),_:1})]),default:u(()=>[e("div",Te,[e("div",Be,[e("button",{onClick:t[0]||(t[0]=r=>N("wastageDetails")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200 flex items-center justify-between text-left hover:from-blue-100 hover:to-blue-200 transition-colors"},[e("div",je,[e("div",De,[l(s(J),{class:"w-5 h-5 text-white"})]),t[9]||(t[9]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-900"},"Wastage Details"),e("p",{class:"text-sm text-gray-600"},"Basic wastage information")],-1))]),l(s(P),{class:V(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":y.value.wastageDetails}])},null,8,["class"])]),A(e("div",$e,[e("div",We,[e("div",Ee,[l(s(B),{for:"store_branch_id"},{default:u(()=>t[10]||(t[10]=[v("Store Branch *")])),_:1}),l(s(H),{modelValue:s(i).store_branch_id,"onUpdate:modelValue":t[1]||(t[1]=r=>s(i).store_branch_id=r),filter:"",placeholder:"Select a store branch",options:s(Z),optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"]),s(i).errors.store_branch_id?(f(),x("p",Le,m(s(i).errors.store_branch_id),1)):w("",!0)]),e("div",Me,[l(s(B),{for:"remarks"},{default:u(()=>t[11]||(t[11]=[v("Remarks *")])),_:1}),l(s(Ce),{id:"remarks",modelValue:s(i).remarks,"onUpdate:modelValue":t[2]||(t[2]=r=>s(i).remarks=r),rows:"3",placeholder:"Enter remarks",class:V({"border-red-500":s(i).errors.remarks}),required:""},null,8,["modelValue","class"]),s(i).errors.remarks?(f(),x("p",Oe,m(s(i).errors.remarks),1)):w("",!0)]),e("div",Re,[l(Fe,{modelValue:k.value,"onUpdate:modelValue":t[3]||(t[3]=r=>k.value=r),"existing-image-urls":I.value,"onUpdate:existingImageUrls":t[4]||(t[4]=r=>I.value=r),label:"Wastage Images *","helper-text":"Upload one or more JPG or PNG images as evidence (max 5MB each)",disabled:s(i).processing,multiple:"",required:""},null,8,["modelValue","existing-image-urls","disabled"]),s(i).errors.images?(f(),x("p",ze,m(s(i).errors.images),1)):w("",!0)])])],512),[[T,y.value.wastageDetails]])]),e("div",He,[e("button",{onClick:t[5]||(t[5]=r=>N("itemSelection")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-green-50 to-green-100 border-b border-green-200 flex items-center justify-between text-left hover:from-green-100 hover:to-green-200 transition-colors"},[e("div",Ye,[e("div",Ge,[l(s(Y),{class:"w-5 h-5 text-white"})]),e("div",null,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Item Selection & Cart",-1)),e("p",Qe,"Search items and add to cart ("+m(L.value)+" items)",1)])]),l(s(P),{class:V(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":y.value.itemSelection}])},null,8,["class"])]),A(e("div",Xe,[oe.value?w("",!0):(f(),x("div",Je,[l(s(D),{class:"border-yellow-200 bg-yellow-50"},{default:u(()=>[l(s($),{class:"w-4 h-4 text-yellow-600"}),l(s(j),{class:"text-yellow-800"},{default:u(()=>t[13]||(t[13]=[v(" Please select a store branch first to search for items. ")])),_:1})]),_:1})])),e("div",Ke,[e("div",Ze,[l(s(B),{class:"text-sm font-medium text-gray-700"},{default:u(()=>t[14]||(t[14]=[v("Search Items *")])),_:1}),l(Ue,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=r=>g.value=r),"sending-store-id":parseInt(s(i).store_branch_id),placeholder:"Type at least 3 characters to search for items...",disabled:!s(i).store_branch_id||te.value,onItemSelected:le},null,8,["modelValue","sending-store-id","disabled"])]),e("div",et,[l(s(S),{onClick:ne,disabled:!g.value||!s(i).store_branch_id,class:"w-full h-10 bg-green-600 hover:bg-green-700"},{default:u(()=>[l(s(Y),{class:"w-4 h-4 mr-2"}),t[15]||(t[15]=v(" Add Item "))]),_:1},8,["disabled"])])]),g.value?(f(),x("div",tt,[e("div",null,[t[16]||(t[16]=e("span",{class:"text-gray-600"},"Item Code:",-1)),e("div",st,m(g.value.item_code),1)]),e("div",null,[t[17]||(t[17]=e("span",{class:"text-gray-600"},"Description:",-1)),e("div",at,m(g.value.description||"No description"),1)]),e("div",null,[t[18]||(t[18]=e("span",{class:"text-gray-600"},"UoM:",-1)),e("div",ot,m(p.unit_of_measurement),1)])])):w("",!0),d.value.length>0?(f(),x("div",rt,[e("div",lt,[t[20]||(t[20]=e("h4",{class:"text-md font-semibold text-gray-900"},"Cart Items",-1)),l(s(S),{variant:"outline",size:"sm",onClick:ue},{default:u(()=>t[19]||(t[19]=[v(" Clear Cart ")])),_:1})]),e("div",nt,[e("table",it,[t[22]||(t[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Reason"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"UoM"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Quantity"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cost"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Total"),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Action")])],-1)),e("tbody",dt,[(f(!0),x(Ie,null,Se(d.value,r=>(f(),x("tr",{key:r.id,class:"hover:bg-gray-50"},[e("td",ct,[e("div",null,[e("div",ut,m(r.item_code),1),e("div",mt,m(r.description),1)])]),e("td",pt,[l(s(H),{modelValue:r.reason,"onUpdate:modelValue":_=>r.reason=_,options:ee.value,class:"w-full",onBlur:_=>ve(r)},null,8,["modelValue","onUpdate:modelValue","options","onBlur"])]),e("td",gt,[e("div",_t,m(r.uom),1)]),e("td",ft,[l(s(G),{type:"number",modelValue:r.quantity,"onUpdate:modelValue":_=>r.quantity=_,onInput:_=>de(r.id,_.target.value),step:"0.01",min:"0.01",class:"w-24 h-8 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",vt,[l(s(G),{type:"number",modelValue:r.cost,"onUpdate:modelValue":_=>r.cost=_,onInput:_=>ce(r.id,_.target.value),step:"0.01",min:"0",class:"w-24 h-8 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",xt,[e("div",yt,m(fe(r.total_cost)),1)]),e("td",bt,[l(s(S),{variant:"ghost",size:"sm",onClick:_=>ie(r.id),class:"text-red-600 hover:text-red-700 hover:bg-red-50"},{default:u(()=>[l(s(Ve),{class:"w-4 h-4"})]),_:2},1032,["onClick"])])]))),128))]),e("tfoot",ht,[e("tr",null,[t[21]||(t[21]=e("td",{colspan:"5",class:"px-4 py-3 text-right font-medium text-gray-900"}," Cart Total: ",-1)),e("td",wt,m(E.value),1)])])])])])):(f(),x("div",kt,[e("div",Ct,[l(s(J),{class:"w-12 h-12 mx-auto mb-4 text-gray-400"}),t[23]||(t[23]=e("h3",{class:"text-lg font-medium mb-2"},"No items in cart",-1)),t[24]||(t[24]=e("p",{class:"text-sm"},"Search for items above and add them to the cart to continue.",-1))])]))],512),[[T,y.value.itemSelection]])]),e("div",It,[e("button",{onClick:t[7]||(t[7]=r=>N("summary")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-purple-50 to-purple-100 border-b border-purple-200 flex items-center justify-between text-left hover:from-purple-100 hover:to-purple-200 transition-colors"},[e("div",St,[e("div",Vt,[l(s(Q),{class:"w-5 h-5 text-white"})]),t[25]||(t[25]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Summary & Update"),e("p",{class:"text-sm text-gray-600"},"Review and update wastage record")],-1))]),l(s(P),{class:V(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":y.value.summary}])},null,8,["class"])]),A(e("div",Nt,[U.value?w("",!0):(f(),x("div",qt,[e("div",Ut,[e("div",Ft,[e("div",Pt,m(L.value),1),t[26]||(t[26]=e("div",{class:"text-sm text-gray-600"},"Items in Cart",-1))]),e("div",At,[e("div",Tt,m(E.value),1),t[27]||(t[27]=e("div",{class:"text-sm text-gray-600"},"Total Cost",-1))]),e("div",Bt,[e("div",jt,m(_e()),1),t[28]||(t[28]=e("div",{class:"text-sm text-gray-600"},"Store Branch",-1))])])])),U.value?(f(),F(s(D),{key:1,class:"mb-4 border-yellow-200 bg-yellow-50"},{default:u(()=>[l(s($),{class:"h-4 w-4 text-yellow-600"}),l(s(j),{class:"text-yellow-800"},{default:u(()=>t[29]||(t[29]=[v(" Please add at least one item to the cart before updating. ")])),_:1})]),_:1})):q.value?w("",!0):(f(),F(s(D),{key:2,class:"mb-4"},{default:u(()=>[l(s($),{class:"h-4 w-4 text-yellow-600"}),l(s(j),{class:"text-yellow-800"},{default:u(()=>t[30]||(t[30]=[v(" Please fill in all required fields and ensure all items have valid quantities and costs. ")])),_:1})]),_:1})),e("div",Dt,[l(s(S),{onClick:me,disabled:!q.value||s(i).processing||U.value,class:"flex-1",size:"lg"},{default:u(()=>[l(s(Q),{class:"w-4 h-4 mr-2"}),v(" "+m(s(i).processing?"Updating...":"Update Wastage Record"),1)]),_:1},8,["disabled"])])],512),[[T,y.value.summary]])])])]),_:1},8,["heading"])}}},Zt=xe($t,[["__scopeId","data-v-f723a588"]]);export{Zt as default};
