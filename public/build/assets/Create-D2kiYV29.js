import{T as De,x as _,ag as ke,y as le,l as xe,V as Ve,r as c,o as m,c as T,w as a,g as u,a as l,b as i,t as D,u as d,d as y,e as O,F as q,m as G,O as Ue,k as x,n as $e,h as Q,z as se,ah as Te,ai as ae,W as Ie}from"./app-Bw_fMWAP.js";import{u as Me}from"./use-toast-DUUUMAOv.js";import{C as Ae,_ as Oe}from"./ConfirmationModal-Cd-Vs65_.js";import{L as qe}from"./loader-circle-CrDwNvR8.js";import{C as Fe}from"./calendar-DBmwDqo5.js";const Le={class:"relative"},ze={class:"relative"},Be=["value","disabled"],Ne={class:"absolute z-50 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-full min-w-[280px]"},Ye={class:"flex justify-between items-center mb-4"},je={class:"text-lg font-semibold"},Ee={class:"grid grid-cols-7 gap-1"},Pe=["onClick"],We={class:"space-y-6"},He={class:"grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4"},Re={key:0,class:"bg-gray-700 text-white text-xs rounded-full size-5 flex items-center justify-center mr-2"},Ge={class:"p-2 sticky top-0 bg-white z-10 border-b"},Qe=["onUpdate:modelValue"],Ke={key:0,class:"bg-gray-700 text-white text-xs rounded-full size-5 flex items-center justify-center mr-2"},Je={class:"p-2 sticky top-0 bg-white z-10 border-b"},Xe=["onUpdate:modelValue"],Ze={key:0,class:"text-center py-4"},et={key:2,class:"px-2 py-4 text-center text-gray-500"},tt={key:0,class:"bg-gray-700 text-white text-xs rounded-full size-5 flex items-center justify-center mr-2"},lt={class:"md:col-span-3 flex items-end justify-end"},st={class:"text-sm font-semibold pt-2"},at=["onClick"],ot={class:"mt-4 flex justify-end"},nt={class:"text-lg font-bold"},pt={__name:"Create",props:{branches:{type:Array,required:!0},dtsSupplier:{type:Object,required:!0},variants:{type:Array,required:!0}},setup(V){const K=V,{toast:W}=Me(),o=De({supplier_id:String(K.dtsSupplier.value),order_date:null,variant:null,items:[{store_branch_id:null,item_id:null,quantity:0,cost:0,uom:null}]}),F=_(!1),L=_(!1),I=_([]),z=_(!1),B=_([]),N=_(!1),Y=_([]),U=_([]),H=_([]),j=_([]),E=_([]),P=_(!1),w=_(new Date),oe={SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6};ke(()=>{E.value=[]});const ne=()=>(B.value||[]).map(e=>oe[e.toUpperCase()]).filter(e=>e!==void 0),re=()=>{var r;const t=ne();return t.length===0&&((r=o.items[0])!=null&&r.store_branch_id)&&o.variant?[0,1,2,3,4,5,6]:[0,1,2,3,4,5,6].filter(f=>!t.includes(f))},ue=()=>{const t=[],e=w.value||new Date,r=e.getFullYear(),f=e.getMonth(),p=new Date(r,f,1).getDay(),S=new Date(r,f+1,0).getDate(),b=re(),C=new Date;C.setHours(0,0,0,0);const k=new Date(C);k.setDate(C.getDate()+(6-C.getDay()));for(let g=0;g<p;g++)t.push(null);for(let g=1;g<=S;g++){const h=new Date(r,f,g),M=h.getDay(),A=b.includes(M)||h<=k;t.push({day:g,date:h,isDisabled:A})}return t},de=()=>w.value=new Date(w.value.getFullYear(),w.value.getMonth()-1,1),ie=()=>w.value=new Date(w.value.getFullYear(),w.value.getMonth()+1,1),ce=t=>{if(t&&!t.isDisabled){const e=t.date,r=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");o.order_date=`${r}-${f}-${p}`,P.value=!1}},me=async(t,e)=>{if(!t||!e){B.value=[];return}N.value=!0;try{const r=await ae.get(route("dts-orders.get-schedule"),{params:{store_branch_id:t,variant:e}});B.value=r.data}catch{W({title:"Error",description:"Could not fetch delivery schedule.",variant:"destructive"}),B.value=[]}finally{N.value=!1}},pe=async t=>{if(!t||!o.supplier_id){I.value=[];return}z.value=!0;try{const e=await ae.get(route("dts-orders.get-items-by-variant"),{params:{variant:t,supplier_id:o.supplier_id}});I.value=e.data}catch{W({title:"Error",description:"Failed to load items.",variant:"destructive"})}finally{z.value=!1}};le(()=>{var t;return{branch:(t=o.items[0])==null?void 0:t.store_branch_id,variant:o.variant}},(t,e)=>{L.value||(t.branch!==e.branch||t.variant!==e.variant)&&(o.order_date=null,me(t.branch,t.variant))},{deep:!0}),le(()=>o.variant,(t,e)=>{var r;L.value||t!==e&&(o.items=[{store_branch_id:((r=o.items[0])==null?void 0:r.store_branch_id)||null,item_id:null,quantity:0,cost:0,uom:null}],U.value=[],t?pe(t):I.value=[])});const fe=t=>{const e=Y.value[t]||"";return K.branches.filter(r=>r.label.toLowerCase().includes(e.toLowerCase()))},J=t=>{const e=U.value[t]||"";return I.value.filter(r=>r.label.toLowerCase().includes(e.toLowerCase()))},ve=(t,e)=>{const r=I.value.find(f=>f.value===e);r&&(o.items[t]={...o.items[t],item_id:r.value,uom:r.uom,cost:r.cost}),U.value[t]="",j.value[t]=!1},_e=async()=>{L.value=!0;const t=o.items[o.items.length-1],e=o.items.length-1,r=document.getElementById(`uom_${e}`),f=r?r.value:null;o.items.push({store_branch_id:(t==null?void 0:t.store_branch_id)||null,item_id:(t==null?void 0:t.item_id)||null,quantity:(t==null?void 0:t.quantity)||0,cost:(t==null?void 0:t.cost)||0,uom:null}),await Ie();const p=o.items.length-1;o.items[p].uom=f;const S=E.value[p];if(S){const b=S.$el||S;b&&typeof b.focus=="function"&&(b.focus(),b.select())}L.value=!1},ge=t=>{o.items.splice(t,1),E.value.splice(t,1),[Y,U,H,j].forEach(r=>{Array.isArray(r.value)&&r.value.splice(t,1)})},ye=()=>{F.value=!0},be=()=>{o.transform(t=>({...t,items:t.items.map(e=>({...e,variant:t.variant}))})).post(route("dts-orders.store"),{onSuccess:()=>{W({title:"Success!",description:"DTS order(s) placed successfully.",variant:"success"})},onFinish:()=>{F.value=!1}})},X=t=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t),he=t=>(o.items[t].quantity||0)*(o.items[t].cost||0),Se=xe(()=>o.items.reduce((t,e)=>t+(e.quantity||0)*(e.cost||0),0));return Ve(()=>{w.value=new Date}),(t,e)=>{const r=c("CardTitle"),f=c("CardHeader"),p=c("Label"),S=c("SelectValue"),b=c("SelectTrigger"),C=c("SelectItem"),k=c("SelectContent"),g=c("SelectShad"),h=c("InputContainer"),M=c("SelectLabel"),A=c("SelectGroup"),$=c("FormError"),Z=c("CardContent"),ee=c("Card"),R=c("Input"),te=c("Button"),we=c("CardFooter"),Ce=c("Layout");return m(),T(Ce,{heading:"Create DTS Orders"},{default:a(()=>[u("form",{onSubmit:x(ye,["prevent"]),class:"space-y-6"},[l(ee,null,{default:a(()=>[l(f,null,{default:a(()=>[l(r,null,{default:a(()=>e[9]||(e[9]=[i("DTS Order Details")])),_:1})]),_:1}),l(Z,{class:"grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4"},{default:a(()=>{var v;return[l(h,null,{default:a(()=>[l(p,null,{default:a(()=>e[10]||(e[10]=[i("Supplier")])),_:1}),l(g,{"model-value":String(V.dtsSupplier.value),disabled:""},{default:a(()=>[l(b,null,{default:a(()=>[l(S,{placeholder:V.dtsSupplier.label},null,8,["placeholder"])]),_:1}),l(k,null,{default:a(()=>[l(C,{value:String(V.dtsSupplier.value)},{default:a(()=>[i(D(V.dtsSupplier.label),1)]),_:1},8,["value"])]),_:1})]),_:1},8,["model-value"])]),_:1}),l(h,null,{default:a(()=>{var s;return[l(p,{for:"variant",class:"flex items-center"},{default:a(()=>e[11]||(e[11]=[u("span",{class:"bg-gray-700 text-white text-xs rounded-full size-5 flex items-center justify-center mr-4"},"2",-1),i("Variant")])),_:1}),l(g,{modelValue:d(o).variant,"onUpdate:modelValue":e[0]||(e[0]=n=>d(o).variant=n),disabled:!((s=d(o).items[0])!=null&&s.store_branch_id)},{default:a(()=>[l(b,{id:"variant"},{default:a(()=>[l(S,{placeholder:"Select Variant..."})]),_:1}),l(k,null,{default:a(()=>[l(A,null,{default:a(()=>[l(M,null,{default:a(()=>e[12]||(e[12]=[i("Variants")])),_:1}),(m(!0),y(q,null,O(V.variants,n=>(m(),T(C,{key:n,value:n},{default:a(()=>[i(D(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),l($,{message:d(o).errors.variant},null,8,["message"])]}),_:1}),u("div",Le,[l(p,{for:"order_date",class:"flex items-center"},{default:a(()=>e[13]||(e[13]=[u("span",{class:"bg-gray-700 text-white text-xs rounded-full size-5 flex items-center justify-center mr-2"},"3",-1),i("Order Date")])),_:1}),u("div",ze,[u("input",{id:"order_date",type:"text",readonly:"",value:d(o).order_date,onClick:e[1]||(e[1]=s=>P.value=!P.value),disabled:!((v=d(o).items[0])!=null&&v.store_branch_id)||!d(o).variant||N.value,class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",placeholder:"Select date"},null,8,Be),N.value?(m(),T(d(qe),{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 size-4 text-gray-500 animate-spin"})):(m(),T(d(Fe),{key:1,class:"absolute right-3 top-1/2 -translate-y-1/2 size-4 text-gray-500 pointer-events-none"}))]),l($,{message:d(o).errors.order_date},null,8,["message"]),G(u("div",Ne,[u("div",Ye,[u("button",{type:"button",onClick:e[2]||(e[2]=x(s=>de(),["stop"])),class:"p-2 rounded-full hover:bg-gray-200"},"<"),u("h2",je,D((w.value||new Date).toLocaleString("default",{month:"long",year:"numeric"})),1),u("button",{type:"button",onClick:e[3]||(e[3]=x(s=>ie(),["stop"])),class:"p-2 rounded-full hover:bg-gray-200"},">")]),e[14]||(e[14]=u("div",{class:"grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 mb-2"},[u("span",null,"Su"),u("span",null,"Mo"),u("span",null,"Tu"),u("span",null,"We"),u("span",null,"Th"),u("span",null,"Fr"),u("span",null,"Sa")],-1)),u("div",Ee,[(m(!0),y(q,null,O(ue(),(s,n)=>(m(),y("div",{key:n,class:$e(["text-center py-1.5 rounded-full text-sm",{"bg-gray-200 text-gray-400 cursor-not-allowed":s&&s.isDisabled,"bg-blue-500 text-white":s&&!s.isDisabled&&d(o).order_date&&s.date.toDateString()===new Date(d(o).order_date+"T00:00:00").toDateString(),"hover:bg-gray-200 cursor-pointer":s&&!s.isDisabled}]),onClick:rt=>ce(s)},D(s?s.day:""),11,Pe))),128))])],512),[[Ue,P.value]])])]}),_:1})]),_:1}),l(ee,null,{default:a(()=>[l(f,null,{default:a(()=>[l(r,null,{default:a(()=>e[15]||(e[15]=[i("Order Items")])),_:1})]),_:1}),l(Z,null,{default:a(()=>[u("div",We,[(m(!0),y(q,null,O(d(o).items,(v,s)=>(m(),y("div",{key:s,class:"p-4 border rounded-lg shadow-sm bg-gray-50 relative"},[u("div",He,[l(h,null,{default:a(()=>[l(p,{for:`branch_${s}`,class:"flex items-center"},{default:a(()=>[s===0?(m(),y("span",Re,"1")):Q("",!0),e[16]||(e[16]=i("Store Branch"))]),_:2},1032,["for"]),l(g,{modelValue:v.store_branch_id,"onUpdate:modelValue":n=>v.store_branch_id=n,open:H.value[s],"onUpdate:open":n=>H.value[s]=n},{default:a(()=>[l(b,{id:`branch_${s}`},{default:a(()=>[l(S,{placeholder:"Select Branch..."})]),_:2},1032,["id"]),l(k,null,{default:a(()=>[u("div",Ge,[G(u("input",{type:"text","onUpdate:modelValue":n=>Y.value[s]=n,placeholder:"Search...",class:"w-full px-3 py-1.5 border rounded-md",onClick:e[4]||(e[4]=x(()=>{},["stop"])),onKeydown:e[5]||(e[5]=x(()=>{},["stop"]))},null,40,Qe),[[se,Y.value[s]]])]),l(A,null,{default:a(()=>[l(M,null,{default:a(()=>e[17]||(e[17]=[i("Branches")])),_:1}),(m(!0),y(q,null,O(fe(s),n=>(m(),T(C,{key:n.value,value:String(n.value)},{default:a(()=>[i(D(n.label),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","open","onUpdate:open"]),l($,{message:d(o).errors[`items.${s}.store_branch_id`]},null,8,["message"])]),_:2},1024),l(h,null,{default:a(()=>[l(p,{for:`item_${s}`,class:"flex items-center"},{default:a(()=>[s===0?(m(),y("span",Ke,"4")):Q("",!0),e[18]||(e[18]=i("Item"))]),_:2},1032,["for"]),l(g,{modelValue:v.item_id,"onUpdate:modelValue":[n=>v.item_id=n,n=>ve(s,n)],open:j.value[s],"onUpdate:open":n=>j.value[s]=n,disabled:z.value||!d(o).variant},{default:a(()=>[l(b,{id:`item_${s}`},{default:a(()=>[l(S,{placeholder:"Select Item..."})]),_:2},1032,["id"]),l(k,null,{default:a(()=>[u("div",Je,[G(u("input",{type:"text","onUpdate:modelValue":n=>U.value[s]=n,placeholder:"Search...",class:"w-full px-3 py-1.5 border rounded-md",onClick:e[6]||(e[6]=x(()=>{},["stop"])),onKeydown:e[7]||(e[7]=x(()=>{},["stop"]))},null,40,Xe),[[se,U.value[s]]])]),l(A,null,{default:a(()=>[l(M,null,{default:a(()=>e[19]||(e[19]=[i("Items")])),_:1}),z.value?(m(),y("div",Ze,"Loading...")):J(s).length>0?(m(!0),y(q,{key:1},O(J(s),n=>(m(),T(C,{key:n.value,value:String(n.value)},{default:a(()=>[i(D(n.label),1)]),_:2},1032,["value"]))),128)):(m(),y("div",et,"No items found"))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","open","onUpdate:open","disabled"]),l($,{message:d(o).errors[`items.${s}.item_id`]},null,8,["message"])]),_:2},1024),l(h,null,{default:a(()=>[l(p,{for:`quantity_${s}`,class:"flex items-center"},{default:a(()=>[s===0?(m(),y("span",tt,"5")):Q("",!0),e[20]||(e[20]=i("Quantity"))]),_:2},1032,["for"]),l(R,{ref_for:!0,ref:n=>{n&&(E.value[s]=n)},id:`quantity_${s}`,modelValue:v.quantity,"onUpdate:modelValue":n=>v.quantity=n,modelModifiers:{number:!0},type:"number",step:"0.01",min:"0"},null,8,["id","modelValue","onUpdate:modelValue"]),l($,{message:d(o).errors[`items.${s}.quantity`]},null,8,["message"])]),_:2},1024),l(h,null,{default:a(()=>[l(p,{for:`uom_${s}`},{default:a(()=>e[21]||(e[21]=[i("UOM")])),_:2},1032,["for"]),l(R,{id:`uom_${s}`,value:v.uom,disabled:"",placeholder:"UOM"},null,8,["id","value"])]),_:2},1024),l(h,null,{default:a(()=>[l(p,{for:`cost_${s}`},{default:a(()=>e[22]||(e[22]=[i("Cost")])),_:2},1032,["for"]),l(R,{id:`cost_${s}`,modelValue:v.cost,"onUpdate:modelValue":n=>v.cost=n,modelModifiers:{number:!0},type:"number",step:"0.01",min:"0"},null,8,["id","modelValue","onUpdate:modelValue"]),l($,{message:d(o).errors[`items.${s}.cost`]},null,8,["message"])]),_:2},1024),u("div",lt,[u("div",st,"Item Total: "+D(X(he(s))),1)])]),u("button",{type:"button",onClick:n=>ge(s),class:"absolute top-2 right-2 text-red-500 hover:text-red-700 transition-colors"},[l(d(Te),{class:"size-5"})],8,at)]))),128))]),u("div",ot,[l(te,{type:"button",onClick:_e,variant:"ghost",class:"text-blue-500 hover:bg-blue-100"},{default:a(()=>[l(d(Ae),{class:"size-4 mr-2"}),e[23]||(e[23]=i(" Add one more item"))]),_:1})])]),_:1}),l(we,{class:"flex justify-between items-center mt-6 p-6 border-t"},{default:a(()=>[u("div",nt,"Overall Total: "+D(X(Se.value)),1),l(te,{type:"submit",disabled:d(o).processing},{default:a(()=>e[24]||(e[24]=[i("Place Order(s)")])),_:1},8,["disabled"])]),_:1})]),_:1})],32),l(Oe,{show:F.value,title:"Place Order(s)",message:"Are you sure you want to place this order(s)? This action cannot be undone.",onConfirm:be,onCancel:e[8]||(e[8]=v=>F.value=!1)},null,8,["show"])]),_:1})}}};export{pt as default};
