import{u as ye}from"./useBackButton-CnvTWR2a.js";import{f as ve,T as P,r,o as p,c as v,w as o,a as t,g as _,b as n,t as i,n as be,h as b,d as D,e as z,u as a,F as X,i as A}from"./app-Drfr7wPO.js";import{u as ge}from"./useToast-Blb7EynO.js";import{u as xe}from"./useEditQuantity-BjinyBMs.js";const ke={class:"flex flex-col gap-5"},Ce={class:"sm:flex-row flex flex-col gap-5"},Te={class:"text-gray-700 text-sm"},De={class:"font-bold"},Oe={class:"text-gray-700 text-sm"},qe={class:"font-bold"},we={class:"text-gray-700 text-sm"},Fe=["onClick"],Ie=["onClick"],Be={key:0},Ee={key:0},Me={__name:"Show",props:{order:{type:Object},orderedItems:{type:Object}},setup(u){ve();const{toast:H}=ge(),{backButton:G}=ye(route("orders-approval.index")),N=u;ref(null);const J=s=>{switch(s){case"APPROVED":return"bg-green-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"REJECTED":return"bg-red-500 text-white";default:return"bg-yellow-500 text-white"}};P({remarks:null});const f=ref(!1),T=ref(!1),O=ref(!1);watch(T,s=>{s||(f.value=!1,m.reset(),m.clearErrors())});const m=P({id:null,remarks:null,updatedOrderedItemDetails:null}),K=s=>{T.value=!0,m.id=s},W=s=>{O.value=!0,m.id=s},Y=()=>{f.value=!0,m.updatedOrderedItemDetails=c.value,m.post(route("orders-approval.approve"),{onSuccess:()=>{H.add({severity:"success",summary:"Success",detail:"Order Approved Successfully.",life:3e3}),f.value=!1},onError:s=>{console.log(s),f.value=!1}})},Z=()=>{f.value=!0,m.post(route("orders-approval.reject"),{onSuccess:()=>{H.add({severity:"success",summary:"Success",detail:"Order Reject Successfully.",life:3e3}),f.value=!1},onError:()=>{f.value=!1}})},c=ref([]);N.orderedItems.forEach(s=>c.value.push({id:s.id,quantity_ordered:s.quantity_ordered,quantity_approved:s.quantity_ordered,item_cost:s.product_inventory.cost,total_cost:s.total_cost}));const h=s=>{const e=c.value.findIndex(d=>d.id===s);if(e!==-1){const d=c.value[e];d.quantity_approved>0&&(d.quantity_approved=Number(parseFloat(d.quantity_approved-.1).toFixed(2)),d.total_cost=parseFloat(d.item_cost*d.quantity_approved).toFixed(2))}},ee=s=>{const e=c.value.findIndex(d=>d.id===s);if(e!==-1){const d=c.value[e];d.quantity_approved=Number(parseFloat(d.quantity_approved+.1).toFixed(2)),d.total_cost=parseFloat(d.item_cost*d.quantity_approved).toFixed(2)}},{isEditQuantityModalOpen:q,formQuantity:w,openEditQuantityModal:te,editOrderQuantity:oe}=xe(null,c,N.order);return(s,e)=>{const d=r("Badge"),k=r("Button"),U=r("DivFlexCenter"),ne=r("TableHeader"),g=r("TH"),le=r("TableHead"),x=r("TD"),re=r("LinkButton"),ae=r("TableBody"),se=r("Table"),de=r("Minus"),ue=r("Plus"),ie=r("MobileTableHeading"),F=r("LabelXS"),pe=r("MobileTableRow"),fe=r("MobileTableContainer"),me=r("TableContainer"),I=r("DialogTitle"),B=r("DialogDescription"),E=r("DialogHeader"),j=r("Label"),$=r("Textarea"),V=r("FormError"),L=r("InputContainer"),Q=r("Loading"),R=r("DialogFooter"),M=r("DialogContent"),S=r("Dialog"),_e=r("Input"),ce=r("Layout");return p(),v(ce,{heading:"Order Details"},{default:o(()=>[t(me,null,{default:o(()=>[_("section",ke,[_("section",Ce,[_("span",Te,[e[8]||(e[8]=n(" Order Number: ")),_("span",De,i(u.order.order_number),1)]),_("span",Oe,[e[9]||(e[9]=n(" Order Date: ")),_("span",qe,i(u.order.order_date),1)]),_("span",we,[e[10]||(e[10]=n(" Status: ")),t(d,{class:be(J(u.order.order_status.toUpperCase()))},{default:o(()=>[n(i(u.order.order_status.toUpperCase()),1)]),_:1},8,["class"])])]),t(U,{class:"gap-5"},{default:o(()=>[u.order.order_status==="pending"?(p(),v(k,{key:0,variant:"destructive",onClick:e[0]||(e[0]=l=>W(u.order.id))},{default:o(()=>e[11]||(e[11]=[n(" Decline Order ")])),_:1})):b("",!0),u.order.order_status==="pending"?(p(),v(k,{key:1,class:"bg-green-500 hover:bg-green-300",onClick:e[1]||(e[1]=l=>K(u.order.id))},{default:o(()=>e[12]||(e[12]=[n(" Approve Order ")])),_:1})):b("",!0)]),_:1})]),t(ne),t(se,null,{default:o(()=>[t(le,null,{default:o(()=>[t(g,null,{default:o(()=>e[13]||(e[13]=[n(" Item Code ")])),_:1}),t(g,null,{default:o(()=>e[14]||(e[14]=[n(" Name ")])),_:1}),t(g,null,{default:o(()=>e[15]||(e[15]=[n(" Unit ")])),_:1}),t(g,null,{default:o(()=>e[16]||(e[16]=[n(" Quantity ")])),_:1}),u.order.order_status==="approved"?(p(),v(g,{key:0},{default:o(()=>e[17]||(e[17]=[n("Approved")])),_:1})):b("",!0),t(g,null,{default:o(()=>e[18]||(e[18]=[n(" Cost ")])),_:1}),t(g,null,{default:o(()=>e[19]||(e[19]=[n(" Total Cost ")])),_:1})]),_:1}),t(ae,null,{default:o(()=>[(p(!0),D(X,null,z(u.orderedItems,l=>(p(),D("tr",{key:u.order.id},[t(x,null,{default:o(()=>[n(i(l.product_inventory.inventory_code),1)]),_:2},1024),t(x,null,{default:o(()=>[n(i(l.product_inventory.name),1)]),_:2},1024),t(x,null,{default:o(()=>[n(i(l.product_inventory.unit_of_measurement.name),1)]),_:2},1024),t(x,{class:"flex items-center gap-3"},{default:o(()=>{var y;return[n(i(((y=a(c).find(C=>C.id===l.id))==null?void 0:y.quantity_approved)||0)+" ",1),u.order.order_status==="pending"?(p(),v(re,{key:0,onClick:C=>a(te)(l.id,l.quantity_ordered)},{default:o(()=>e[20]||(e[20]=[n(" Edit Quantity ")])),_:2},1032,["onClick"])):b("",!0)]}),_:2},1024),u.order.order_status==="approved"?(p(),v(x,{key:0},{default:o(()=>[n(i(l.quantity_approved),1)]),_:2},1024)):b("",!0),t(x,null,{default:o(()=>[n(i(l.product_inventory.cost),1)]),_:2},1024),t(x,null,{default:o(()=>{var y;return[n(i(((y=a(c).find(C=>C.id===l.id))==null?void 0:y.total_cost)||0),1)]}),_:2},1024)]))),128))]),_:1})]),_:1}),t(fe,null,{default:o(()=>[(p(!0),D(X,null,z(u.orderedItems,l=>(p(),v(pe,{key:u.order.id},{default:o(()=>[t(ie,{title:`${l.product_inventory.name} (${l.product_inventory.inventory_code})`},{default:o(()=>[u.order.order_status==="pending"?(p(),v(U,{key:0,class:"gap-2"},{default:o(()=>[_("button",{onClick:y=>h(l.id)},[t(de,{class:"size-4 text-red-500"})],8,Fe),_("button",{onClick:y=>ee(l.id)},[t(ue,{class:"size-4 text-green-500"})],8,Ie)]),_:2},1024)):b("",!0)]),_:2},1032,["title"]),t(F,null,{default:o(()=>[n("UOM: "+i(l.product_inventory.unit_of_measurement.name),1)]),_:2},1024),t(F,null,{default:o(()=>{var y;return[n("Quantity: "+i(((y=a(c).find(C=>C.id===l.id))==null?void 0:y.quantity_approved)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(k,{variant:"outline",class:"text-lg px-7",onClick:a(G)},{default:o(()=>e[21]||(e[21]=[n(" Back ")])),_:1},8,["onClick"]),t(S,{open:a(T),"onUpdate:open":e[3]||(e[3]=l=>A(T)?T.value=l:null)},{default:o(()=>[t(M,{class:"sm:max-w-[600px]"},{default:o(()=>[t(E,null,{default:o(()=>[t(I,null,{default:o(()=>e[22]||(e[22]=[n("Approve Order")])),_:1}),t(B)]),_:1}),t(L,null,{default:o(()=>[t(j,{class:"text-xs"},{default:o(()=>e[23]||(e[23]=[n("Remarks")])),_:1}),t($,{modelValue:a(m).remarks,"onUpdate:modelValue":e[2]||(e[2]=l=>a(m).remarks=l)},null,8,["modelValue"]),t(V,null,{default:o(()=>[n(i(a(m).errors.remarks),1)]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(k,{disabled:a(f),onClick:Y,type:"submit",class:"gap-2"},{default:o(()=>[e[24]||(e[24]=n(" Approve ")),a(f)?(p(),D("span",Be,[t(Q)])):b("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1}),e[25]||(e[25]=_("div",{class:"space-y-5"},null,-1))]),_:1},8,["open"]),t(S,{open:a(O),"onUpdate:open":e[5]||(e[5]=l=>A(O)?O.value=l:null)},{default:o(()=>[t(M,{class:"sm:max-w-[600px]"},{default:o(()=>[t(E,null,{default:o(()=>[t(I,null,{default:o(()=>e[26]||(e[26]=[n("Reject Order")])),_:1}),t(B)]),_:1}),t(L,null,{default:o(()=>[t(j,{class:"text-xs"},{default:o(()=>e[27]||(e[27]=[n("Remarks")])),_:1}),t($,{modelValue:a(m).remarks,"onUpdate:modelValue":e[4]||(e[4]=l=>a(m).remarks=l)},null,8,["modelValue"]),t(V,null,{default:o(()=>[n(i(a(m).errors.remarks),1)]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(k,{disabled:a(f),onClick:Z,type:"submit",class:"gap-2"},{default:o(()=>[e[28]||(e[28]=n(" Reject ")),_("span",null,[a(f)?(p(),v(Q,{key:0})):b("",!0)])]),_:1},8,["disabled"])]),_:1})]),_:1}),e[29]||(e[29]=_("div",{class:"space-y-5"},null,-1))]),_:1},8,["open"]),t(S,{open:a(q),"onUpdate:open":e[7]||(e[7]=l=>A(q)?q.value=l:null)},{default:o(()=>[t(M,{class:"sm:max-w-[600px]"},{default:o(()=>[t(E,null,{default:o(()=>[t(I,null,{default:o(()=>e[30]||(e[30]=[n("Edit Quantity")])),_:1}),t(B,null,{default:o(()=>e[31]||(e[31]=[n(" Please input all the required fields. ")])),_:1})]),_:1}),t(L,null,{default:o(()=>[t(F,null,{default:o(()=>e[32]||(e[32]=[n("Quantity")])),_:1}),t(_e,{type:"number",modelValue:a(w).quantity,"onUpdate:modelValue":e[6]||(e[6]=l=>a(w).quantity=l)},null,8,["modelValue"]),t(V,null,{default:o(()=>[n(i(a(w).errors.quantity),1)]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(k,{onClick:a(oe),disabled:a(f),type:"submit",class:"gap-2"},{default:o(()=>[e[33]||(e[33]=n(" Confirm ")),a(f)?(p(),D("span",Ee,[t(Q)])):b("",!0)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}};export{Me as default};
