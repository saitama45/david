import{f as W,T as X,x as j,l as k,r as T,o as i,d as c,a as h,u as ee,Z as te,w as C,b as re,g as t,t as d,F as b,e as g,h as _,m as L,z as O,n as V,A as P,N as se}from"./app-rjK1ng7o.js";import{u as oe}from"./useToast-DBCD-RTl.js";const ae={class:"bg-white border rounded-md shadow-sm p-6"},de={class:"space-y-4"},le={class:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ie={class:"text-lg font-bold text-blue-700"},ce={class:"text-lg font-bold text-blue-600"},ue={class:"text-sm font-medium text-gray-700"},ye={key:0,class:"mt-6 overflow-x-auto"},be={class:"min-w-full border-collapse border border-gray-300 text-sm"},pe={class:"bg-gray-100"},me=["colspan"],ge={class:"text-xs font-bold"},xe={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},fe={key:1,class:"text-xs text-gray-500 mt-1"},he={class:"bg-gray-200"},_e={class:"text-xs"},ve={class:"text-xs"},we={class:"border border-gray-300 px-3 py-2"},Ee={class:"border border-gray-300 px-3 py-2"},Te={class:"border border-gray-300 px-3 py-2 text-center"},Ce={class:"border border-gray-300 px-3 py-2 text-right"},ke=["onUpdate:modelValue","disabled"],Ae={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ne={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ie={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},De={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-green-50"},Se={class:"bg-gray-700 text-white font-bold"},Fe=["colspan"],Me={class:"border border-gray-300 px-3 py-2 text-right"},Re={key:1,class:"mt-6 overflow-x-auto"},$e={class:"min-w-full border-collapse border border-gray-300 text-sm"},Be={class:"bg-white"},Le={class:"border border-gray-300 px-3 py-2"},Oe={class:"border border-gray-300 px-3 py-2"},Ve={class:"border border-gray-300 px-3 py-2 text-center font-semibold"},Pe={key:0},Ue={class:"bg-gray-200"},qe={class:"border border-gray-300 px-3 py-2 font-bold text-base",colspan:"3"},Ge={class:"border border-gray-300 px-3 py-2",colspan:"2"},Ke={class:"font-bold"},Qe={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},ze={key:1,class:"text-xs text-gray-500 mt-1"},Je={class:"border border-gray-300 px-2 py-1"},He=["onUpdate:modelValue","min","disabled","placeholder","onBlur"],Ye={class:"bg-blue-50 font-semibold"},Ze={class:"border border-gray-300 px-3 py-2 text-center"},We={class:"bg-gray-700 text-white font-bold"},Xe={class:"border border-gray-300 px-3 py-2 text-center"},tt={__name:"Edit",props:{batch_number:{type:String,required:!0},variant:{type:String,default:null},date_from:{type:String,default:null},date_to:{type:String,default:null},stores:{type:Array,default:()=>[]},dates:{type:Array,default:()=>[]},sap_item:{type:Object,default:null},existing_orders:{type:Object,default:()=>({})},status:{type:String,default:null},supplier_items:{type:Array,default:()=>[]},store_order_status:{type:Object,default:()=>({})}},setup(y){const l=y,{toast:v}=oe(),U=W(),A=()=>{se.get(route("cs-dts-mass-commits.index"))},q=()=>{let r=!1;if(l.variant==="FRUITS AND VEGETABLES")for(const e in a.value){for(const o in a.value[e]){for(const u in a.value[e][o])if(a.value[e][o][u]&&parseFloat(a.value[e][o][u])>0){r=!0;break}if(r)break}if(r)break}else for(const e in a.value){for(const o in a.value[e])if(a.value[e][o]&&parseFloat(a.value[e][o])>0){r=!0;break}if(r)break}if(!r){v.add({severity:"warn",summary:"No Orders",detail:"Please enter at least one order quantity before committing.",life:3e3});return}U.require({message:"Are you sure you want to commit these orders? This will finalize the quantities and update the status.",header:"Confirm Order Commit",icon:"pi pi-exclamation-triangle",accept:()=>{G()},reject:()=>{},acceptClass:"p-button-success",rejectClass:"p-button-danger"})},x=X({variant:l.variant,orders:{},sap_item:l.sap_item,supplier_items:l.supplier_items||[]}),G=()=>{l.variant==="FRUITS AND VEGETABLES"?(x.orders=a.value,x.supplier_items=l.supplier_items,x.sap_item=null):(x.orders=a.value,x.sap_item=l.sap_item),x.variant=l.variant,x.put(route("cs-dts-mass-commits.update",l.batch_number),{onSuccess:()=>{v.add({severity:"success",summary:"Orders Committed",detail:"Your mass orders have been successfully committed.",life:3e3})},onError:r=>{v.add({severity:"error",summary:"Error",detail:r.error||"Failed to commit orders. Please try again.",life:5e3})}})},N=r=>{if(!r)return"Not Selected";try{const[e,o,u]=r.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o,10)-1]} ${parseInt(u,10)}, ${e}`}catch{return r}},a=j({});l.variant==="FRUITS AND VEGETABLES"?l.supplier_items.forEach(r=>{a.value[r.id]={},l.dates.forEach(e=>{a.value[r.id][e.date]={},l.stores.forEach(o=>{var p,f;const u=((f=(p=l.existing_orders[r.id])==null?void 0:p[e.date])==null?void 0:f[o.id])||"";a.value[r.id][e.date][o.id]=u})})}):l.dates.forEach(r=>{a.value[r.date]={},l.stores.forEach(e=>{var u;const o=((u=l.existing_orders[r.date])==null?void 0:u[e.id])||"";a.value[r.date][e.id]=o})});const I=r=>{let e=0;return l.stores.forEach(o=>{var p;const u=parseFloat(((p=a.value[r])==null?void 0:p[o.id])||0);e+=isNaN(u)?0:u}),e},K=k(()=>{let r=0;return l.dates.forEach(e=>{r+=I(e.date)}),r}),D=(r,e)=>!r.delivery_schedule_ids||!e.delivery_schedule_id?!1:r.delivery_schedule_ids.includes(e.delivery_schedule_id),Q=r=>l.stores.filter(e=>D(e,r)),w=r=>l.dates.filter(e=>D(r,e)),z=k(()=>{let r=0;return l.stores.forEach(e=>{r+=w(e).length}),r}),S=r=>{let e=0;return a.value[r]?(Object.keys(a.value[r]).forEach(o=>{Object.keys(a.value[r][o]).forEach(u=>{const p=parseFloat(a.value[r][o][u]||0);e+=isNaN(p)?0:p})}),e):0},J=()=>10,F=r=>S(r)*1.1,M=(r,e)=>F(r)*e,H=k(()=>{let r=0;return l.supplier_items.forEach(e=>{r+=M(e.id,e.price)}),r}),R=r=>{const e=Array.from(document.querySelectorAll('input[type="number"]')),o=e.indexOf(r.target);o>-1&&o<e.length-1&&(r.preventDefault(),e[o+1].focus(),e[o+1].select())},Y=(r,e,o)=>{if(l.variant==="ICE CREAM"){const u=parseFloat(o);if(o!==""&&o!==null&&!isNaN(u)&&u>0&&u<5)return v.add({severity:"warn",summary:"Invalid Quantity",detail:"ICE CREAM orders must be at least 5 gallons (GAL 3.8)",life:4e3}),a.value[r][e]="",!1}return!0},E=(r,e)=>{const o=`${r}-${e}`;return l.store_order_status[o]==="received"};return(r,e)=>{const o=T("Button"),u=T("TableHeader"),p=T("TableContainer"),f=T("Layout");return i(),c(b,null,[h(ee(te),{title:"Commit DTS Mass Order"}),h(f,{heading:`Commit DTS Mass Order: ${y.batch_number}`},{default:C(()=>[h(p,null,{default:C(()=>{var $,B;return[h(u,null,{default:C(()=>[h(o,{onClick:A,variant:"outline",class:"text-black border-black hover:bg-gray-100"},{default:C(()=>e[0]||(e[0]=[re(" Back ")])),_:1})]),_:1}),t("div",ae,[t("div",de,[t("div",le,[t("div",ne,[t("div",null,[e[1]||(e[1]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Batch Number",-1)),t("p",ie,d(y.batch_number),1)]),t("div",null,[e[2]||(e[2]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Variant",-1)),t("p",ce,d(y.variant),1)]),t("div",null,[e[3]||(e[3]=t("label",{class:"text-xs font-semibold text-gray-600 uppercase"},"Date Range",-1)),t("p",ue,d(N(y.date_from))+" - "+d(N(y.date_to)),1)])])]),y.variant==="FRUITS AND VEGETABLES"?(i(),c("div",ye,[t("table",be,[t("thead",null,[t("tr",pe,[e[4]||(e[4]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"100px"}},"ITEM CODE",-1)),e[5]||(e[5]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"200px"}},"ITEM NAME",-1)),e[6]||(e[6]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"UOM",-1)),e[7]||(e[7]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"PRICE",-1)),(i(!0),c(b,null,g(y.stores,s=>(i(),c("th",{key:`store-${s.id}`,colspan:w(s).length,class:"border border-gray-300 px-2 py-2 font-semibold text-center bg-blue-50",style:{"min-width":"120px"}},[t("div",ge,d(s.name),1),s.brand_code?(i(),c("div",xe,d(s.brand_code),1)):_("",!0),s.complete_address?(i(),c("div",fe,d(s.complete_address),1)):_("",!0)],8,me))),128)),e[8]||(e[8]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL ORDER",-1)),e[9]||(e[9]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"BUFFER",-1)),e[10]||(e[10]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL PO",-1)),e[11]||(e[11]=t("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-green-100 align-middle"},"TOTAL PRICE",-1))]),t("tr",he,[(i(!0),c(b,null,g(y.stores,s=>(i(),c(b,{key:`dates-${s.id}`},[(i(!0),c(b,null,g(w(s),n=>(i(),c("th",{key:`date-${s.id}-${n.date}`,class:"border border-gray-300 px-2 py-2 font-semibold text-center"},[t("div",_e,d(n.day_of_week),1),t("div",ve,d(n.display.split("- ")[1]),1)]))),128))],64))),128))])]),t("tbody",null,[(i(!0),c(b,null,g(y.supplier_items,s=>(i(),c("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",we,d(s.item_code),1),t("td",Ee,d(s.item_name),1),t("td",Te,d(s.uom),1),t("td",Ce,d(s.price.toFixed(2)),1),(i(!0),c(b,null,g(y.stores,n=>(i(),c(b,{key:`body-${n.id}`},[(i(!0),c(b,null,g(w(n),m=>(i(),c("td",{key:`${s.id}-${n.id}-${m.date}`,class:"border border-gray-300 px-1 py-1"},[L(t("input",{"onUpdate:modelValue":Z=>a.value[s.id][m.date][n.id]=Z,type:"number",step:"0.01",min:"0",disabled:E(n.id,m.date),class:V(["w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",{"bg-gray-100 cursor-not-allowed opacity-60":E(n.id,m.date)}]),onKeydown:P(R,["enter"])},null,42,ke),[[O,a.value[s.id][m.date][n.id]]])]))),128))],64))),128)),t("td",Ae,d(S(s.id).toFixed(2)),1),t("td",Ne,d(J())+"% ",1),t("td",Ie,d(F(s.id).toFixed(2)),1),t("td",De,d(M(s.id,s.price).toFixed(2)),1)]))),128)),t("tr",Se,[e[12]||(e[12]=t("td",{colspan:"4",class:"border border-gray-300 px-3 py-2 text-right"},"TOTAL PRICE",-1)),t("td",{colspan:z.value+3,class:"border border-gray-300 px-3 py-2"},null,8,Fe),t("td",Me,d(H.value.toFixed(2)),1)])])])])):(i(),c("div",Re,[t("table",$e,[t("thead",null,[e[13]||(e[13]=t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"120px"}},"ITEM CODE"),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"200px"}},"ITEM DESCRIPTION"),t("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-center",style:{"min-width":"100px"}},"UOM")],-1)),t("tr",Be,[t("td",Le,d((($=y.sap_item)==null?void 0:$.item_code)||""),1),t("td",Oe,d(((B=y.sap_item)==null?void 0:B.item_description)||""),1),t("td",Ve,[y.sap_item?(i(),c("span",Pe,d(y.sap_item.alt_uom),1)):_("",!0)])])]),t("tbody",null,[(i(!0),c(b,null,g(y.dates,s=>(i(),c(b,{key:s.date},[t("tr",Ue,[t("td",qe,d(s.display),1)]),e[15]||(e[15]=t("tr",{class:"bg-gray-50"},[t("td",{class:"border border-gray-300 px-3 py-2 font-semibold",colspan:"2"},"Store Name"),t("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"},"Quantity")],-1)),(i(!0),c(b,null,g(Q(s),n=>(i(),c("tr",{key:`${s.date}-${n.id}`,class:"hover:bg-gray-50"},[t("td",Ge,[t("div",null,[t("div",Ke,d(n.name),1),n.brand_code?(i(),c("div",Qe,d(n.brand_code),1)):_("",!0),n.complete_address?(i(),c("div",ze,d(n.complete_address),1)):_("",!0)])]),t("td",Je,[L(t("input",{"onUpdate:modelValue":m=>a.value[s.date][n.id]=m,type:"number",step:"0.01",min:y.variant==="ICE CREAM"?"5":"0",disabled:E(n.id,s.date),class:V(["w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",{"bg-gray-100 cursor-not-allowed opacity-60":E(n.id,s.date)}]),placeholder:y.variant==="ICE CREAM"?"Min: 5":"0",onBlur:m=>Y(s.date,n.id,a.value[s.date][n.id]),onKeydown:P(R,["enter"])},null,42,He),[[O,a.value[s.date][n.id]]])])]))),128)),t("tr",Ye,[e[14]||(e[14]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"},"TOTAL",-1)),t("td",Ze,d(I(s.date)),1)])],64))),128)),t("tr",We,[e[16]||(e[16]=t("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"},"GRAND TOTAL",-1)),t("td",Xe,d(K.value),1)])])])])),t("div",{class:"flex justify-end gap-3 mt-6"},[t("button",{onClick:A,class:"px-4 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"}," Cancel "),t("button",{onClick:q,class:"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"}," COMMIT ALL ")])])])]}),_:1})]),_:1},8,["heading"])],64)}}};export{tt as default};
