import{x as M,T as W,y as X,N as L,l as ee,r as y,o as t,d as r,a,u,Z as le,w as s,g as n,t as i,b as m,b0 as te,h as c,k as S,F as C,e as $,E,c as b,n as q}from"./app-Bw_fMWAP.js";import{l as ae}from"./lodash-Cj3gZpb5.js";import{_ as z}from"./InputError-Zc8PC0Tw.js";import{U as ne}from"./upload-D4_mASjI.js";import{A as V,a as U}from"./arrow-up-ByaCg8eD.js";const oe={class:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md"},se={key:0,class:"mb-6 p-4 border border-blue-300 bg-blue-50 rounded-md text-blue-800"},de={key:0,class:"font-medium"},ue={key:1,class:"font-medium"},re={class:"text-sm mt-1"},ie={key:2},ce={class:"mt-4"},me=["href"],pe={key:1,class:"mt-4 text-sm text-gray-600"},be={key:1,class:"mb-6 p-4 border border-green-300 bg-green-50 rounded-md text-green-800"},fe={key:0,class:"font-medium"},ve={key:1,class:"font-medium"},he={key:2,class:"text-sm mt-1"},ye={class:"flex justify-end"},we={key:2,class:"mt-6 p-4 border border-purple-300 bg-purple-50 rounded-md text-purple-800"},ge={class:"list-disc pl-5 space-y-1"},_e={class:"mt-8"},xe={class:"hidden md:block"},ke={key:0},Se=["colspan"],Ce={class:"flex flex-wrap gap-1"},Ve={class:"md:hidden grid grid-cols-1 gap-4"},Ue={key:0,class:"text-center py-4 text-gray-500"},Te={class:"flex justify-between items-start"},Be={class:"font-semibold text-gray-800"},De={class:"text-sm text-gray-600"},Ae={class:"text-xs text-gray-500"},$e={class:"mt-4 pt-4 border-t"},je={class:"text-sm mb-2"},Oe={class:"font-medium text-gray-800"},Me={class:"text-sm"},Ne={class:"flex flex-wrap gap-1 mt-1"},ze={__name:"Index",props:{downloadSchedule:{type:Object,default:null},uploadSchedule:{type:Object,default:null},message:{type:String,required:!0},userBranches:{type:Object,required:!0},branchesAwaitingUpload:{type:Object,required:!0},uploadedCountsAwaitingSubmission:{type:Array,required:!0},transactions:{type:Object,required:!0},filters:{type:Object,default:()=>({})},can:{type:Object,required:!0}},setup(o){const g=o,T=M(null),w=W({schedule_id:g.uploadSchedule?g.uploadSchedule.id:null,branch_id:null,file:null}),f=M(g.filters.sort||"calculated_date"),p=M(g.filters.direction||"desc"),v=M({year:g.filters.year||null,month:g.filters.month||null,calculated_date:g.filters.calculated_date||null,status:g.filters.status||null,uploader_name:g.filters.uploader_name||null,branch_name:g.filters.branch_name||null}),k=h=>{f.value===h?p.value=p.value==="asc"?"desc":"asc":(f.value=h,p.value="asc")};X([v,f,p],ae.throttle(()=>{L.get(route("month-end-count.index"),{...v.value,sort:f.value,direction:p.value},{preserveState:!0,replace:!0})},300),{deep:!0});const I=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],F=h=>{if(!h)return"N/A";const e=new Date(h);if(isNaN(e.getTime()))return h;const j=e.getTimezoneOffset()*6e4,D=new Date(e.getTime()+j);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(D)},K=()=>{if(!w.branch_id){alert("Please select a branch.");return}if(!w.file){alert("Please select a file to upload.");return}w.post(route("month-end-count.upload"),{onSuccess:()=>{w.reset(),T.value=null},onError:h=>{console.error("Upload Error:",h),alert("Upload failed. Check console for details.")}})},B=h=>{const e=new Date;return e.setMonth(h-1),e.toLocaleString("en-US",{month:"long"})},H=ee(()=>Object.keys(g.branchesAwaitingUpload).length>0),N=(h,e)=>{L.get(route("month-end-count.review",{schedule:h,branch:e}))};return(h,e)=>{const j=y("Label"),D=y("Select"),O=y("Button"),A=y("Input"),_=y("TH"),J=y("TableHead"),x=y("TD"),P=y("Badge"),R=y("TableBody"),Y=y("Table"),Z=y("Pagination"),G=y("TableContainer"),Q=y("Layout");return t(),r(C,null,[a(u(le),{title:"Month End Count"}),a(Q,{heading:"Month End Count"},{default:s(()=>[n("div",oe,[e[27]||(e[27]=n("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Month End Count Process",-1)),o.downloadSchedule?(t(),r("div",se,[o.can.download_month_end_count_template?(t(),r("p",de,i(o.message),1)):(t(),r("p",ue,"A month end count is scheduled. Please contact your administrator to get the required permissions to download the template.")),n("p",re,"Scheduled for: "+i(B(o.downloadSchedule.month))+" "+i(o.downloadSchedule.year)+" (MEC Schedule Date: "+i(o.downloadSchedule.calculated_date)+")",1),o.can.download_month_end_count_template?(t(),r("div",ie,[n("div",ce,[a(j,{for:"download_branch"},{default:s(()=>e[20]||(e[20]=[m("Select Branch for Download")])),_:1}),a(D,{id:"download_branch",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=l=>T.value=l),options:Object.entries(o.userBranches).map(([l,d])=>({value:l,label:d})),optionLabel:"label",optionValue:"value",placeholder:"Select a Branch",filter:"",class:"w-full"},null,8,["modelValue","options"])]),T.value?(t(),r("a",{key:0,href:h.route("month-end-count.download",{branch_id:T.value}),class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[a(u(te),{class:"-ml-1 mr-2 h-5 w-5"}),e[21]||(e[21]=m(" Download Count Template "))],8,me)):(t(),r("p",pe,"Please select a branch to enable download."))])):c("",!0)])):H.value?(t(),r("div",be,[o.can.upload_month_end_count_transaction?(t(),r("p",fe,i(o.message),1)):(t(),r("p",ve,"A month end count is pending upload. Please contact your administrator to get the required permissions to upload the count sheet.")),o.uploadSchedule?(t(),r("p",he,"Scheduled for: "+i(B(o.uploadSchedule.month))+" "+i(o.uploadSchedule.year)+" (MEC Schedule Date: "+i(o.uploadSchedule.calculated_date)+")",1)):c("",!0),o.can.upload_month_end_count_transaction?(t(),r("form",{key:3,onSubmit:S(K,["prevent"]),class:"mt-4 space-y-4"},[n("div",null,[a(j,{for:"upload_branch"},{default:s(()=>e[22]||(e[22]=[m("Select Branch for Upload")])),_:1}),a(D,{id:"upload_branch",modelValue:u(w).branch_id,"onUpdate:modelValue":e[1]||(e[1]=l=>u(w).branch_id=l),options:Object.entries(o.branchesAwaitingUpload).map(([l,d])=>({value:l,label:d})),optionLabel:"label",optionValue:"value",placeholder:"Select a Branch",filter:"",class:"w-full"},null,8,["modelValue","options"]),a(z,{message:u(w).errors.branch_id},null,8,["message"])]),n("div",null,[e[23]||(e[23]=n("label",{for:"file",class:"block text-sm font-medium text-gray-700"},"Upload Completed Count Sheet",-1)),n("input",{type:"file",onInput:e[2]||(e[2]=l=>u(w).file=l.target.files[0]),id:"file",class:"mt-1 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"},null,32),a(z,{message:u(w).errors.file},null,8,["message"])]),n("div",ye,[a(O,{type:"submit",disabled:u(w).processing||!u(w).file||!u(w).branch_id},{default:s(()=>[a(u(ne),{class:"-ml-1 mr-2 h-5 w-5"}),e[24]||(e[24]=m(" Upload and Process Count "))]),_:1},8,["disabled"])])],32)):c("",!0)])):c("",!0),o.can.upload_month_end_count_transaction&&o.uploadedCountsAwaitingSubmission.length?(t(),r("div",we,[e[26]||(e[26]=n("p",{class:"font-medium mb-2"},"Your Uploaded Counts Awaiting Submission:",-1)),n("ul",ge,[(t(!0),r(C,null,$(o.uploadedCountsAwaitingSubmission,l=>(t(),r("li",{key:`${l.schedule_id}-${l.branch_id}`},[m(" Count for "+i(B(l.schedule_month))+" "+i(l.schedule_year)+" (Branch: "+i(l.branch_name)+") ",1),a(O,{onClick:d=>N(l.schedule_id,l.branch_id),variant:"link",size:"sm",class:"ml-2 p-0 h-auto"},{default:s(()=>[a(u(E),{class:"h-4 w-4 mr-1"}),e[25]||(e[25]=m(" Review "))]),_:2},1032,["onClick"])]))),128))])])):c("",!0)]),n("div",_e,[e[37]||(e[37]=n("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Transaction History",-1)),a(G,null,{default:s(()=>[n("div",xe,[a(Y,null,{default:s(()=>[a(J,null,{default:s(()=>[a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[3]||(e[3]=l=>k("year"))},[e[28]||(e[28]=m(" Year ")),f.value==="year"&&p.value==="asc"?(t(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="year"&&p.value==="desc"?(t(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:v.value.year,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value.year=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[5]||(e[5]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[6]||(e[6]=l=>k("month"))},[e[29]||(e[29]=m(" Month ")),f.value==="month"&&p.value==="asc"?(t(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="month"&&p.value==="desc"?(t(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(D,{modelValue:v.value.month,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value.month=l),options:I,optionLabel:"label",optionValue:"value",placeholder:"Select Month",class:"mt-1 w-full text-sm",showClear:""},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[8]||(e[8]=l=>k("calculated_date"))},[e[30]||(e[30]=m(" MEC Schedule Date ")),f.value==="calculated_date"&&p.value==="asc"?(t(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="calculated_date"&&p.value==="desc"?(t(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"date",modelValue:v.value.calculated_date,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value.calculated_date=l),class:"mt-1 w-full text-sm",onKeydown:e[10]||(e[10]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[11]||(e[11]=l=>k("branch_name"))},[e[31]||(e[31]=m(" Branch ")),f.value==="branch_name"&&p.value==="asc"?(t(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="branch_name"&&p.value==="desc"?(t(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:v.value.branch_name,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.branch_name=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[13]||(e[13]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[14]||(e[14]=l=>k("uploader_name"))},[e[32]||(e[32]=m(" Uploader ")),f.value==="uploader_name"&&p.value==="asc"?(t(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="uploader_name"&&p.value==="desc"?(t(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:v.value.uploader_name,"onUpdate:modelValue":e[15]||(e[15]=l=>v.value.uploader_name=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[16]||(e[16]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),a(_,null,{default:s(()=>[n("div",{class:"flex items-center cursor-pointer",onClick:e[17]||(e[17]=l=>k("statuses"))},[e[33]||(e[33]=m(" Status ")),f.value==="statuses"&&p.value==="asc"?(t(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="statuses"&&p.value==="desc"?(t(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),a(A,{type:"text",modelValue:v.value.status,"onUpdate:modelValue":e[18]||(e[18]=l=>v.value.status=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[19]||(e[19]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),o.can.view_transaction?(t(),b(_,{key:0},{default:s(()=>e[34]||(e[34]=[m("Actions")])),_:1})):c("",!0)]),_:1}),a(R,null,{default:s(()=>[o.transactions.data.length?c("",!0):(t(),r("tr",ke,[n("td",{colspan:o.can.view_transaction?7:6,class:"text-center py-4"},"No transactions found.",8,Se)])),(t(!0),r(C,null,$(o.transactions.data,l=>(t(),r("tr",{key:`${l.schedule_id}-${l.branch_id}`},[a(x,null,{default:s(()=>[m(i(l.year),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(B(l.month)),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(F(l.calculated_date)),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(l.branch_name),1)]),_:2},1024),a(x,null,{default:s(()=>[m(i(l.uploader_name),1)]),_:2},1024),a(x,null,{default:s(()=>[n("div",Ce,[(t(!0),r(C,null,$([...new Set(l.statuses.split(", "))],d=>(t(),b(P,{key:d,class:q(["capitalize",{"bg-yellow-500 text-white":d==="pending"||d==="uploaded","bg-blue-500 text-white":d==="level1_approved","bg-green-500 text-white":d==="level2_approved","bg-red-500 text-white":d==="rejected"||d==="expired","bg-purple-500 text-white":d==="pending_level1_approval"}])},{default:s(()=>[m(i(d.replace(/_/g," ")),1)]),_:2},1032,["class"]))),128))])]),_:2},1024),o.can.view_transaction?(t(),b(x,{key:0},{default:s(()=>[a(O,{onClick:d=>N(l.schedule_id,l.branch_id),variant:"outline",size:"icon"},{default:s(()=>[a(u(E),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)):c("",!0)]))),128))]),_:1})]),_:1})]),n("div",Ve,[o.transactions.data.length?c("",!0):(t(),r("div",Ue," No transactions found. ")),(t(!0),r(C,null,$(o.transactions.data,l=>(t(),r("div",{key:`${l.schedule_id}-${l.branch_id}`,class:"bg-white p-4 rounded-lg shadow"},[n("div",Te,[n("div",null,[n("p",Be,i(l.branch_name),1),n("p",De,i(B(l.month))+" "+i(l.year),1),n("p",Ae,"Date: "+i(F(l.calculated_date)),1)]),o.can.view_transaction?(t(),b(O,{key:0,onClick:d=>N(l.schedule_id,l.branch_id),variant:"outline",size:"icon"},{default:s(()=>[a(u(E),{class:"h-5 w-5"})]),_:2},1032,["onClick"])):c("",!0)]),n("div",$e,[n("div",je,[e[35]||(e[35]=n("span",{class:"text-gray-500"},"Uploader: ",-1)),n("span",Oe,i(l.uploader_name),1)]),n("div",Me,[e[36]||(e[36]=n("span",{class:"text-gray-500"},"Status: ",-1)),n("div",Ne,[(t(!0),r(C,null,$([...new Set(l.statuses.split(", "))],d=>(t(),b(P,{key:d,class:q(["capitalize",{"bg-yellow-500 text-white":d==="pending"||d==="uploaded","bg-blue-500 text-white":d==="level1_approved","bg-green-500 text-white":d==="level2_approved","bg-red-500 text-white":d==="rejected"||d==="expired","bg-purple-500 text-white":d==="pending_level1_approval"}])},{default:s(()=>[m(i(d.replace(/_/g," ")),1)]),_:2},1032,["class"]))),128))])])])]))),128))]),a(Z,{data:o.transactions},null,8,["data"])]),_:1})])]),_:1})],64)}}};export{ze as default};
