import{f as W,T as X,x as j,y as ee,l as E,r as w,o as i,d as c,a as x,u as te,Z as re,w as T,b as se,g as r,t as l,F as p,e as m,h,n as P,m as $,z as L,A as V,N as oe}from"./app-Drfr7wPO.js";import{u as ae}from"./useToast-Blb7EynO.js";const de={class:"bg-white border rounded-md shadow-sm p-6"},le={class:"space-y-4"},ne={class:"text-center"},ie={class:"text-lg font-medium text-blue-600"},ce={class:"text-md font-medium text-gray-700 mt-1"},ue={key:0,class:"mt-6 overflow-x-auto"},pe={class:"min-w-full border-collapse border border-gray-300 text-sm"},ye={class:"bg-gray-100"},be=["colspan"],me={class:"text-xs font-bold"},ge={key:0,class:"text-xs text-gray-600 mt-1 font-bold"},fe={key:1,class:"text-xs text-gray-500 mt-1"},_e={class:"bg-gray-200"},xe={class:"text-xs"},he={class:"text-xs"},ve={class:"border border-gray-300 px-3 py-2"},Ee={class:"border border-gray-300 px-3 py-2"},we={class:"border border-gray-300 px-3 py-2 text-center"},Te={class:"border border-gray-300 px-3 py-2 text-right"},ke=["onUpdate:modelValue","disabled","title","onClick"],Ce={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ae={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Ne={class:"border border-gray-300 px-3 py-2 text-center font-semibold bg-yellow-50"},Se={class:"border border-gray-300 px-3 py-2 text-right font-semibold bg-green-50"},De={class:"bg-gray-700 text-white font-bold"},Fe=["colspan"],Oe={class:"border border-gray-300 px-3 py-2 text-right"},Re={key:1,class:"mt-6 overflow-x-auto"},Ie={class:"min-w-full border-collapse border border-gray-300 text-sm"},Me={class:"bg-white"},Be={class:"border border-gray-300 px-3 py-2"},Pe={class:"border border-gray-300 px-3 py-2"},$e={class:"border border-gray-300 px-3 py-2 text-center font-semibold"},Le={key:0},Ve={class:"bg-gray-200"},Ue={class:"border border-gray-300 px-3 py-2 font-bold",colspan:"3"},Ge={class:"border border-gray-300 px-3 py-2",colspan:"2"},Ke={class:"font-medium"},qe={key:0,class:"text-xs text-gray-600 mt-1"},Je={key:1,class:"text-xs text-gray-500 mt-1"},Qe={class:"border border-gray-300 px-2 py-1"},ze=["onUpdate:modelValue","min","placeholder","onBlur"],He={class:"bg-blue-50 font-semibold"},Ye={class:"border border-gray-300 px-3 py-2 text-center"},Ze={class:"bg-gray-700 text-white font-bold"},We={class:"border border-gray-300 px-3 py-2 text-center"},et={__name:"Create",props:{variant:{type:String,default:null},date_from:{type:String,default:null},date_to:{type:String,default:null},stores:{type:Array,default:()=>[]},dates:{type:Array,default:()=>[]},sap_item:{type:Object,default:null},supplier_items:{type:Array,default:()=>[]}},setup(U){const s=U,{toast:_}=ae(),G=W(),C=()=>{oe.get(route("dts-mass-orders.index"))},K=()=>{let t=!1;if(s.variant==="FRUITS AND VEGETABLES")for(const e in d.value){for(const o in d.value[e]){for(const u in d.value[e][o])if(d.value[e][o][u]&&parseFloat(d.value[e][o][u])>0){t=!0;break}if(t)break}if(t)break}else for(const e in d.value){for(const o in d.value[e])if(d.value[e][o]&&parseFloat(d.value[e][o])>0){t=!0;break}if(t)break}if(!t){_.add({severity:"warn",summary:"No Orders",detail:"Please enter at least one order quantity before placing orders.",life:3e3});return}G.require({message:"Are you sure you want to place these orders? This action cannot be undone.",header:"Confirm Order Placement",icon:"pi pi-exclamation-triangle",accept:()=>{q()},reject:()=>{},acceptClass:"p-button-success",rejectClass:"p-button-danger"})},g=X({variant:s.variant,orders:{},sap_item:s.sap_item,supplier_items:s.supplier_items||[]}),q=()=>{if(s.variant==="FRUITS AND VEGETABLES"){const t={};Object.keys(d.value).forEach(e=>{t[e]={},Object.keys(d.value[e]).forEach(o=>{Object.keys(d.value[e][o]).forEach(u=>{t[e][u]||(t[e][u]={}),t[e][u][o]=d.value[e][o][u]})})}),g.orders=t,g.supplier_items=s.supplier_items,g.sap_item=null,console.log("Submitting FRUITS AND VEGETABLES orders:",{orders:t,supplier_items:s.supplier_items,variant:s.variant})}else g.orders=d.value,g.sap_item=s.sap_item;g.variant=s.variant,g.post(route("dts-mass-orders.store"),{onSuccess:()=>{_.add({severity:"success",summary:"Orders Placed",detail:"Your mass orders have been successfully placed.",life:3e3})},onError:t=>{console.error("Error placing orders:",t),_.add({severity:"error",summary:"Error",detail:t.error||JSON.stringify(t)||"Failed to place orders. Please try again.",life:5e3})}})},A=t=>{if(!t)return"Not Selected";try{const[e,o,u]=t.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o,10)-1]} ${parseInt(u,10)}, ${e}`}catch{return t}},d=j({});ee(()=>[s.variant,s.supplier_items,s.dates,s.stores],()=>{if(s.variant==="FRUITS AND VEGETABLES"){const t={};s.supplier_items.forEach(e=>{t[e.id]={},s.stores.forEach(o=>{t[e.id][o.id]={},s.dates.forEach(u=>{t[e.id][o.id][u.date]=""})})}),d.value=t}else{const t={};s.dates.forEach(e=>{t[e.date]={},s.stores.forEach(o=>{t[e.date][o.id]=""})}),d.value=t}},{immediate:!0});const N=t=>{let e=0;return s.stores.forEach(o=>{var b;const u=parseFloat(((b=d.value[t])==null?void 0:b[o.id])||0);e+=isNaN(u)?0:u}),e},J=E(()=>{let t=0;return s.dates.forEach(e=>{t+=N(e.date)}),t}),f=(t,e)=>!t.delivery_schedule_ids||!e.delivery_schedule_id?!1:t.delivery_schedule_ids.includes(e.delivery_schedule_id),S=t=>s.stores.filter(e=>f(e,t)),v=t=>s.dates,Q=E(()=>{let t=0;return s.stores.forEach(e=>{t+=v().length}),t});E(()=>{let t=0;return s.dates.forEach(e=>{const o=S(e).length;o>t&&(t=o)}),t||1});const z=(t,e,o)=>{if(s.variant==="ICE CREAM"){const u=parseFloat(o);if(o!==""&&o!==null&&!isNaN(u)&&u>0&&u<5)return _.add({severity:"warn",summary:"Invalid Quantity",detail:"ICE CREAM orders must be at least 5 gallons (GAL 3.8)",life:4e3}),d.value[t][e]="",!1}return!0},D=t=>{const e=Array.from(document.querySelectorAll('input[type="number"]')),o=e.indexOf(t.target);o>-1&&o<e.length-1&&(t.preventDefault(),e[o+1].focus(),e[o+1].select())},H=(t,e,o)=>{f(t,e)||_.add({severity:"warn",summary:"No Delivery Schedule",detail:`${t.name} does not have a delivery schedule for ${e.day_of_week}.`,life:4e3})},F=t=>{let e=0;return d.value[t]?(Object.keys(d.value[t]).forEach(o=>{Object.keys(d.value[t][o]).forEach(u=>{const b=parseFloat(d.value[t][o][u]||0);e+=isNaN(b)?0:b})}),e):0},Y=()=>10,O=t=>F(t)*1.1,R=(t,e)=>O(t)*e,Z=E(()=>{let t=0;return s.supplier_items.forEach(e=>{t+=R(e.id,e.price)}),t});return(t,e)=>{const o=w("Button"),u=w("TableHeader"),b=w("TableContainer"),I=w("Layout");return i(),c(p,null,[x(te(re),{title:"Create DTS Mass Order"}),x(I,{heading:"Create DTS Mass Order"},{default:T(()=>[x(b,null,{default:T(()=>{var M,B;return[x(u,null,{default:T(()=>[x(o,{onClick:C,variant:"outline",class:"text-black border-black hover:bg-gray-100"},{default:T(()=>e[0]||(e[0]=[se(" Back ")])),_:1})]),_:1}),r("div",de,[r("div",le,[r("div",ne,[r("p",ie,"Variant: "+l(s.variant||"Not Selected"),1),r("p",ce," Date Range: "+l(A(s.date_from))+" - "+l(A(s.date_to)),1)]),s.variant==="FRUITS AND VEGETABLES"?(i(),c("div",ue,[r("table",pe,[r("thead",null,[r("tr",ye,[e[1]||(e[1]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"100px"}},"ITEM CODE",-1)),e[2]||(e[2]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"200px"}},"ITEM NAME",-1)),e[3]||(e[3]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"UOM",-1)),e[4]||(e[4]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center align-middle",style:{"min-width":"80px"}},"PRICE",-1)),(i(!0),c(p,null,m(s.stores,a=>(i(),c("th",{key:`store-${a.id}`,colspan:v(a).length,class:"border border-gray-300 px-2 py-2 font-semibold text-center bg-blue-50",style:{"min-width":"120px"}},[r("div",me,l(a.name),1),a.brand_code?(i(),c("div",ge,l(a.brand_code),1)):h("",!0),a.complete_address?(i(),c("div",fe,l(a.complete_address),1)):h("",!0)],8,be))),128)),e[5]||(e[5]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL ORDER",-1)),e[6]||(e[6]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"BUFFER",-1)),e[7]||(e[7]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-yellow-100 align-middle"},"TOTAL PO",-1)),e[8]||(e[8]=r("th",{rowspan:"2",class:"border border-gray-300 px-3 py-2 font-semibold text-center bg-green-100 align-middle"},"TOTAL PRICE",-1))]),r("tr",_e,[(i(!0),c(p,null,m(s.stores,a=>(i(),c(p,{key:`dates-${a.id}`},[(i(!0),c(p,null,m(v(a),n=>(i(),c("th",{key:`date-${a.id}-${n.date}`,class:"border border-gray-300 px-2 py-2 font-semibold text-center"},[r("div",xe,l(n.day_of_week),1),r("div",he,l(n.display.split("- ")[1]),1)]))),128))],64))),128))])]),r("tbody",null,[(i(!0),c(p,null,m(s.supplier_items,a=>(i(),c("tr",{key:a.id,class:"hover:bg-gray-50"},[r("td",ve,l(a.item_code),1),r("td",Ee,l(a.item_name),1),r("td",we,l(a.uom),1),r("td",Te,l(a.price.toFixed(2)),1),(i(!0),c(p,null,m(s.stores,n=>(i(),c(p,{key:`body-${n.id}`},[(i(!0),c(p,null,m(v(n),y=>(i(),c("td",{key:`${a.id}-${n.id}-${y.date}`,class:P(["border border-gray-300 px-1 py-1",f(n,y)?"":"bg-gray-100"])},[$(r("input",{"onUpdate:modelValue":k=>d.value[a.id][n.id][y.date]=k,type:"number",step:"0.01",min:"0",disabled:!f(n,y),class:P(["w-full px-2 py-1 border rounded text-center",f(n,y)?"border-gray-300 focus:ring-1 focus:ring-blue-500":"border-gray-200 bg-gray-100 cursor-not-allowed text-gray-400"]),title:f(n,y)?"":"No delivery schedule for this store on this day",onKeydown:V(D,["enter"]),onClick:k=>H(n,y,k)},null,42,ke),[[L,d.value[a.id][n.id][y.date]]])],2))),128))],64))),128)),r("td",Ce,l(F(a.id).toFixed(2)),1),r("td",Ae,l(Y())+"% ",1),r("td",Ne,l(O(a.id).toFixed(2)),1),r("td",Se,l(R(a.id,a.price).toFixed(2)),1)]))),128)),r("tr",De,[e[9]||(e[9]=r("td",{colspan:"4",class:"border border-gray-300 px-3 py-2 text-right"},"TOTAL PRICE",-1)),r("td",{colspan:Q.value+3,class:"border border-gray-300 px-3 py-2"},null,8,Fe),r("td",Oe,l(Z.value.toFixed(2)),1)])])])])):(i(),c("div",Re,[r("table",Ie,[r("thead",null,[e[10]||(e[10]=r("tr",{class:"bg-gray-100"},[r("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"120px"}}," ITEM CODE "),r("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-left",style:{"min-width":"200px"}}," ITEM DESCRIPTION "),r("th",{class:"border border-gray-300 px-3 py-2 font-semibold text-center",style:{"min-width":"100px"}}," UOM ")],-1)),r("tr",Me,[r("td",Be,l(((M=s.sap_item)==null?void 0:M.item_code)||""),1),r("td",Pe,l(((B=s.sap_item)==null?void 0:B.item_description)||""),1),r("td",$e,[s.sap_item?(i(),c("span",Le,l(s.sap_item.alt_uom),1)):h("",!0)])])]),r("tbody",null,[(i(!0),c(p,null,m(s.dates,a=>(i(),c(p,{key:a.date},[r("tr",Ve,[r("td",Ue,l(a.display),1)]),e[12]||(e[12]=r("tr",{class:"bg-gray-50"},[r("td",{class:"border border-gray-300 px-3 py-2 font-semibold",colspan:"2"}," Store Name "),r("td",{class:"border border-gray-300 px-3 py-2 font-semibold text-center"}," Quantity ")],-1)),(i(!0),c(p,null,m(S(a),n=>(i(),c("tr",{key:`${a.date}-${n.id}`,class:"hover:bg-gray-50"},[r("td",Ge,[r("div",null,[r("div",Ke,l(n.name),1),n.brand_code?(i(),c("div",qe,l(n.brand_code),1)):h("",!0),n.complete_address?(i(),c("div",Je,l(n.complete_address),1)):h("",!0)])]),r("td",Qe,[$(r("input",{"onUpdate:modelValue":y=>d.value[a.date][n.id]=y,type:"number",step:"0.01",min:s.variant==="ICE CREAM"?"5":"0",class:"w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-center",placeholder:s.variant==="ICE CREAM"?"Min: 5":"0",onBlur:y=>z(a.date,n.id,d.value[a.date][n.id]),onKeydown:V(D,["enter"])},null,40,ze),[[L,d.value[a.date][n.id]]])])]))),128)),r("tr",He,[e[11]||(e[11]=r("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"}," TOTAL ",-1)),r("td",Ye,l(N(a.date)),1)])],64))),128)),r("tr",Ze,[e[13]||(e[13]=r("td",{class:"border border-gray-300 px-3 py-2",colspan:"2"}," GRAND TOTAL ",-1)),r("td",We,l(J.value),1)])])])])),r("div",{class:"flex justify-end gap-3 mt-6"},[r("button",{onClick:C,class:"px-4 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"}," Cancel "),r("button",{onClick:K,class:"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"}," Place Orders ")])])])]}),_:1})]),_:1})],64)}}};export{et as default};
