import{u as z}from"./useSelectOptions-DqOryH05.js";import{u as pe}from"./useToast-CL68v_82.js";import{f as fe,T as I,r as s,o as T,c as _e,w as l,a as t,b as n,u,t as d,d as x,e as ye,F as ce,h as G,i as J,g as L}from"./app-DPA7xop8.js";import{u as be}from"./useEditQuantity-X4K8rsxR.js";const Ve={key:0},ge={key:0},Se={__name:"Create",props:{menus:{type:Object,required:!0},branches:{type:Object,required:!0}},setup(E){const{toast:b}=pe(),U=fe(),{options:K}=z(E.menus),{options:W}=z(E.branches),q=I({store_transactions_file:null}),y=ref(!1),C=ref(!1),Y=()=>{C.value=!0};watch(C,i=>{i||(y.value=!1)});const Z=()=>{y.value=!0,q.post(route("store-transactions.import"),{onSuccess:()=>{y.value=!1,C.value=!1,b.add({severity:"success",summary:"Success",detail:"Store transactions created successfully",life:3e3})},onError:i=>{b.add({severity:"error",summary:"Error",detail:"An error occured while trying to import store transactions.",life:3e3}),y.value=!1}})},o=I({id:null,product_id:null,name:null,quantity:null,discount:0,price:null,line_total:null,net_total:null}),r=I({order_date:null,lot_serial:null,posted:null,tim_number:null,receipt_number:null,store_branch_id:null,customer_id:null,customer:null,items:[]}),h=i=>{U.require({message:"Are you sure you want to remove this item from your orders?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Remove",severity:"danger"},accept:()=>{r.items=r.items.filter(e=>e.id!==i),b.add({severity:"success",summary:"Confirmed",detail:"Item Removed",life:3e3})}})};watch(()=>o.id,i=>{i!=null&&(o.clearErrors(),axios.get(route("menu-item.show",i)).then(e=>e.data).then(e=>{console.log(e),o.name=e.name,o.price=e.price,o.product_id=e.product_id}).catch(e=>console.log(e)))});const ee=()=>{if(o.id===null){o.setError("id","Item field is required");return}if(o.quantity<1){o.setError("quantity","Quantity must be atleast 1");return}console.log(o);const i=r.items.findIndex(e=>e.id===o.id);if(i===-1)o.line_total=parseFloat(o.quantity*o.price),o.net_total=parseFloat(o.quantity*o.price),r.items.push({...o});else{const e=r.items[i];e.quantity+=o.quantity,o.line_total=parseFloat(o.quantity*o.price),o.net_total=parseFloat(o.quantity*o.price)}o.reset(),o.clearErrors()};watch(()=>o.quantity,i=>{if(i&&o.price){o.line_total=parseFloat(i*o.price);const e=o.discount/100*o.line_total;o.net_total=parseFloat(o.line_total-e)}}),watch(()=>o.discount,i=>{if(o.line_total){const e=i/100*o.line_total;o.net_total=parseFloat(o.line_total-e)}});const te=()=>{if(r.items.length<1){b.add({severity:"error",summary:"Error",detail:"Please select at least one item before proceeding.",life:5e3});return}U.require({message:"Are you sure you want to create this store transaction?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{r.post(route("store-transactions.store"),{onSuccess:()=>{b.add({severity:"success",summary:"Success",detail:"Store transaction Created Successfully.",life:5e3})},onError:i=>{b.add({severity:"error",summary:"Error",detail:"Something went wrong while trying to create the store transaction.",life:5e3})}})}})},{isEditQuantityModalOpen:v,formQuantity:c,openEditQuantityModal:Ce}=be(),le=()=>{if(c.quantity<.1){c.setError("quantity","Quantity should be more than 0");return}const i=r.items.findIndex(e=>e.id===c.id);r.items[i].quantity=c.quantity,r.items[i].total_cost=parseFloat(r.items[i].quantity*r.items[i].cost).toFixed(2),b.add({severity:"success",summary:"Success",detail:"Quantity Updated",life:3e3}),c.reset(),c.clearErrors(),v.value=!1};return(i,e)=>{const k=s("CardTitle"),P=s("CardDescription"),B=s("CardHeader"),m=s("LabelXS"),ne=s("DatePicker"),f=s("FormError"),p=s("InputContainer"),_=s("Input"),Q=s("Select"),S=s("DivFlexCol"),H=s("CardContent"),F=s("Card"),D=s("Button"),oe=s("CardFooter"),N=s("SpanBold"),w=s("DivFlexCenter"),V=s("TH"),ue=s("TableHead"),g=s("TD"),ae=s("DeleteButton"),re=s("TableBody"),se=s("Table"),ie=s("TableContainer"),O=s("DialogTitle"),j=s("DialogDescription"),A=s("DialogHeader"),M=s("Loading"),R=s("DialogFooter"),X=s("DialogContent"),$=s("Dialog"),de=s("Label"),me=s("Layout");return T(),_e(me,{heading:"Create Store Transaction",buttonName:"Import Store Transactions",hasButton:!0,handleClick:Y},{default:l(()=>[t(F,{class:"grid grid-cols-3 gap-3 p-5"},{default:l(()=>[t(F,null,{default:l(()=>[t(B,null,{default:l(()=>[t(k,null,{default:l(()=>e[18]||(e[18]=[n("Transaction Details")])),_:1}),t(P,null,{default:l(()=>e[19]||(e[19]=[n("Please input all the information required.")])),_:1})]),_:1}),t(H,null,{default:l(()=>[t(S,{class:"gap-3"},{default:l(()=>[t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[20]||(e[20]=[n("Date")])),_:1}),t(ne,{modelValue:u(r).order_date,"onUpdate:modelValue":e[0]||(e[0]=a=>u(r).order_date=a),showIcon:""},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.order_date),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[21]||(e[21]=[n("Lot/Serial")])),_:1}),t(_,{modelValue:u(r).lot_serial,"onUpdate:modelValue":e[1]||(e[1]=a=>u(r).lot_serial=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.lot_serial),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[22]||(e[22]=[n("Posted")])),_:1}),t(_,{modelValue:u(r).posted,"onUpdate:modelValue":e[2]||(e[2]=a=>u(r).posted=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.posted),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[23]||(e[23]=[n("TM#")])),_:1}),t(_,{modelValue:u(r).tim_number,"onUpdate:modelValue":e[3]||(e[3]=a=>u(r).tim_number=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.tim_number),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[24]||(e[24]=[n("Receipt No.")])),_:1}),t(_,{modelValue:u(r).receipt_number,"onUpdate:modelValue":e[4]||(e[4]=a=>u(r).receipt_number=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.receipt_number),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[25]||(e[25]=[n("Branch")])),_:1}),t(Q,{modelValue:u(r).store_branch_id,"onUpdate:modelValue":e[5]||(e[5]=a=>u(r).store_branch_id=a),filter:"",placeholder:"Select a branch",options:u(W),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(f,null,{default:l(()=>[n(d(u(r).errors.store_branch_id),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[26]||(e[26]=[n("Customer ID")])),_:1}),t(_,{modelValue:u(r).customer_id,"onUpdate:modelValue":e[6]||(e[6]=a=>u(r).customer_id=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.customer_id),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[27]||(e[27]=[n("Customer")])),_:1}),t(_,{modelValue:u(r).customer,"onUpdate:modelValue":e[7]||(e[7]=a=>u(r).customer=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(r).errors.customer),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(S,{class:"gap-5 col-span-2"},{default:l(()=>[t(F,null,{default:l(()=>[t(B,null,{default:l(()=>[t(k,null,{default:l(()=>e[28]||(e[28]=[n("Menu List")])),_:1}),t(P,null,{default:l(()=>e[29]||(e[29]=[n("Please input all the required fields.")])),_:1})]),_:1}),t(H,{class:"space-y-3 w-full"},{default:l(()=>[t(S,{class:"grid grid-cols-2 gap-3 sm:items-center"},{default:l(()=>[t(p,{class:"w-full col-span-2"},{default:l(()=>[t(m,null,{default:l(()=>e[30]||(e[30]=[n("Item")])),_:1}),t(Q,{filter:"",placeholder:"Select a Store",options:u(K),optionLabel:"label",optionValue:"value",modelValue:u(o).id,"onUpdate:modelValue":e[8]||(e[8]=a=>u(o).id=a)},null,8,["options","modelValue"]),t(f,null,{default:l(()=>[n(d(u(o).errors.id),1)]),_:1})]),_:1}),t(p,{class:"w-full"},{default:l(()=>[t(m,null,{default:l(()=>e[31]||(e[31]=[n("Price")])),_:1}),t(_,{disabled:"",type:"number",modelValue:u(o).price,"onUpdate:modelValue":e[9]||(e[9]=a=>u(o).price=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(o).errors.price),1)]),_:1})]),_:1}),t(p,{class:"w-full"},{default:l(()=>[t(m,null,{default:l(()=>e[32]||(e[32]=[n("Quantity")])),_:1}),t(_,{type:"number",modelValue:u(o).quantity,"onUpdate:modelValue":e[10]||(e[10]=a=>u(o).quantity=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(o).errors.quantity),1)]),_:1})]),_:1}),t(p,{class:"w-full"},{default:l(()=>[t(m,null,{default:l(()=>e[33]||(e[33]=[n("Discount")])),_:1}),t(_,{type:"number",modelValue:u(o).discount,"onUpdate:modelValue":e[11]||(e[11]=a=>u(o).discount=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(o).errors.discount),1)]),_:1})]),_:1}),t(p,{class:"w-full"},{default:l(()=>[t(m,null,{default:l(()=>e[34]||(e[34]=[n("Line Total")])),_:1}),t(_,{type:"number",modelValue:u(o).line_total,"onUpdate:modelValue":e[12]||(e[12]=a=>u(o).line_total=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(o).errors.line_total),1)]),_:1})]),_:1}),t(p,{class:"w-full"},{default:l(()=>[t(m,null,{default:l(()=>e[35]||(e[35]=[n("Net Total")])),_:1}),t(_,{type:"number",modelValue:u(o).net_total,"onUpdate:modelValue":e[13]||(e[13]=a=>u(o).net_total=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(o).errors.net_total),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(oe,{class:"justify-end"},{default:l(()=>[t(D,{onClick:ee},{default:l(()=>e[36]||(e[36]=[n("Add")])),_:1})]),_:1})]),_:1}),t(ie,null,{default:l(()=>[t(w,{class:"flex justify-between"},{default:l(()=>[t(N,null,{default:l(()=>e[37]||(e[37]=[n("Items Sold")])),_:1}),t(w,{class:"gap-2"},{default:l(()=>[t(m,null,{default:l(()=>e[38]||(e[38]=[n(" Overall Total:")])),_:1}),t(N)]),_:1})]),_:1}),t(se,null,{default:l(()=>[t(ue,null,{default:l(()=>[t(V,null,{default:l(()=>e[39]||(e[39]=[n("Item")])),_:1}),t(V,null,{default:l(()=>e[40]||(e[40]=[n("Price")])),_:1}),t(V,null,{default:l(()=>e[41]||(e[41]=[n("Quantity")])),_:1}),t(V,null,{default:l(()=>e[42]||(e[42]=[n("Discount")])),_:1}),t(V,null,{default:l(()=>e[43]||(e[43]=[n("Line Total")])),_:1}),t(V,null,{default:l(()=>e[44]||(e[44]=[n("Net Total")])),_:1}),t(V,null,{default:l(()=>e[45]||(e[45]=[n("Actions")])),_:1})]),_:1}),t(re,null,{default:l(()=>[(T(!0),x(ce,null,ye(u(r).items,a=>(T(),x("tr",null,[t(g,null,{default:l(()=>[n(d(a.name),1)]),_:2},1024),t(g,null,{default:l(()=>[n(d(a.price),1)]),_:2},1024),t(g,null,{default:l(()=>[n(d(a.quantity),1)]),_:2},1024),t(g,null,{default:l(()=>[n(d(a.discount),1)]),_:2},1024),t(g,null,{default:l(()=>[n(d(a.line_total),1)]),_:2},1024),t(g,null,{default:l(()=>[n(d(a.net_total),1)]),_:2},1024),t(g,{class:"flex gap-3 items-center"},{default:l(()=>[t(ae,{onClick:Te=>h(a.id)},null,8,["onClick"])]),_:2},1024)]))),256))]),_:1})]),_:1}),t(w,{class:"justify-end"},{default:l(()=>[t(D,{onClick:te},{default:l(()=>e[46]||(e[46]=[n("Proceed")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t($,{open:u(v),"onUpdate:open":e[15]||(e[15]=a=>J(v)?v.value=a:null)},{default:l(()=>[t(X,{class:"sm:max-w-[600px]"},{default:l(()=>[t(A,null,{default:l(()=>[t(O,null,{default:l(()=>e[47]||(e[47]=[n("Edit Quantity")])),_:1}),t(j,null,{default:l(()=>e[48]||(e[48]=[n(" Please input all the required fields. ")])),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[49]||(e[49]=[n("Quantity")])),_:1}),t(_,{type:"number",modelValue:u(c).quantity,"onUpdate:modelValue":e[14]||(e[14]=a=>u(c).quantity=a)},null,8,["modelValue"]),t(f,null,{default:l(()=>[n(d(u(c).errors.quantity),1)]),_:1})]),_:1}),t(R,null,{default:l(()=>[t(D,{onClick:le,disabled:u(y),type:"submit",class:"gap-2"},{default:l(()=>[e[50]||(e[50]=n(" Confirm ")),u(y)?(T(),x("span",Ve,[t(M)])):G("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t($,{open:u(C),"onUpdate:open":e[17]||(e[17]=a=>J(C)?C.value=a:null)},{default:l(()=>[t(X,{class:"sm:max-w-[600px]"},{default:l(()=>[t(A,null,{default:l(()=>[t(O,null,{default:l(()=>e[51]||(e[51]=[n("Import Store Transactions List")])),_:1}),t(j,null,{default:l(()=>e[52]||(e[52]=[n(" Import the excel file here. ")])),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m,null,{default:l(()=>e[53]||(e[53]=[n(" Store Transactions List ")])),_:1}),t(_,{disabled:u(y),type:"file",onInput:e[16]||(e[16]=a=>u(q).store_transactions_file=a.target.files[0])},null,8,["disabled"]),t(f,null,{default:l(()=>[n(d(u(q).errors.store_transactions_file),1)]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(de,{class:"text-xs"},{default:l(()=>e[54]||(e[54]=[n("Store Transaction Template")])),_:1}),e[55]||(e[55]=L("ul",null,[L("li",{class:"text-xs"},[n(" Template: "),L("a",{class:"text-blue-500 underline",href:"/excel/store-transactions-template"},"Click to download")])],-1))]),_:1}),t(R,null,{default:l(()=>[t(D,{disabled:u(y),onClick:Z,class:"gap-2"},{default:l(()=>[e[56]||(e[56]=n(" Proceed ")),u(y)?(T(),x("span",ge,[t(M)])):G("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}};export{Se as default};
