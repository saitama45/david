import{X as ue,x as b,f as me,G as pe,T as ge,aW as ve,l as _,r as xe,o as p,c as q,w as i,a as o,u as s,b as v,aj as w,g as e,n as k,aX as P,m as F,O as N,ay as B,s as O,d as x,t as c,h as y,aY as fe,P as R,F as _e,e as ye,_ as W,ah as be,b7 as z,N as he}from"./app-rjK1ng7o.js";import{a as T,_ as U}from"./AlertDescription-B6smwBW-.js";import{I as we}from"./ItemAutoComplete-95Pbgfq4.js";import{I as ke}from"./ImageUpload-CpHSdbke.js";import{u as Ce}from"./useSelectOptions-C8yZk_6t.js";import{A as Ie}from"./arrow-left-CawIyKRQ.js";import{P as L}from"./package-Dr2_9bTP.js";import{T as D}from"./triangle-alert-wjSEt5KL.js";import"./lodash-DqVvdaAw.js";import"./loader-circle-9bq-iArU.js";import"./circle-alert-D5cL6bJ-.js";import"./x-DY7ygrlY.js";import"./upload-CiN_PamT.js";const Se={class:"space-y-4"},Ve={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},qe={class:"flex items-center gap-3"},Pe={class:"p-2 bg-blue-600 rounded-lg"},Fe={class:"px-4 sm:px-6 py-4"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"space-y-2"},Te={key:0,class:"text-sm text-red-600"},Ue={class:"space-y-2 md:col-span-2"},De={key:0,class:"text-sm text-red-600"},Ae={class:"space-y-2 md:col-span-2"},$e={key:0,class:"text-sm text-red-600"},je={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ee={class:"flex items-center gap-3"},Oe={class:"p-2 bg-green-600 rounded-lg"},Re={class:"text-sm text-gray-600"},We={class:"px-4 sm:px-6 py-4"},ze={key:0,class:"mb-4"},Le={class:"grid grid-cols-1 md:grid-cols-12 gap-4 mb-6"},He={class:"space-y-2 md:col-span-8"},Ge={class:"space-y-2 md:col-span-4 flex items-end"},Me={key:1,class:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm bg-blue-50 p-3 rounded-lg"},Ye={class:"font-medium"},Qe={class:"font-medium"},Xe={class:"font-medium"},Je={key:2,class:"space-y-4"},Ke={class:"flex items-center justify-between"},Ze={class:"border rounded-lg overflow-hidden"},et={class:"w-full"},tt={class:"divide-y divide-gray-200"},st={class:"px-4 py-4"},at={class:"font-medium text-gray-900"},ot={class:"text-sm text-gray-500"},lt={class:"px-4 py-4",style:{"min-width":"170px"}},rt={class:"px-4 py-4"},nt={class:"text-sm text-gray-900"},dt={class:"px-4 py-4"},it={class:"px-4 py-4"},ct={class:"px-4 py-4"},ut={class:"text-sm font-medium text-gray-900"},mt={class:"px-4 py-4 text-center"},pt={class:"bg-gray-50"},gt={colspan:"2",class:"px-4 py-3 font-bold text-green-600"},vt={key:3,class:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg"},xt={class:"text-gray-500"},ft={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},_t={class:"flex items-center gap-3"},yt={class:"p-2 bg-purple-600 rounded-lg"},bt={class:"px-4 sm:px-6 py-4"},ht={key:0,class:"bg-blue-50 p-4 rounded-lg mb-4"},wt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},kt={class:"text-center"},Ct={class:"text-2xl font-bold text-blue-600"},It={class:"text-center"},St={class:"text-2xl font-bold text-green-600"},Vt={class:"text-center"},qt={class:"text-lg font-semibold text-purple-600"},Pt={class:"flex flex-col sm:flex-row gap-3"},Ft={__name:"Create",props:{branches:Array,items:Array},setup(H){const A=H,{options:G}=Ce(A.branches),M=b(["Spoilage","Wastage","Scrap"]),Y=me(),$=pe(),r=ge({store_branch_id:"",remarks:"",cartItems:[],images:[]}),u=b(null),Q=b(!1),m=b([]),h=b([]),d=ve({id:null,inventory_code:null,name:null,description:null,unit_of_measurement:null,base_uom:null,base_qty:null,quantity:null,cost:null,total_cost:null,uom:null,stock:0}),f=b({wastageDetails:!0,itemSelection:!0,summary:!0}),C=a=>{f.value[a]=!f.value[a]},X=_(()=>A.branches.find(a=>a.value===r.store_branch_id)),J=_(()=>m.value.reduce((a,t)=>a+parseFloat(t.quantity||0)*parseFloat(t.cost||0),0)),j=_(()=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(J.value)),I=_(()=>r.store_branch_id&&r.remarks&&r.remarks.trim()!==""&&h.value.length>0&&m.value.length>0&&m.value.every(a=>a.sap_masterfile_id&&parseFloat(a.quantity)>0&&parseFloat(a.cost)>=0&&a.reason)),K=_(()=>r.store_branch_id),E=_(()=>m.value.length),S=_(()=>m.value.length===0),Z=a=>{if(!a){Object.keys(d).forEach(t=>{d[t]=null}),u.value=null;return}d.id=a.id,d.inventory_code=String(a.item_code),d.description=a.description||"No description",d.unit_of_measurement=a.alt_uom||a.uom,d.cost=Number(a.cost_per_quantity||1),d.uom=a.uom,d.stock=a.stock||0,u.value=a},ee=()=>{if(!u.value)return;if(m.value.find(n=>n.sap_masterfile_id===u.value.id)){alert("This item is already in the cart. You can update the quantity there.");return}const t={id:Date.now(),sap_masterfile_id:u.value.id,item_code:u.value.item_code,description:u.value.description||"No description",quantity:1,cost:d.cost||0,uom:d.unit_of_measurement,total_cost:d.cost||0,reason:"Spoilage"};m.value.push(t),u.value=null,Object.keys(d).forEach(n=>{d[n]=null})},te=a=>{const t=m.value.findIndex(n=>n.id===a);t>-1&&m.value.splice(t,1)},se=(a,t)=>{const n=m.value.find(l=>l.id===a);n&&(n.quantity=parseFloat(t)||0,n.total_cost=n.quantity*n.cost)},ae=(a,t)=>{const n=m.value.find(l=>l.id===a);n&&(n.cost=parseFloat(t)||0,n.total_cost=n.quantity*n.cost)},V=()=>{m.value=[]},oe=()=>{const a=m.value.map(t=>({sap_masterfile_id:t.sap_masterfile_id,quantity:parseFloat(t.quantity),cost:parseFloat(t.cost),reason:t.reason}));r.cartItems=a,r.images=h.value,r.post(route("wastage.store"),{onSuccess:()=>{V(),re(),$.add({severity:"success",summary:"Success",detail:"Wastage record saved successfully!",life:3e3})},onError:t=>{console.error("Form validation errors:",t),$.add({severity:"error",summary:"Error",detail:"Failed to save wastage record. Please check the form.",life:3e3})}})},le=()=>{I.value&&Y.require({message:"Are you sure you want to save this wastage record?",header:"Confirm Save",icon:"pi pi-exclamation-triangle",rejectProps:{label:"No",severity:"danger",outlined:!0,size:"small"},acceptProps:{label:"Yes",severity:"success",size:"small"},accept:()=>{oe()},reject:()=>{}})},re=()=>{r.reset(),V(),u.value=null,h.value=[],Object.keys(d).forEach(a=>{d[a]=null})},ne=()=>{he.get(route("wastage.index"))},de=()=>{var a;return((a=X.value)==null?void 0:a.label)||"Select a store"},ie=a=>a?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(a):"â‚±0.00",ce=a=>{(!a.reason||a.reason.trim()==="")&&(a.reason="Spoilage")};return(a,t)=>{const n=xe("Layout");return p(),q(n,{heading:"Create Wastage Record"},{"header-actions":i(()=>[o(s(w),{variant:"outline",onClick:ne},{default:i(()=>[o(s(Ie),{class:"w-4 h-4 mr-2"}),t[7]||(t[7]=v(" Back to Records "))]),_:1})]),default:i(()=>[e("div",Se,[e("div",Ve,[e("button",{onClick:t[0]||(t[0]=l=>C("wastageDetails")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200 flex items-center justify-between text-left hover:from-blue-100 hover:to-blue-200 transition-colors"},[e("div",qe,[e("div",Pe,[o(s(L),{class:"w-5 h-5 text-white"})]),t[8]||(t[8]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-900"},"Wastage Details"),e("p",{class:"text-sm text-gray-600"},"Basic wastage information")],-1))]),o(s(P),{class:k(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":f.value.wastageDetails}])},null,8,["class"])]),F(e("div",Fe,[e("div",Ne,[e("div",Be,[o(s(B),{for:"store_branch_id"},{default:i(()=>t[9]||(t[9]=[v("Store Branch *")])),_:1}),o(s(O),{modelValue:s(r).store_branch_id,"onUpdate:modelValue":t[1]||(t[1]=l=>s(r).store_branch_id=l),filter:"",placeholder:"Select a store branch",options:s(G),optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"]),s(r).errors.store_branch_id?(p(),x("p",Te,c(s(r).errors.store_branch_id),1)):y("",!0)]),e("div",Ue,[o(s(B),{for:"remarks"},{default:i(()=>t[10]||(t[10]=[v("Remarks *")])),_:1}),o(s(fe),{id:"remarks",modelValue:s(r).remarks,"onUpdate:modelValue":t[2]||(t[2]=l=>s(r).remarks=l),rows:"3",placeholder:"Enter remarks",class:k({"border-red-500":s(r).errors.remarks}),required:""},null,8,["modelValue","class"]),s(r).errors.remarks?(p(),x("p",De,c(s(r).errors.remarks),1)):y("",!0)]),e("div",Ae,[o(ke,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=l=>h.value=l),label:"Wastage Images *","helper-text":"Upload one or more JPG or PNG images as evidence (max 5MB each)",disabled:s(r).processing,multiple:"",required:""},null,8,["modelValue","disabled"]),s(r).errors.images?(p(),x("p",$e,c(s(r).errors.images),1)):y("",!0)])])],512),[[N,f.value.wastageDetails]])]),e("div",je,[e("button",{onClick:t[4]||(t[4]=l=>C("itemSelection")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-green-50 to-green-100 border-b border-green-200 flex items-center justify-between text-left hover:from-green-100 hover:to-green-200 transition-colors"},[e("div",Ee,[e("div",Oe,[o(s(R),{class:"w-5 h-5 text-white"})]),e("div",null,[t[11]||(t[11]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Item Selection & Cart",-1)),e("p",Re,"Search items and add to cart ("+c(E.value)+" items)",1)])]),o(s(P),{class:k(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":f.value.itemSelection}])},null,8,["class"])]),F(e("div",We,[K.value?y("",!0):(p(),x("div",ze,[o(s(U),{class:"border-yellow-200 bg-yellow-50"},{default:i(()=>[o(s(D),{class:"w-4 h-4 text-yellow-600"}),o(s(T),{class:"text-yellow-800"},{default:i(()=>t[12]||(t[12]=[v(" Please select a store branch first to search for items. ")])),_:1})]),_:1})])),e("div",Le,[e("div",He,[o(s(B),{class:"text-sm font-medium text-gray-700"},{default:i(()=>t[13]||(t[13]=[v("Search Items *")])),_:1}),o(we,{modelValue:u.value,"onUpdate:modelValue":t[5]||(t[5]=l=>u.value=l),"sending-store-id":parseInt(s(r).store_branch_id),placeholder:"Type at least 3 characters to search for items...",disabled:!s(r).store_branch_id||Q.value,onItemSelected:Z},null,8,["modelValue","sending-store-id","disabled"])]),e("div",Ge,[o(s(w),{onClick:ee,disabled:!u.value||!s(r).store_branch_id,class:"w-full h-10 bg-green-600 hover:bg-green-700"},{default:i(()=>[o(s(R),{class:"w-4 h-4 mr-2"}),t[14]||(t[14]=v(" Add Items "))]),_:1},8,["disabled"])])]),u.value?(p(),x("div",Me,[e("div",null,[t[15]||(t[15]=e("span",{class:"text-gray-600"},"Item Code:",-1)),e("div",Ye,c(u.value.item_code),1)]),e("div",null,[t[16]||(t[16]=e("span",{class:"text-gray-600"},"Description:",-1)),e("div",Qe,c(u.value.description||"No description"),1)]),e("div",null,[t[17]||(t[17]=e("span",{class:"text-gray-600"},"UoM:",-1)),e("div",Xe,c(d.unit_of_measurement),1)])])):y("",!0),m.value.length>0?(p(),x("div",Je,[e("div",Ke,[t[19]||(t[19]=e("h4",{class:"text-md font-semibold text-gray-900"},"Cart Items",-1)),o(s(w),{variant:"outline",size:"sm",onClick:V},{default:i(()=>t[18]||(t[18]=[v(" Clear Cart ")])),_:1})]),e("div",Ze,[e("table",et,[t[21]||(t[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Reason"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"UoM"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Quantity"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cost"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Total"),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Action")])],-1)),e("tbody",tt,[(p(!0),x(_e,null,ye(m.value,l=>(p(),x("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",st,[e("div",null,[e("div",at,c(l.item_code),1),e("div",ot,c(l.description),1)])]),e("td",lt,[o(s(O),{modelValue:l.reason,"onUpdate:modelValue":g=>l.reason=g,options:M.value,class:"w-full",onBlur:g=>ce(l)},null,8,["modelValue","onUpdate:modelValue","options","onBlur"])]),e("td",rt,[e("div",nt,c(l.uom),1)]),e("td",dt,[o(s(W),{type:"number",modelValue:l.quantity,"onUpdate:modelValue":g=>l.quantity=g,onInput:g=>se(l.id,g.target.value),step:"0.01",min:"0.01",class:"w-24 h-8 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",it,[o(s(W),{type:"number",modelValue:l.cost,"onUpdate:modelValue":g=>l.cost=g,onInput:g=>ae(l.id,g.target.value),step:"0.01",min:"0",class:"w-24 h-8 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",ct,[e("div",ut,c(ie(l.total_cost)),1)]),e("td",mt,[o(s(w),{variant:"ghost",size:"sm",onClick:g=>te(l.id),class:"text-red-600 hover:text-red-700 hover:bg-red-50"},{default:i(()=>[o(s(be),{class:"w-4 h-4"})]),_:2},1032,["onClick"])])]))),128))]),e("tfoot",pt,[e("tr",null,[t[20]||(t[20]=e("td",{colspan:"5",class:"px-4 py-3 text-right font-medium text-gray-900"}," Cart Total: ",-1)),e("td",gt,c(j.value),1)])])])])])):(p(),x("div",vt,[e("div",xt,[o(s(L),{class:"w-12 h-12 mx-auto mb-4 text-gray-400"}),t[22]||(t[22]=e("h3",{class:"text-lg font-medium mb-2"},"No items in cart",-1)),t[23]||(t[23]=e("p",{class:"text-sm"},"Search for items above and add them to the cart to continue.",-1))])]))],512),[[N,f.value.itemSelection]])]),e("div",ft,[e("button",{onClick:t[6]||(t[6]=l=>C("summary")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-purple-50 to-purple-100 border-b border-purple-200 flex items-center justify-between text-left hover:from-purple-100 hover:to-purple-200 transition-colors"},[e("div",_t,[e("div",yt,[o(s(z),{class:"w-5 h-5 text-white"})]),t[24]||(t[24]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Summary & Submit"),e("p",{class:"text-sm text-gray-600"},"Review and create wastage record")],-1))]),o(s(P),{class:k(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":f.value.summary}])},null,8,["class"])]),F(e("div",bt,[S.value?y("",!0):(p(),x("div",ht,[e("div",wt,[e("div",kt,[e("div",Ct,c(E.value),1),t[25]||(t[25]=e("div",{class:"text-sm text-gray-600"},"Items in Cart",-1))]),e("div",It,[e("div",St,c(j.value),1),t[26]||(t[26]=e("div",{class:"text-sm text-gray-600"},"Total Cost",-1))]),e("div",Vt,[e("div",qt,c(de()),1),t[27]||(t[27]=e("div",{class:"text-sm text-gray-600"},"Store Branch",-1))])])])),S.value?(p(),q(s(U),{key:1,class:"mb-4 border-yellow-200 bg-yellow-50"},{default:i(()=>[o(s(D),{class:"h-4 w-4 text-yellow-600"}),o(s(T),{class:"text-yellow-800"},{default:i(()=>t[28]||(t[28]=[v(" Please add at least one item to the cart before saving. ")])),_:1})]),_:1})):I.value?y("",!0):(p(),q(s(U),{key:2,class:"mb-4"},{default:i(()=>[o(s(D),{class:"h-4 w-4 text-yellow-600"}),o(s(T),{class:"text-yellow-800"},{default:i(()=>t[29]||(t[29]=[v(" Please fill in all required fields and ensure all items have valid quantities and costs. ")])),_:1})]),_:1})),e("div",Pt,[o(s(w),{onClick:le,disabled:!I.value||s(r).processing||S.value,class:"flex-1",size:"lg"},{default:i(()=>[o(s(z),{class:"w-4 h-4 mr-2"}),v(" "+c(s(r).processing?"Saving...":"Save Wastage Record"),1)]),_:1},8,["disabled"])])],512),[[N,f.value.summary]])])])]),_:1})}}},Lt=ue(Ft,[["__scopeId","data-v-5e72bdb0"]]);export{Lt as default};
