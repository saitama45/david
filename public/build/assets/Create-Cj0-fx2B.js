import{Y as xe,x,az as we,y as X,V as Ne,a4 as De,o as c,d as _,g as t,m as Y,z as ke,h as w,t as m,S as ue,F as se,e as oe,n as F,W as Ae,f as Oe,T as ce,bq as Ue,l as V,r as je,c as me,w as b,a as l,u as n,b as C,N as _e,aA as K,br as ae,O as le,aP as U,s as fe,_ as W,bs as ve,P as Fe,ay as ie,bt as Le,a$ as Te,aW as Me,aX as Be,aY as Pe,a_ as Qe,i as Re,b0 as ze}from"./app-Bp7xdNcv.js";import{l as Ge}from"./lodash-KmyjfxIh.js";import{u as He}from"./useToast-BYf4YE8m.js";import{u as Ke}from"./useSelectOptions-DNoqVwQ-.js";import{u as We}from"./useEditQuantity-DLPB5BXZ.js";import{_ as pe,a as ge}from"./ItemQuantityModal.vue_vue_type_style_index_0_scoped_cebaab2c_lang-BGO3cF0Q.js";import ye from"./StockIndicator-OXXkftVS.js";import{A as Ye}from"./arrow-left-Bx8aOM0-.js";import{P as te}from"./package-8PI2OvT-.js";import{T as be}from"./triangle-alert-ClI8I6RE.js";import{S as he}from"./square-pen-BXz0dBaO.js";import{C as Xe}from"./chevron-left-CG0IIGB9.js";import"./circle-x-ya5U_PzQ.js";const Je={class:"relative"},Ze=["placeholder","disabled"],et={key:1,class:"absolute right-2 top-1/2 transform -translate-y-1/2"},tt={key:0,class:"mt-1 text-sm text-red-600"},st=["onClick","onMouseenter"],ot={class:"flex justify-between items-start"},rt={class:"flex-1"},nt={class:"font-medium text-sm text-gray-900"},at={class:"text-sm text-gray-600"},lt={class:"text-xs text-gray-500"},it={class:"ml-2 text-right"},dt={key:0,class:"text-xs text-green-500"},ut={key:1,class:"text-xs text-red-500"},ct={key:3,class:"mt-1 text-xs text-gray-500"},mt={__name:"ItemAutoComplete",props:{modelValue:{type:[String,Object],default:""},sendingStoreId:{type:[Number,null],default:null},placeholder:{type:String,default:"Type at least 3 characters to search..."},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","item-selected"],setup(M,{emit:Q}){const D=M,h=Q,a=x(""),i=x(!1),f=x([]),I=x(!1),N=x(""),k=x(-1),A=x(null),L=x(null),s=x({top:"0px",left:"0px",width:"0px"}),S=async()=>{if(!A.value||!i.value)return;await Ae();const d=A.value.getBoundingClientRect(),y=window.pageYOffset||document.documentElement.scrollTop,p=window.pageXOffset||document.documentElement.scrollLeft,q=240,T=window.innerHeight-d.bottom,re=d.top;let Z=d.bottom+y;T<q&&re>q&&(Z=d.top+y-q);const ne=320;let P=d.left+p,H=Math.min(d.width,ne);P+H>window.innerWidth+p&&(P=window.innerWidth+p-H-8),P<p&&(P=p+8),s.value={top:`${Z}px`,left:`${P}px`,width:`${H}px`}},B=()=>{i.value&&S()},R=Ge.debounce(async d=>{var y,p;if(!d||d.length<3){f.value=[],i.value=!1;return}if(!D.sendingStoreId){N.value="Please select a sending store first";return}I.value=!0,N.value="";try{const q=await we.get(route("interco.items.search"),{params:{sending_store_id:D.sendingStoreId,search:d}});f.value=q.data.items||[],i.value=f.value.length>0,k.value=-1,i.value&&await S()}catch(q){N.value=((p=(y=q.response)==null?void 0:y.data)==null?void 0:p.message)||"Failed to search items",f.value=[],i.value=!1}finally{I.value=!1}},300);X(()=>D.modelValue,d=>{d&&typeof d=="object"?a.value=`${d.item_code} - ${d.description}`:a.value=""}),X(a,d=>{R(d)});const $=d=>{a.value=`${d.item_code} - ${d.description}`,h("update:modelValue",d),h("item-selected",d),i.value=!1,k.value=-1},J=async()=>{(f.value.length>0||a.value.length>=3)&&(i.value=!0,await S())},O=d=>{if(i.value)switch(d.key){case"ArrowDown":d.preventDefault(),k.value=Math.min(k.value+1,f.value.length-1);break;case"ArrowUp":d.preventDefault(),k.value=Math.max(k.value-1,-1);break;case"Enter":d.preventDefault(),k.value>=0&&f.value[k.value]&&$(f.value[k.value]);break;case"Escape":i.value=!1,k.value=-1;break}},z=d=>{var y,p;!((y=L.value)!=null&&y.contains(d.target))&&!((p=A.value)!=null&&p.contains(d.target))&&(i.value=!1,k.value=-1)},G=()=>{a.value="",h("update:modelValue",""),h("item-selected",null),f.value=[],i.value=!1};return Ne(()=>{document.addEventListener("click",z),window.addEventListener("resize",B),window.addEventListener("scroll",B)}),De(()=>{document.removeEventListener("click",z),window.removeEventListener("resize",B),window.removeEventListener("scroll",B)}),D.modelValue&&typeof D.modelValue=="object"&&(a.value=`${D.modelValue.item_code} - ${D.modelValue.description}`),(d,y)=>(c(),_("div",{class:"relative dropdown-container",ref_key:"dropdownRef",ref:L},[t("div",Je,[Y(t("input",{ref_key:"inputRef",ref:A,"onUpdate:modelValue":y[0]||(y[0]=p=>a.value=p),type:"text",placeholder:M.sendingStoreId?M.placeholder:"Please select a sending store first",disabled:M.disabled,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10",onClick:J,onKeydown:O,onFocus:J},null,40,Ze),[[ke,a.value]]),a.value&&!M.disabled?(c(),_("button",{key:0,type:"button",class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:G},y[1]||(y[1]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):w("",!0),I.value?(c(),_("div",et,y[2]||(y[2]=[t("svg",{class:"animate-spin h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):w("",!0)]),N.value?(c(),_("div",tt,m(N.value),1)):w("",!0),i.value&&f.value.length>0?(c(),_("div",{key:1,class:"fixed z-dropdown bg-white border border-gray-300 rounded-md shadow-2xl max-h-60 overflow-y-auto",style:ue({top:s.value.top,left:s.value.left,width:s.value.width})},[(c(!0),_(se,null,oe(f.value,(p,q)=>(c(),_("div",{key:p.id,class:F(["px-3 py-2 cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0",{"bg-blue-50":k.value===q}]),onClick:T=>$(p),onMouseenter:T=>k.value=q},[t("div",ot,[t("div",rt,[t("div",nt,m(p.item_code),1),t("div",at,m(p.description),1),t("div",lt," UOM: "+m(p.alt_uom||p.uom),1)]),t("div",it,[t("div",{class:F(["text-sm font-medium",p.stock>0?"text-green-600":"text-red-600"])}," Stock: "+m(p.stock),3),p.stock>0?(c(),_("div",dt," Available ")):(c(),_("div",ut," Out of stock "))])])],42,st))),128))],4)):w("",!0),i.value&&!I.value&&a.value.length>=3&&f.value.length===0&&!N.value?(c(),_("div",{key:2,class:"fixed z-dropdown bg-white border border-gray-300 rounded-md shadow-2xl px-3 py-2 text-sm text-gray-500",style:ue({top:s.value.top,left:s.value.left,width:s.value.width})},' No items found matching "'+m(a.value)+'" ',5)):w("",!0),!i.value&&a.value.length<3&&a.value.length>0?(c(),_("div",ct," Type at least 3 characters to search ")):w("",!0)],512))}},_t=xe(mt,[["__scopeId","data-v-d67e96eb"]]),ft={class:"space-y-4"},vt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},pt={class:"flex items-center gap-3"},gt={class:"p-2 bg-blue-600 rounded-lg"},yt={class:"px-4 sm:px-6 py-4"},bt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ht={class:"space-y-2"},xt={key:0,class:"text-sm text-red-600"},wt={class:"space-y-2"},kt={key:0,class:"text-sm text-red-600"},Ct={key:1,class:"text-sm text-muted-foreground"},St={class:"space-y-2"},It={key:0,class:"text-sm text-red-600"},$t={class:"space-y-2 md:col-span-3"},qt={key:0,class:"text-sm text-red-600"},Et={class:"space-y-2 md:col-span-3"},Vt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Nt={class:"flex items-center gap-3"},Dt={class:"p-2 bg-green-600 rounded-lg"},At={class:"px-4 sm:px-6 py-4"},Ot={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ut={class:"space-y-2"},jt={key:0,class:"text-sm text-red-600"},Ft={class:"space-y-2"},Lt={class:"space-y-2"},Tt={class:"space-y-2"},Mt={key:0,class:"text-sm text-red-600"},Bt={class:"flex justify-end mt-4"},Pt={key:1,class:"text-sm text-muted-foreground mt-2"},Qt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Rt={class:"flex items-center gap-3"},zt={class:"p-2 bg-purple-600 rounded-lg"},Gt={class:"text-lg font-semibold text-gray-900"},Ht={class:"p-4 sm:p-6 space-y-4"},Kt={class:"flex flex-col gap-3"},Wt={class:"relative"},Yt={class:"flex flex-wrap gap-2"},Xt={class:"flex items-center gap-2"},Jt={class:"font-bold text-lg"},Zt={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 text-sm text-gray-600"},es={class:"flex items-center gap-2"},ts={class:"block md:hidden space-y-2"},ss={class:"flex items-start justify-between mb-2"},os={class:"flex-1"},rs={class:"font-medium text-gray-900"},ns=["onClick"],as={class:"grid grid-cols-2 gap-2 text-sm"},ls={class:"mt-1 flex items-center gap-1"},is={class:"font-medium"},ds=["onClick"],us={class:"mt-1"},cs={class:"mt-2 pt-2 border-t border-gray-100"},ms=["onClick"],_s={key:0,class:"text-center py-8 text-gray-500"},fs={class:"hidden md:block"},vs={class:"overflow-x-auto border border-gray-200 rounded-lg"},ps={class:"w-full text-sm"},gs={class:"divide-y divide-gray-200"},ys={class:"px-4 py-3 text-gray-900"},bs={class:"font-medium"},hs={class:"px-4 py-3 text-center"},xs={class:"flex items-center justify-center gap-2"},ws={class:"font-medium"},ks=["onClick"],Cs={key:0,class:"text-xs text-red-600 text-center"},Ss={key:1,class:"text-xs text-red-600 text-center"},Is={class:"px-4 py-3 text-gray-900"},$s={class:"px-4 py-3 text-center"},qs={class:"flex justify-center gap-1"},Es=["onClick"],Vs=["onClick"],Ns={key:0},Ds={colspan:"4",class:"px-4 py-8 text-center text-gray-500"},As={class:"flex flex-col items-center"},Os={key:0,class:"flex flex-col sm:flex-row items-center justify-between gap-3 pt-4 border-t border-gray-200"},Us={class:"text-sm text-gray-700"},js={class:"flex items-center gap-1"},Fs=["disabled"],Ls=["onClick","disabled"],Ts=["disabled"],Ms={key:1,class:"mt-4"},Bs={class:"flex flex-col sm:flex-row gap-3 justify-end pt-4 border-t border-gray-200"},Ps={class:"flex gap-2"},Qs={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Rs={class:"grid gap-4 py-4"},zs={class:"grid grid-cols-4 items-center gap-4"},Gs={__name:"Create",props:{branches:Array,items:Array,user_store_branch_id:Number},setup(M){const Q=M,D=Oe(),{toast:h}=He(),a=ce({store_branch_id:Q.user_store_branch_id,sending_store_branch_id:null,transfer_date:new Date().toISOString().split("T")[0],interco_reason:"",remarks:"",items:[]}),i=x([]);x(null),x(!1),x(null),x([]),x([]);const f=x({}),I=x(!1),N=x(null),k=x(null),A=x(!1),L=x([]),s=Ue({id:null,inventory_code:null,name:null,description:null,unit_of_measurement:null,base_uom:null,base_qty:null,quantity:null,cost:null,total_cost:null,uom:null}),S=ce({item:null}),{options:B}=Ke(Q.branches),{isEditQuantityModalOpen:R,formQuantity:$,openEditQuantityModal:J}=We(a,i,null),O=x({transferDetails:!0,addItem:!0,items:!0}),z=o=>{O.value[o]=!O.value[o]},G=x(""),d=x(1),y=x(10),p=V(()=>{if(!G.value)return i.value;const o=G.value.toLowerCase();return i.value.filter(e=>e.description.toLowerCase().includes(o)||e.item_code.toLowerCase().includes(o)||e.uom&&e.uom.toLowerCase().includes(o))}),q=V(()=>Math.ceil(p.value.length/y.value)),T=V(()=>{const o=(d.value-1)*y.value,e=o+y.value;return p.value.slice(o,e)}),re=V(()=>{const o=q.value,e=d.value,g=2,r=[];for(let u=Math.max(2,e-g);u<=Math.min(o-1,e+g);u++)r.push(u);return e-g>2&&r.unshift("..."),e+g<o-1&&r.push("..."),o>1&&r.unshift(1),o>1&&o!==1&&r.push(o),r.filter(u=>u!=="..."||r.indexOf(u)===r.lastIndexOf(u))});V(()=>Q.branches.find(o=>o.id===a.sending_store_branch_id)),V(()=>Q.branches.find(o=>o.id===a.store_branch_id));const Z=V(()=>i.value.reduce((o,e)=>o+(e.quantity_ordered||0),0));V(()=>i.value.reduce((o,e)=>o+(e.quantity_ordered||0)*(e.cost_per_quantity||0),0)),V(()=>a.sending_store_branch_id&&a.store_branch_id&&a.sending_store_branch_id!==a.store_branch_id);const ne=V(()=>a.sending_store_branch_id&&a.store_branch_id&&a.sending_store_branch_id!==a.store_branch_id),P=V(()=>a.store_branch_id?B.value.filter(o=>o.value!==a.store_branch_id):[]),H=V(()=>!a.store_branch_id),Ce=()=>{if(S.clearErrors(),!S.item){S.setError("item","Item field is required");return}if(isNaN(Number(s.quantity))||Number(s.quantity)<1){S.setError("quantity","Quantity must be at least 1 and a valid number");return}if(s.cost===null||Number(s.cost)===0){h.add({severity:"error",summary:"Validation Error",detail:"Item cost cannot be zero or empty.",life:5e3});return}const o=[];if(s.inventory_code||o.push("Item code is missing"),s.unit_of_measurement||o.push("UOM is missing"),(!s.quantity||Number(s.quantity)<1)&&o.push("Valid quantity is required"),(s.cost===null||isNaN(Number(s.cost)))&&o.push("Item cost is invalid"),s.description||(s.description="No description"),o.length>0){h.add({severity:"error",summary:"Validation Error",detail:o.join("; "),life:5e3});return}const e=i.value.findIndex(u=>u.item_code===s.inventory_code),g=Number(s.quantity),r=Number(s.cost);if(e!==-1){const u=i.value[e],v=u.quantity_ordered+g,E=parseFloat((v*r).toFixed(2));u.quantity_ordered=v,u.total_cost=E,u.stock===void 0&&s.stock!==void 0&&(u.stock=s.stock)}else{const u={id:Date.now(),item_code:String(s.inventory_code),description:s.description||"No description",unit_of_measurement:s.unit_of_measurement,alt_uom:s.unit_of_measurement,quantity_ordered:parseFloat(Number(s.quantity).toFixed(2)),cost_per_quantity:Number(s.cost),uom:s.uom,stock:s.stock||0,total_cost:parseFloat((Number(s.quantity)*Number(s.cost)).toFixed(2))};i.value.push(u)}Object.keys(s).forEach(u=>{s[u]=null}),N.value=null,h.add({severity:"success",summary:"Success",detail:"Item added successfully.",life:5e3}),S.item=null,S.clearErrors()},de=o=>{i.value.splice(o,1)},ee=(o,e)=>{J(o.id,o.quantity_ordered)},Se=()=>{let o=i.value.findIndex(e=>e.id===$.id);if(o===-1&&(o=i.value.findIndex(e=>e.item_code===$.item_code||e.description===$.description)),o!==-1){const e=Number($.quantity),g=i.value[o];if(isNaN(e)||e<=0){$.errors.quantity="Quantity must be a positive number.",h.add({severity:"error",summary:"Validation Error",detail:"Quantity must be a positive number.",life:3e3});return}const r=Number(g.cost_per_quantity);if(isNaN(r)){h.add({severity:"error",summary:"Calculation Error",detail:"Item cost is invalid. Cannot update total cost.",life:3e3});return}g.quantity_ordered=parseFloat(e.toFixed(2)),g.total_cost=parseFloat((e*r).toFixed(2)),i.value=[...i.value],h.add({severity:"success",summary:"Success",detail:"Quantity Updated.",life:3e3}),R.value=!1}else h.add({severity:"error",summary:"Error",detail:`Item not found in transfer list. Looking for ID: ${$.id}, Item Code: ${$.item_code}, Description: ${$.description}`,life:5e3})},Ie=()=>{console.log("üîç Validating form...");const o={};console.log("üìã Checking store selection..."),a.sending_store_branch_id?console.log("‚úÖ Sending store OK:",a.sending_store_branch_id):(console.log("‚ùå Sending store missing"),o.sending_store_branch_id="Sending store is required"),a.store_branch_id?console.log("‚úÖ Receiving store OK:",a.store_branch_id):(console.log("‚ùå Receiving store missing"),o.store_branch_id="Receiving store is required"),a.sending_store_branch_id===a.store_branch_id&&(console.log("‚ùå Stores are the same"),o.store_selection="Sending and receiving stores must be different"),a.transfer_date?console.log("‚úÖ Transfer date OK:",a.transfer_date):(console.log("‚ùå Transfer date missing"),o.transfer_date="Transfer date is required"),!a.interco_reason||!a.interco_reason.trim()?(console.log("‚ùå Transfer reason missing"),o.interco_reason="Reason for transfer is required"):console.log("‚úÖ Transfer reason OK:",a.interco_reason),console.log("üì¶ Checking items..."),i.value.length===0?(console.log("‚ùå No items found"),o.items="At least one item is required"):console.log(`‚úÖ Found ${i.value.length} items`),i.value.forEach((g,r)=>{console.log(`üîç Validating item ${r+1}:`,{item_code:g.item_code,quantity:g.quantity_ordered,stock:g.stock}),(!g.quantity_ordered||g.quantity_ordered<1)&&(console.log(`‚ùå Item ${r+1} quantity invalid`),o[`item_${r}_quantity`]="Quantity must be at least 1"),g.quantity_ordered>(g.stock||0)&&(console.log(`‚ùå Item ${r+1} insufficient stock`),o[`item_${r}_stock`]=`Insufficient stock. Only ${g.stock||0} available`)}),f.value=o;const e=Object.keys(o).length===0;return console.log(`üèÅ Validation ${e?"PASSED":"FAILED"}`,{errorsCount:Object.keys(o).length,errors:o}),e},$e=()=>{if(console.log("üöÄ SubmitForm called - Starting form submission"),!Ie()){console.log("‚ùå Form validation failed"),h.add({severity:"error",summary:"Validation Error",detail:"Please fix all validation errors before submitting.",life:5e3});return}if(i.value.length===0){console.log("‚ùå No items to submit"),h.add({severity:"error",summary:"No Items",detail:"Please add at least one item to the transfer before submitting.",life:5e3});return}console.log("‚úÖ Form validation passed, showing confirmation dialog"),D.require({message:"Are you sure you want to create this interco transfer?",header:"Confirm Interco Transfer Creation",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-danger",rejectLabel:"No",acceptLabel:"Yes",acceptClass:"p-button-success",accept:()=>{qe()},reject:()=>{console.log("‚ùå User cancelled transfer creation"),h.add({severity:"info",summary:"Cancelled",detail:"Interco transfer creation was cancelled.",life:3e3})}})},qe=()=>{console.log("üîÑ Executing form submission..."),console.log("üìä Form data:",{store_branch_id:a.store_branch_id,sending_store_branch_id:a.sending_store_branch_id,interco_reason:a.interco_reason,items_count:i.value.length});const o={store_branch_id:a.store_branch_id,sending_store_branch_id:a.sending_store_branch_id,transfer_date:a.transfer_date,interco_reason:a.interco_reason,remarks:a.remarks||"",items:i.value.map((e,g)=>{const r={item_code:String(e.item_code),quantity_ordered:parseInt(Number(e.quantity_ordered)),quantity_committed:parseInt(Number(e.quantity_ordered)),cost_per_quantity:Number(e.cost_per_quantity||1),uom:String(e.unit_of_measurement||e.uom||"PCS"),remarks:e.remarks||""};return console.log(`üì¶ Item ${g+1}:`,r),r})};console.log("üì§ Submitting data to backend:",o),I.value=!0,_e.post(route("interco.store"),o,{onStart:()=>{console.log("üîÑ Request started")},onSuccess:e=>{console.log("‚úÖ Request successful - Interco order created"),I.value=!1,h.add({severity:"success",summary:"Success",detail:"Interco transfer request created successfully!",life:5e3})},onError:e=>{if(console.error("‚ùå Form submission errors:",e),f.value=e,e.error)h.add({severity:"error",summary:"Submission Failed",detail:e.error,life:8e3});else if(e.items)h.add({severity:"error",summary:"Item Validation Error",detail:`Issue with items: ${e.items}`,life:8e3});else if(e.store_branch_id)h.add({severity:"error",summary:"Store Selection Error",detail:`Receiving store: ${e.store_branch_id}`,life:8e3});else if(e.sending_store_branch_id)h.add({severity:"error",summary:"Store Selection Error",detail:`Sending store: ${e.sending_store_branch_id}`,life:8e3});else{const g=Object.entries(e).map(([r,u])=>`${r}: ${u}`).join("; ");h.add({severity:"error",summary:"Validation Failed",detail:g,life:1e4})}I.value=!1},onCancel:()=>{console.log("‚èπÔ∏è Request was cancelled"),I.value=!1},onFinish:()=>{console.log("üèÅ Request finished"),I.value=!1},preserveState:!0,preserveScroll:!0})},Ee=()=>{try{if(i.value.length===0){h.add({severity:"info",summary:"Info",detail:"No items to clear.",life:3e3});return}D.require({message:"Are you sure you want to remove ALL items from the transfer?",header:"Confirm Clear All",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Cancel",acceptLabel:"Clear All",acceptClass:"p-button-danger",accept:()=>{i.value=[],h.add({severity:"success",summary:"Success",detail:"All items have been removed from the transfer.",life:3e3})},reject:()=>{}})}catch(o){console.error("Error in clearAllItems:",o),window.confirm("Are you sure you want to remove ALL items from the transfer?")&&(i.value=[])}};X(()=>a.store_branch_id,o=>{N.value=null,k.value=null,Object.keys(s).forEach(e=>{s[e]=null}),a.sending_store_branch_id===o&&(a.sending_store_branch_id=null),i.value=[],L.value=[]}),X(()=>a.sending_store_branch_id,o=>{o?L.value=[]:L.value=[],k.value=null,Object.keys(s).forEach(e=>{s[e]=null}),i.value=i.value.filter(e=>e.stock>0),N.value=null,k.value=null,Object.keys(s).forEach(e=>{s[e]=null})}),X(N,async o=>{if(o){A.value=!0,S.item=o;const[e,g]=o.split("|");e==="916A2C"&&console.log("üéØ DEBUG: 916A2C selected in productId watch:",{itemCode:e,altUOM:g,fullItemCode:o,sendingStoreId:a.sending_store_branch_id});try{const r=a.sending_store_branch_id;if(console.log("üîç DEBUG: Fetching item details:",{itemCode:e,altUOM:g,sendingStoreId:r}),!r){h.add({severity:"error",summary:"Error",detail:"Failed to determine sending store.",life:5e3}),A.value=!1;return}const u=await we.get(route("interco.get-item-details",{itemCode:e,altUOM:g,sendingStoreId:r})),v=u.data.item;if(console.log("üìä DEBUG: API response:",{status:u.status,hasData:!!v,result:v}),v)s.inventory_code=String(v.item_code),s.description=v.description||"No description",s.unit_of_measurement=v.alt_uom||v.uom,s.cost=Number(v.cost_per_quantity),s.uom=v.uom,s.stock=v.stock||0,e==="916A2C"&&console.log("üéØ DEBUG: 916A2C API success - Product details updated:",{inventory_code:s.inventory_code,description:s.description,unit_of_measurement:s.unit_of_measurement,stock:s.stock,original_api_description:v.description,fallback_used:v.description===null||v.description===void 0}),console.log("‚úÖ DEBUG: Product details updated:",{inventory_code:s.inventory_code,description:s.description,unit_of_measurement:s.unit_of_measurement,stock:s.stock});else{const E=L.value.find(j=>j.value===o);if(console.log("üîÑ DEBUG: Using fallback data:",{hasSelectedOption:!!E,hasOriginalData:!!(E&&E._originalData),originalData:E==null?void 0:E._originalData}),E&&E._originalData){const j=E._originalData;s.inventory_code=String(j.item_code),s.description=j.description||"No description",s.unit_of_measurement=j.alt_uom||j.uom,s.cost=Number(j.cost_per_quantity||0),s.uom=j.uom,s.stock=0,e==="916A2C"&&console.log("üéØ DEBUG: 916A2C fallback - Product details set:",{inventory_code:s.inventory_code,description:s.description,unit_of_measurement:s.unit_of_measurement,original_fallback_description:j.description,selected_option_label:E.label}),console.log("‚úÖ DEBUG: Fallback product details set:",{inventory_code:s.inventory_code,description:s.description,unit_of_measurement:s.unit_of_measurement})}else console.log("‚ùå DEBUG: No fallback data available"),h.add({severity:"error",summary:"Error",detail:"Item details not found.",life:5e3})}}catch(r){console.log("‚ö†Ô∏è DEBUG: API call failed, using fallback:",{error:r.message,itemCode:e});const u=L.value.find(v=>v.value===o);if(u&&u._originalData){const v=u._originalData;s.inventory_code=String(v.item_code),s.description=v.description||"No description",s.unit_of_measurement=v.alt_uom||v.uom,s.cost=Number(v.cost_per_quantity||0),s.uom=v.uom,s.stock=0,console.log("‚úÖ DEBUG: Catch fallback product details set:",{inventory_code:s.inventory_code,description:s.description})}else console.log("‚ùå DEBUG: No fallback data available in catch block"),h.add({severity:"error",summary:"Error",detail:"Failed to load item details.",life:5e3})}finally{A.value=!1}}else Object.keys(s).forEach(e=>{s[e]=null})},{deep:!0});const Ve=o=>{if(!o){Object.keys(s).forEach(e=>{s[e]=null}),k.value=null;return}console.log("üéØ DEBUG: Auto-complete item selected:",{item_code:o.item_code,description:o.description,alt_uom:o.alt_uom,stock:o.stock}),s.id=o.id,s.inventory_code=String(o.item_code),s.description=o.description||"No description",s.unit_of_measurement=o.alt_uom||o.uom,s.cost=Number(o.cost_per_quantity||1),s.uom=o.uom,s.stock=o.stock||0,k.value=o,S.item=o.item_code,(o.item_code==="916A2C"||o.item_code==="397A2D")&&console.log(`üéØ DEBUG: ${o.item_code} auto-complete selected - Product details set:`,{inventory_code:s.inventory_code,description:s.description,unit_of_measurement:s.unit_of_measurement,stock:s.stock,item_code:o.item_code}),console.log("‚úÖ DEBUG: Auto-complete product details set:",{inventory_code:s.inventory_code,description:s.description,unit_of_measurement:s.unit_of_measurement,stock:s.stock})};return(o,e)=>{const g=je("Layout");return c(),me(g,{heading:"Create Store Transfer"},{"header-actions":b(()=>[l(n(K),{variant:"outline",onClick:e[0]||(e[0]=r=>n(_e).get(o.route("interco.index")))},{default:b(()=>[l(n(Ye),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=C(" Back to Transfers "))]),_:1})]),default:b(()=>[t("div",ft,[t("div",vt,[t("button",{onClick:e[1]||(e[1]=r=>z("transferDetails")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200 flex items-center justify-between text-left hover:from-blue-100 hover:to-blue-200 transition-colors"},[t("div",pt,[t("div",gt,[l(n(te),{class:"w-5 h-5 text-white"})]),e[21]||(e[21]=t("div",null,[t("h2",{class:"text-lg font-semibold text-gray-900"},"Transfer Details"),t("p",{class:"text-sm text-gray-600"},"Basic transfer information")],-1))]),l(n(ae),{class:F(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":O.value.transferDetails}])},null,8,["class"])]),Y(t("div",yt,[t("div",bt,[t("div",ht,[l(n(U),{for:"receiving_store"},{default:b(()=>e[22]||(e[22]=[C("Receiving Store *")])),_:1}),l(n(fe),{filter:"",placeholder:"Select receiving store",modelValue:n(a).store_branch_id,"onUpdate:modelValue":e[2]||(e[2]=r=>n(a).store_branch_id=r),options:n(B),optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"]),f.value.store_branch_id?(c(),_("p",xt,m(f.value.store_branch_id),1)):w("",!0)]),t("div",wt,[l(n(U),{for:"sending_store"},{default:b(()=>e[23]||(e[23]=[C("Sending Store *")])),_:1}),l(n(fe),{filter:"",placeholder:"Select sending store",modelValue:n(a).sending_store_branch_id,"onUpdate:modelValue":e[3]||(e[3]=r=>n(a).sending_store_branch_id=r),options:P.value,disabled:H.value,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options","disabled"]),f.value.sending_store_branch_id?(c(),_("p",kt,m(f.value.sending_store_branch_id),1)):w("",!0),n(a).store_branch_id?w("",!0):(c(),_("p",Ct," Select a receiving store first "))]),t("div",St,[l(n(U),{for:"transfer_date"},{default:b(()=>e[24]||(e[24]=[C("Transfer Date")])),_:1}),l(n(W),{id:"transfer_date",type:"date",modelValue:n(a).transfer_date,"onUpdate:modelValue":e[4]||(e[4]=r=>n(a).transfer_date=r),class:"w-full"},null,8,["modelValue"]),f.value.transfer_date?(c(),_("p",It,m(f.value.transfer_date),1)):w("",!0)]),t("div",$t,[l(n(U),{for:"reason"},{default:b(()=>e[25]||(e[25]=[C("Reason for Transfer *")])),_:1}),l(n(ve),{id:"reason",modelValue:n(a).interco_reason,"onUpdate:modelValue":e[5]||(e[5]=r=>n(a).interco_reason=r),placeholder:"Explain why this transfer is needed...",rows:"3"},null,8,["modelValue"]),f.value.interco_reason?(c(),_("p",qt,m(f.value.interco_reason),1)):w("",!0)]),t("div",Et,[l(n(U),{for:"remarks"},{default:b(()=>e[26]||(e[26]=[C("Remarks (Optional)")])),_:1}),l(n(ve),{id:"remarks",modelValue:n(a).remarks,"onUpdate:modelValue":e[6]||(e[6]=r=>n(a).remarks=r),placeholder:"Additional notes or instructions...",rows:"2"},null,8,["modelValue"])])])],512),[[le,O.value.transferDetails]])]),t("div",Vt,[t("button",{onClick:e[7]||(e[7]=r=>z("addItem")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-green-50 to-green-100 border-b border-green-200 flex items-center justify-between text-left hover:from-green-100 hover:to-green-200 transition-colors"},[t("div",Nt,[t("div",Dt,[l(n(Fe),{class:"w-5 h-5 text-white"})]),e[27]||(e[27]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900"},"Add Items"),t("p",{class:"text-sm text-gray-600"},"Add items to your transfer")],-1))]),l(n(ae),{class:F(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":O.value.addItem}])},null,8,["class"])]),Y(t("div",At,[f.value.store_selection?(c(),me(n(pe),{key:0,class:"mb-4"},{default:b(()=>[l(n(be),{class:"w-4 h-4"}),l(n(ge),null,{default:b(()=>[C(m(f.value.store_selection),1)]),_:1})]),_:1})):w("",!0),t("div",Ot,[t("div",Ut,[l(n(U),{class:"text-sm font-medium text-gray-700"},{default:b(()=>e[28]||(e[28]=[C("Item")])),_:1}),l(_t,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=r=>k.value=r),"sending-store-id":n(a).sending_store_branch_id,placeholder:"Type at least 3 characters to search for items...",disabled:!n(a).sending_store_branch_id||A.value,onItemSelected:Ve},null,8,["modelValue","sending-store-id","disabled"]),n(S).errors.item?(c(),_("p",jt,m(n(S).errors.item),1)):w("",!0)]),t("div",Ft,[l(n(U),{class:"text-sm font-medium text-gray-700"},{default:b(()=>e[29]||(e[29]=[C("UOM")])),_:1}),l(n(W),{type:"text",disabled:"",modelValue:s.unit_of_measurement,"onUpdate:modelValue":e[9]||(e[9]=r=>s.unit_of_measurement=r),class:"flex h-10 w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm"},null,8,["modelValue"])]),t("div",Lt,[l(n(U),{class:"text-sm font-medium text-gray-700"},{default:b(()=>e[30]||(e[30]=[C("SOH Stock")])),_:1}),l(n(W),{type:"text",disabled:"",value:s.stock||0,class:"flex h-10 w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm"},null,8,["value"])]),t("div",Tt,[l(n(U),{class:"text-sm font-medium text-gray-700"},{default:b(()=>e[31]||(e[31]=[C("Quantity")])),_:1}),l(n(W),{type:"number",modelValue:s.quantity,"onUpdate:modelValue":e[10]||(e[10]=r=>s.quantity=r),class:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm"},null,8,["modelValue"]),n(S).errors.quantity?(c(),_("p",Mt,m(n(S).errors.quantity),1)):w("",!0)])]),t("div",Bt,[l(n(K),{onClick:Ce,disabled:A.value||!n(a).sending_store_branch_id},{default:b(()=>e[32]||(e[32]=[C(" Add to Transfer ")])),_:1},8,["disabled"])]),n(a).sending_store_branch_id?w("",!0):(c(),_("p",Pt," Select a sending store to add items "))],512),[[le,O.value.addItem]])]),t("div",Qt,[t("button",{onClick:e[11]||(e[11]=r=>z("items")),class:"w-full px-4 sm:px-6 py-4 bg-gradient-to-r from-purple-50 to-purple-100 border-b border-purple-200 flex items-center justify-between text-left hover:from-purple-100 hover:to-purple-200 transition-colors"},[t("div",Rt,[t("div",zt,[l(n(te),{class:"w-5 h-5 text-white"})]),t("div",null,[t("h3",Gt,"Transfer Items ("+m(i.value.length)+")",1),e[33]||(e[33]=t("p",{class:"text-sm text-gray-600"},"Manage your transfer items and quantities",-1))])]),l(n(ae),{class:F(["w-5 h-5 text-gray-600 transition-transform duration-200",{"rotate-180":O.value.items}])},null,8,["class"])]),Y(t("div",Ht,[t("div",Kt,[t("div",Wt,[Y(t("input",{type:"text","onUpdate:modelValue":e[12]||(e[12]=r=>G.value=r),placeholder:"Search items by code or description...",class:"w-full h-10 pl-10 pr-4 rounded-md border border-gray-300 bg-white text-sm shadow-sm transition-colors placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"},null,512),[[ke,G.value]]),e[34]||(e[34]=t("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),t("div",Yt,[t("div",Xt,[e[35]||(e[35]=t("span",{class:"text-sm text-gray-600"},"Total Quantity:",-1)),t("span",Jt,m(Z.value),1)])])]),t("div",Zt,[t("span",null,m(p.value.length)+" items found",1),t("div",es,[e[36]||(e[36]=t("span",null,"Items per page:",-1)),t("button",{onClick:e[13]||(e[13]=r=>y.value=10),class:F(["px-2 py-1 rounded text-xs font-medium transition-colors",y.value===10?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"])}," 10 ",2),t("button",{onClick:e[14]||(e[14]=r=>y.value=25),class:F(["px-2 py-1 rounded text-xs font-medium transition-colors",y.value===25?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"])}," 25 ",2),t("button",{onClick:e[15]||(e[15]=r=>y.value=50),class:F(["px-2 py-1 rounded text-xs font-medium transition-colors",y.value===50?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"])}," 50 ",2)])]),t("div",ts,[(c(!0),_(se,null,oe(T.value,(r,u)=>(c(),_("div",{key:r.id,class:"bg-white border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow"},[t("div",ss,[t("div",os,[t("div",rs,m(r.item_code)+" - "+m(r.description)+" ("+m(r.alt_uom||r.uom)+")",1)]),t("button",{onClick:v=>de(u),class:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600 hover:border-red-300 flex-shrink-0 ml-2 rounded-md border border-gray-300"},[l(n(ie),{class:"w-4 h-4"})],8,ns)]),t("div",as,[t("div",null,[e[37]||(e[37]=t("span",{class:"text-gray-600"},"Quantity:",-1)),t("div",ls,[t("span",is,m(r.quantity_ordered),1),t("button",{onClick:v=>ee(r,u),class:"text-blue-600 hover:text-blue-800"},[l(n(he),{class:"w-3 h-3"})],8,ds)])]),t("div",null,[e[38]||(e[38]=t("span",{class:"text-gray-600"},"SOH Stock:",-1)),t("div",us,[l(ye,{available:Number(r.stock||0),requested:r.quantity_ordered,size:"small"},null,8,["available","requested"])])])]),t("div",cs,[t("button",{onClick:v=>ee(r,u),class:"w-full text-sm text-blue-600 hover:text-blue-800 font-medium"}," Edit Quantity ",8,ms)])]))),128)),T.value.length===0?(c(),_("div",_s,[l(n(te),{class:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e[39]||(e[39]=t("p",null,"No items found. Try searching or add items manually.",-1))])):w("",!0)]),t("div",fs,[t("div",vs,[t("table",ps,[e[41]||(e[41]=t("thead",{class:"bg-gray-50 border-b border-gray-200"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left font-medium text-gray-900"},"Description"),t("th",{class:"px-4 py-3 text-center font-medium text-gray-900"},"Quantity"),t("th",{class:"px-4 py-3 text-left font-medium text-gray-900"},"SOH Stock"),t("th",{class:"px-4 py-3 text-center font-medium text-gray-900"},"Actions")])],-1)),t("tbody",gs,[(c(!0),_(se,null,oe(T.value,(r,u)=>(c(),_("tr",{key:r.id,class:"hover:bg-gray-50"},[t("td",ys,[t("div",null,[t("p",bs,m(r.item_code)+" - "+m(r.description)+" ("+m(r.alt_uom||r.uom)+")",1)])]),t("td",hs,[t("div",xs,[t("span",ws,m(r.quantity_ordered),1),t("button",{onClick:v=>ee(r,u),class:"text-blue-600 hover:text-blue-800"},[l(n(he),{class:"w-3 h-3"})],8,ks)]),f.value[`item_${u}_quantity`]?(c(),_("p",Cs,m(f.value[`item_${u}_quantity`]),1)):w("",!0),f.value[`item_${u}_stock`]?(c(),_("p",Ss,m(f.value[`item_${u}_stock`]),1)):w("",!0)]),t("td",Is,[l(ye,{available:Number(r.stock||0),requested:r.quantity_ordered,size:"small"},null,8,["available","requested"])]),t("td",$s,[t("div",qs,[t("button",{onClick:v=>ee(r,u),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Edit ",8,Es),t("button",{onClick:v=>de(u),class:"text-red-600 hover:text-red-800"},[l(n(ie),{class:"w-4 h-4"})],8,Vs)])])]))),128)),T.value.length===0?(c(),_("tr",Ns,[t("td",Ds,[t("div",As,[l(n(te),{class:"w-12 h-12 text-gray-400 mb-2"}),e[40]||(e[40]=t("p",null,"No items found. Try searching or add items manually.",-1))])])])):w("",!0)])])])]),p.value.length>y.value?(c(),_("div",Os,[t("div",Us," Showing "+m((d.value-1)*y.value+1)+" to "+m(Math.min(d.value*y.value,p.value.length))+" of "+m(p.value.length)+" items ",1),t("div",js,[t("button",{onClick:e[16]||(e[16]=r=>d.value--),disabled:d.value===1,class:"h-8 w-8 p-0 rounded-md border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[l(n(Xe),{class:"w-4 h-4"})],8,Fs),(c(!0),_(se,null,oe(re.value,r=>(c(),_("button",{key:r,onClick:u=>d.value=r==="..."?null:d.value=r,disabled:r==="...",class:F(["h-8 w-8 p-0 rounded-md text-sm font-medium transition-colors",d.value===r?"bg-blue-600 text-white":r==="..."?"text-gray-500 cursor-default":"border border-gray-300 hover:bg-gray-50"])},m(r),11,Ls))),128)),t("button",{onClick:e[17]||(e[17]=r=>d.value++),disabled:d.value===q.value,class:"h-8 w-8 p-0 rounded-md border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[l(n(Le),{class:"w-4 h-4"})],8,Ts)])])):w("",!0),f.value.items?(c(),_("div",Ms,[l(n(pe),{variant:"destructive"},{default:b(()=>[l(n(be),{class:"w-4 h-4"}),l(n(ge),null,{default:b(()=>[C(m(f.value.items),1)]),_:1})]),_:1})])):w("",!0),t("div",Bs,[t("div",Ps,[l(n(K),{onClick:Ee,variant:"outline",class:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:i.value.length===0},{default:b(()=>[l(n(ie),{class:"w-4 h-4 mr-2"}),e[42]||(e[42]=C(" Clear All "))]),_:1},8,["disabled"])]),l(n(K),{onClick:$e,disabled:I.value||!ne.value,class:"min-w-[120px]"},{default:b(()=>[I.value?(c(),_("svg",Qs,e[43]||(e[43]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):w("",!0),C(" "+m(I.value?"Creating...":"Create Transfer"),1)]),_:1},8,["disabled"])])],512),[[le,O.value.items]])])]),l(n(ze),{open:n(R),"onUpdate:open":e[19]||(e[19]=r=>Re(R)?R.value=r:null)},{default:b(()=>[l(n(Te),{class:"sm:max-w-[425px]"},{default:b(()=>[l(n(Me),null,{default:b(()=>[l(n(Be),null,{default:b(()=>e[44]||(e[44]=[C("Edit Quantity")])),_:1}),l(n(Pe),null,{default:b(()=>e[45]||(e[45]=[C(" Make changes to the quantity here. Click save when you're done. ")])),_:1})]),_:1}),t("div",Rs,[t("div",zs,[l(n(U),{for:"quantity",class:"text-right"},{default:b(()=>e[46]||(e[46]=[C(" Quantity ")])),_:1}),l(n(W),{id:"quantity",type:"number",class:"col-span-3",modelValue:n($).quantity,"onUpdate:modelValue":e[18]||(e[18]=r=>n($).quantity=r)},null,8,["modelValue"])])]),l(n(Qe),null,{default:b(()=>[l(n(K),{onClick:Se},{default:b(()=>e[47]||(e[47]=[C("Save changes")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}},ao=xe(Gs,[["__scopeId","data-v-4590ee8e"]]);export{ao as default};
