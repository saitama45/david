import{f as ye,T as I,r,o as x,c as be,w as t,a as l,b as a,g as b,u as n,bT as f,t as d,d as q,e as Ve,F as Ce,h as ge,i as Te}from"./app-p8ycGfai.js";import{u as H}from"./useSelectOptions-Ci2WUICq.js";import{u as ve}from"./useToast-BAk2IYqi.js";const xe={class:"space-y-3"},De=["onClick"],Se=["onClick"],ke={key:0},Pe={__name:"Create",props:{menus:{type:Object,required:!0},branches:{type:Object,required:!0}},setup(F){const P=ye(),{toast:U}=ve(),o=I({store_branch_id:null,order_number:null,transaction_period:null,transaction_date:null,cashier_id:null,order_type:null,sub_total:0,total_amount:0,tax_amount:0,payment_type:null,discount_amount:0,discount_type:null,service_charge:0,remarks:"",items:[]}),s=I({id:null,name:null,quantity:null,price:null,total_price:null}),j=()=>{if(s.id===null){s.setError("id","Item field is required");return}if(s.quantity<1){s.setError("quantity","Quantity must be atleast 1");return}console.log(s.id);const p=o.items.findIndex(e=>e.id===s.id);if(p===-1)s.total_price=parseFloat(s.quantity*s.price),o.items.push({...s});else{const e=o.items[p];e.quantity+=s.quantity,e.total_price=parseFloat(e.quantity*s.price)}s.reset(),s.clearErrors()},{options:A}=H(F.menus),{options:N}=H(F.branches);watch(()=>s.id,p=>{p!=null&&(s.clearErrors(),axios.get(route("menu-item.show",p)).then(e=>e.data).then(e=>{s.name=e.name,s.price=e.price}).catch(e=>console.log(e)))});const M=p=>{const e=o.items.findIndex(_=>_.id===p);o.items[e].quantity+=1,o.items[e].total_price=parseFloat(o.items[e].quantity*o.items[e].price).toFixed(2)},Q=computed(()=>{const p=o.items.reduce((e,_)=>e+parseFloat(_.total_price),0).toFixed(2);return o.sub_total=p,o.total_amount=p-o.discount_amount+o.service_charge,p}),R=p=>{const e=o.items.findIndex(_=>_.id===p);if(o.items[e].quantity-=1,o.items[e].quantity<1){o.items=o.items.filter(_=>_.id!==p);return}o.items[e].total_price=parseFloat(o.items[e].quantity*o.items[e].price).toFixed(2)},$=p=>{P.require({message:"Are you sure you want to remove this item from your orders?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Remove",severity:"danger"},accept:()=>{o.items=o.items.filter(e=>e.id!==p),U.add({severity:"success",summary:"Confirmed",detail:"Item Removed",life:3e3})}})},X=()=>{if(o.items.length<1){U.add({severity:"error",summary:"Error",detail:"Please select at least one item before proceeding.",life:5e3});return}P.require({message:"Are you sure you want to create this record?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{o.post(route("usage-records.store"),{onSuccess:()=>{console.log("success")},onError:()=>{console.log("error")}})}})},G=[{value:"breakfast",label:"Breakfast"},{value:"lunch",label:"Lunch"},{value:"dinner",label:"Dinner"}],z=[{value:"dine_in",label:"Dine In"},{value:"take_out",label:"Take Out"}],J=[{value:"cash",label:"Cash"},{value:"credit_card",label:"Credit Card"},{value:"debit_card",label:"Debit Card"},{value:"gift_card",label:"Gift Card"}],D=I({store_transactions_file:null}),y=ref(!1),V=ref(!1),K=()=>{V.value=!0},W=()=>{y.value=!0,D.post(route("usage-records.import"),{onSuccess:()=>{y.value=!1,V.value=!1},onError:()=>{y.value=!1}})};return(p,e)=>{const _=r("CardTitle"),L=r("CardDescription"),i=r("LabelXS"),C=r("Select"),m=r("InputContainer"),c=r("Input"),Y=r("DatePicker"),Z=r("Textarea"),B=r("CardHeader"),S=r("Card"),w=r("DivFlexCol"),h=r("CardContent"),k=r("Button"),ee=r("CardFooter"),O=r("SpanBold"),v=r("DivFlexCenter"),g=r("TH"),le=r("TableHead"),T=r("TD"),te=r("Minus"),oe=r("Plus"),ne=r("DeleteButton"),ae=r("TableBody"),ue=r("Table"),re=r("TableContainer"),se=r("DialogTitle"),de=r("DialogDescription"),ie=r("DialogHeader"),me=r("Loading"),pe=r("DialogFooter"),fe=r("DialogContent"),_e=r("Dialog"),ce=r("Layout");return x(),be(ce,{heading:"Create New Transaction",hasButton:!0,buttonName:"Import Store Transactions",handleClick:K},{default:t(()=>[l(S,{class:"p-5 grid sm:grid-cols-3 grid-cols-1 gap-5"},{default:t(()=>[l(S,{class:"sm:col-span-1 col-span-2"},{default:t(()=>[l(B,null,{default:t(()=>[l(_,null,{default:t(()=>e[18]||(e[18]=[a("Transaction Details")])),_:1}),l(L,null,{default:t(()=>e[19]||(e[19]=[a(" Please input all the required fields. ")])),_:1}),b("section",xe,[l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[20]||(e[20]=[a("Store Branch")])),_:1}),l(C,{filter:"",placeholder:"Select a branch",options:n(N),optionLabel:"label",optionValue:"value",modelValue:n(o).store_branch_id,"onUpdate:modelValue":e[0]||(e[0]=u=>n(o).store_branch_id=u)},null,8,["options","modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.store_branch_id),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[21]||(e[21]=[a("Order Number")])),_:1}),l(c,{modelValue:n(o).order_number,"onUpdate:modelValue":e[1]||(e[1]=u=>n(o).order_number=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.order_number),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[22]||(e[22]=[a("Transaction Period")])),_:1}),l(C,{filter:"",placeholder:"Select a period",options:G,optionLabel:"label",optionValue:"value",modelValue:n(o).transaction_period,"onUpdate:modelValue":e[2]||(e[2]=u=>n(o).transaction_period=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.transaction_period),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[23]||(e[23]=[a("Transaction Date")])),_:1}),l(Y,{modelValue:n(o).transaction_date,"onUpdate:modelValue":e[3]||(e[3]=u=>n(o).transaction_date=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.transaction_date),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[24]||(e[24]=[a("Cashier Id")])),_:1}),l(c,{modelValue:n(o).cashier_id,"onUpdate:modelValue":e[4]||(e[4]=u=>n(o).cashier_id=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.cashier_id),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[25]||(e[25]=[a("Order Type")])),_:1}),l(C,{filter:"",placeholder:"Select a type",options:z,optionLabel:"label",optionValue:"value",modelValue:n(o).order_type,"onUpdate:modelValue":e[5]||(e[5]=u=>n(o).order_type=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.order_type),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[26]||(e[26]=[a("Sub Total")])),_:1}),l(c,{modelValue:n(o).sub_total,"onUpdate:modelValue":e[6]||(e[6]=u=>n(o).sub_total=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.sub_total),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[27]||(e[27]=[a("Tax Amount")])),_:1}),l(c,{modelValue:n(o).tax_amount,"onUpdate:modelValue":e[7]||(e[7]=u=>n(o).tax_amount=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.tax_amount),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[28]||(e[28]=[a("Service Charge")])),_:1}),l(c,{modelValue:n(o).service_charge,"onUpdate:modelValue":e[8]||(e[8]=u=>n(o).service_charge=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.service_charge),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[29]||(e[29]=[a("Discount Type")])),_:1}),l(c,{modelValue:n(o).discount_type,"onUpdate:modelValue":e[9]||(e[9]=u=>n(o).discount_type=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.discount_type),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[30]||(e[30]=[a("Discount Amount")])),_:1}),l(c,{modelValue:n(o).discount_amount,"onUpdate:modelValue":e[10]||(e[10]=u=>n(o).discount_amount=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.discount_amount),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[31]||(e[31]=[a("Total Amount")])),_:1}),l(c,{modelValue:n(o).total_amount,"onUpdate:modelValue":e[11]||(e[11]=u=>n(o).total_amount=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.total_amount),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[32]||(e[32]=[a("Payment Type")])),_:1}),l(C,{filter:"",placeholder:"Select a type",options:J,optionLabel:"label",optionValue:"value",modelValue:n(o).payment_type,"onUpdate:modelValue":e[12]||(e[12]=u=>n(o).payment_type=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.payment_type),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[33]||(e[33]=[a("Remarks")])),_:1}),l(Z,{modelValue:n(o).remarks,"onUpdate:modelValue":e[13]||(e[13]=u=>n(o).remarks=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(o).errors.remarks),1)]),_:1})]),_:1})])]),_:1})]),_:1}),l(w,{class:"gap-5 col-span-2"},{default:t(()=>[l(S,null,{default:t(()=>[l(B,null,{default:t(()=>[l(_,null,{default:t(()=>e[34]||(e[34]=[a("Menu List")])),_:1}),l(L,null,{default:t(()=>e[35]||(e[35]=[a("Please input all the required fields.")])),_:1})]),_:1}),l(h,{class:"space-y-3 w-full"},{default:t(()=>[l(w,{class:"sm:items-center gap-3"},{default:t(()=>[l(m,{class:"w-full"},{default:t(()=>[l(i,null,{default:t(()=>e[36]||(e[36]=[a("Item")])),_:1}),l(C,{filter:"",placeholder:"Select a Store",options:n(A),optionLabel:"label",optionValue:"value",modelValue:n(s).id,"onUpdate:modelValue":e[14]||(e[14]=u=>n(s).id=u)},null,8,["options","modelValue"]),l(f,null,{default:t(()=>[a(d(n(s).errors.id),1)]),_:1})]),_:1}),l(m,{class:"w-full"},{default:t(()=>[l(i,null,{default:t(()=>e[37]||(e[37]=[a("Quantity")])),_:1}),l(c,{type:"number",modelValue:n(s).quantity,"onUpdate:modelValue":e[15]||(e[15]=u=>n(s).quantity=u)},null,8,["modelValue"]),l(f,null,{default:t(()=>[a(d(n(s).errors.quantity),1)]),_:1})]),_:1})]),_:1})]),_:1}),l(ee,{class:"justify-end"},{default:t(()=>[l(k,{onClick:j},{default:t(()=>e[38]||(e[38]=[a("Add")])),_:1})]),_:1})]),_:1}),l(re,null,{default:t(()=>[l(v,{class:"flex justify-between"},{default:t(()=>[l(O,null,{default:t(()=>e[39]||(e[39]=[a("Items Sold")])),_:1}),l(v,{class:"gap-2"},{default:t(()=>[l(i,null,{default:t(()=>e[40]||(e[40]=[a(" Overall Total:")])),_:1}),l(O,null,{default:t(()=>[a(d(n(Q)),1)]),_:1})]),_:1})]),_:1}),l(ue,null,{default:t(()=>[l(le,null,{default:t(()=>[l(g,null,{default:t(()=>e[41]||(e[41]=[a("Item")])),_:1}),l(g,null,{default:t(()=>e[42]||(e[42]=[a("Price")])),_:1}),l(g,null,{default:t(()=>e[43]||(e[43]=[a("Quantity")])),_:1}),l(g,null,{default:t(()=>e[44]||(e[44]=[a("Total Price")])),_:1}),l(g,null,{default:t(()=>e[45]||(e[45]=[a("Actions")])),_:1})]),_:1}),l(ae,null,{default:t(()=>[(x(!0),q(Ce,null,Ve(n(o).items,u=>(x(),q("tr",null,[l(T,null,{default:t(()=>[a(d(u.name),1)]),_:2},1024),l(T,null,{default:t(()=>[a(d(u.price),1)]),_:2},1024),l(T,null,{default:t(()=>[a(d(u.quantity),1)]),_:2},1024),l(T,null,{default:t(()=>[a(d(u.total_price),1)]),_:2},1024),l(T,null,{default:t(()=>[l(v,{class:"gap-3"},{default:t(()=>[b("button",{class:"text-red-500",onClick:E=>R(u.id)},[l(te)],8,De),b("button",{class:"text-green-500",onClick:E=>M(u.id)},[l(oe)],8,Se),l(ne,{onClick:E=>$(u.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),256))]),_:1})]),_:1}),l(v,{class:"justify-end"},{default:t(()=>[l(k,{onClick:X},{default:t(()=>e[46]||(e[46]=[a("Proceed")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(_e,{open:n(V),"onUpdate:open":e[17]||(e[17]=u=>Te(V)?V.value=u:null)},{default:t(()=>[l(fe,{class:"sm:max-w-[600px]"},{default:t(()=>[l(ie,null,{default:t(()=>[l(se,null,{default:t(()=>e[47]||(e[47]=[a("Import Store Transactions")])),_:1}),l(de,null,{default:t(()=>e[48]||(e[48]=[a(" Import the excel file here. ")])),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[49]||(e[49]=[a(" Store Transactions ")])),_:1}),l(c,{disabled:n(y),type:"file",onInput:e[16]||(e[16]=u=>n(D).store_transactions_file=u.target.files[0])},null,8,["disabled"]),l(f,null,{default:t(()=>[a(d(n(D).errors.store_transactions_file),1)]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(i,null,{default:t(()=>e[50]||(e[50]=[a("Store Transactions Template")])),_:1}),e[51]||(e[51]=b("ul",null,[b("li",{class:"text-xs"},[a(" Template: "),b("a",{class:"text-blue-500 underline",href:"/excel/store-transactions-template"},"Click to download")])],-1))]),_:1}),l(pe,null,{default:t(()=>[l(k,{disabled:n(y),onClick:W,class:"gap-2"},{default:t(()=>[e[52]||(e[52]=a(" Proceed ")),n(y)?(x(),q("span",ke,[l(me)])):ge("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}};export{Pe as default};
