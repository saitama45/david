import{D as _e,f as ve,x as p,Q as u,y as V,N,l as ge,T as be,V as xe,r as n,o as F,c as we,w as l,a as t,d as B,g as i,u as _,b as a,X as ye,t as g,h as A,R as he,i as H,e as Se,F as Ie}from"./app-DZB5krWT.js";import"./lodash-gd7BEsaJ.js";import{u as Te}from"./useToast-D0DYAlSU.js";import{u as De}from"./useSelectOptions-BNQxcMe3.js";/**
 * @license lucide-vue-next v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=_e("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ke={key:0,class:"relative mx-auto w-full max-w-4xl bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg shadow-lg mb-4 mt-4",role:"alert"},Ce={class:"flex items-center justify-between mb-2"},Ne={class:"font-bold flex items-center"},Fe={class:"max-h-40 overflow-y-auto pr-2"},Le={class:"text-sm whitespace-pre-line"},Ve={class:"flex items-center justify-center flex-col"},Be={class:"text-center"},Me={class:"flex justify-end"},Oe={key:0},$e={__name:"MainIndex",props:{transactions:{type:Object,required:!0},branches:{type:Object,required:!0}},setup(M){const{toast:T}=Te();ve();const{options:E}=De(M.branches);let D=p(u().props.filters.search),d=p(u().props.filters.from??new Date().toISOString().slice(0,10)),c=p(u().props.filters.to??new Date().toISOString().slice(0,10));const m=p(u().props.filters.branchId??"all");V(d,o=>{N.get(route("store-transactions.main-index"),{search:D.value,from:o,to:c.value,branchId:m.value},{preserveState:!0,preserveScroll:!0})}),V(c,o=>{N.get(route("store-transactions.main-index"),{search:D.value,from:d.value,to:o,branchId:m.value},{preserveState:!0,preserveScroll:!0})}),V(m,o=>{N.get(route("store-transactions.main-index"),{search:D.value,from:d.value,to:c.value,branchId:o},{preserveState:!0,preserveScroll:!0})});const z=()=>{d.value=new Date().toISOString().slice(0,10),c.value=new Date().toISOString().slice(0,10),m.value="all",D.value=null,N.get(route("store-transactions.main-index"),{search:D.value,from:d.value,to:c.value,branchId:m.value},{preserveState:!0,preserveScroll:!0,replace:!0})},q=ge(()=>route("store-transactions.export-main-index",{branchId:m.value,from:d.value,to:c.value})),k=be({store_transactions_file:null}),v=p(!1),y=p(!1),W=()=>{y.value=!0};V(y,o=>{o||(v.value=!1,k.reset())});const O=p(!1),L=p(""),C=p([]),h=p(""),P=o=>{if(!o||o.length===0)return"";const e={};o.forEach(r=>{const f=r.data&&r.data.product_id?r.data.product_id:"N/A",x=r.reason||"Unknown reason",w=`${f}-${x}`;e[w]||(e[w]={productId:f,reason:x,count:0,rowNumbers:[]}),e[w].count++,e[w].rowNumbers.push(r.row_number)});let b=`The following import warnings occurred:

`;return Object.values(e).forEach(r=>{const f=r.productId!=="N/A"?` (Product ID: ${r.productId})`:"",x=r.rowNumbers.length>5?`${r.rowNumbers.slice(0,5).join(", ")}... (and ${r.rowNumbers.length-5} more)`:r.rowNumbers.join(", ");b+=`- ${r.reason}${f}. Occurrences: ${r.count} (Rows: ${x})
`}),b},X=()=>{v.value=!0,k.post(route("store-transactions.import"),{onSuccess:()=>{v.value=!1,y.value=!1;const o=u().props.flash;console.log("onSuccess: flash object from Inertia:",o),o.skipped_import_rows&&o.skipped_import_rows.length>0?(C.value=o.skipped_import_rows,h.value=P(C.value),T.add({severity:"warn",summary:"Import Completed with Warnings",detail:o.warning||"Some transactions were skipped during import. See message below for details.",life:5e3})):o.success&&(h.value="",T.add({severity:"success",summary:"Success",detail:o.success,life:3e3})),u().props.flash.skipped_import_rows=null,u().props.flash.warning=null,u().props.flash.success=null,u().props.flash.error=null,N.reload({preserveState:!0})},onError:o=>{v.value=!1,y.value=!1;const e=u().props.flash;e.error?L.value=e.error:o.store_transactions_file?L.value=o.store_transactions_file[0]:L.value="An unknown error occurred during import.",O.value=!0,u().props.flash.error=null},onFinish:()=>{v.value=!1}})},Q=o=>{if(!o)return"N/a";try{const e=new Date(o),b=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),f=e.getFullYear();return`${b}/${r}/${f}`}catch(e){return console.error("Error formatting date:",o,e),o}};xe(()=>{const o=u().props.flash;console.log("onMounted: Full flash object from Inertia:",o),console.log("onMounted: branchesOptions:",E.value),console.log("onMounted: initial branchId.value:",m.value),o.skipped_import_rows&&o.skipped_import_rows.length>0?(C.value=o.skipped_import_rows,h.value=P(C.value),o.warning&&T.add({severity:"warn",summary:"Import Warning",detail:o.warning,life:5e3})):o.success?T.add({severity:"success",summary:"Success",detail:o.success,life:3e3}):o.error&&T.add({severity:"error",summary:"Import Error",detail:o.error,life:5e3}),u().props.flash.skipped_import_rows=null,u().props.flash.warning=null,u().props.flash.success=null,u().props.flash.error=null});const Y=()=>{h.value="",C.value=[]};return(o,e)=>{const b=n("DialogTitle"),r=n("DialogDescription"),f=n("DialogHeader"),x=n("DialogContent"),w=n("Dialog"),G=n("Select"),J=n("Filter"),K=n("PopoverTrigger"),R=n("Button"),j=n("Input"),Z=n("PopoverContent"),ee=n("Popover"),te=n("DivFlexCenter"),oe=n("TableHeader"),S=n("TH"),le=n("TableHead"),I=n("TD"),ne=n("ShowButton"),se=n("TableBody"),ae=n("Table"),re=n("Pagination"),ue=n("TableContainer"),ie=n("LabelXS"),de=n("FormError"),$=n("InputContainer"),ce=n("Label"),pe=n("Loading"),me=n("DialogFooter"),fe=n("Layout");return F(),we(fe,{heading:"Store Transactions",hasButton:!0,buttonName:"Import Store Transactions",handleClick:W,hasExcelDownload:!0,exportRoute:q.value},{default:l(()=>[t(he,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-1"},{default:l(()=>[h.value?(F(),B("div",ke,[i("div",Ce,[i("strong",Ne,[t(_(U),{class:"size-5 mr-2"}),e[6]||(e[6]=a(" Import Warnings! "))]),i("button",{onClick:Y,class:"text-yellow-700 hover:text-yellow-900 focus:outline-none"},[t(_(ye),{class:"size-4"})])]),i("div",Fe,[i("p",Le,g(h.value),1)])])):A("",!0)]),_:1}),t(w,{open:O.value,"onUpdate:open":e[0]||(e[0]=s=>O.value=s)},{default:l(()=>[t(x,{class:"sm:max-w-[400px] flex items-center justify-center flex-col"},{default:l(()=>[t(f,null,{default:l(()=>[t(b,null,{default:l(()=>[t(_(U),{class:"size-12 text-red-500"})]),_:1}),t(r)]),_:1}),i("div",Ve,[e[7]||(e[7]=i("h1",{class:"text-2xl font-bold"},"Error",-1)),i("p",Be,g(L.value),1)])]),_:1})]),_:1},8,["open"]),t(ue,null,{default:l(()=>[t(oe,null,{default:l(()=>[t(G,{filter:"",placeholder:"Select a Branch",modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),options:_(E),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(te,{class:"gap-5"},{default:l(()=>[t(ee,null,{default:l(()=>[t(K,null,{default:l(()=>[t(J)]),_:1}),t(Z,null,{default:l(()=>[i("div",Me,[t(R,{onClick:z,variant:"link",class:"text-end text-red-500 text-xs"},{default:l(()=>e[8]||(e[8]=[a(" Reset Filter ")])),_:1})]),e[9]||(e[9]=i("label",{class:"text-xs"},"From",-1)),t(j,{type:"date",modelValue:_(d),"onUpdate:modelValue":e[2]||(e[2]=s=>H(d)?d.value=s:d=s)},null,8,["modelValue"]),e[10]||(e[10]=i("label",{class:"text-xs"},"To",-1)),t(j,{type:"date",modelValue:_(c),"onUpdate:modelValue":e[3]||(e[3]=s=>H(c)?c.value=s:c=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ae,null,{default:l(()=>[t(le,null,{default:l(()=>[t(S,null,{default:l(()=>e[11]||(e[11]=[a("Branch Code")])),_:1}),t(S,null,{default:l(()=>e[12]||(e[12]=[a("Branch Name")])),_:1}),t(S,null,{default:l(()=>e[13]||(e[13]=[a("POS Sales Date")])),_:1}),t(S,null,{default:l(()=>e[14]||(e[14]=[a("Transactions Count")])),_:1}),t(S,null,{default:l(()=>e[15]||(e[15]=[a("Overall Net Total")])),_:1}),t(S,null,{default:l(()=>e[16]||(e[16]=[a("Actions")])),_:1})]),_:1}),t(se,null,{default:l(()=>[(F(!0),B(Ie,null,Se(M.transactions.data,s=>(F(),B("tr",{key:s.order_date},[t(I,null,{default:l(()=>[a(g(s.branch_code),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(s.branch_name),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(Q(s.order_date)),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(s.transaction_count),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(s.net_total),1)]),_:2},1024),t(I,{class:"flex items-center"},{default:l(()=>[t(ne,{isLink:!0,href:o.route("store-transactions.index",{order_date:new Date(s.order_date).toLocaleDateString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit"}),branchId:s.store_branch_id})},null,8,["href"])]),_:2},1024)]))),128))]),_:1})]),_:1}),t(re,{data:M.transactions},null,8,["data"])]),_:1}),t(w,{open:y.value,"onUpdate:open":e[5]||(e[5]=s=>y.value=s)},{default:l(()=>[t(x,{class:"sm:max-w-[600px]"},{default:l(()=>[t(f,null,{default:l(()=>[t(b,null,{default:l(()=>e[17]||(e[17]=[a("Import Store Transactions List")])),_:1}),t(r,null,{default:l(()=>e[18]||(e[18]=[a(" Import the excel file here. ")])),_:1})]),_:1}),t($,null,{default:l(()=>[t(ie,null,{default:l(()=>e[19]||(e[19]=[a(" Store Transactions List ")])),_:1}),t(j,{disabled:v.value,type:"file",onInput:e[4]||(e[4]=s=>_(k).store_transactions_file=s.target.files[0])},null,8,["disabled"]),t(de,null,{default:l(()=>[a(g(_(k).errors.store_transactions_file),1)]),_:1})]),_:1}),t($,null,{default:l(()=>[t(ce,{class:"text-xs"},{default:l(()=>e[20]||(e[20]=[a("Store Transaction Template")])),_:1}),e[21]||(e[21]=i("ul",null,[i("li",{class:"text-xs"},[a(" Template: "),i("a",{class:"text-blue-500 underline",href:"/excel/store-transactions-template"},"Click to download")])],-1))]),_:1}),t(me,null,{default:l(()=>[t(R,{disabled:v.value||!_(k).store_transactions_file,onClick:X,class:"gap-2"},{default:l(()=>[e[22]||(e[22]=a(" Proceed ")),v.value?(F(),B("span",Oe,[t(pe)])):A("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["exportRoute"])}}};export{$e as default};
