import{f as J,x as K,l as M,r as w,o as r,d as m,a as t,u as g,Z as ee,w as n,g as y,b as o,t as i,n as $,c as B,h as S,F as U,e as te,m as j,A as x,B as N,W as le,N as L}from"./app-Bw_fMWAP.js";import{u as ne}from"./useToast-CgNL_wIh.js";import{A as oe}from"./arrow-left-D4hae3WF.js";import{C as se}from"./check-CDHR8V18.js";import{S as A}from"./save-D1-8COpm.js";import{X as F}from"./x-CdvG2xaQ.js";const ae={class:"mb-6 p-4 bg-white rounded-lg shadow-md"},ue={class:"flex justify-between items-center mb-4"},re={class:"overflow-y-auto max-h-[75vh]"},ie={key:0},de={key:0,class:"flex items-center gap-1"},ce=["onClick"],ge={key:0,class:"flex items-center gap-1"},fe=["onClick"],ve={key:0,class:"flex items-center gap-1"},pe=["onClick"],ye={key:0,class:"flex items-center gap-1"},me=["onClick"],be={key:0,class:"flex items-center gap-1"},he=["onClick"],Ee={__name:"Review",props:{schedule:{type:Object,required:!0},branch:{type:Object,required:!0},countItems:{type:Array,required:!0},canEditItems:{type:Boolean,required:!0}},setup(C){const u=C,D=J(),{toast:E}=ne(),d=K(null),b=K(""),V=K(null),q={mounted:s=>{const e=s.querySelector("input");e?(e.focus(),e.select()):typeof s.focus=="function"&&(s.focus(),typeof s.select=="function"&&s.select())}},O=s=>{const e=new Date;return e.setMonth(s-1),e.toLocaleString("en-US",{month:"long"})},v=s=>s==="uploaded"||s==="upload",H=s=>{const e=parseFloat(s.bulk_qty)||0,k=parseFloat(s.loose_qty)||0,c=parseFloat(s.config)||1;return c===0?e+k:(e+k/c).toFixed(4)},T=(s,e)=>{if(!u.canEditItems||!v(s.status)){E.add({severity:"warn",summary:"Editing Disabled",detail:"You do not have permission or the item status prevents editing.",life:3e3});return}if(e!=="total_qty"){if(e==="config"&&s.packaging_config){E.add({severity:"warn",summary:"Editing Disabled",detail:"Config cannot be edited when Packaging Config has a value.",life:4e3});return}d.value={itemId:s.id,field:e},b.value=s[e],le(()=>{V.value&&V.value.select()})}},h=()=>{d.value=null,b.value=""},_=s=>{if(!d.value)return;const{field:e}=d.value;let k=b.value;if(["bulk_qty","loose_qty","config"].includes(e)&&(k=parseFloat(k),isNaN(k)||e==="config"&&k<=0||e!=="config"&&k<0)){const c=e==="config"?"Config must be a positive number.":`${e} must be a non-negative number.`;E.add({severity:"error",summary:"Invalid Input",detail:c,life:3e3});return}L.put(route("month-end-count.update-review-item",s.id),{[e]:k},{preserveScroll:!0,onSuccess:()=>{E.add({severity:"success",summary:"Success",detail:"Item updated successfully.",life:3e3}),h()},onError:c=>{const f=Object.values(c)[0]||"An unknown error occurred.";E.add({severity:"error",summary:"Update Failed",detail:f,life:5e3})}})},P=()=>{D.require({message:"Are you sure you want to submit this count for Level 1 approval? You will no longer be able to edit it.",header:"Confirm Submission",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-danger",accept:()=>{L.post(route("month-end-count.submit-for-approval",{schedule:u.schedule.id,branch:u.branch.id}),{},{onSuccess:()=>{E.add({severity:"success",summary:"Success",detail:"Count submitted for Level 1 approval.",life:3e3})},onError:s=>{const e=Object.values(s)[0]||"An unknown error occurred.";E.add({severity:"error",summary:"Submission Failed",detail:e,life:5e3})}})}})},Q=()=>{L.get(route("month-end-count.index"))},R=M(()=>u.countItems.some(s=>s.status==="uploaded")),I=M(()=>u.countItems.length>0?u.countItems[0].status:u.schedule.status);return(s,e)=>{const k=w("Badge"),c=w("Button"),f=w("TH"),Y=w("TableHead"),p=w("TD"),z=w("Input"),W=w("TableBody"),X=w("Table"),Z=w("TableContainer"),G=w("Layout");return r(),m(U,null,[t(g(ee),{title:`Month End Count Review - ${C.branch.name}`},null,8,["title"]),t(G,{heading:`Month End Count Review - ${C.branch.name}`},{default:n(()=>[y("div",ae,[e[10]||(e[10]=y("h3",{class:"text-lg font-semibold mb-2"},"Schedule Details",-1)),y("p",null,[e[5]||(e[5]=y("strong",null,"Year:",-1)),o(" "+i(C.schedule.year),1)]),y("p",null,[e[6]||(e[6]=y("strong",null,"Month:",-1)),o(" "+i(O(C.schedule.month)),1)]),y("p",null,[e[7]||(e[7]=y("strong",null,"MEC Schedule Date:",-1)),o(" "+i(C.schedule.calculated_date),1)]),y("p",null,[e[8]||(e[8]=y("strong",null,"Branch:",-1)),o(" "+i(C.branch.name),1)]),y("p",null,[e[9]||(e[9]=y("strong",null,"Current Status:",-1)),t(k,{class:$(["capitalize",{"bg-yellow-500 text-white":I.value==="pending"||I.value==="uploaded","bg-blue-500 text-white":I.value==="level1_approved","bg-green-500 text-white":I.value==="level2_approved","bg-red-500 text-white":I.value==="rejected"||I.value==="expired","bg-purple-500 text-white":I.value==="pending_level1_approval"}])},{default:n(()=>[o(i(I.value.replace("_"," ")),1)]),_:1},8,["class"])])]),y("div",ue,[t(c,{onClick:Q,variant:"outline"},{default:n(()=>[t(g(oe),{class:"h-4 w-4 mr-2"}),e[11]||(e[11]=o(" Back "))]),_:1}),R.value?(r(),B(c,{key:0,onClick:P,variant:"success",class:"bg-green-600 hover:bg-green-700 text-white"},{default:n(()=>[t(g(se),{class:"h-4 w-4 mr-2"}),e[12]||(e[12]=o(" Submit for Level 1 Approval "))]),_:1})):S("",!0)]),t(Z,null,{default:n(()=>[y("div",re,[t(X,null,{default:n(()=>[t(Y,{class:"sticky top-0 z-10 bg-gray-100"},{default:n(()=>[t(f,null,{default:n(()=>e[13]||(e[13]=[o("Item Code")])),_:1}),t(f,null,{default:n(()=>e[14]||(e[14]=[o("Item Name")])),_:1}),t(f,null,{default:n(()=>e[15]||(e[15]=[o("Category 1")])),_:1}),t(f,null,{default:n(()=>e[16]||(e[16]=[o("Area")])),_:1}),t(f,null,{default:n(()=>e[17]||(e[17]=[o("Category 2")])),_:1}),t(f,null,{default:n(()=>e[18]||(e[18]=[o("Packaging")])),_:1}),t(f,null,{default:n(()=>e[19]||(e[19]=[o("Conversion")])),_:1}),t(f,null,{default:n(()=>e[20]||(e[20]=[o("Bulk UOM")])),_:1}),t(f,null,{default:n(()=>e[21]||(e[21]=[o("Loose UOM")])),_:1}),t(f,null,{default:n(()=>e[22]||(e[22]=[o("Current SOH")])),_:1}),t(f,null,{default:n(()=>e[23]||(e[23]=[o("Bulk Qty")])),_:1}),t(f,null,{default:n(()=>e[24]||(e[24]=[o("Loose Qty")])),_:1}),t(f,null,{default:n(()=>e[25]||(e[25]=[o("Remarks")])),_:1}),t(f,null,{default:n(()=>e[26]||(e[26]=[o("Total Qty")])),_:1}),t(f,null,{default:n(()=>e[27]||(e[27]=[o("Uploaded By")])),_:1})]),_:1}),t(W,null,{default:n(()=>[C.countItems.length?S("",!0):(r(),m("tr",ie,e[28]||(e[28]=[y("td",{colspan:"15",class:"text-center py-4"},"No count items found for this schedule and branch.",-1)]))),(r(!0),m(U,null,te(C.countItems,l=>(r(),m("tr",{key:l.id},[t(p,null,{default:n(()=>[o(i(l.item_code),1)]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.item_name),1)]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.category),1)]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.area),1)]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.category2),1)]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.packaging_config),1)]),_:2},1024),t(p,null,{default:n(()=>[d.value&&d.value.itemId===l.id&&d.value.field==="config"?(r(),m("div",de,[j(t(z,{ref_for:!0,ref_key:"editInput",ref:V,type:"number",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),class:"w-24 text-right py-1",onKeyup:[x(a=>_(l),["enter"]),x(h,["esc"])]},null,8,["modelValue","onKeyup"]),[[q]]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:a=>_(l)},{default:n(()=>[t(g(A),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:h},{default:n(()=>[t(g(F),{class:"h-4 w-4"})]),_:1})])):(r(),m("div",{key:1,onClick:a=>T(l,"config"),class:$(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":u.canEditItems&&v(l.status)&&!l.packaging_config,"cursor-not-allowed bg-gray-50 text-gray-500":!u.canEditItems||!v(l.status)||l.packaging_config}])},[o(i(l.config)+" ",1),u.canEditItems&&v(l.status)&&!l.packaging_config?(r(),B(g(N),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):S("",!0)],10,ce))]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.uom),1)]),_:2},1024),t(p,null,{default:n(()=>[d.value&&d.value.itemId===l.id&&d.value.field==="loose_uom"?(r(),m("div",ge,[j(t(z,{ref_for:!0,ref_key:"editInput",ref:V,type:"text",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=a=>b.value=a),class:"w-24 text-right py-1",onKeyup:[x(a=>_(l),["enter"]),x(h,["esc"])]},null,8,["modelValue","onKeyup"]),[[q]]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:a=>_(l)},{default:n(()=>[t(g(A),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:h},{default:n(()=>[t(g(F),{class:"h-4 w-4"})]),_:1})])):(r(),m("div",{key:1,onClick:a=>T(l,"loose_uom"),class:$(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":u.canEditItems&&v(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!u.canEditItems||!v(l.status)}])},[o(i(l.loose_uom)+" ",1),u.canEditItems&&v(l.status)?(r(),B(g(N),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):S("",!0)],10,fe))]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.current_soh),1)]),_:2},1024),t(p,null,{default:n(()=>[d.value&&d.value.itemId===l.id&&d.value.field==="bulk_qty"?(r(),m("div",ve,[j(t(z,{ref_for:!0,ref_key:"editInput",ref:V,type:"number",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),class:"w-24 text-right py-1",onKeyup:[x(a=>_(l),["enter"]),x(h,["esc"])]},null,8,["modelValue","onKeyup"]),[[q]]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:a=>_(l)},{default:n(()=>[t(g(A),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:h},{default:n(()=>[t(g(F),{class:"h-4 w-4"})]),_:1})])):(r(),m("div",{key:1,onClick:a=>T(l,"bulk_qty"),class:$(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":u.canEditItems&&v(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!u.canEditItems||!v(l.status)}])},[o(i(l.bulk_qty)+" ",1),u.canEditItems&&v(l.status)?(r(),B(g(N),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):S("",!0)],10,pe))]),_:2},1024),t(p,null,{default:n(()=>[d.value&&d.value.itemId===l.id&&d.value.field==="loose_qty"?(r(),m("div",ye,[j(t(z,{ref_for:!0,ref_key:"editInput",ref:V,type:"number",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),class:"w-24 text-right py-1",onKeyup:[x(a=>_(l),["enter"]),x(h,["esc"])]},null,8,["modelValue","onKeyup"]),[[q]]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:a=>_(l)},{default:n(()=>[t(g(A),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:h},{default:n(()=>[t(g(F),{class:"h-4 w-4"})]),_:1})])):(r(),m("div",{key:1,onClick:a=>T(l,"loose_qty"),class:$(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":u.canEditItems&&v(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!u.canEditItems||!v(l.status)}])},[o(i(l.loose_qty)+" ",1),u.canEditItems&&v(l.status)?(r(),B(g(N),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):S("",!0)],10,me))]),_:2},1024),t(p,null,{default:n(()=>[d.value&&d.value.itemId===l.id&&d.value.field==="remarks"?(r(),m("div",be,[j(t(z,{ref_for:!0,ref_key:"editInput",ref:V,type:"text",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),class:"w-24 text-right py-1",onKeyup:[x(a=>_(l),["enter"]),x(h,["esc"])]},null,8,["modelValue","onKeyup"]),[[q]]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:a=>_(l)},{default:n(()=>[t(g(A),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(c,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:h},{default:n(()=>[t(g(F),{class:"h-4 w-4"})]),_:1})])):(r(),m("div",{key:1,onClick:a=>T(l,"remarks"),class:$(["group p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400 bg-blue-50":u.canEditItems&&v(l.status),"cursor-not-allowed bg-gray-50 text-gray-500":!u.canEditItems||!v(l.status)}])},[o(i(l.remarks)+" ",1),u.canEditItems&&v(l.status)?(r(),B(g(N),{key:0,class:"h-3 w-3 ml-1 text-gray-500 opacity-0 group-hover:opacity-100"})):S("",!0)],10,he))]),_:2},1024),t(p,null,{default:n(()=>[o(i(H(l)),1)]),_:2},1024),t(p,null,{default:n(()=>[o(i(l.uploader?`${l.uploader.first_name} ${l.uploader.last_name}`:"N/A"),1)]),_:2},1024)]))),128))]),_:1})]),_:1})])]),_:1})]),_:1},8,["heading"])],64)}}};export{Ee as default};
