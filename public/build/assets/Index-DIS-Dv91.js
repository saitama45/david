import{u as ce}from"./useSearch-DbS36i7w.js";import{G as _e,f as ve,Q as be,x,y as ge,N as E,l as ke,T as ye,V as he,r as s,o as m,c as g,w as l,d as T,g as a,t as u,h as k,b as n,a as t,u as p,i as we,e as H,F as P}from"./app-Drfr7wPO.js";import{u as Ie}from"./useAuth-CGUY0YG2.js";import{u as Ce}from"./useReferenceDelete-Lc4jVcC1.js";import"./lodash-IPPPM5x9.js";const xe={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},Te={class:"block sm:inline whitespace-pre-line"},Be={key:1,class:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4",role:"alert"},De={class:"block sm:inline"},Me={class:"space-y-5"},Ae={class:"flex flex-col space-y-1"},Se={class:"flex flex-col space-y-1"},Fe={class:"text-xs"},Le=["href"],Ee={__name:"Index",props:{items:{type:Object,required:!0}},setup(M){const y=_e();ve();const r=be(),Q=()=>{E.get(route("sapitems.create"))};let h=x(r.props.filter||"all");const{search:B}=ce("sapitems.index"),A=i=>{h.value=i};ge(h,function(i){E.get(route("sapitems.index"),{filter:i},{preserveState:!0,replace:!0})});const{hasAccess:C}=Ie(),{deleteModel:L}=Ce(),V=ke(()=>route("sapitems.export",{search:B.value,filter:h.value})),D=x(!1),d=x([]),v=x(""),S=i=>{if(!i||i.length===0)return"";let e=`The following items were skipped during import due to validation issues:

`;return i.forEach(f=>{e+=`- Item Code: ${f.item_code||"N/A"}, AltUOM: ${f.alt_uom||"N/A"}, Reason: ${f.reason}
`}),e},Y=()=>{if(d.value.length===0)return;const i=S(d.value),e=new Blob([i],{type:"text/plain"}),f=URL.createObjectURL(e),b=document.createElement("a");b.href=f,b.download=`sap_masterfile_skipped_items_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(f)},F=ye({products_file:null}),j=()=>{w.value=!0,F.post(route("sapitems.import"),{onSuccess:()=>{w.value=!1,D.value=!1,r.props.flash&&r.props.flash.skippedItems&&r.props.flash.skippedItems.length>0?(d.value=r.props.flash.skippedItems,d.value.length<=15?v.value=S(d.value):v.value="",y.add({severity:"warn",summary:"Import Completed with Warnings",detail:`${d.value.length} items were skipped during import. Download the report for details.`,life:5e3})):r.props.flash&&r.props.flash.success&&(v.value="",y.add({severity:"success",summary:"Success",detail:r.props.flash.success,life:3e3}))},onError:i=>{w.value=!1,y.add({severity:"error",summary:"Error",detail:"An error occurred while trying to import items. Please make sure that you are using the correct format.",life:3e3})},onFinish:()=>{w.value=!1}})},W=()=>{D.value=!0},w=x(!1);return he(()=>{r.props.flash&&r.props.flash.skippedItems&&r.props.flash.skippedItems.length>0?(d.value=r.props.flash.skippedItems,d.value.length<=15?v.value=S(d.value):v.value="",y.add({severity:"warn",summary:"Import Completed with Warnings",detail:`${d.value.length} items were skipped during the last import. Download the report for details.`,life:5e3})):r.props.flash&&r.props.flash.success?y.add({severity:"success",summary:"Success",detail:r.props.flash.success,life:3e3}):r.props.flash&&r.props.flash.error&&y.add({severity:"error",summary:"Error",detail:r.props.flash.error,life:3e3})}),(i,e)=>{const f=s("FilterTabButton"),b=s("FilterTab"),U=s("Input"),X=s("SearchBar"),N=s("Button"),q=s("TableHeader"),c=s("TH"),z=s("TableHead"),_=s("TD"),O=s("ShowButton"),$=s("EditButton"),R=s("DeleteButton"),G=s("TableBody"),J=s("Table"),K=s("MobileTableHeading"),I=s("LabelXS"),Z=s("MobileTableRow"),ee=s("MobileTableContainer"),te=s("Pagination"),le=s("TableContainer"),oe=s("DialogTitle"),se=s("DialogDescription"),ne=s("DialogHeader"),ae=s("FormError"),re=s("Label"),ie=s("Loading"),ue=s("DialogFooter"),de=s("DialogContent"),pe=s("Dialog"),me=s("Layout");return m(),g(me,{heading:"SAPMasterfile List",hasButton:p(C)("create new SAPMasterfile items"),buttonName:"Create New Item",handleClick:Q,hasExcelDownload:!0,exportRoute:V.value},{default:l(()=>[v.value&&d.value.length<=15?(m(),T("div",xe,[e[8]||(e[8]=a("strong",{class:"font-bold"},"Import Warnings:",-1)),a("span",Te,u(v.value),1),a("span",{class:"absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer",onClick:e[0]||(e[0]=o=>v.value="")},e[7]||(e[7]=[a("svg",{class:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},[a("title",null,"Close"),a("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})],-1)]))])):k("",!0),d.value.length>0?(m(),T("div",Be,[e[9]||(e[9]=a("strong",{class:"font-bold"},"Import Summary:",-1)),a("span",De,u(d.value.length)+" items were skipped during import.",1),a("button",{onClick:Y,class:"mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded text-sm"}," Download Skipped Items Report "),e[10]||(e[10]=a("p",{class:"text-sm mt-2"},[n(" Common reasons for skipped items: "),a("ul",{class:"list-disc list-inside text-sm ml-4"},[a("li",null,"Item already exists in the database"),a("li",null,"Missing ItemCode or AltUOM values"),a("li",null,"Duplicate items within the import file"),a("li",null,"Invalid data format")])],-1))])):k("",!0),t(b,null,{default:l(()=>[t(f,{label:"All",filter:"all",currentFilter:p(h),onClick:e[1]||(e[1]=o=>A("all"))},null,8,["currentFilter"]),t(f,{label:"Active",filter:"is_active",currentFilter:p(h),onClick:e[2]||(e[2]=o=>A("is_active"))},null,8,["currentFilter"]),t(f,{label:"InActive",filter:"inactive",currentFilter:p(h),onClick:e[3]||(e[3]=o=>A("inactive"))},null,8,["currentFilter"])]),_:1}),t(le,null,{default:l(()=>[t(q,null,{default:l(()=>[t(X,null,{default:l(()=>[t(U,{class:"pl-10",modelValue:p(B),"onUpdate:modelValue":e[4]||(e[4]=o=>we(B)?B.value=o:null),placeholder:"Search..."},null,8,["modelValue"])]),_:1}),t(N,{onClick:W},{default:l(()=>e[11]||(e[11]=[n("Update List")])),_:1})]),_:1}),t(J,null,{default:l(()=>[t(z,null,{default:l(()=>[t(c,null,{default:l(()=>e[12]||(e[12]=[n("Id")])),_:1}),t(c,null,{default:l(()=>e[13]||(e[13]=[n("Item Code")])),_:1}),t(c,null,{default:l(()=>e[14]||(e[14]=[n("Item Desc")])),_:1}),t(c,null,{default:l(()=>e[15]||(e[15]=[n("Base UOM")])),_:1}),t(c,null,{default:l(()=>e[16]||(e[16]=[n("Base QTY")])),_:1}),t(c,null,{default:l(()=>e[17]||(e[17]=[n("Alternate UOM")])),_:1}),t(c,null,{default:l(()=>e[18]||(e[18]=[n("Alternate QTY")])),_:1}),t(c,null,{default:l(()=>e[19]||(e[19]=[n("Active")])),_:1}),t(c,null,{default:l(()=>e[20]||(e[20]=[n("Action")])),_:1})]),_:1}),t(G,null,{default:l(()=>[(m(!0),T(P,null,H(M.items.data,o=>(m(),T("tr",null,[t(_,null,{default:l(()=>[n(u(o.id),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(o.ItemCode),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(o.ItemDescription),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(o.BaseUOM),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(o.BaseQty),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(o.AltUOM),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(o.AltQty),1)]),_:2},1024),t(_,null,{default:l(()=>[n(u(Number(o.is_active)?"Yes":"No"),1)]),_:2},1024),t(_,{class:"flex items-center gap-2"},{default:l(()=>[p(C)("view item")?(m(),g(O,{key:0,isLink:!0,href:i.route("sapitems.show",o.id)},null,8,["href"])):k("",!0),p(C)("edit items")?(m(),g($,{key:1,isLink:!0,href:i.route("sapitems.edit",o.id)},null,8,["href"])):k("",!0),t(R,{onClick:fe=>p(L)(i.route("sapitems.destroy",o.id),"SAP Masterfile Item")},null,8,["onClick"])]),_:2},1024)]))),256))]),_:1})]),_:1}),t(ee,null,{default:l(()=>[(m(!0),T(P,null,H(M.items.data,o=>(m(),g(Z,{key:o.id},{default:l(()=>[t(K,{title:`${o.ItemDescription} (${o.ItemCode})`},{default:l(()=>[p(C)("view item")?(m(),g(O,{key:0,isLink:!0,href:i.route("sapitems.show",o.id)},null,8,["href"])):k("",!0),p(C)("edit items")?(m(),g($,{key:1,isLink:!0,href:i.route("sapitems.edit",o.id)},null,8,["href"])):k("",!0),t(R,{onClick:fe=>p(L)(i.route("sapitems.destroy",o.id),"SAP Masterfile Item")},null,8,["onClick"])]),_:2},1032,["title"]),t(I,null,{default:l(()=>[n("Item No: "+u(o.ItemCode),1)]),_:2},1024),t(I,null,{default:l(()=>[n("Base UOM: "+u(o.BaseUOM),1)]),_:2},1024),t(I,null,{default:l(()=>[n("Base Qty: "+u(o.BaseQty),1)]),_:2},1024),t(I,null,{default:l(()=>[n("Alt UOM: "+u(o.AltUOM),1)]),_:2},1024),t(I,null,{default:l(()=>[n("Alt Qty: "+u(o.AltQty),1)]),_:2},1024),t(I,null,{default:l(()=>[n("Active: "+u(Number(o.is_active)?"Yes":"No"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(te,{data:M.items},null,8,["data"])]),_:1}),t(pe,{open:D.value,"onUpdate:open":e[6]||(e[6]=o=>D.value=o)},{default:l(()=>[t(de,{class:"sm:max-w-[600px]"},{default:l(()=>[t(ne,null,{default:l(()=>[t(oe,null,{default:l(()=>e[21]||(e[21]=[n("Import Products")])),_:1}),t(se,null,{default:l(()=>e[22]||(e[22]=[n(" Import the excel file of the products. ")])),_:1})]),_:1}),a("div",Me,[a("div",Ae,[t(U,{type:"file",onInput:e[5]||(e[5]=o=>p(F).products_file=o.target.files[0])}),t(ae,null,{default:l(()=>[n(u(p(F).errors.products_file),1)]),_:1})]),a("div",Se,[t(re,{class:"text-xs"},{default:l(()=>e[23]||(e[23]=[n("Accepted Products File Format")])),_:1}),a("ul",null,[a("li",Fe,[a("a",{class:"text-blue-500 underline",href:i.route("excel.sapmasterfile-template")},"Click to download",8,Le)])])])]),t(ue,null,{default:l(()=>[t(N,{disabled:w.value,onClick:j,type:"submit",class:"gap-2"},{default:l(()=>[e[24]||(e[24]=n(" Proceed ")),a("span",null,[w.value?(m(),g(ie,{key:0})):k("",!0)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["hasButton","exportRoute"])}}};export{Ee as default};
