import{D as Y,Y as q,x as m,l as D,y as R,W as H,o as a,d as n,g as r,t as p,h as v,F as Q,e as ee,n as G,A as M,k as A,a as y,u as g,w as U,X as te,aA as le,b as $,c as oe}from"./app-p8ycGfai.js";import{a as se,_ as ae}from"./AlertDescription-CsY3pWXH.js";import{L as re}from"./loader-circle-PEkmcZqs.js";import{C as z}from"./circle-alert-DTQS8jZO.js";import{U as ne}from"./upload-DTUN6lfo.js";/**
 * @license lucide-vue-next v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=Y("CalculatorIcon",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),ie={class:"space-y-3"},ce={class:"block text-sm font-medium text-gray-700 mb-1"},de={key:0,class:"text-xs text-gray-500"},ue={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},fe=["onClick","onKeydown","aria-label"],pe={class:"aspect-w-1 aspect-h-1"},ve={key:0,class:"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center"},ge={key:1,class:"absolute inset-0 bg-red-50 rounded-lg flex flex-col items-center justify-center p-4"},he={class:"text-xs text-red-700 text-center mb-2"},me={key:0,class:"text-xs text-gray-600 mb-2"},ye={class:"flex gap-2"},xe=["onClick"],be={key:0,class:"text-xs text-gray-500"},ke=["src","alt","onLoad","onError","onLoadstart"],we={class:"absolute top-1 right-1 pointer-events-none"},Ie={key:0,class:"absolute bottom-1 left-1 bg-black bg-opacity-75 text-white text-xs p-1 rounded max-w-full truncate pointer-events-none"},_e={key:0,class:"block text-yellow-300"},De={key:1,class:"absolute top-1 left-1 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"},Ue={class:"space-y-3"},Fe={class:"mx-auto w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center"},Le=["accept","disabled","multiple"],Ce={__name:"ImageUpload",props:{modelValue:{type:Array,default:()=>[]},existingImageUrls:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!1},label:{type:String,default:"Upload Image"},helperText:{type:String,default:"Upload JPG or PNG image (max 5MB)"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","update:existingImageUrls","error"],setup(f,{emit:V}){const i=f,x=V,F=m(null),h=m(""),k=m(!1),b=m([]),d=m({}),c=m({}),u=m({}),j=(e,l=0)=>{if(console.log("üîó Transforming URL:",e,"Attempt:",l),!e)return console.warn("‚ö†Ô∏è Empty URL provided to transformGoogleDriveUrl"),{url:"",isGoogleDrive:!1,hasMoreFallbacks:!1};if(e.includes("drive.google.com"))try{let t=null;if(e.includes("/file/d/")){const o=e.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);o&&(t=o[1])}else if(e.includes("open?id=")){const o=e.match(/[?&]id=([a-zA-Z0-9_-]+)/);o&&(t=o[1])}if(t){const o=[`/proxy/google-drive/${t}`,`https://drive.google.com/thumbnail?id=${t}&sz=s400`,`https://drive.google.com/uc?export=view&id=${t}`,`https://drive.google.com/uc?export=download&id=${t}`,`https://docs.google.com/uc?export=view&id=${t}`,`https://lh3.googleusercontent.com/d/${t}=s400`];if(l<o.length){const s=o[l];return console.log("‚úÖ Google Drive URL transformed:",{original:e,transformed:s,fileId:t,attemptIndex:l,totalFormats:o.length}),{url:s,isGoogleDrive:!0,hasMoreFallbacks:l<o.length-1,fileId:t,attemptIndex:l,totalFormats:o.length,allFormats:o}}else return console.warn("‚ö†Ô∏è All Google Drive URL formats exhausted for:",e),{url:"",isGoogleDrive:!0,hasMoreFallbacks:!1,fileId:t}}else console.warn("‚ö†Ô∏è Could not extract file ID from Google Drive URL:",e)}catch(t){console.error("‚ùå Error transforming Google Drive URL:",t,"URL:",e)}return console.log("‚ÑπÔ∏è URL unchanged (not a Google Drive URL):",e),{url:e,isGoogleDrive:!1,hasMoreFallbacks:!1}},I=D(()=>{console.log("üñºÔ∏è Computing allImages. Existing URLs:",i.existingImageUrls,"New previews:",b.value),console.log("üî¢ Current urlAttempts state:",JSON.parse(JSON.stringify(u.value)));const e=i.existingImageUrls.map(o=>{u.value[o]===void 0?(console.log("üÜï Initializing urlAttempts for:",o.substring(0,50)+"..."),u.value[o]=0):console.log("‚ôªÔ∏è Preserving urlAttempts for:",o.substring(0,50)+"...","attempts:",u.value[o]);const s=u.value[o],w=j(o,s),X={type:"existing",url:w.url,id:o,originalUrl:o,urlInfo:w,attemptIndex:s};return console.log("üìé Created image object:",{originalUrl:o.substring(0,50)+"...",attemptIndex:s,finalUrl:w.url,hasMoreFallbacks:w.hasMoreFallbacks}),X}),l=b.value.map(o=>({type:"new",...o})),t=[...e,...l];return console.log("üìä Final allImages result:",t.length,"images"),t}),L=D(()=>I.value.length>0),T=D(()=>{try{return!1}catch(e){return console.warn("Could not determine development mode:",e),!1}}),E=e=>{console.log("‚úÖ Image loaded successfully:",e),d.value[e]=!1,c.value[e]=null,console.log("üîÑ Resetting urlAttempts for image:",e),u.value[e]=0},N=(e,l)=>{if(console.error("‚ùå Image failed to load:",{imageId:e,image:l}),l.urlInfo&&l.urlInfo.isGoogleDrive&&l.urlInfo.hasMoreFallbacks){const t=(u.value[e]||0)+1;u.value[e]=t,console.log("üîÑ Trying fallback URL for Google Drive image:",{imageId:e,nextAttempt:t,totalFormats:l.urlInfo.totalFormats});return}d.value[e]=!1,l.urlInfo&&l.urlInfo.isGoogleDrive?c.value[e]=`Failed to load image after trying ${l.urlInfo.totalFormats} different URL formats. The Google Drive file may not be publicly accessible or may have been deleted.`:c.value[e]="Failed to load image. The URL may be invalid or the image may not be accessible.",console.error("‚ùå All URL attempts exhausted for image:",e)},S=e=>{const l=e.id;d.value[l]=!0,c.value[l]=null,console.log("üîÑ Starting image load:",l,"URL:",e.url,"Attempt:",e.attemptIndex)},B=e=>{console.log("üîÑ Manual retry triggered for image:",e.id),e.urlInfo&&e.urlInfo.isGoogleDrive&&e.urlInfo.hasMoreFallbacks?(u.value[e.id]=(u.value[e.id]||0)+1,c.value[e.id]=null,d.value[e.id]=!0):(u.value[e.id]=0,c.value[e.id]=null,d.value[e.id]=!0)},_=(e,l)=>{if(d.value[e.id]||c.value[e.id]){console.log("üö´ Image click ignored - image is loading or has errors:",e.id);return}console.log("üîó Opening image in new tab:",e.url),window.open(e.url,"_blank")},O=()=>{var e;i.disabled||(e=F.value)==null||e.click()},P=e=>{const l=e.target.files;l&&C(Array.from(l))},J=e=>{if(e.preventDefault(),k.value=!1,i.disabled)return;const l=e.dataTransfer.files;l&&C(Array.from(l))},K=e=>{e.preventDefault(),i.disabled||(k.value=!0)},W=()=>{k.value=!1},C=e=>{h.value="";let l=i.multiple?[...i.modelValue]:[];const t=["image/jpeg","image/jpg","image/png"],o=5*1024*1024;for(const s of e){if(!i.multiple&&l.length>0)break;if(!t.includes(s.type)){h.value="Invalid file type. Only JPEG and PNG images are allowed.",x("error",h.value);continue}if(s.size>o){h.value=`File ${s.name} is too large. Maximum size is 5MB.`,x("error",h.value);continue}l.push(s)}x("update:modelValue",l)},Z=e=>{if(e.type==="existing"){const l=i.existingImageUrls.filter(t=>t!==e.id);x("update:existingImageUrls",l)}else if(e.type==="new"){const l=i.modelValue.filter(t=>t.name+t.size!==e.id);x("update:modelValue",l)}};return R(()=>i.existingImageUrls,(e,l)=>{console.log("üîÑ existingImageUrls changed:",{newUrls:e,oldUrls:l}),H(()=>{const t=new Set(I.value.map(o=>o.id));Object.keys(d.value).forEach(o=>{t.has(o)||(delete d.value[o],delete c.value[o])}),console.log("üîÑ Updated loading states after existingImageUrls change")})},{deep:!0,immediate:!0}),R(()=>i.modelValue,e=>{if(!e||e.length===0){b.value=[];return}b.value=[];for(const l of e){const t=new FileReader;t.onload=o=>{b.value.push({url:o.target.result,file:l,id:l.name+l.size})},t.readAsDataURL(l)}},{deep:!0,immediate:!0}),(e,l)=>(a(),n("div",ie,[r("div",null,[r("label",ce,p(f.label),1),f.helperText?(a(),n("p",de,p(f.helperText),1)):v("",!0)]),L.value?(a(),n("div",ue,[(a(!0),n(Q,null,ee(I.value,(t,o)=>(a(),n("div",{key:t.id,class:G(["relative group cursor-pointer",{"cursor-zoom-in":!d.value[t.id]&&!c.value[t.id]}]),onClick:s=>_(t),onKeydown:[M(s=>_(t),["enter"]),M(A(s=>_(t),["prevent"]),["space"])],tabindex:"0",role:"button","aria-label":t.type==="new"?`View ${t.file.name} in modal viewer`:"View image in modal viewer"},[r("div",pe,[d.value[t.id]?(a(),n("div",ve,[y(g(re),{class:"w-8 h-8 text-blue-600 animate-spin"})])):c.value[t.id]?(a(),n("div",ge,[y(g(z),{class:"w-8 h-8 text-red-500 mb-2"}),r("p",he,p(c.value[t.id]),1),t.urlInfo&&t.urlInfo.isGoogleDrive?(a(),n("p",me," Tried "+p(t.urlInfo.totalFormats)+" URL formats ",1)):v("",!0),r("div",ye,[r("button",{onClick:s=>B(t),class:"text-xs text-blue-600 hover:text-blue-800 underline"},p(t.urlInfo&&t.urlInfo.isGoogleDrive&&t.urlInfo.hasMoreFallbacks?"Try Next URL":"Retry"),9,xe),t.urlInfo&&t.urlInfo.isGoogleDrive&&t.urlInfo.hasMoreFallbacks?(a(),n("span",be," ("+p(t.urlInfo.totalFormats-(t.attemptIndex+1))+" left) ",1)):v("",!0)])])):(a(),n("img",{key:2,src:t.url,alt:t.type==="new"?`${t.file.name} - Click to view in modal`:"Existing image - Click to view in modal",class:"object-cover shadow-lg rounded-lg w-full h-full hover:opacity-90 transition-opacity",onLoad:()=>E(t.id),onError:()=>N(t.id,t.url),onLoadstart:()=>S(t)},null,40,ke))]),r("div",we,[y(g(le),{variant:"destructive",size:"icon",class:"h-7 w-7 opacity-50 group-hover:opacity-100 transition-opacity pointer-events-auto",onClick:A(s=>Z(t),["stop"]),disabled:f.disabled,"aria-label":t.type==="new"?`Remove ${t.file.name}`:"Remove image"},{default:U(()=>[y(g(te),{class:"w-4 h-4"})]),_:2},1032,["onClick","disabled","aria-label"])]),T.value?(a(),n("div",Ie,[$(p(t.type==="existing"?"Existing":"New")+" ",1),t.type==="existing"?(a(),n("span",_e,"ID: "+p(t.id.substring(0,10))+"...",1)):v("",!0)])):v("",!0),!d.value[t.id]&&!c.value[t.id]?(a(),n("div",De," Click to view ")):v("",!0)],42,fe))),128))])):v("",!0),f.multiple||!L.value?(a(),n("div",{key:1,class:"relative",onClick:O,onDrop:J,onDragover:K,onDragleave:W},[r("div",{class:G(["border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",k.value?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400",f.disabled?"cursor-not-allowed opacity-60":""])},[r("div",Ue,[r("div",Fe,[y(g(ne),{class:"w-6 h-6 text-gray-400"})]),l[0]||(l[0]=r("div",null,[r("p",{class:"text-sm text-gray-600"},[r("span",{class:"font-medium text-blue-600 hover:text-blue-700"},"Click to upload")]),r("p",{class:"text-xs text-gray-500 mt-1"},"or drag and drop")],-1))])],2)],32)):v("",!0),h.value?(a(),oe(g(ae),{key:2,variant:"destructive"},{default:U(()=>[y(g(z),{class:"h-4 w-4"}),y(g(se),null,{default:U(()=>[$(p(h.value),1)]),_:1})]),_:1})):v("",!0),r("input",{ref_key:"fileInput",ref:F,type:"file",accept:["image/jpeg","image/jpg","image/png"].join(","),class:"hidden",onChange:P,disabled:f.disabled,multiple:f.multiple},null,40,Le)]))}},Ve=q(Ce,[["__scopeId","data-v-5dadcb71"]]);export{ze as C,Ve as I};
