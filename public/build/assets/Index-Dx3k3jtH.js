import{f as oe,x as S,y as le,N as I,l as b,r as k,o,c as z,w as m,a as n,g as r,u as V,b as H,n as P,d as l,h as B,e as h,t as x,F as w,C as ae,m as ne,A as Q,X as ie}from"./app-p8ycGfai.js";import{l as ue}from"./lodash-Z9yJD-f9.js";import{u as $}from"./useSelectOptions-Ci2WUICq.js";import{u as ce}from"./useToast-BAk2IYqi.js";import{C as de}from"./check-DHL4itGq.js";const pe={class:"flex items-center gap-4"},me={class:"flex items-center gap-4"},fe={class:"flex items-center gap-4"},ve={class:"p-2"},ye={class:"flex items-center gap-2 ml-auto"},ge={key:0,class:"flex items-center gap-2"},be={key:1},he={class:"bg-white border rounded-md shadow-sm"},xe={class:"overflow-x-auto max-h-[75vh] overflow-y-auto"},we={class:"min-w-full"},Ce={class:"bg-slate-100 sticky top-0 z-10 text-slate-800 shadow-sm"},_e={class:"text-sm"},Se=["colspan"],ke={class:"flex justify-center items-center gap-2 font-bold text-blue-800"},Ee={key:0,class:"text-xs font-normal mt-1"},Oe={key:0},De=["colspan"],Ie={key:0,class:"flex items-center justify-end gap-1"},Ve=["onClick"],Ne={__name:"Index",props:{report:{type:Array,required:!0},dynamicHeaders:{type:Array,required:!0},branches:{type:Object,required:!0},suppliers:{type:Object,required:!0},filters:{type:Object,required:!0},totalBranches:{type:Number,required:!0},branchStatuses:{type:Object,required:!0},permissions:{type:Object,required:!0},availableCategories:{type:Array,required:!0}},setup(T){const a=T,{toast:p}=ce(),K=oe();$(a.branches);const{options:J}=$(a.suppliers),c=S(a.filters.order_date||new Date().toISOString().slice(0,10)),f=S(a.filters.supplier_id||"all"),C=S(a.filters.category||"all"),g=S(null),E=S(""),X={mounted:t=>{const e=t.querySelector("input");e?(e.focus(),e.select()):typeof t.focus=="function"&&(t.focus(),typeof t.select=="function"&&t.select())}},A=t=>{var u;const e=(u=a.branchStatuses[t])==null?void 0:u.toLowerCase();return e==="received"||e==="incomplete"},q=t=>["FINISHED GOODS","FG","FINISHED GOOD"].includes(t.category)?a.permissions.canEditFinishedGood:a.permissions.canEditOther,Y=(t,e,u)=>{if(A(e)){p.add({severity:"warn",summary:"Editing Disabled",detail:"Cannot edit commits for this branch as its order has already been processed.",life:4e3});return}if(!q(t)){p.add({severity:"warn",summary:"Permission Denied",detail:"You do not have permission to edit items in this category.",life:4e3});return}g.value={rowIndex:u,field:e},E.value=t[e]},M=()=>{g.value=null,E.value=""},L=()=>{if(!g.value)return;const{rowIndex:t,field:e}=g.value,u=a.report[t],y=parseFloat(E.value);if(isNaN(y)||y<0){p.add({severity:"error",summary:"Invalid Input",detail:"Quantity must be a non-negative number.",life:3e3});return}I.post(route("cs-mass-commits.update-commit"),{order_date:c.value,item_code:u.item_code,brand_code:e,new_quantity:y},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.add({severity:"success",summary:"Success",detail:"Commit quantity updated.",life:3e3}),M()},onError:d=>{const _=Object.values(d)[0]||"An unknown error occurred.";p.add({severity:"error",summary:"Update Failed",detail:_,life:5e3})}})},v=S(!1),W=()=>{if(v.value){p.add({severity:"warn",summary:"Processing",detail:"Commit process is already running. Please wait.",life:3e3});return}K.require({message:`Are you sure you want to commit all orders for ${c.value}? This action cannot be undone.`,header:"Confirm All Commits",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-success",rejectClass:"p-button-danger",accept:()=>{console.log("CS Mass Commits - Starting confirm-all request",{order_date:c.value,supplier_id:f.value,timestamp:new Date().toISOString()}),v.value=!0,I.post(route("cs-mass-commits.confirm-all"),{order_date:c.value,supplier_id:f.value},{preserveState:!0,preserveScroll:!0,onStart:()=>{console.log("CS Mass Commits - Request started"),p.add({severity:"info",summary:"Processing",detail:"Committing orders... This may take a moment.",life:2e3})},onSuccess:t=>{var d,_,O,D;console.log("CS Mass Commits - Request successful",{response:t,timestamp:new Date().toISOString()}),v.value=!1;const u=((d=t.props.flash)==null?void 0:d.success)||((_=t.props.flash)==null?void 0:_.info)||"Orders have been processed.",y=(O=t.props.flash)!=null&&O.success?"success":(D=t.props.flash)!=null&&D.info?"info":"success";p.add({severity:y,summary:"Success",detail:u,life:4e3}),setTimeout(()=>{I.reload({preserveScroll:!0,onSuccess:()=>{console.log("CS Mass Commits - Page reloaded successfully")}})},500)},onError:t=>{console.error("CS Mass Commits - Request failed",{errors:t,timestamp:new Date().toISOString()}),v.value=!1;const e=Object.values(t)[0]||"An unknown error occurred during the commit process.";p.add({severity:"error",summary:"Commit Failed",detail:e,life:6e3})},onFinish:()=>{console.log("CS Mass Commits - Request finished"),v.value=!1}})},reject:()=>{console.log("CS Mass Commits - User cancelled the commit operation")}})},Z=t=>{switch(t==null?void 0:t.toUpperCase()){case"RECEIVED":return"bg-green-500 text-white";case"APPROVED":return"bg-teal-500 text-white";case"INCOMPLETE":return"bg-orange-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMMITTED":return"bg-blue-500 text-white";case"PARTIAL_COMMITTED":return"bg-indigo-500 text-white";case"REJECTED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}};le([c,f,C],ue.throttle(()=>{I.get(route("cs-mass-commits.index"),{order_date:c.value,supplier_id:f.value,category:C.value},{preserveState:!0,preserveScroll:!0,replace:!0})},300));const ee=()=>{c.value=new Date().toISOString().slice(0,10),f.value="all",C.value="all"},te=b(()=>{const t=Object.values(a.branchStatuses);return t.length===0?!1:t.some(e=>(e==null?void 0:e.toLowerCase())!=="received"&&(e==null?void 0:e.toLowerCase())!=="incomplete")}),se=b(()=>route("cs-mass-commits.export",{order_date:c.value,supplier_id:f.value})),F=b(()=>a.dynamicHeaders.slice(0,4)),N=b(()=>a.dynamicHeaders.slice(4,-2)),R=b(()=>a.dynamicHeaders.slice(-2)),U=b(()=>N.value.length),re=b(()=>F.value.length+U.value+R.value.length);return(t,e)=>{const u=k("Input"),y=k("Select"),d=k("Button"),_=k("TableHeader"),O=k("TableContainer"),D=k("Layout");return o(),z(D,{heading:"CS Mass Commits",hasExcelDownload:!0,exportRoute:se.value},{default:m(()=>[n(O,null,{default:m(()=>[n(_,{class:"flex-wrap"},{default:m(()=>[r("div",pe,[e[5]||(e[5]=r("label",{for:"order_date",class:"text-sm font-medium text-gray-700"},"Date:",-1)),n(u,{id:"order_date",type:"date",modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"w-48"},null,8,["modelValue"])]),r("div",me,[e[6]||(e[6]=r("label",{for:"supplier_filter",class:"text-sm font-medium text-gray-700"},"Supplier:",-1)),n(y,{id:"supplier_filter",filter:"",placeholder:"Select a Supplier",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),options:V(J),optionLabel:"label",optionValue:"value",class:"w-64"},null,8,["modelValue","options"])]),r("div",fe,[e[8]||(e[8]=r("label",{for:"category_filter",class:"text-sm font-medium text-gray-700"},"Category:",-1)),n(y,{id:"category_filter",filter:"",placeholder:"All Categories",modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=s=>C.value=s),options:a.availableCategories.map(s=>({label:s,value:s})),optionLabel:"label",optionValue:"value",class:"w-64"},{header:m(()=>[r("div",ve,[n(d,{text:"",onClick:e[2]||(e[2]=s=>C.value="all"),class:"w-full text-left"},{default:m(()=>e[7]||(e[7]=[H("All Categories")])),_:1})])]),_:1},8,["modelValue","options"])]),r("div",ye,[n(d,{onClick:ee,variant:"outline"},{default:m(()=>e[9]||(e[9]=[H(" Reset Filters ")])),_:1}),te.value?(o(),z(d,{key:0,onClick:W,variant:"destructive",disabled:v.value,class:P({"opacity-50 cursor-not-allowed":v.value})},{default:m(()=>[v.value?(o(),l("span",ge,e[10]||(e[10]=[r("svg",{class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),H(" Processing... ")]))):(o(),l("span",be,"Confirm All Commits"))]),_:1},8,["disabled","class"])):B("",!0)])]),_:1}),r("div",he,[r("div",xe,[r("table",we,[r("thead",Ce,[r("tr",_e,[(o(!0),l(w,null,h(F.value,s=>(o(),l("th",{key:s.field,rowspan:"2",class:"px-4 py-3 text-left whitespace-nowrap font-bold border-b-2 border-slate-200 bg-slate-200"},x(s.label),1))),128)),r("th",{colspan:U.value,class:"px-4 py-4 text-center bg-blue-100 border-b-2 border-slate-200"},[r("div",ke,[e[11]||(e[11]=r("span",null,"BRANCH QUANTITIES",-1)),n(V(ae),{class:"w-4 h-4"})])],8,Se),(o(!0),l(w,null,h(R.value,s=>(o(),l("th",{key:s.field,rowspan:"2",class:"px-4 py-3 text-right whitespace-nowrap font-bold border-b-2 border-slate-200 bg-slate-200"},x(s.label),1))),128))]),r("tr",null,[(o(!0),l(w,null,h(N.value,s=>(o(),l("th",{key:s.field,class:"px-4 py-2 text-center whitespace-nowrap font-semibold border-b-2 border-slate-200 bg-blue-50"},[r("div",null,x(s.label.replace(" Qty","")),1),a.branchStatuses[s.field]?(o(),l("div",Ee,[r("span",{class:P([Z(a.branchStatuses[s.field]),"px-2 py-1 rounded-full shadow-sm"])},x(a.branchStatuses[s.field].toUpperCase()),3)])):B("",!0)]))),128))])]),r("tbody",null,[T.report.length===0?(o(),l("tr",Oe,[r("td",{colspan:re.value,class:"text-center p-4"},"No data available for the selected filters.",8,De)])):B("",!0),(o(!0),l(w,null,h(T.report,(s,j)=>(o(),l("tr",{key:j,class:"border-t"},[(o(!0),l(w,null,h(F.value,i=>(o(),l("td",{key:i.field,class:"px-4 py-3 text-left whitespace-nowrap"},x(s[i.field]),1))),128)),(o(!0),l(w,null,h(N.value,i=>(o(),l("td",{key:i.field,class:"px-4 py-3 text-right whitespace-nowrap"},[g.value&&g.value.rowIndex===j&&g.value.field===i.field?(o(),l("div",Ie,[ne(n(u,{type:"number",modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=G=>E.value=G),class:"w-24 text-right py-1",onKeyup:[Q(L,["enter"]),Q(M,["esc"])]},null,8,["modelValue"]),[[X]]),n(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-green-600 hover:bg-green-100",onClick:L},{default:m(()=>[n(V(de),{class:"h-4 w-4"})]),_:1}),n(d,{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-600 hover:bg-red-100",onClick:M},{default:m(()=>[n(V(ie),{class:"h-4 w-4"})]),_:1})])):(o(),l("div",{key:1,onClick:G=>Y(s,i.field,j),class:P(["p-1 rounded min-h-[36px] flex items-center justify-end transition-all duration-150",{"cursor-pointer hover:bg-blue-100 hover:ring-1 hover:ring-blue-400":!A(i.field)&&q(s),"cursor-not-allowed bg-gray-50 text-gray-500":A(i.field)||!q(s)}])},x(s[i.field]),11,Ve))]))),128)),(o(!0),l(w,null,h(R.value,i=>(o(),l("td",{key:i.field,class:"px-4 py-3 text-right whitespace-nowrap"},x(s[i.field]),1))),128))]))),128))])])])])]),_:1})]),_:1},8,["exportRoute"])}}};export{Ne as default};
