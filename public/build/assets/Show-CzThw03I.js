import{f as de,x as C,y as ce,T as me,r as c,o as u,c as v,w as o,a as s,g as l,b as n,t as i,u as m,aZ as L,n as fe,h as E,d as x,e as Q,m as z,A,X as R,F as $,N as pe}from"./app-Bp7xdNcv.js";import{u as _e}from"./useBackButton-B5cTAtmc.js";import{u as ye}from"./useToast-BYf4YE8m.js";import{u as ve}from"./useAuth-Bvg2Md3x.js";import{S as j}from"./save-DFGjJjgb.js";import{S as K}from"./square-pen-BXz0dBaO.js";const ge={class:"flex flex-col gap-5"},be={class:"sm:flex-row flex flex-col gap-5"},xe={class:"text-gray-700 text-sm"},ke={class:"font-bold"},Ce={class:"text-gray-700 text-sm"},he={class:"font-bold"},we={class:"text-gray-700 text-sm"},Se={class:"font-bold"},Te={class:"sm:flex-row flex flex-col gap-5"},Ne={class:"text-gray-700 text-sm"},De={class:"font-bold"},qe={class:"text-gray-700 text-sm"},Ie={class:"sm:flex-row flex flex-col gap-5"},Oe={class:"text-gray-700 text-sm"},Ee={class:"font-bold"},Ae={class:"text-gray-700 text-sm"},Ve={class:"font-bold"},Me={class:"font-medium"},Be={key:0},Pe={key:1,class:"flex items-center gap-2"},Fe={key:0},He={key:0},Ue={key:1},Ke={__name:"Show",props:{order:{type:Object,required:!0},items:{type:Object,required:!0}},setup(d){const X=de(),{toast:N}=ye(),{hasAccess:V}=ve(),{backButton:G}=_e(route("store-commits.index")),M=d,Z=t=>t?new Date(t).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"}):"N/A",J=t=>{var e,r;return((e=t.store_branch)==null?void 0:e.name)||((r=t.store_branch)==null?void 0:r.branch_name)||t.store_name||"Unknown Store"},W=t=>{switch(t==null?void 0:t.toUpperCase()){case"APPROVED":return"bg-blue-500 text-white";case"COMMITTED":return"bg-yellow-500 text-white";case"PENDING":return"bg-gray-500 text-white";case"DECLINED":return"bg-red-500 text-white";case"OPEN":return"bg-gray-500 text-white";case"IN_TRANSIT":return"bg-purple-500 text-white";case"RECEIVED":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}},B=t=>{var e,r;return t.item_description||((e=t.sapMasterfile)==null?void 0:e.ItemDescription)||((r=t.sapMasterfile)==null?void 0:r.ItemName)||t.description||"Description not available"},D=t=>t.item_uom||t.uom||"",w=C(!1),Y=C(!1);C(!1);const p=C(null),g=C("");C(null);const P={mounted:t=>{const e=t.tagName==="INPUT"?t:t.querySelector("input");e&&(e.focus(),e.select())}};ce(Y,t=>{t||(w.value=!1,S.reset(),S.clearErrors())});const S=me({order_id:null,action:"commit",remarks:null}),ee=t=>{X.require({message:"Are you sure you want to transit this store order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{w.value=!0,S.order_id=t,S.action="commit",S.post(route("store-commits.commit"),{onSuccess:()=>{N.add({severity:"success",summary:"Success",detail:"Store Order Transited Successfully.",life:3e3}),w.value=!1},onError:()=>{w.value=!1}})}})},T=C([]);M.items.forEach(t=>T.value.push({id:t.id,quantity_approved:t.quantity_approved,quantity_commited:t.quantity_commited||t.quantity_approved,item_code:t.item_code,description:t.description,soh_stock:t.soh_stock,uom:t.uom}));const F=t=>{const e=T.value.find(r=>r.id===t);e&&(p.value={id:t,originalValue:e.quantity_commited},g.value=e.quantity_commited.toString())},q=()=>{if(!p.value)return;const t=parseFloat(g.value);if(isNaN(t)||t<0){N.add({severity:"error",summary:"Error",detail:"Please enter a valid quantity.",life:3e3});return}const e=Number(t.toFixed(2)),r=p.value.id;p.value.originalValue;const y=T.value.find(f=>f.id===r);y&&(y.quantity_commited=e);const _=M.items.find(f=>f.id===r);_&&(_.quantity_commited=e),te(r,e),p.value=null,g.value=""},I=()=>{p.value=null,g.value=""},te=(t,e)=>{console.log("Updating quantity for item:",t,"quantity:",e),pe.post(route("store-commits.update-quantity",t),{quantity_commited:e},{preserveScroll:!0,onSuccess:r=>{console.log("Quantity update successful"),N.add({severity:"success",summary:"Success",detail:"Quantity updated successfully.",life:2e3})},onError:r=>{console.log("Quantity update failed with errors:",r);let y="Failed to update quantity. Please refresh the page.";if(r&&typeof r=="object"){const _=Object.values(r);_.length>0&&_[0]&&(y=Array.isArray(_[0])?_[0][0]:_[0])}console.error("Detailed error information:",{errors:r,itemId:t,quantity:e,timestamp:new Date().toISOString()}),N.add({severity:"error",summary:"Update Failed",detail:y,life:5e3})}})};return(t,e)=>{const r=c("Button"),y=c("DivFlexCenter"),_=c("TableHeader"),f=c("TH"),oe=c("TableHead"),k=c("TD"),H=c("Input"),se=c("TableBody"),ne=c("Table"),ae=c("MobileTableHeading"),O=c("LabelXS"),re=c("MobileTableRow"),le=c("MobileTableContainer"),ie=c("TableContainer"),ue=c("Layout");return u(),v(ue,{heading:"Store Order Details"},{default:o(()=>[s(ie,null,{default:o(()=>{var U;return[l("section",ge,[l("section",be,[l("span",xe,[e[3]||(e[3]=n(" Order Number: ")),l("span",ke,i(d.order.order_number),1)]),l("span",Ce,[e[4]||(e[4]=n(" Store: ")),l("span",he,i(J(d.order)),1)]),l("span",we,[e[5]||(e[5]=n(" Supplier: ")),l("span",Se,i(((U=d.order.supplier)==null?void 0:U.name)??"N/A"),1)])]),l("section",Te,[l("span",Ne,[e[6]||(e[6]=n(" Order Date: ")),l("span",De,i(Z(d.order.order_date)),1)]),l("span",qe,[e[7]||(e[7]=n(" Interco Status: ")),s(m(L),{class:fe([W(d.order.interco_status),"font-bold"])},{default:o(()=>{var a;return[n(i(((a=d.order.interco_status)==null?void 0:a.toUpperCase())??"N/A"),1)]}),_:1},8,["class"])])]),l("section",Ie,[l("span",Oe,[e[8]||(e[8]=n(" Interco Reason: ")),l("span",Ee,i(d.order.interco_reason??"N/A"),1)]),l("span",Ae,[e[9]||(e[9]=n(" Remarks: ")),l("span",Ve,i(d.order.remarks??"N/A"),1)])]),s(y,{class:"gap-5"},{default:o(()=>[d.order.interco_status==="approved"&&m(V)("commit store orders")?(u(),v(r,{key:0,class:"bg-green-500 hover:bg-green-300",onClick:e[0]||(e[0]=a=>ee(d.order.id)),disabled:w.value},{default:o(()=>e[10]||(e[10]=[n(" Transit Orders ")])),_:1},8,["disabled"])):E("",!0)]),_:1})]),s(_),s(ne,null,{default:o(()=>[s(oe,null,{default:o(()=>[s(f,null,{default:o(()=>e[11]||(e[11]=[n(" Item Code ")])),_:1}),s(f,null,{default:o(()=>e[12]||(e[12]=[n(" Description ")])),_:1}),s(f,null,{default:o(()=>e[13]||(e[13]=[n(" UOM ")])),_:1}),s(f,null,{default:o(()=>e[14]||(e[14]=[n(" Approved Qty ")])),_:1}),s(f,null,{default:o(()=>e[15]||(e[15]=[n(" SOH Stock ")])),_:1}),d.order.interco_status==="approved"?(u(),v(f,{key:0},{default:o(()=>e[16]||(e[16]=[n("Committed Qty")])),_:1})):(u(),v(f,{key:1},{default:o(()=>e[17]||(e[17]=[n("Committed Qty")])),_:1}))]),_:1}),s(se,null,{default:o(()=>[(u(!0),x($,null,Q(d.items,a=>(u(),x("tr",{key:a.id},[s(k,null,{default:o(()=>[n(i(a.item_code),1)]),_:2},1024),s(k,null,{default:o(()=>[l("div",null,[l("p",Me,i(B(a)),1),D(a)?(u(),v(m(L),{key:0,variant:"outline",class:"text-xs mt-1"},{default:o(()=>[n(i(D(a)),1)]),_:2},1024)):E("",!0)])]),_:2},1024),s(k,null,{default:o(()=>[n(i(D(a)??"N/A"),1)]),_:2},1024),s(k,null,{default:o(()=>[n(i(a.quantity_approved),1)]),_:2},1024),s(k,null,{default:o(()=>[n(i(a.soh_stock??0),1)]),_:2},1024),d.order.interco_status==="approved"?(u(),v(k,{key:0,class:"flex items-center gap-3"},{default:o(()=>{var b;return[p.value&&p.value.id===a.id?(u(),x("div",Be,[z(s(H,{type:"number",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=h=>g.value=h),class:"w-20 text-right",onKeyup:[A(q,["enter"]),A(I,["esc"])]},null,8,["modelValue"]),[[P]]),s(y,{class:"gap-1 ml-2"},{default:o(()=>[s(m(j),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:q}),s(m(R),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:I})]),_:1})])):(u(),x("div",Pe,[n(i(((b=T.value.find(h=>h.id===a.id))==null?void 0:b.quantity_commited)||0)+" ",1),m(V)("commit store orders")?(u(),v(m(K),{key:0,class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:h=>F(a.id)},null,8,["onClick"])):E("",!0)]))]}),_:2},1024)):(u(),v(k,{key:1},{default:o(()=>[n(i(a.quantity_commited),1)]),_:2},1024))]))),128))]),_:1})]),_:1}),s(le,null,{default:o(()=>[(u(!0),x($,null,Q(d.items,a=>(u(),v(re,{key:a.id},{default:o(()=>[s(ae,{title:`${B(a)} (${a.item_code})`},{default:o(()=>[d.order.interco_status==="approved"&&m(V)("commit store orders")?(u(),x("div",Fe,[p.value&&p.value.id===a.id?(u(),x("div",He,[z(s(H,{type:"number",modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=b=>g.value=b),class:"w-20 text-right",onKeyup:[A(q,["enter"]),A(I,["esc"])]},null,8,["modelValue"]),[[P]]),s(y,{class:"gap-1 ml-2"},{default:o(()=>[s(m(j),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:q}),s(m(R),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:I})]),_:1})])):(u(),x("div",Ue,[s(m(K),{class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:b=>F(a.id)},null,8,["onClick"])]))])):E("",!0)]),_:2},1032,["title"]),s(O,null,{default:o(()=>[n("UOM: "+i(D(a)??"N/A"),1)]),_:2},1024),s(O,null,{default:o(()=>[n("Approved: "+i(a.quantity_approved),1)]),_:2},1024),s(O,null,{default:o(()=>[n("SOH Stock: "+i(a.soh_stock??0),1)]),_:2},1024),s(O,null,{default:o(()=>{var b;return[n(" Committed: "+i(((b=T.value.find(h=>h.id===a.id))==null?void 0:b.quantity_commited)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]}),_:1}),s(r,{variant:"outline",class:"text-lg px-7",onClick:m(G)},{default:o(()=>e[18]||(e[18]=[n(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{Ke as default};
