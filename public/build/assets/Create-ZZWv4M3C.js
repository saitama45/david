import{f as Ie,T as M,r as s,o as b,c as $,w as o,g as c,a as t,b as n,u as r,s as A,t as i,i as z,d as I,e as J,F as X,h as Se}from"./app-rjK1ng7o.js";import{u as Oe}from"./useBackButton-B9bUould.js";import{u as W}from"./useSelectOptions-C8yZk_6t.js";import{u as Be}from"./useToast-DBCD-RTl.js";import{u as Ee}from"./useEditQuantity-BCpCvMmE.js";const Le={class:"grid sm:grid-cols-3 gap-5 grid-cols-1"},we={class:"grid gap-5"},Me={class:"flex flex-col space-y-1"},Ue={class:"flex flex-col space-y-1"},Pe={class:"flex flex-col space-y-1"},Qe={class:"flex flex-col space-y-1"},je={class:"flex flex-col space-y-1"},He={class:"flex flex-col space-y-1"},Ne={class:"flex flex-col space-y-1"},Re={class:"flex flex-col space-y-1"},$e=["onClick"],Ae=["onClick"],ze=["onClick"],Je=["onClick"],Xe={key:0},he={__name:"Create",props:{products:{type:Object,required:!1},branches:{type:Object,required:!1}},setup(Y){const{backButton:G}=Oe(route("direct-receiving.index")),S=Ie(),{toast:x}=Be(),v=ref(null);onBeforeMount(()=>{const u=localStorage.getItem("storeStoreOrderDraft");u&&(v.value=JSON.parse(u))}),onMounted(()=>{v.value!=null&&S.require({message:"You have an unfinished draft. Would you like to continue where you left off or discard the draft?",header:"Unfinished Draft Detected",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Discard",severity:"danger"},acceptProps:{label:"Continue",severity:"primary"},accept:()=>{l.supplier_id=v.value.supplier_id,l.store_branch_id=v.value.store_branch_id,l.order_date=v.value.order_date,l.orders=v.value.orders}})});const U=Y,{options:K}=W(U.products),{options:Z}=W(U.branches),C=ref(null),h=ref(!1),V=ref(!1);watch(h,u=>{u||(P.reset(),P.clearErrors())});const d=reactive({id:null,inventory_code:null,name:null,unit_of_measurement:null,quantity:null,cost:null,total_cost:null}),P=M({orders_file:null}),l=M({store_branch_id:"",vendor:"",vendor_address:"",date_needed:null,orders:[]}),ee=computed(()=>l.orders.reduce((u,e)=>u+parseFloat(e.total_cost),0).toFixed(2)),m=M({item:null}),te=()=>{if(l.orders.length<1){x.add({severity:"error",summary:"Error",detail:"Please select at least one item before proceeding.",life:5e3});return}S.require({message:"Are you sure you want to place this order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{l.post(route("direct-receiving.store"),{onSuccess:()=>{x.add({severity:"success",summary:"Success",detail:"Order Created Successfully.",life:5e3}),localStorage.removeItem("storeStoreOrderDraft")},onError:u=>{x.add({severity:"error",summary:"Error",detail:"Can't place the order.",life:5e3})}})}})};watch(C,u=>{u&&(V.value=!0,m.item=u,axios.get(route("product.show",u)).then(e=>e.data).then(e=>{d.id=e.id,d.name=e.name,d.inventory_code=e.inventory_code,d.unit_of_measurement=e.unit_of_measurement,d.cost=e.cost}).catch(e=>console.log(e)).finally(()=>V.value=!1))});const oe=()=>{if(m.clearErrors(),!m.item){m.setError("item","Item field is required");return}if(Number(d.quantity)<.1){m.setError("quantity","Quantity must be at least 0.1");return}if(!d.inventory_code||!d.name||!d.unit_of_measurement||!d.quantity)return;const u=l.orders.findIndex(e=>e.id===d.id);if(u!==-1){const e=l.orders[u].quantity+=Number(d.quantity);l.orders[u].total_cost=parseFloat(d.cost*e).toFixed(2)}else d.total_cost=parseFloat(d.cost*d.quantity).toFixed(2),l.orders.push({...d});Object.keys(d).forEach(e=>{d[e]=null}),C.value=null,x.add({severity:"success",summary:"Success",detail:"Item added successfully.",life:5e3}),m.item=null,m.clearErrors()},le=u=>{const e=l.orders.findIndex(f=>f.id===u);l.orders[e].quantity=parseFloat((l.orders[e].quantity+.1).toFixed(2)),l.orders[e].total_cost=parseFloat(l.orders[e].quantity*l.orders[e].cost).toFixed(2)},ne=u=>{const e=l.orders.findIndex(f=>f.id===u);if(l.orders[e].quantity=parseFloat((l.orders[e].quantity-.1).toFixed(2)),l.orders[e].quantity<.1){l.orders=l.orders.filter(f=>f.id!==u);return}l.orders[e].total_cost=parseFloat(l.orders[e].quantity*l.orders[e].cost).toFixed(2)},Q=u=>{S.require({message:"Are you sure you want to remove this item from your orders?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Remove",severity:"danger"},accept:()=>{l.orders=l.orders.filter(e=>e.id!==u),x.add({severity:"success",summary:"Confirmed",detail:"Item Removed",life:3e3})}})},{isEditQuantityModalOpen:O,formQuantity:B,openEditQuantityModal:ae,editQuantity:se}=Ee(l);return watch(l,u=>{localStorage.setItem("storeStoreOrderDraft",JSON.stringify(u))}),(u,e)=>{const f=s("CardTitle"),j=s("CardDescription"),E=s("CardHeader"),k=s("InputLabel"),p=s("FormError"),re=s("DatePicker"),g=s("Input"),de=s("Textarea"),L=s("CardContent"),w=s("Card"),q=s("Label"),T=s("Button"),H=s("CardFooter"),D=s("LabelXS"),ue=s("SpanBold"),N=s("DivFlexCenter"),_=s("TH"),ie=s("TableHead"),y=s("TD"),ce=s("LinkButton"),R=s("Trash2"),me=s("TableBody"),fe=s("Table"),pe=s("Minus"),_e=s("Plus"),ye=s("MobileTableHeading"),ve=s("MobileTableRow"),be=s("MobileTableContainer"),xe=s("DialogTitle"),Ce=s("DialogDescription"),ge=s("DialogHeader"),De=s("InputContainer"),Ve=s("Loading"),ke=s("DialogFooter"),qe=s("DialogContent"),Te=s("Dialog"),Fe=s("Layout");return b(),$(Fe,{heading:"Direct Receiving"},{default:o(()=>[c("div",Le,[c("section",we,[t(w,null,{default:o(()=>[t(E,null,{default:o(()=>[t(f,null,{default:o(()=>e[10]||(e[10]=[n("Order Details")])),_:1}),t(j,null,{default:o(()=>e[11]||(e[11]=[n("Please input all the fields")])),_:1})]),_:1}),t(L,{class:"space-y-3"},{default:o(()=>[c("div",Me,[t(k,{label:"Store Branch"}),t(r(A),{filter:"",placeholder:"Select a Store",modelValue:r(l).store_branch_id,"onUpdate:modelValue":e[0]||(e[0]=a=>r(l).store_branch_id=a),options:r(Z),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(p,null,{default:o(()=>[n(i(r(l).errors.store_branch_id),1)]),_:1})]),c("div",Ue,[t(k,{label:"Received Date"}),t(re,{showIcon:"",fluid:"",dateFormat:"yy/mm/dd",modelValue:r(l).date_needed,"onUpdate:modelValue":e[1]||(e[1]=a=>r(l).date_needed=a),showOnFocus:!1,manualInput:!0,maxDate:new Date},null,8,["modelValue","maxDate"]),t(p,null,{default:o(()=>[n(i(r(l).errors.date_needed),1)]),_:1})]),c("div",Pe,[t(k,{label:"Vendor"}),t(g,{modelValue:r(l).vendor,"onUpdate:modelValue":e[2]||(e[2]=a=>r(l).vendor=a)},null,8,["modelValue"]),t(p,null,{default:o(()=>[n(i(r(l).errors.vendor),1)]),_:1})]),c("div",Qe,[t(k,{label:"Vendor Address"}),t(de,{modelValue:r(l).vendor_address,"onUpdate:modelValue":e[3]||(e[3]=a=>r(l).vendor_address=a)},null,8,["modelValue"]),t(p,null,{default:o(()=>[n(i(r(l).errors.vendor_address),1)]),_:1})])]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(E,null,{default:o(()=>[t(f,null,{default:o(()=>e[12]||(e[12]=[n("Add Item")])),_:1}),t(j,null,{default:o(()=>e[13]||(e[13]=[n("Please input all the fields")])),_:1})]),_:1}),t(L,{class:"space-y-3"},{default:o(()=>[c("div",je,[t(q,null,{default:o(()=>e[14]||(e[14]=[n("Item")])),_:1}),t(r(A),{filter:"",placeholder:"Select an Item",modelValue:r(C),"onUpdate:modelValue":e[4]||(e[4]=a=>z(C)?C.value=a:null),options:r(K),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(p,null,{default:o(()=>[n(i(r(m).errors.item),1)]),_:1})]),c("div",He,[t(q,null,{default:o(()=>e[15]||(e[15]=[n("Unit Of Measurement (UOM)")])),_:1}),t(g,{type:"text",disabled:"",modelValue:r(d).unit_of_measurement,"onUpdate:modelValue":e[5]||(e[5]=a=>r(d).unit_of_measurement=a)},null,8,["modelValue"])]),c("div",Ne,[t(q,null,{default:o(()=>e[16]||(e[16]=[n("Cost")])),_:1}),t(g,{type:"text",modelValue:r(d).cost,"onUpdate:modelValue":e[6]||(e[6]=a=>r(d).cost=a)},null,8,["modelValue"])]),c("div",Re,[t(q,null,{default:o(()=>e[17]||(e[17]=[n("Quantity")])),_:1}),t(g,{type:"number",modelValue:r(d).quantity,"onUpdate:modelValue":e[7]||(e[7]=a=>r(d).quantity=a)},null,8,["modelValue"]),t(p,null,{default:o(()=>[n(i(r(m).errors.quantity),1)]),_:1})])]),_:1}),t(H,{class:"flex justify-end"},{default:o(()=>[t(T,{onClick:oe},{default:o(()=>e[18]||(e[18]=[n(" Add to Orders ")])),_:1})]),_:1})]),_:1})]),t(w,{class:"col-span-2 flex flex-col"},{default:o(()=>[t(E,{class:"flex justify-between"},{default:o(()=>[t(N,{class:"justify-between"},{default:o(()=>[t(f,null,{default:o(()=>e[19]||(e[19]=[n("Items List")])),_:1}),t(N,{class:"gap-2"},{default:o(()=>[t(D,null,{default:o(()=>e[20]||(e[20]=[n(" Overall Total:")])),_:1}),t(ue,null,{default:o(()=>[n(i(r(ee)),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(L,{class:"flex-1"},{default:o(()=>[t(fe,null,{default:o(()=>[t(ie,null,{default:o(()=>[t(_,null,{default:o(()=>e[21]||(e[21]=[n(" Name ")])),_:1}),t(_,null,{default:o(()=>e[22]||(e[22]=[n(" Code ")])),_:1}),t(_,null,{default:o(()=>e[23]||(e[23]=[n(" Quantity ")])),_:1}),t(_,null,{default:o(()=>e[24]||(e[24]=[n(" Unit ")])),_:1}),t(_,null,{default:o(()=>e[25]||(e[25]=[n(" Cost ")])),_:1}),t(_,null,{default:o(()=>e[26]||(e[26]=[n(" Total Cost ")])),_:1}),t(_,null,{default:o(()=>e[27]||(e[27]=[n(" Action ")])),_:1})]),_:1}),t(me,null,{default:o(()=>[(b(!0),I(X,null,J(r(l).orders,a=>(b(),I("tr",{key:a.item_code},[t(y,null,{default:o(()=>[n(i(a.name),1)]),_:2},1024),t(y,null,{default:o(()=>[n(i(a.inventory_code),1)]),_:2},1024),t(y,null,{default:o(()=>[n(i(a.quantity),1)]),_:2},1024),t(y,null,{default:o(()=>[n(i(a.unit_of_measurement),1)]),_:2},1024),t(y,null,{default:o(()=>[n(i(a.cost),1)]),_:2},1024),t(y,null,{default:o(()=>[n(i(a.total_cost),1)]),_:2},1024),t(y,{class:"flex gap-3"},{default:o(()=>[t(ce,{onClick:F=>r(ae)(a.id,a.quantity)},{default:o(()=>e[28]||(e[28]=[n(" Edit Quantity ")])),_:2},1032,["onClick"]),c("button",{onClick:F=>Q(a.id),variant:"outline",class:"text-red-500"},[t(R)],8,$e)]),_:2},1024)]))),128))]),_:1})]),_:1}),t(be,null,{default:o(()=>[(b(!0),I(X,null,J(r(l).orders,a=>(b(),$(ve,{key:a.item_code},{default:o(()=>[t(ye,{title:`${a.name} (${a.inventory_code})`},{default:o(()=>[c("button",{class:"text-red-500 size-5",onClick:F=>ne(a.id)},[t(pe)],8,Ae),c("button",{class:"text-green-500 size-5",onClick:F=>le(a.id)},[t(_e)],8,ze),c("button",{onClick:F=>Q(a.id),variant:"outline",class:"text-red-500 size-5"},[t(R)],8,Je)]),_:2},1032,["title"]),t(D,null,{default:o(()=>[n("UOM: "+i(a.unit_of_measurement),1)]),_:2},1024),t(D,null,{default:o(()=>[n("Quantity: "+i(a.quantity),1)]),_:2},1024),t(D,null,{default:o(()=>[n("Cost: "+i(a.cost),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(H,{class:"flex justify-end"},{default:o(()=>[t(T,{onClick:te},{default:o(()=>e[29]||(e[29]=[n("Save")])),_:1})]),_:1})]),_:1})]),t(Te,{open:r(O),"onUpdate:open":e[9]||(e[9]=a=>z(O)?O.value=a:null)},{default:o(()=>[t(qe,{class:"sm:max-w-[600px]"},{default:o(()=>[t(ge,null,{default:o(()=>[t(xe,null,{default:o(()=>e[30]||(e[30]=[n("Edit Quantity")])),_:1}),t(Ce,null,{default:o(()=>e[31]||(e[31]=[n(" Please input all the required fields. ")])),_:1})]),_:1}),t(De,null,{default:o(()=>[t(D,null,{default:o(()=>e[32]||(e[32]=[n("Quantity")])),_:1}),t(g,{type:"number",modelValue:r(B).quantity,"onUpdate:modelValue":e[8]||(e[8]=a=>r(B).quantity=a)},null,8,["modelValue"]),t(p,null,{default:o(()=>[n(i(r(B).errors.quantity),1)]),_:1})]),_:1}),t(ke,null,{default:o(()=>[t(T,{onClick:r(se),disabled:r(V),type:"submit",class:"gap-2"},{default:o(()=>[e[33]||(e[33]=n(" Confirm ")),r(V)?(b(),I("span",Xe,[t(Ve)])):Se("",!0)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(T,{variant:"outline",class:"text-lg px-7",onClick:r(G)},{default:o(()=>e[34]||(e[34]=[n(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{he as default};
