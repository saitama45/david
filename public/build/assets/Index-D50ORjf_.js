import{x as M,T as W,y as X,N as z,l as ee,r as y,o,d as m,a as t,u,Z as le,w as n,g as a,t as r,b as i,aY as te,h as c,k as S,F as C,e as A,E,c as b,n as P}from"./app-DZB5krWT.js";import{l as ae}from"./lodash-gd7BEsaJ.js";import{_ as q}from"./InputError-Dc51D8Mg.js";import{U as oe}from"./upload-CvWl6ZJn.js";import{A as V,a as U}from"./arrow-up-1_eznSVm.js";const ne={class:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md"},se={key:0,class:"mb-6 p-4 border border-blue-300 bg-blue-50 rounded-md text-blue-800"},de={class:"font-medium"},ue={class:"text-sm mt-1"},re={class:"mt-4"},ie=["href"],ce={key:1,class:"mt-4 text-sm text-gray-600"},me={key:1,class:"mb-6 p-4 border border-green-300 bg-green-50 rounded-md text-green-800"},pe={class:"font-medium"},be={key:0,class:"text-sm mt-1"},fe={class:"flex justify-end"},ve={key:2,class:"mt-6 p-4 border border-purple-300 bg-purple-50 rounded-md text-purple-800"},he={class:"list-disc pl-5 space-y-1"},ye={key:3,class:"mb-6 p-4 border border-gray-300 bg-gray-50 rounded-md text-gray-800"},ge={class:"font-medium"},we={class:"mt-8"},xe={class:"hidden md:block"},_e={key:0},ke=["colspan"],Se={class:"flex flex-wrap gap-1"},Ce={class:"md:hidden grid grid-cols-1 gap-4"},Ve={key:0,class:"text-center py-4 text-gray-500"},Ue={class:"flex justify-between items-start"},Te={class:"font-semibold text-gray-800"},Be={class:"text-sm text-gray-600"},De={class:"text-xs text-gray-500"},$e={class:"mt-4 pt-4 border-t"},Ae={class:"text-sm mb-2"},je={class:"font-medium text-gray-800"},Oe={class:"text-sm"},Me={class:"flex flex-wrap gap-1 mt-1"},Pe={__name:"Index",props:{downloadSchedule:{type:Object,default:null},uploadSchedule:{type:Object,default:null},message:{type:String,required:!0},userBranches:{type:Object,required:!0},branchesAwaitingUpload:{type:Object,required:!0},uploadedCountsAwaitingSubmission:{type:Array,required:!0},transactions:{type:Object,required:!0},filters:{type:Object,default:()=>({})},can:{type:Object,required:!0}},setup(s){const w=s,T=M(null),g=W({schedule_id:w.uploadSchedule?w.uploadSchedule.id:null,branch_id:null,file:null}),f=M(w.filters.sort||"calculated_date"),p=M(w.filters.direction||"desc"),v=M({year:w.filters.year||null,month:w.filters.month||null,calculated_date:w.filters.calculated_date||null,status:w.filters.status||null,uploader_name:w.filters.uploader_name||null,branch_name:w.filters.branch_name||null}),k=h=>{f.value===h?p.value=p.value==="asc"?"desc":"asc":(f.value=h,p.value="asc")};X([v,f,p],ae.throttle(()=>{z.get(route("month-end-count.index"),{...v.value,sort:f.value,direction:p.value},{preserveState:!0,replace:!0})},300),{deep:!0});const I=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],F=h=>{if(!h)return"N/A";const e=new Date(h);if(isNaN(e.getTime()))return h;const j=e.getTimezoneOffset()*6e4,D=new Date(e.getTime()+j);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(D)},K=()=>{if(!g.branch_id){alert("Please select a branch.");return}if(!g.file){alert("Please select a file to upload.");return}g.post(route("month-end-count.upload"),{onSuccess:()=>{g.reset(),T.value=null},onError:h=>{console.error("Upload Error:",h),alert("Upload failed. Check console for details.")}})},B=h=>{const e=new Date;return e.setMonth(h-1),e.toLocaleString("en-US",{month:"long"})},H=ee(()=>Object.keys(w.branchesAwaitingUpload).length>0),N=(h,e)=>{z.get(route("month-end-count.review",{schedule:h,branch:e}))};return(h,e)=>{const j=y("Label"),D=y("Select"),O=y("Button"),$=y("Input"),x=y("TH"),J=y("TableHead"),_=y("TD"),L=y("Badge"),Y=y("TableBody"),R=y("Table"),Z=y("Pagination"),G=y("TableContainer"),Q=y("Layout");return o(),m(C,null,[t(u(le),{title:"Month End Count"}),t(Q,{heading:"Month End Count"},{default:n(()=>[a("div",ne,[e[27]||(e[27]=a("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Month End Count Process",-1)),s.downloadSchedule?(o(),m("div",se,[a("p",de,r(s.message),1),a("p",ue,"Scheduled for: "+r(B(s.downloadSchedule.month))+" "+r(s.downloadSchedule.year)+" (MEC Schedule Date: "+r(s.downloadSchedule.calculated_date)+")",1),a("div",re,[t(j,{for:"download_branch"},{default:n(()=>e[20]||(e[20]=[i("Select Branch for Download")])),_:1}),t(D,{id:"download_branch",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=l=>T.value=l),options:Object.entries(s.userBranches).map(([l,d])=>({value:l,label:d})),optionLabel:"label",optionValue:"value",placeholder:"Select a Branch",filter:"",class:"w-full"},null,8,["modelValue","options"])]),T.value?(o(),m("a",{key:0,href:h.route("month-end-count.download",{schedule_id:s.downloadSchedule.id,branch_id:T.value}),class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[t(u(te),{class:"-ml-1 mr-2 h-5 w-5"}),e[21]||(e[21]=i(" Download Count Template "))],8,ie)):(o(),m("p",ce,"Please select a branch to enable download."))])):H.value?(o(),m("div",me,[a("p",pe,r(s.message),1),s.uploadSchedule?(o(),m("p",be,"Scheduled for: "+r(B(s.uploadSchedule.month))+" "+r(s.uploadSchedule.year)+" (MEC Schedule Date: "+r(s.uploadSchedule.calculated_date)+")",1)):c("",!0),a("form",{onSubmit:S(K,["prevent"]),class:"mt-4 space-y-4"},[a("div",null,[t(j,{for:"upload_branch"},{default:n(()=>e[22]||(e[22]=[i("Select Branch for Upload")])),_:1}),t(D,{id:"upload_branch",modelValue:u(g).branch_id,"onUpdate:modelValue":e[1]||(e[1]=l=>u(g).branch_id=l),options:Object.entries(s.branchesAwaitingUpload).map(([l,d])=>({value:l,label:d})),optionLabel:"label",optionValue:"value",placeholder:"Select a Branch",filter:"",class:"w-full"},null,8,["modelValue","options"]),t(q,{message:u(g).errors.branch_id},null,8,["message"])]),a("div",null,[e[23]||(e[23]=a("label",{for:"file",class:"block text-sm font-medium text-gray-700"},"Upload Completed Count Sheet",-1)),a("input",{type:"file",onInput:e[2]||(e[2]=l=>u(g).file=l.target.files[0]),id:"file",class:"mt-1 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"},null,32),t(q,{message:u(g).errors.file},null,8,["message"])]),a("div",fe,[t(O,{type:"submit",disabled:u(g).processing||!u(g).file||!u(g).branch_id},{default:n(()=>[t(u(oe),{class:"-ml-1 mr-2 h-5 w-5"}),e[24]||(e[24]=i(" Upload and Process Count "))]),_:1},8,["disabled"])])],32)])):c("",!0),s.uploadedCountsAwaitingSubmission.length?(o(),m("div",ve,[e[26]||(e[26]=a("p",{class:"font-medium mb-2"},"Your Uploaded Counts Awaiting Submission:",-1)),a("ul",he,[(o(!0),m(C,null,A(s.uploadedCountsAwaitingSubmission,l=>(o(),m("li",{key:`${l.schedule_id}-${l.branch_id}`},[i(" Count for "+r(B(l.schedule_month))+" "+r(l.schedule_year)+" (Branch: "+r(l.branch_name)+") ",1),t(O,{onClick:d=>N(l.schedule_id,l.branch_id),variant:"link",size:"sm",class:"ml-2 p-0 h-auto"},{default:n(()=>[t(u(E),{class:"h-4 w-4 mr-1"}),e[25]||(e[25]=i(" Review "))]),_:2},1032,["onClick"])]))),128))])])):(o(),m("div",ye,[a("p",ge,r(s.message),1)]))]),a("div",we,[e[37]||(e[37]=a("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Transaction History",-1)),t(G,null,{default:n(()=>[a("div",xe,[t(R,null,{default:n(()=>[t(J,null,{default:n(()=>[t(x,null,{default:n(()=>[a("div",{class:"flex items-center cursor-pointer",onClick:e[3]||(e[3]=l=>k("year"))},[e[28]||(e[28]=i(" Year ")),f.value==="year"&&p.value==="asc"?(o(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="year"&&p.value==="desc"?(o(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),t($,{type:"text",modelValue:v.value.year,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value.year=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[5]||(e[5]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),t(x,null,{default:n(()=>[a("div",{class:"flex items-center cursor-pointer",onClick:e[6]||(e[6]=l=>k("month"))},[e[29]||(e[29]=i(" Month ")),f.value==="month"&&p.value==="asc"?(o(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="month"&&p.value==="desc"?(o(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),t(D,{modelValue:v.value.month,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value.month=l),options:I,optionLabel:"label",optionValue:"value",placeholder:"Select Month",class:"mt-1 w-full text-sm",showClear:""},null,8,["modelValue"])]),_:1}),t(x,null,{default:n(()=>[a("div",{class:"flex items-center cursor-pointer",onClick:e[8]||(e[8]=l=>k("calculated_date"))},[e[30]||(e[30]=i(" MEC Schedule Date ")),f.value==="calculated_date"&&p.value==="asc"?(o(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="calculated_date"&&p.value==="desc"?(o(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),t($,{type:"date",modelValue:v.value.calculated_date,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value.calculated_date=l),class:"mt-1 w-full text-sm",onKeydown:e[10]||(e[10]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),t(x,null,{default:n(()=>[a("div",{class:"flex items-center cursor-pointer",onClick:e[11]||(e[11]=l=>k("branch_name"))},[e[31]||(e[31]=i(" Branch ")),f.value==="branch_name"&&p.value==="asc"?(o(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="branch_name"&&p.value==="desc"?(o(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),t($,{type:"text",modelValue:v.value.branch_name,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.branch_name=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[13]||(e[13]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),t(x,null,{default:n(()=>[a("div",{class:"flex items-center cursor-pointer",onClick:e[14]||(e[14]=l=>k("uploader_name"))},[e[32]||(e[32]=i(" Uploader ")),f.value==="uploader_name"&&p.value==="asc"?(o(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="uploader_name"&&p.value==="desc"?(o(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),t($,{type:"text",modelValue:v.value.uploader_name,"onUpdate:modelValue":e[15]||(e[15]=l=>v.value.uploader_name=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[16]||(e[16]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),t(x,null,{default:n(()=>[a("div",{class:"flex items-center cursor-pointer",onClick:e[17]||(e[17]=l=>k("statuses"))},[e[33]||(e[33]=i(" Status ")),f.value==="statuses"&&p.value==="asc"?(o(),b(u(V),{key:0,class:"h-4 w-4 ml-1"})):c("",!0),f.value==="statuses"&&p.value==="desc"?(o(),b(u(U),{key:1,class:"h-4 w-4 ml-1"})):c("",!0)]),t($,{type:"text",modelValue:v.value.status,"onUpdate:modelValue":e[18]||(e[18]=l=>v.value.status=l),placeholder:"Filter...",class:"mt-1 w-full text-sm",onKeydown:e[19]||(e[19]=S(()=>{},["stop"]))},null,8,["modelValue"])]),_:1}),s.can.view_transaction?(o(),b(x,{key:0},{default:n(()=>e[34]||(e[34]=[i("Actions")])),_:1})):c("",!0)]),_:1}),t(Y,null,{default:n(()=>[s.transactions.data.length?c("",!0):(o(),m("tr",_e,[a("td",{colspan:s.can.view_transaction?7:6,class:"text-center py-4"},"No transactions found.",8,ke)])),(o(!0),m(C,null,A(s.transactions.data,l=>(o(),m("tr",{key:`${l.schedule_id}-${l.branch_id}`},[t(_,null,{default:n(()=>[i(r(l.year),1)]),_:2},1024),t(_,null,{default:n(()=>[i(r(B(l.month)),1)]),_:2},1024),t(_,null,{default:n(()=>[i(r(F(l.calculated_date)),1)]),_:2},1024),t(_,null,{default:n(()=>[i(r(l.branch_name),1)]),_:2},1024),t(_,null,{default:n(()=>[i(r(l.uploader_name),1)]),_:2},1024),t(_,null,{default:n(()=>[a("div",Se,[(o(!0),m(C,null,A([...new Set(l.statuses.split(", "))],d=>(o(),b(L,{key:d,class:P(["capitalize",{"bg-yellow-500 text-white":d==="pending"||d==="uploaded","bg-blue-500 text-white":d==="level1_approved","bg-green-500 text-white":d==="level2_approved","bg-red-500 text-white":d==="rejected"||d==="expired","bg-purple-500 text-white":d==="pending_level1_approval"}])},{default:n(()=>[i(r(d.replace(/_/g," ")),1)]),_:2},1032,["class"]))),128))])]),_:2},1024),s.can.view_transaction?(o(),b(_,{key:0},{default:n(()=>[t(O,{onClick:d=>N(l.schedule_id,l.branch_id),variant:"outline",size:"icon"},{default:n(()=>[t(u(E),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)):c("",!0)]))),128))]),_:1})]),_:1})]),a("div",Ce,[s.transactions.data.length?c("",!0):(o(),m("div",Ve," No transactions found. ")),(o(!0),m(C,null,A(s.transactions.data,l=>(o(),m("div",{key:`${l.schedule_id}-${l.branch_id}`,class:"bg-white p-4 rounded-lg shadow"},[a("div",Ue,[a("div",null,[a("p",Te,r(l.branch_name),1),a("p",Be,r(B(l.month))+" "+r(l.year),1),a("p",De,"Date: "+r(F(l.calculated_date)),1)]),s.can.view_transaction?(o(),b(O,{key:0,onClick:d=>N(l.schedule_id,l.branch_id),variant:"outline",size:"icon"},{default:n(()=>[t(u(E),{class:"h-5 w-5"})]),_:2},1032,["onClick"])):c("",!0)]),a("div",$e,[a("div",Ae,[e[35]||(e[35]=a("span",{class:"text-gray-500"},"Uploader: ",-1)),a("span",je,r(l.uploader_name),1)]),a("div",Oe,[e[36]||(e[36]=a("span",{class:"text-gray-500"},"Status: ",-1)),a("div",Me,[(o(!0),m(C,null,A([...new Set(l.statuses.split(", "))],d=>(o(),b(L,{key:d,class:P(["capitalize",{"bg-yellow-500 text-white":d==="pending"||d==="uploaded","bg-blue-500 text-white":d==="level1_approved","bg-green-500 text-white":d==="level2_approved","bg-red-500 text-white":d==="rejected"||d==="expired","bg-purple-500 text-white":d==="pending_level1_approval"}])},{default:n(()=>[i(r(d.replace(/_/g," ")),1)]),_:2},1032,["class"]))),128))])])])]))),128))]),t(Z,{data:s.transactions},null,8,["data"])]),_:1})])]),_:1})],64)}}};export{Pe as default};
