import{f as ue,x as S,y as de,T as ce,r as c,o as u,c as _,w as o,a as n,g as d,b as s,t as l,n as pe,u as p,h as P,d as b,e as M,m as R,A as V,X as z,F as L,N as fe}from"./app-Bp7xdNcv.js";import{u as me}from"./useBackButton-B5cTAtmc.js";import{u as ve}from"./useToast-BYf4YE8m.js";import{u as _e}from"./useAuth-Bvg2Md3x.js";import{S as Q}from"./save-DFGjJjgb.js";import{S as $}from"./square-pen-BXz0dBaO.js";const ye={class:"flex flex-col gap-5"},ge={class:"sm:flex-row flex flex-col gap-5"},be={class:"text-gray-700 text-sm"},xe={class:"font-bold"},ke={class:"text-gray-700 text-sm"},qe={class:"font-bold"},Se={class:"text-gray-700 text-sm"},Ce={class:"font-bold"},we={class:"sm:flex-row flex flex-col gap-5"},Te={class:"text-gray-700 text-sm"},he={class:"font-bold"},Ne={class:"text-gray-700 text-sm"},Ae={class:"sm:flex-row flex flex-col gap-5"},De={class:"text-gray-700 text-sm"},Oe={class:"font-bold"},Be={class:"text-gray-700 text-sm"},Pe={class:"font-bold"},Ve={key:0},Ee={key:1,class:"flex items-center gap-2"},Ie={key:0},He={key:0},Fe={key:1},$e={__name:"Show",props:{order:{type:Object,required:!0},items:{type:Object,required:!0}},setup(a){const I=ue(),{toast:h}=ve(),{hasAccess:A}=_e(),{backButton:j}=me(route("interco-approval.index")),E=a,K=t=>t?new Date(t).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"}):"N/A",X=t=>{var e,i,m;return t.from_store_name||((e=t.sending_store)==null?void 0:e.name)||((i=t.sending_store)==null?void 0:i.branch_name)||((m=t.sending_store)==null?void 0:m.brand_name)||"Unknown Sending Store"},G=t=>{var e,i;return t.to_store_name||((e=t.receiving_store)==null?void 0:e.name)||((i=t.receiving_store)==null?void 0:i.branch_name)||"Unknown Receiving Store"},J=t=>{switch(t.toUpperCase()){case"APPROVED":return"bg-green-500 text-white";case"OPEN":return"bg-blue-500 text-white";case"DISAPPROVED":return"bg-red-500 text-white";default:return"bg-yellow-500 text-white"}},v=S(!1),W=S(!1);S(!1);const f=S(null),y=S("");S(null);const H={mounted:t=>{const e=t.tagName==="INPUT"?t:t.querySelector("input");e&&(e.focus(),e.select())}};de(W,t=>{t||(v.value=!1,C.reset(),C.clearErrors())});const C=ce({order_id:null,remarks:null}),Y=t=>{I.require({message:"Are you sure you want to approve this interco order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{v.value=!0,C.order_id=t,C.post(route("interco-approval.approve"),{onSuccess:()=>{h.add({severity:"success",summary:"Success",detail:"Interco Order Approved Successfully.",life:3e3}),v.value=!1},onError:()=>{v.value=!1}})}})},Z=t=>{I.require({message:"Are you sure you want to disapprove this interco order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"danger"},accept:()=>{v.value=!0,C.order_id=t,C.post(route("interco-approval.disapprove"),{onSuccess:()=>{h.add({severity:"success",summary:"Success",detail:"Interco Order Disapproved Successfully.",life:3e3}),v.value=!1},onError:()=>{v.value=!1}})}})},w=S([]);E.items.forEach(t=>w.value.push({id:t.id,quantity_ordered:t.quantity_ordered,quantity_approved:t.quantity_approved||t.quantity_ordered,quantity_commited:t.quantity_commited||t.quantity_approved||t.quantity_ordered,item_code:t.item_code,description:t.description,soh_stock:t.soh_stock,uom:t.uom}));const F=t=>{const e=w.value.find(i=>i.id===t);e&&(f.value={id:t,originalValue:e.quantity_approved},y.value=e.quantity_approved.toString())},D=()=>{if(!f.value)return;const t=parseFloat(y.value);if(isNaN(t)||t<0){h.add({severity:"error",summary:"Error",detail:"Please enter a valid quantity.",life:3e3});return}const e=Number(t.toFixed(2)),i=f.value.id;f.value.originalValue;const m=w.value.find(N=>N.id===i);m&&(m.quantity_approved=e,m.quantity_commited=e);const x=E.items.find(N=>N.id===i);x&&(x.quantity_approved=e,x.quantity_commited=e),ee(i,e),f.value=null,y.value=""},O=()=>{f.value=null,y.value=""},ee=(t,e)=>{fe.post(route("interco-approval.update-quantity",t),{quantity_approved:e,quantity_commited:e},{preserveScroll:!0,onSuccess:()=>{h.add({severity:"success",summary:"Success",detail:"Quantity updated successfully.",life:2e3})},onError:()=>{w.value.find(i=>i.id===t),E.items.find(i=>i.id===t),h.add({severity:"error",summary:"Error",detail:"Failed to update quantity. Please refresh the page.",life:3e3})}})};return(t,e)=>{const i=c("Badge"),m=c("Button"),x=c("DivFlexCenter"),N=c("TableHeader"),k=c("TH"),te=c("TableHead"),q=c("TD"),U=c("Input"),oe=c("TableBody"),ne=c("Table"),se=c("MobileTableHeading"),B=c("LabelXS"),re=c("MobileTableRow"),ae=c("MobileTableContainer"),le=c("TableContainer"),ie=c("Layout");return u(),_(ie,{heading:"Interco Order Details"},{default:o(()=>[n(le,null,{default:o(()=>[d("section",ye,[d("section",ge,[d("span",be,[e[4]||(e[4]=s(" Interco Number: ")),d("span",xe,l(a.order.interco_number),1)]),d("span",ke,[e[5]||(e[5]=s(" Sending Store: ")),d("span",qe,l(X(a.order)),1)]),d("span",Se,[e[6]||(e[6]=s(" Receiving Store: ")),d("span",Ce,l(G(a.order)),1)])]),d("section",we,[d("span",Te,[e[7]||(e[7]=s(" Transfer Date: ")),d("span",he,l(K(a.order.transfer_date||a.order.order_date)),1)]),d("span",Ne,[e[8]||(e[8]=s(" Status: ")),n(i,{class:pe([J(a.order.interco_status),"font-bold"])},{default:o(()=>{var r;return[s(l(((r=a.order.interco_status)==null?void 0:r.toUpperCase())??"N/A"),1)]}),_:1},8,["class"])])]),d("section",Ae,[d("span",De,[e[9]||(e[9]=s(" Reason: ")),d("span",Oe,l(a.order.interco_reason??"N/A"),1)]),d("span",Be,[e[10]||(e[10]=s(" Remarks: ")),d("span",Pe,l(a.order.remarks??"N/A"),1)])]),n(x,{class:"gap-5"},{default:o(()=>[a.order.interco_status==="open"&&p(A)("approve interco requests")?(u(),_(m,{key:0,variant:"destructive",onClick:e[0]||(e[0]=r=>Z(a.order.id)),disabled:v.value},{default:o(()=>e[11]||(e[11]=[s(" Disapprove Order ")])),_:1},8,["disabled"])):P("",!0),a.order.interco_status==="open"&&p(A)("approve interco requests")?(u(),_(m,{key:1,class:"bg-green-500 hover:bg-green-300",onClick:e[1]||(e[1]=r=>Y(a.order.id)),disabled:v.value},{default:o(()=>e[12]||(e[12]=[s(" Approve Order ")])),_:1},8,["disabled"])):P("",!0)]),_:1})]),n(N),n(ne,null,{default:o(()=>[n(te,null,{default:o(()=>[n(k,null,{default:o(()=>e[13]||(e[13]=[s(" Item Code ")])),_:1}),n(k,null,{default:o(()=>e[14]||(e[14]=[s(" Description ")])),_:1}),n(k,null,{default:o(()=>e[15]||(e[15]=[s(" UOM ")])),_:1}),n(k,null,{default:o(()=>e[16]||(e[16]=[s(" Ordered Qty ")])),_:1}),n(k,null,{default:o(()=>e[17]||(e[17]=[s(" SOH Stock ")])),_:1}),a.order.interco_status==="open"?(u(),_(k,{key:0},{default:o(()=>e[18]||(e[18]=[s("Approved Qty")])),_:1})):(u(),_(k,{key:1},{default:o(()=>e[19]||(e[19]=[s("Approved Qty")])),_:1}))]),_:1}),n(oe,null,{default:o(()=>[(u(!0),b(L,null,M(a.items,r=>(u(),b("tr",{key:r.id},[n(q,null,{default:o(()=>[s(l(r.item_code),1)]),_:2},1024),n(q,null,{default:o(()=>[s(l(r.description),1)]),_:2},1024),n(q,null,{default:o(()=>[s(l(r.uom??"N/A"),1)]),_:2},1024),n(q,null,{default:o(()=>[s(l(r.quantity_ordered),1)]),_:2},1024),n(q,null,{default:o(()=>[s(l(r.soh_stock??0),1)]),_:2},1024),a.order.interco_status==="open"?(u(),_(q,{key:0,class:"flex items-center gap-3"},{default:o(()=>{var g;return[f.value&&f.value.id===r.id?(u(),b("div",Ve,[R(n(U,{type:"number",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=T=>y.value=T),class:"w-20 text-right",onKeyup:[V(D,["enter"]),V(O,["esc"])]},null,8,["modelValue"]),[[H]]),n(x,{class:"gap-1 ml-2"},{default:o(()=>[n(p(Q),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:D}),n(p(z),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:O})]),_:1})])):(u(),b("div",Ee,[s(l(((g=w.value.find(T=>T.id===r.id))==null?void 0:g.quantity_approved)||0)+" ",1),p(A)("approve interco requests")?(u(),_(p($),{key:0,class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:T=>F(r.id)},null,8,["onClick"])):P("",!0)]))]}),_:2},1024)):(u(),_(q,{key:1},{default:o(()=>[s(l(r.quantity_approved),1)]),_:2},1024))]))),128))]),_:1})]),_:1}),n(ae,null,{default:o(()=>[(u(!0),b(L,null,M(a.items,r=>(u(),_(re,{key:r.id},{default:o(()=>[n(se,{title:`${r.description} (${r.item_code})`},{default:o(()=>[a.order.interco_status==="open"&&p(A)("approve interco requests")?(u(),b("div",Ie,[f.value&&f.value.id===r.id?(u(),b("div",He,[R(n(U,{type:"number",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=g=>y.value=g),class:"w-20 text-right",onKeyup:[V(D,["enter"]),V(O,["esc"])]},null,8,["modelValue"]),[[H]]),n(x,{class:"gap-1 ml-2"},{default:o(()=>[n(p(Q),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:D}),n(p(z),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:O})]),_:1})])):(u(),b("div",Fe,[n(p($),{class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:g=>F(r.id)},null,8,["onClick"])]))])):P("",!0)]),_:2},1032,["title"]),n(B,null,{default:o(()=>[s("UOM: "+l(r.uom??"N/A"),1)]),_:2},1024),n(B,null,{default:o(()=>[s("Ordered: "+l(r.quantity_ordered),1)]),_:2},1024),n(B,null,{default:o(()=>[s("SOH Stock: "+l(r.soh_stock??0),1)]),_:2},1024),n(B,null,{default:o(()=>{var g;return[s(" Approved: "+l(((g=w.value.find(T=>T.id===r.id))==null?void 0:g.quantity_approved)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n(m,{variant:"outline",class:"text-lg px-7",onClick:p(j)},{default:o(()=>e[20]||(e[20]=[s(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{$e as default};
