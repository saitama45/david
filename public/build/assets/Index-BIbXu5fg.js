import{D as me,f as pe,T as H,aX as ge,x as b,y as J,N as B,l as fe,az as ve,r as D,o as l,d as i,a,u as n,Z as ye,w as u,g as o,b as p,c as L,P as be,h as w,F as M,e as A,t as g,ay as he,k as $,X as xe,n as G,B as _e,S as K,a_ as we,j as W}from"./app-DZB5krWT.js";import{_ as ke}from"./InputError-Dc51D8Mg.js";import{l as ee}from"./lodash-gd7BEsaJ.js";import{S as Ce}from"./save-BmdQDWl4.js";import{L as Se}from"./loader-circle-d-j6G0qq.js";/**
 * @license lucide-vue-next v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=me("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),De={class:"bg-white rounded-lg shadow-sm p-4 mb-6"},$e={class:"flex justify-between items-center"},Ve={class:"w-56"},Ne={key:0,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"},Ee={class:"p-4 flex justify-between items-start"},Pe={class:"text-xl font-bold text-indigo-800"},Le={class:"text-sm text-gray-500"},Me={class:"px-4 pb-4 space-y-5 flex-grow"},Fe={key:0,class:"flex items-center gap-2 mt-1"},Oe=["onClick"],Ue={class:"font-medium text-gray-800 text-lg"},Ie=["onClick"],Te={class:"flex justify-between items-baseline mb-1"},ze={class:"text-sm font-semibold text-gray-800"},Be=["title"],Ae={class:"flex h-3 rounded-full"},Ge={key:1,class:"text-sm text-gray-500 mt-1"},qe={class:"p-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-500"},Ye={class:"font-medium text-gray-700"},Ze={key:1,class:"text-center py-16 text-gray-500 bg-white rounded-lg shadow-sm"},Xe={key:0,class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert"},Qe={class:"flex justify-end gap-3 mt-8"},Re={class:"mt-4 space-y-4"},He={class:"relative group"},Je={class:"border rounded-lg"},Ke={key:0,class:"flex justify-center items-center h-48"},We={key:1,class:"divide-y max-h-[50vh] overflow-y-auto"},et={class:"text-gray-800 font-medium truncate pr-4"},tt={key:2,class:"text-center py-12 text-gray-500"},st={key:0,class:"flex justify-between items-center"},ot={class:"text-sm text-gray-600"},at={class:"flex gap-2"},ut={__name:"Index",props:{schedules:{type:Object,required:!0},can:{type:Object,required:!0},filters:{type:Object,default:()=>({})}},setup(h){const F=h,te=pe(),f=H({year:new Date().getFullYear()}),V=ge({year:F.filters.year}),x=H({calculated_date:""}),k=b(!1),O=b(!1),U=b(null),C=b(null),m=b(null),I=b(!1),S=b("");J(V,ee.throttle(()=>{B.get(route("month-end-schedules.index"),{year:V.year},{preserveState:!0,replace:!0})},300)),J(S,ee.throttle(t=>{z(1,t)},300));const N=t=>F.can.edit_month_end_schedules?Object.values(t.progress||{}).reduce((r,d)=>r+d,0)===0:!1,se=t=>F.can.delete_month_end_schedules?Object.values(t.progress||{}).reduce((r,d)=>r+d,0)===0:!1,E=t=>Object.values(t.progress||{}).reduce((r,d)=>r+d,0)>0,T=fe(()=>{var t;return((t=m.value)==null?void 0:t.data)||[]}),z=async(t=1,e="")=>{if(C.value){I.value=!0;try{const r=await ve.get(route("month-end-schedules.details",C.value.id),{params:{page:t,search:e}});m.value=r.data}catch(r){console.error("Failed to fetch schedule details:",r)}finally{I.value=!1}}},oe=t=>{C.value=t,S.value="",m.value=null,O.value=!0,z(1,"")},q=t=>{t>0&&t<=m.value.last_page&&z(t,S.value)},ae=t=>{if(!N(t))return;U.value=t.id;const e=new Date(t.calculated_date),r=new Intl.DateTimeFormat("en-CA",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"Asia/Manila"}).format(e);x.calculated_date=r},Y=()=>{U.value=null,x.reset(),x.clearErrors()},re=t=>{B.put(route("month-end-schedules.update",t),{calculated_date:x.calculated_date},{preserveScroll:!0,onSuccess:()=>Y()})},le=()=>{f.post(route("month-end-schedules.store"),{onSuccess:()=>{f.reset(),k.value=!1}})},ne=t=>{te.require({message:"Are you sure you want to delete this schedule entry? This action cannot be undone.",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{B.delete(route("month-end-schedules.destroy",t),{preserveScroll:!0})}})},ie=t=>t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",timeZone:"Asia/Manila"}):"N/A",Z=t=>{if(!t)return"";const e=new Date;return e.setMonth(t-1),e.toLocaleString("en-US",{month:"long"})},de=t=>{const e=t.total_stores||0;return`${Object.values(t.progress||{}).reduce((d,c)=>d+c,0)} / ${e}`},P={pending:"#f59e0b",uploaded:"#f59e0b",pending_level1_approval:"#8b5cf6",level1_approved:"#3b82f6",level2_approved:"#22c55e",rejected:"#ef4444",expired:"#ef4444",not_started:"#e5e7eb"},X=t=>{const e=t.progress||{},r=t.total_stores||0;if(r===0)return[];const d=[];let c=0;["level2_approved","level1_approved","pending_level1_approval","uploaded","pending","rejected","expired"].forEach(y=>{if(e[y]){const _=e[y];d.push({percentage:_/r*100,color:P[y]||"#6b7280",label:y,count:_}),c+=_}});const j=r-c;return j>0&&d.push({percentage:j/r*100,color:P.not_started,label:"Not Started",count:j}),d.reverse()},ue=t=>!t||!t.length?"No store data.":[...t].reverse().map(e=>`${e.label.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}: ${e.count}`).join(`
`),Q=t=>{const e=t.toLowerCase().replace(/ /g,"_");return P[e]||P.not_started};return(t,e)=>{var y,_;const r=D("Label"),d=D("Input"),c=D("Button"),R=D("Pagination"),j=D("Layout");return l(),i(M,null,[a(n(ye),{title:"Month End Schedules"}),a(j,{heading:"Month End Schedules Management"},{default:u(()=>[o("div",De,[o("div",$e,[o("div",Ve,[a(r,{for:"year_filter"},{default:u(()=>e[11]||(e[11]=[p("Filter by Year")])),_:1}),a(d,{id:"year_filter",type:"number",modelValue:V.year,"onUpdate:modelValue":e[0]||(e[0]=s=>V.year=s),min:"2000",max:"2099",class:"w-full mt-1",placeholder:"Enter Year"},null,8,["modelValue"])]),h.can.create_month_end_schedules?(l(),L(c,{key:0,onClick:e[1]||(e[1]=s=>k.value=!0),class:"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold"},{default:u(()=>[a(n(be),{class:"-ml-1 mr-2 h-5 w-5"}),e[12]||(e[12]=p(" Generate Schedules "))]),_:1})):w("",!0)])]),h.schedules.data.length>0?(l(),i("div",Ne,[(l(!0),i(M,null,A(h.schedules.data,s=>(l(),i("div",{key:s.id,class:"bg-white rounded-lg shadow-md flex flex-col justify-between transition-transform duration-300 ease-in-out hover:-translate-y-1 border-t-4 border-indigo-400"},[o("div",Ee,[o("div",null,[o("h3",Pe,g(Z(s.month)),1),o("p",Le,g(s.year),1)]),se(s)?(l(),L(c,{key:0,onClick:$(v=>ne(s.id),["stop"]),variant:"ghost",size:"icon",class:"text-gray-400 hover:text-red-500 hover:bg-red-50 -mt-1 -mr-2"},{default:u(()=>[a(n(he),{class:"h-5 w-5"})]),_:2},1032,["onClick"])):w("",!0)]),o("div",Me,[o("div",null,[a(r,{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider"},{default:u(()=>e[13]||(e[13]=[p("MEC Schedule Date")])),_:1}),U.value===s.id?(l(),i("div",Fe,[a(d,{type:"date",modelValue:n(x).calculated_date,"onUpdate:modelValue":e[2]||(e[2]=v=>n(x).calculated_date=v),class:"w-full py-1",onClick:e[3]||(e[3]=$(()=>{},["stop"]))},null,8,["modelValue"]),a(c,{onClick:$(v=>re(s.id),["stop"]),size:"icon",variant:"ghost",class:"text-green-600 hover:bg-green-100 h-8 w-8 shrink-0"},{default:u(()=>[a(n(Ce),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(c,{onClick:$(Y,["stop"]),size:"icon",variant:"ghost",class:"text-red-600 hover:bg-red-100 h-8 w-8 shrink-0"},{default:u(()=>[a(n(xe),{class:"h-4 w-4"})]),_:1})])):(l(),i("div",{key:1,onClick:v=>ae(s),class:G(["p-2 -ml-2 rounded min-h-[32px] flex items-center justify-between group w-full transition-all duration-150",{"cursor-pointer bg-blue-50 hover:bg-blue-100":N(s),"cursor-not-allowed":!N(s)}])},[o("span",Ue,g(ie(s.calculated_date)),1),N(s)?(l(),L(n(_e),{key:0,class:"h-4 w-4 text-blue-400 opacity-0 group-hover:opacity-100"})):w("",!0)],10,Oe))]),o("div",{onClick:v=>E(s)?oe(s):null,class:G(["group",{"cursor-pointer":E(s),"cursor-default":!E(s)}])},[o("div",Te,[a(r,{class:G(["text-xs font-semibold text-gray-500 uppercase tracking-wider",{"group-hover:text-indigo-600":E(s)}])},{default:u(()=>e[14]||(e[14]=[p("Progress")])),_:2},1032,["class"]),o("span",ze,g(de(s)),1)]),s.total_stores>0?(l(),i("div",{key:0,class:"w-full bg-gray-200 rounded-full h-3",title:ue(X(s))},[o("div",Ae,[(l(!0),i(M,null,A(X(s),(v,ce)=>(l(),i("div",{key:ce,class:"transition-all duration-300",style:K({width:v.percentage+"%",backgroundColor:v.color})},null,4))),128))])],8,Be)):(l(),i("div",Ge,"No active stores."))],10,Ie)]),o("div",qe,[e[15]||(e[15]=p(" Created by: ")),o("span",Ye,g(s.creator?`${s.creator.first_name} ${s.creator.last_name}`:"N/A"),1)])]))),128))])):(l(),i("div",Ze,[a(n(we),{class:"mx-auto h-12 w-12 text-gray-400"}),e[16]||(e[16]=o("h3",{class:"mt-4 text-lg font-medium text-gray-800"},"No Schedules Found",-1)),e[17]||(e[17]=o("p",{class:"mt-1 text-sm"},"No schedules have been generated for the selected year.",-1))])),h.schedules.data.length>0?(l(),L(R,{key:2,data:h.schedules,class:"mt-6"},null,8,["data"])):w("",!0)]),_:1}),a(n(W),{visible:k.value,"onUpdate:visible":e[6]||(e[6]=s=>k.value=s),modal:"",header:"Generate Schedules",style:{width:"32rem"}},{default:u(()=>[o("form",{onSubmit:$(le,["prevent"]),class:"mt-4"},[n(f).errors.error?(l(),i("div",Xe,[e[18]||(e[18]=o("p",{class:"font-bold"},"Error",-1)),o("p",null,g(n(f).errors.error),1)])):w("",!0),e[22]||(e[22]=o("p",{class:"text-sm text-gray-600 mb-6"},"Generate schedules for an entire year. This will not override existing schedules for the selected year.",-1)),a(r,{for:"generate_year"},{default:u(()=>e[19]||(e[19]=[p("Year")])),_:1}),a(d,{id:"generate_year",type:"number",modelValue:n(f).year,"onUpdate:modelValue":e[4]||(e[4]=s=>n(f).year=s),min:"2000",max:"2099",class:"w-full mt-1",placeholder:"Enter Year"},null,8,["modelValue"]),a(ke,{message:n(f).errors.year,class:"mt-2"},null,8,["message"]),o("div",Qe,[a(c,{type:"button",variant:"outline",onClick:e[5]||(e[5]=s=>k.value=!1)},{default:u(()=>e[20]||(e[20]=[p("Cancel")])),_:1}),a(c,{type:"submit",disabled:n(f).processing,class:"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold"},{default:u(()=>e[21]||(e[21]=[p("Generate")])),_:1},8,["disabled"])])],32)]),_:1},8,["visible"]),a(n(W),{visible:O.value,"onUpdate:visible":e[10]||(e[10]=s=>O.value=s),modal:"",header:`Store Progress for ${Z((y=C.value)==null?void 0:y.month)} ${(_=C.value)==null?void 0:_.year}`,style:{width:"40rem"}},{default:u(()=>[o("div",Re,[o("div",He,[a(n(je),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 transition-colors group-focus-within:text-indigo-500"}),a(d,{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=s=>S.value=s),placeholder:"Search for a store...",class:"w-full pl-10 py-2 bg-gray-100 border-transparent rounded-lg focus:outline-none focus:bg-white"},null,8,["modelValue"])]),o("div",Je,[I.value&&!T.value.length?(l(),i("div",Ke,[a(n(Se),{class:"h-8 w-8 text-indigo-400 animate-spin"})])):T.value.length>0?(l(),i("ul",We,[(l(!0),i(M,null,A(T.value,s=>(l(),i("li",{key:s.id,class:"flex items-center justify-between p-3 hover:bg-gray-50"},[o("span",et,g(s.name),1),o("span",{class:"px-2.5 py-0.5 text-xs font-semibold rounded-full shrink-0",style:K({backgroundColor:Q(s.status)+"20",color:Q(s.status)})},g(s.status),5)]))),128))])):(l(),i("div",tt,e[23]||(e[23]=[o("p",null,"No stores found for your search.",-1)])))]),m.value&&m.value.last_page>1?(l(),i("div",st,[o("span",ot,"Page "+g(m.value.current_page)+" of "+g(m.value.last_page),1),o("div",at,[a(c,{onClick:e[8]||(e[8]=s=>q(m.value.current_page-1)),disabled:!m.value.prev_page_url,variant:"outline"},{default:u(()=>e[24]||(e[24]=[p("Previous")])),_:1},8,["disabled"]),a(c,{onClick:e[9]||(e[9]=s=>q(m.value.current_page+1)),disabled:!m.value.next_page_url,variant:"outline"},{default:u(()=>e[25]||(e[25]=[p("Next")])),_:1},8,["disabled"])])])):w("",!0)])]),_:1},8,["visible","header"])],64)}}};export{ut as default};
