import{u as me}from"./useSearch-Cd1k-Yv4.js";import{G as ve,f as ke,x as D,Q as U,y as h,N as E,l as O,T as ye,r as s,o as d,c as v,w as l,a as e,u as f,b5 as be,d as k,g as p,t as a,h as c,i as Se,b as n,e as $,F as H}from"./app-Bw_fMWAP.js";import{u as Oe}from"./useAuth-CBAjI_yz.js";import{u as ge}from"./useReferenceDelete-DwjgMHj7.js";import"./lodash-Cj3gZpb5.js";const Me={key:0,class:"mb-6"},Ce={key:0,class:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4",role:"alert"},Be={class:"font-bold"},Te={key:0},Pe={key:1,class:"mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700"},De=["href"],xe={class:"space-y-5"},Fe={class:"flex flex-col space-y-1"},Ie={class:"flex flex-col space-y-1"},Le={class:"text-xs"},we=["href"],$e={__name:"Index",props:{boms:{type:Object,required:!0}},setup(C){const x=ve();ke();let y=D(U().props.filter||"all");const{search:b}=me("pos-bom.index"),B=i=>{y.value=i,E.get(route("pos-bom.index"),{filter:i,search:b.value},{preserveState:!0,replace:!0})};h(y,function(i){E.get(route("pos-bom.index"),{filter:i,search:b.value},{preserveState:!0,replace:!0})});const{hasAccess:g}=Oe(),{deleteModel:F}=ge(),Q=O(()=>route("pos-bom.export",{search:b.value,filter:y.value})),M=D(!1),T=ye({pos_bom_file:null}),N=()=>{S.value=!0,T.post(route("pos-bom.import"),{onSuccess:()=>{S.value=!1,M.value=!1},onError:i=>{S.value=!1,console.error("Import Error:",i),x.add({severity:"error",summary:"Import Error",detail:i.pos_bom_file||"An error occurred while trying to update POS BOMs. Please make sure that you are using the correct format.",life:5e3})},onFinish:()=>{S.value=!1}})},z=()=>M.value=!0,S=D(!1),V=O(()=>U().props.flash),_=O(()=>V.value.import_summary||null),K=O(()=>_.value&&_.value.skipped_details_present),X=O(()=>route("pos-bom.downloadSkippedImportLog"));return h(_,i=>{if(i){let t=`Processed: ${i.processed_count}. `;i.skipped_empty_keys_count>0&&(t+=`Skipped (Empty Keys): ${i.skipped_empty_keys_count}. `),i.skipped_pos_masterfile_validation_count>0&&(t+=`Skipped (POS Masterfile Validation): ${i.skipped_pos_masterfile_validation_count}. `),i.skipped_sap_masterfile_validation_count>0&&(t+=`Skipped (SAP Masterfile Validation): ${i.skipped_sap_masterfile_validation_count}. `),x.add({severity:i.skipped_details_present?"warn":"success",summary:i.skipped_details_present?"Import with Skips":"Import Successful",detail:t,life:8e3})}},{immediate:!0}),(i,t)=>{const P=s("FilterTabButton"),j=s("FilterTab"),I=s("Input"),q=s("SearchBar"),L=s("Button"),G=s("TableHeader"),r=s("TH"),J=s("TableHead"),u=s("TD"),w=s("ShowButton"),R=s("EditButton"),A=s("DeleteButton"),W=s("TableBody"),Y=s("Table"),Z=s("MobileTableHeading"),m=s("LabelXS"),ee=s("MobileTableRow"),te=s("MobileTableContainer"),le=s("Pagination"),oe=s("TableContainer"),ne=s("DialogTitle"),se=s("DialogDescription"),ae=s("DialogHeader"),ie=s("FormError"),re=s("Label"),ue=s("Loading"),de=s("DialogFooter"),pe=s("DialogContent"),fe=s("Dialog"),_e=s("Layout");return d(),v(_e,{heading:"BOM List",hasButton:!1,handleClick:null,hasExcelDownload:!0,exportRoute:Q.value},{default:l(()=>[e(f(be)),_.value?(d(),k("div",Me,[_.value.success_message?(d(),k("div",Ce,[p("p",Be,a(_.value.success_message),1),p("p",null,"Processed: "+a(_.value.processed_count),1),p("p",null,"Skipped (Empty Keys): "+a(_.value.skipped_empty_keys_count),1),p("p",null,"Skipped (POS Masterfile Validation): "+a(_.value.skipped_pos_masterfile_validation_count),1),p("p",null,"Skipped (SAP Masterfile Validation): "+a(_.value.skipped_sap_masterfile_validation_count),1),_.value.skipped_unauthorized_count!==void 0?(d(),k("p",Te,"Skipped (Unauthorized): "+a(_.value.skipped_unauthorized_count),1)):c("",!0)])):c("",!0),K.value?(d(),k("div",Pe,[t[6]||(t[6]=p("p",null,"Some rows were skipped during the import due to validation errors or missing masterfile data.",-1)),p("a",{href:X.value,class:"font-bold underline cursor-pointer hover:text-yellow-900"}," Click here to download a log file with details ",8,De)])):c("",!0)])):c("",!0),e(j,null,{default:l(()=>[e(P,{label:"All",filter:"all",currentFilter:f(y),onClick:t[0]||(t[0]=o=>B("all"))},null,8,["currentFilter"]),e(P,{label:"Active",filter:"is_active",currentFilter:f(y),onClick:t[1]||(t[1]=o=>B("is_active"))},null,8,["currentFilter"]),e(P,{label:"InActive",filter:"inactive",currentFilter:f(y),onClick:t[2]||(t[2]=o=>B("inactive"))},null,8,["currentFilter"])]),_:1}),e(oe,null,{default:l(()=>[e(G,null,{default:l(()=>[e(q,null,{default:l(()=>[e(I,{class:"pl-10",modelValue:f(b),"onUpdate:modelValue":t[3]||(t[3]=o=>Se(b)?b.value=o:null),placeholder:"Search..."},null,8,["modelValue"])]),_:1}),e(L,{onClick:z},{default:l(()=>t[7]||(t[7]=[n("Update List")])),_:1})]),_:1}),e(Y,null,{default:l(()=>[e(J,null,{default:l(()=>[e(r,null,{default:l(()=>t[8]||(t[8]=[n("Id")])),_:1}),e(r,null,{default:l(()=>t[9]||(t[9]=[n("POS Code")])),_:1}),e(r,null,{default:l(()=>t[10]||(t[10]=[n("POS Desc")])),_:1}),e(r,null,{default:l(()=>t[11]||(t[11]=[n("Assembly")])),_:1}),e(r,null,{default:l(()=>t[12]||(t[12]=[n("Item Code")])),_:1}),e(r,null,{default:l(()=>t[13]||(t[13]=[n("Item Desc")])),_:1}),e(r,null,{default:l(()=>t[14]||(t[14]=[n("Rec Percent")])),_:1}),e(r,null,{default:l(()=>t[15]||(t[15]=[n("Recipe Qty")])),_:1}),e(r,null,{default:l(()=>t[16]||(t[16]=[n("Recipe UOM")])),_:1}),e(r,null,{default:l(()=>t[17]||(t[17]=[n("BOM Qty")])),_:1}),e(r,null,{default:l(()=>t[18]||(t[18]=[n("BOM UOM")])),_:1}),e(r,null,{default:l(()=>t[19]||(t[19]=[n("Unit Cost")])),_:1}),e(r,null,{default:l(()=>t[20]||(t[20]=[n("Total Cost")])),_:1}),e(r,null,{default:l(()=>t[21]||(t[21]=[n("Action")])),_:1})]),_:1}),e(W,null,{default:l(()=>[(d(!0),k(H,null,$(C.boms.data,o=>(d(),k("tr",{key:o.id},[e(u,null,{default:l(()=>[n(a(o.id),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.POSCode),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.POSDescription),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.Assembly),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.ItemCode),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.ItemDescription),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(Number(o.RecPercent*100).toFixed(2))+"%",1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.RecipeQty),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.RecipeUOM),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.BOMQty),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.BOMUOM),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.UnitCost),1)]),_:2},1024),e(u,null,{default:l(()=>[n(a(o.TotalCost),1)]),_:2},1024),e(u,{class:"flex items-center gap-2"},{default:l(()=>[f(g)("view POSMasterfile BOM")?(d(),v(w,{key:0,isLink:!0,href:i.route("pos-bom.show",o.id)},null,8,["href"])):c("",!0),f(g)("edit POSMasterfile BOM")?(d(),v(R,{key:1,isLink:!0,href:i.route("pos-bom.edit",o.id)},null,8,["href"])):c("",!0),e(A,{onClick:ce=>f(F)(i.route("pos-bom.destroy",o.id),"POSMasterfile BOM Item")},null,8,["onClick"])]),_:2},1024)]))),128))]),_:1})]),_:1}),e(te,null,{default:l(()=>[(d(!0),k(H,null,$(C.boms.data,o=>(d(),v(ee,{key:o.id},{default:l(()=>[e(Z,{title:`${o.POSDescription} (${o.POSCode})`},{default:l(()=>[f(g)("view POSMasterfile BOM")?(d(),v(w,{key:0,isLink:!0,href:i.route("pos-bom.show",o.id)},null,8,["href"])):c("",!0),f(g)("edit POSMasterfile BOM")?(d(),v(R,{key:1,isLink:!0,href:i.route("pos-bom.edit",o.id)},null,8,["href"])):c("",!0),e(A,{onClick:ce=>f(F)(i.route("pos-bom.destroy",o.id),"POSMasterfile BOM Item")},null,8,["onClick"])]),_:2},1032,["title"]),e(m,null,{default:l(()=>[n("POS Code: "+a(o.POSCode),1)]),_:2},1024),e(m,null,{default:l(()=>[n("Item Code: "+a(o.ItemCode),1)]),_:2},1024),e(m,null,{default:l(()=>[n("Assembly: "+a(o.Assembly),1)]),_:2},1024),e(m,null,{default:l(()=>[n("Rec Percent: "+a(Number(o.RecPercent*100).toFixed(2))+"%",1)]),_:2},1024),e(m,null,{default:l(()=>[n("Recipe Qty: "+a(o.RecipeQty)+" "+a(o.RecipeUOM),1)]),_:2},1024),e(m,null,{default:l(()=>[n("BOM Qty: "+a(o.BOMQty)+" "+a(o.BOMUOM),1)]),_:2},1024),e(m,null,{default:l(()=>[n("Unit Cost: "+a(o.UnitCost),1)]),_:2},1024),e(m,null,{default:l(()=>[n("Total Cost: "+a(o.TotalCost),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(le,{data:C.boms},null,8,["data"])]),_:1}),e(fe,{open:M.value,"onUpdate:open":t[5]||(t[5]=o=>M.value=o)},{default:l(()=>[e(pe,{class:"sm:max-w-[600px]"},{default:l(()=>[e(ae,null,{default:l(()=>[e(ne,null,{default:l(()=>t[22]||(t[22]=[n("Import POS BOMs")])),_:1}),e(se,null,{default:l(()=>t[23]||(t[23]=[n(" Import the excel file of the POS BOMs. ")])),_:1})]),_:1}),p("div",xe,[p("div",Fe,[e(I,{type:"file",onInput:t[4]||(t[4]=o=>f(T).pos_bom_file=o.target.files[0])}),e(ie,null,{default:l(()=>[n(a(f(T).errors.pos_bom_file),1)]),_:1})]),p("div",Ie,[e(re,{class:"text-xs"},{default:l(()=>t[24]||(t[24]=[n("Accepted POS BOMs File Format")])),_:1}),p("ul",null,[p("li",Le,[p("a",{class:"text-blue-500 underline",href:i.route("excel.pos-bom-template")},"Click to download template",8,we)])])])]),e(de,null,{default:l(()=>[e(L,{disabled:S.value,onClick:N,type:"submit",class:"gap-2"},{default:l(()=>[t[25]||(t[25]=n(" Proceed ")),p("span",null,[S.value?(d(),v(ue,{key:0})):c("",!0)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["exportRoute"])}}};export{$e as default};
