import{Y as ne,x as j,l as k,y as H,r as q,o as u,c as f,w as a,g as n,u as e,aA as v,N as g,a as s,P as G,b as r,h as x,d as w,e as T,aQ as D,t as d,n as E,ay as N,aN as F,F as R,aL as Q,aM as U,_ as re,aB as de,aF as ue,aG as ie,aH as ce,aK as Y,aZ as K,E as Z,bu as fe}from"./app-p8ycGfai.js";import{_ as me,a as _e,b as J,c as b,d as ve,e as y}from"./TableHeader-a0F1Zfhh.js";import{S as ge}from"./search-Czf2XZZ_.js";import{R as pe}from"./rotate-ccw-JUU7RYek.js";import{S as X}from"./square-pen-CI0P5sG9.js";const xe={class:"flex gap-2"},be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},ye={class:"flex items-center justify-between"},he={class:"text-sm font-medium text-muted-foreground"},we={class:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center"},ke={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},$e={class:"relative"},Ce={class:"flex gap-2"},Se={class:"text-sm text-muted-foreground"},Te={class:"hidden md:block"},Ne={class:"flex justify-end gap-2"},Re={class:"flex items-center justify-between"},Ae={class:"flex items-center gap-2"},Pe={class:"font-semibold text-sm"},je={class:"flex gap-1"},De={class:"text-sm"},Ee={class:"font-medium"},Fe={class:"grid grid-cols-2 gap-3 text-sm"},Oe={class:"font-medium"},Ve={class:"font-medium"},ze={class:"text-sm"},Ie={class:"font-medium"},Be={class:"flex items-center justify-between text-sm"},Le={class:"font-medium"},Me={key:0,class:"text-center py-12"},We={class:"text-muted-foreground mb-4"},He={key:1,class:"mt-6"},qe={__name:"Index",props:{wastages:Object,statistics:Object,filters:Object,statusOptions:Array,storeOptions:Array,permissions:Object},setup(c){const m=c,h=j(m.filters.search||""),_=j(m.filters.status||"pending"),$=j(""),A=k(()=>h.value||_.value&&_.value!=="all"||$.value),ee=k(()=>{const o=m.statistics?m.statistics:{};return[{label:"Total Records",value:o.total?o.total:0,color:"text-blue-600"},{label:"Pending",value:o.pending?o.pending:0,color:"text-yellow-600"},{label:"Approved L1",value:o.approved_lvl1?o.approved_lvl1:0,color:"text-blue-600"},{label:"Approved L2",value:o.approved_lvl2?o.approved_lvl2:0,color:"text-green-600"},{label:"Cancelled",value:o.cancelled?o.cancelled:0,color:"text-red-600"}]}),O=()=>{const o={};h.value&&(o.search=h.value),_.value&&(o.status=_.value),$.value&&(o.date_range=$.value),console.log("Applying filters with params:",o),console.log("Current status.value:",_.value),g.get(route("wastage.index"),o,{preserveState:!0,preserveScroll:!0})},te=()=>{h.value="",_.value="pending",$.value="",g.get(route("wastage.index"),{},{preserveState:!0,preserveScroll:!0})},V=o=>{if(!o)return"N/A";const t=new Date(o),p=String(t.getMonth()+1).padStart(2,"0"),P=String(t.getDate()).padStart(2,"0"),l=t.getFullYear();let i=t.getHours();const le=String(t.getMinutes()).padStart(2,"0"),oe=i>=12?"P.M.":"A.M.";return i=i%12,i=i||12,`${p}/${P}/${l} ${String(i).padStart(2,"0")}:${le} ${oe}`},z=o=>o?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(o):"â‚±0.00",I=o=>{var t,p;return((t=o.storeBranch)==null?void 0:t.name)||((p=o.store_branch)==null?void 0:p.name)||"Unknown Store"},C=o=>{var t;return((t=m.statusOptions)==null?void 0:t.find(p=>p.value===o))||{label:o,color:"text-gray-600",bg_color:"bg-gray-100"}},B=k(()=>m.permissions.can_create),se=k(()=>m.permissions.can_edit),L=k(()=>m.permissions.can_delete),ae=k(()=>m.permissions.can_export),M=o=>o.wastage_status==="pending"&&se.value,W=o=>{confirm("Are you sure you want to delete this wastage record? This action cannot be undone.")&&g.delete(route("wastage.destroy",o.id),{preserveScroll:!0,onSuccess:()=>{}})};H([h,$],()=>{clearTimeout(S),S=setTimeout(()=>{O()},500)}),H(_,(o,t)=>{o!==t&&(console.log("Status watcher triggered:",{newStatus:o,oldStatus:t}),clearTimeout(S),S=setTimeout(()=>{O()},200))});let S;return(o,t)=>{const p=q("Pagination"),P=q("Layout");return u(),f(P,{heading:"Wastage Records",hasExcelDownload:ae.value},{"header-actions":a(()=>[n("div",xe,[B.value?(u(),f(e(v),{key:0,onClick:t[0]||(t[0]=l=>e(g).get(o.route("wastage.create")))},{default:a(()=>[s(e(G),{class:"w-4 h-4 mr-2"}),t[4]||(t[4]=r(" New Wastage Record "))]),_:1})):x("",!0)])]),default:a(()=>[n("div",be,[(u(!0),w(R,null,T(ee.value,l=>(u(),f(e(D),{key:l.label},{default:a(()=>[s(e(F),{class:"p-4"},{default:a(()=>[n("div",ye,[n("div",null,[n("p",he,d(l.label),1),n("p",{class:E(["text-2xl font-bold",l.color])},d(l.value),3)]),n("div",we,[s(e(N),{class:"w-4 h-4 text-primary"})])])]),_:2},1024)]),_:2},1024))),128))]),s(e(D),{class:"mb-6"},{default:a(()=>[s(e(Q),null,{default:a(()=>[s(e(U),{class:"text-lg"},{default:a(()=>t[5]||(t[5]=[r("Filters")])),_:1})]),_:1}),s(e(F),null,{default:a(()=>[n("div",ke,[n("div",$e,[s(e(ge),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s(e(re),{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),placeholder:"Search records...",class:"pl-10"},null,8,["modelValue"])]),s(e(de),{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=l=>_.value=l)},{default:a(()=>[s(e(ue),null,{default:a(()=>[s(e(ie),{placeholder:"All Statuses"})]),_:1}),s(e(ce),null,{default:a(()=>[s(e(Y),{value:"all"},{default:a(()=>t[6]||(t[6]=[r("All Statuses")])),_:1}),(u(!0),w(R,null,T(c.statusOptions,l=>(u(),f(e(Y),{key:l.value,value:String(l.value)},{default:a(()=>[r(d(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),n("div",Ce,[s(e(v),{variant:"outline",onClick:te,disabled:!A.value},{default:a(()=>[s(e(pe),{class:"w-4 h-4 mr-2"}),t[7]||(t[7]=r(" Clear "))]),_:1},8,["disabled"])])])]),_:1})]),_:1}),s(e(D),null,{default:a(()=>[s(e(Q),null,{default:a(()=>[s(e(U),null,{default:a(()=>t[8]||(t[8]=[r("Wastage Records")])),_:1}),n("p",Se," Showing "+d(c.wastages.from)+" to "+d(c.wastages.to)+" of "+d(c.wastages.total)+" records ",1)]),_:1}),s(e(F),null,{default:a(()=>[n("div",Te,[s(e(me),null,{default:a(()=>[s(e(_e),null,{default:a(()=>[s(e(J),null,{default:a(()=>[s(e(b),null,{default:a(()=>t[9]||(t[9]=[r("Wastage #")])),_:1}),s(e(b),null,{default:a(()=>t[10]||(t[10]=[r("Store")])),_:1}),s(e(b),null,{default:a(()=>t[11]||(t[11]=[r("Total Qty")])),_:1}),s(e(b),null,{default:a(()=>t[12]||(t[12]=[r("Items")])),_:1}),s(e(b),null,{default:a(()=>t[13]||(t[13]=[r("Total Cost")])),_:1}),s(e(b),null,{default:a(()=>t[14]||(t[14]=[r("Status")])),_:1}),s(e(b),null,{default:a(()=>t[15]||(t[15]=[r("Date")])),_:1}),s(e(b),{class:"text-right"},{default:a(()=>t[16]||(t[16]=[r("Actions")])),_:1})]),_:1})]),_:1}),s(e(ve),null,{default:a(()=>[(u(!0),w(R,null,T(c.wastages.data,l=>(u(),f(e(J),{key:l.id},{default:a(()=>[s(e(y),{class:"font-medium"},{default:a(()=>[r(d(l.wastage_no),1)]),_:2},1024),s(e(y),null,{default:a(()=>[r(d(I(l)),1)]),_:2},1024),s(e(y),null,{default:a(()=>[r(d(l.total_quantity),1)]),_:2},1024),s(e(y),null,{default:a(()=>[r(d(l.items_count),1)]),_:2},1024),s(e(y),null,{default:a(()=>[r(d(z(l.total_cost)),1)]),_:2},1024),s(e(y),null,{default:a(()=>[s(e(K),{class:E(C(l.wastage_status).bg_color+" "+C(l.wastage_status).color)},{default:a(()=>[r(d(l.status_label),1)]),_:2},1032,["class"])]),_:2},1024),s(e(y),null,{default:a(()=>[r(d(V(l.encoded_date)),1)]),_:2},1024),s(e(y),{class:"text-right"},{default:a(()=>[n("div",Ne,[s(e(v),{variant:"ghost",size:"sm",onClick:i=>e(g).get(o.route("wastage.show",l.id))},{default:a(()=>[s(e(Z),{class:"w-4 h-4"})]),_:2},1032,["onClick"]),M(l)?(u(),f(e(v),{key:0,variant:"ghost",size:"sm",onClick:i=>e(g).get(o.route("wastage.edit",l.id))},{default:a(()=>[s(e(X),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):x("",!0),L.value&&l.wastage_status==="pending"?(u(),f(e(v),{key:1,variant:"ghost",size:"sm",onClick:i=>W(l),class:"text-red-600 hover:text-red-700 hover:bg-red-50"},{default:a(()=>[s(e(N),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):x("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s(fe,{class:"md:hidden"},{default:a(()=>[(u(!0),w(R,null,T(c.wastages.data,l=>(u(),w("div",{key:l.id,class:"border-b last:border-b-0 p-4 space-y-3"},[n("div",Re,[n("div",Ae,[n("span",Pe,d(l.wastage_no),1),s(e(K),{class:E(C(l.wastage_status).bg_color+" "+C(l.wastage_status).color)},{default:a(()=>[r(d(l.status_label),1)]),_:2},1032,["class"])]),n("div",je,[s(e(v),{variant:"ghost",size:"sm",onClick:i=>e(g).get(o.route("wastage.show",l.id))},{default:a(()=>[s(e(Z),{class:"w-4 h-4"})]),_:2},1032,["onClick"]),M(l)?(u(),f(e(v),{key:0,variant:"ghost",size:"sm",onClick:i=>e(g).get(o.route("wastage.edit",l.id))},{default:a(()=>[s(e(X),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):x("",!0),L.value&&l.wastage_status==="PENDING"?(u(),f(e(v),{key:1,variant:"ghost",size:"sm",onClick:i=>W(l),class:"text-red-600 hover:text-red-700 hover:bg-red-50"},{default:a(()=>[s(e(N),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):x("",!0)])]),n("div",De,[t[17]||(t[17]=n("span",{class:"text-muted-foreground text-xs"},"Store:",-1)),n("div",Ee,d(I(l)),1)]),n("div",Fe,[n("div",null,[t[18]||(t[18]=n("span",{class:"text-muted-foreground text-xs"},"Total Qty:",-1)),n("div",Oe,d(l.total_quantity),1)]),n("div",null,[t[19]||(t[19]=n("span",{class:"text-muted-foreground text-xs"},"Items:",-1)),n("div",Ve,d(l.items_count),1)])]),n("div",ze,[t[20]||(t[20]=n("span",{class:"text-muted-foreground text-xs"},"Total Cost:",-1)),n("div",Ie,d(z(l.total_cost)),1)]),n("div",Be,[n("div",null,[t[21]||(t[21]=n("span",{class:"text-muted-foreground text-xs"},"Date:",-1)),n("div",Le,d(V(l.encoded_date)),1)])])]))),128))]),_:1}),c.wastages.data.length===0?(u(),w("div",Me,[s(e(N),{class:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),t[23]||(t[23]=n("h3",{class:"text-lg font-medium mb-2"},"No wastage records found",-1)),n("p",We,d(A.value?"Try adjusting your filters":"Get started by creating your first wastage record"),1),B.value&&!A.value?(u(),f(e(v),{key:0,onClick:t[3]||(t[3]=l=>e(g).get(o.route("wastage.create")))},{default:a(()=>[s(e(G),{class:"w-4 h-4 mr-2"}),t[22]||(t[22]=r(" Create Wastage Record "))]),_:1})):x("",!0)])):x("",!0),c.wastages.data.length>0?(u(),w("div",He,[s(p,{data:c.wastages},null,8,["data"])])):x("",!0)]),_:1})]),_:1})]),_:1},8,["hasExcelDownload"])}}},Ze=ne(qe,[["__scopeId","data-v-2b772e1e"]]);export{Ze as default};
