import{f as _e,x as p,Q as u,y as L,N,l as ve,T as ge,V as be,r as s,o as F,c as xe,w as l,a as t,d as B,g as i,u as _,b as a,X as we,t as g,h as H,R as ye,i as A,e as Se,F as he}from"./app-DPA7xop8.js";import"./lodash-But43GHr.js";import{u as Ie}from"./useToast-CL68v_82.js";import{u as Te}from"./useSelectOptions-DqOryH05.js";import{T as U}from"./triangle-alert-B9jhW3xO.js";const De={key:0,class:"relative mx-auto w-full max-w-4xl bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg shadow-lg mb-4 mt-4",role:"alert"},ke={class:"flex items-center justify-between mb-2"},Ce={class:"font-bold flex items-center"},Ne={class:"max-h-40 overflow-y-auto pr-2"},Fe={class:"text-sm whitespace-pre-line"},Ve={class:"flex items-center justify-center flex-col"},Le={class:"text-center"},Be={class:"flex justify-end"},Oe={key:0},$e={__name:"MainIndex",props:{transactions:{type:Object,required:!0},branches:{type:Object,required:!0}},setup(O){const{toast:T}=Ie();_e();const{options:E}=Te(O.branches);let D=p(u().props.filters.search),d=p(u().props.filters.from??new Date().toISOString().slice(0,10)),c=p(u().props.filters.to??new Date().toISOString().slice(0,10));const m=p(u().props.filters.branchId??"all");L(d,o=>{N.get(route("store-transactions.main-index"),{search:D.value,from:o,to:c.value,branchId:m.value},{preserveState:!0,preserveScroll:!0})}),L(c,o=>{N.get(route("store-transactions.main-index"),{search:D.value,from:d.value,to:o,branchId:m.value},{preserveState:!0,preserveScroll:!0})}),L(m,o=>{N.get(route("store-transactions.main-index"),{search:D.value,from:d.value,to:c.value,branchId:o},{preserveState:!0,preserveScroll:!0})});const z=()=>{d.value=new Date().toISOString().slice(0,10),c.value=new Date().toISOString().slice(0,10),m.value="all",D.value=null,N.get(route("store-transactions.main-index"),{search:D.value,from:d.value,to:c.value,branchId:m.value},{preserveState:!0,preserveScroll:!0,replace:!0})},W=ve(()=>route("store-transactions.export-main-index",{branchId:m.value,from:d.value,to:c.value})),k=ge({store_transactions_file:null}),v=p(!1),y=p(!1),X=()=>{y.value=!0};L(y,o=>{o||(v.value=!1,k.reset())});const M=p(!1),V=p(""),C=p([]),S=p(""),P=o=>{if(!o||o.length===0)return"";const e={};o.forEach(r=>{const f=r.data&&r.data.product_id?r.data.product_id:"N/A",x=r.reason||"Unknown reason",w=`${f}-${x}`;e[w]||(e[w]={productId:f,reason:x,count:0,rowNumbers:[]}),e[w].count++,e[w].rowNumbers.push(r.row_number)});let b=`The following import warnings occurred:

`;return Object.values(e).forEach(r=>{const f=r.productId!=="N/A"?` (Product ID: ${r.productId})`:"",x=r.rowNumbers.length>5?`${r.rowNumbers.slice(0,5).join(", ")}... (and ${r.rowNumbers.length-5} more)`:r.rowNumbers.join(", ");b+=`- ${r.reason}${f}. Occurrences: ${r.count} (Rows: ${x})
`}),b},q=()=>{v.value=!0,k.post(route("store-transactions.import"),{onSuccess:()=>{v.value=!1,y.value=!1;const o=u().props.flash;console.log("onSuccess: flash object from Inertia:",o),o.skipped_import_rows&&o.skipped_import_rows.length>0?(C.value=o.skipped_import_rows,S.value=P(C.value),T.add({severity:"warn",summary:"Import Completed with Warnings",detail:o.warning||"Some transactions were skipped during import. See message below for details.",life:5e3})):o.success&&(S.value="",T.add({severity:"success",summary:"Success",detail:o.success,life:3e3})),u().props.flash.skipped_import_rows=null,u().props.flash.warning=null,u().props.flash.success=null,u().props.flash.error=null,N.reload({preserveState:!0})},onError:o=>{v.value=!1,y.value=!1;const e=u().props.flash;e.error?V.value=e.error:o.store_transactions_file?V.value=o.store_transactions_file[0]:V.value="An unknown error occurred during import.",M.value=!0,u().props.flash.error=null},onFinish:()=>{v.value=!1}})},Q=o=>{if(!o)return"N/a";try{const e=new Date(o),b=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),f=e.getFullYear();return`${b}/${r}/${f}`}catch(e){return console.error("Error formatting date:",o,e),o}};be(()=>{const o=u().props.flash;console.log("onMounted: Full flash object from Inertia:",o),console.log("onMounted: branchesOptions:",E.value),console.log("onMounted: initial branchId.value:",m.value),o.skipped_import_rows&&o.skipped_import_rows.length>0?(C.value=o.skipped_import_rows,S.value=P(C.value),o.warning&&T.add({severity:"warn",summary:"Import Warning",detail:o.warning,life:5e3})):o.success?T.add({severity:"success",summary:"Success",detail:o.success,life:3e3}):o.error&&T.add({severity:"error",summary:"Import Error",detail:o.error,life:5e3}),u().props.flash.skipped_import_rows=null,u().props.flash.warning=null,u().props.flash.success=null,u().props.flash.error=null});const Y=()=>{S.value="",C.value=[]};return(o,e)=>{const b=s("DialogTitle"),r=s("DialogDescription"),f=s("DialogHeader"),x=s("DialogContent"),w=s("Dialog"),G=s("Select"),J=s("Filter"),K=s("PopoverTrigger"),R=s("Button"),j=s("Input"),Z=s("PopoverContent"),ee=s("Popover"),te=s("DivFlexCenter"),oe=s("TableHeader"),h=s("TH"),le=s("TableHead"),I=s("TD"),se=s("ShowButton"),ne=s("TableBody"),ae=s("Table"),re=s("Pagination"),ue=s("TableContainer"),ie=s("LabelXS"),de=s("FormError"),$=s("InputContainer"),ce=s("Label"),pe=s("Loading"),me=s("DialogFooter"),fe=s("Layout");return F(),xe(fe,{heading:"Store Transactions",hasButton:!0,buttonName:"Import Store Transactions",handleClick:X,hasExcelDownload:!0,exportRoute:W.value},{default:l(()=>[t(ye,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-1"},{default:l(()=>[S.value?(F(),B("div",De,[i("div",ke,[i("strong",Ce,[t(_(U),{class:"size-5 mr-2"}),e[6]||(e[6]=a(" Import Warnings! "))]),i("button",{onClick:Y,class:"text-yellow-700 hover:text-yellow-900 focus:outline-none"},[t(_(we),{class:"size-4"})])]),i("div",Ne,[i("p",Fe,g(S.value),1)])])):H("",!0)]),_:1}),t(w,{open:M.value,"onUpdate:open":e[0]||(e[0]=n=>M.value=n)},{default:l(()=>[t(x,{class:"sm:max-w-[400px] flex items-center justify-center flex-col"},{default:l(()=>[t(f,null,{default:l(()=>[t(b,null,{default:l(()=>[t(_(U),{class:"size-12 text-red-500"})]),_:1}),t(r)]),_:1}),i("div",Ve,[e[7]||(e[7]=i("h1",{class:"text-2xl font-bold"},"Error",-1)),i("p",Le,g(V.value),1)])]),_:1})]),_:1},8,["open"]),t(ue,null,{default:l(()=>[t(oe,null,{default:l(()=>[t(G,{filter:"",placeholder:"Select a Branch",modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=n=>m.value=n),options:_(E),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(te,{class:"gap-5"},{default:l(()=>[t(ee,null,{default:l(()=>[t(K,null,{default:l(()=>[t(J)]),_:1}),t(Z,null,{default:l(()=>[i("div",Be,[t(R,{onClick:z,variant:"link",class:"text-end text-red-500 text-xs"},{default:l(()=>e[8]||(e[8]=[a(" Reset Filter ")])),_:1})]),e[9]||(e[9]=i("label",{class:"text-xs"},"From",-1)),t(j,{type:"date",modelValue:_(d),"onUpdate:modelValue":e[2]||(e[2]=n=>A(d)?d.value=n:d=n)},null,8,["modelValue"]),e[10]||(e[10]=i("label",{class:"text-xs"},"To",-1)),t(j,{type:"date",modelValue:_(c),"onUpdate:modelValue":e[3]||(e[3]=n=>A(c)?c.value=n:c=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ae,null,{default:l(()=>[t(le,null,{default:l(()=>[t(h,null,{default:l(()=>e[11]||(e[11]=[a("Branch Code")])),_:1}),t(h,null,{default:l(()=>e[12]||(e[12]=[a("Branch Name")])),_:1}),t(h,null,{default:l(()=>e[13]||(e[13]=[a("POS Sales Date")])),_:1}),t(h,null,{default:l(()=>e[14]||(e[14]=[a("Transactions Count")])),_:1}),t(h,null,{default:l(()=>e[15]||(e[15]=[a("Overall Net Total")])),_:1}),t(h,null,{default:l(()=>e[16]||(e[16]=[a("Actions")])),_:1})]),_:1}),t(ne,null,{default:l(()=>[(F(!0),B(he,null,Se(O.transactions.data,n=>(F(),B("tr",{key:n.order_date},[t(I,null,{default:l(()=>[a(g(n.branch_code),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(n.branch_name),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(Q(n.order_date)),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(n.transaction_count),1)]),_:2},1024),t(I,null,{default:l(()=>[a(g(n.net_total),1)]),_:2},1024),t(I,{class:"flex items-center"},{default:l(()=>[t(se,{isLink:!0,href:o.route("store-transactions.index",{order_date:new Date(n.order_date).toLocaleDateString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit"}),branchId:n.store_branch_id})},null,8,["href"])]),_:2},1024)]))),128))]),_:1})]),_:1}),t(re,{data:O.transactions},null,8,["data"])]),_:1}),t(w,{open:y.value,"onUpdate:open":e[5]||(e[5]=n=>y.value=n)},{default:l(()=>[t(x,{class:"sm:max-w-[600px]"},{default:l(()=>[t(f,null,{default:l(()=>[t(b,null,{default:l(()=>e[17]||(e[17]=[a("Import Store Transactions List")])),_:1}),t(r,null,{default:l(()=>e[18]||(e[18]=[a(" Import the excel file here. ")])),_:1})]),_:1}),t($,null,{default:l(()=>[t(ie,null,{default:l(()=>e[19]||(e[19]=[a(" Store Transactions List ")])),_:1}),t(j,{disabled:v.value,type:"file",onInput:e[4]||(e[4]=n=>_(k).store_transactions_file=n.target.files[0])},null,8,["disabled"]),t(de,null,{default:l(()=>[a(g(_(k).errors.store_transactions_file),1)]),_:1})]),_:1}),t($,null,{default:l(()=>[t(ce,{class:"text-xs"},{default:l(()=>e[20]||(e[20]=[a("Store Transaction Template")])),_:1}),e[21]||(e[21]=i("ul",null,[i("li",{class:"text-xs"},[a(" Template: "),i("a",{class:"text-blue-500 underline",href:"/excel/store-transactions-template"},"Click to download")])],-1))]),_:1}),t(me,null,{default:l(()=>[t(R,{disabled:v.value||!_(k).store_transactions_file,onClick:q,class:"gap-2"},{default:l(()=>[e[22]||(e[22]=a(" Proceed ")),v.value?(F(),B("span",Oe,[t(pe)])):H("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["exportRoute"])}}};export{$e as default};
