import{f as h,l as _,r as i,o as c,d as v,a as t,u as y,Z as j,w as l,g as s,b as n,t as o,c as z,h as b,F as C,e as E,N as T}from"./app-rjK1ng7o.js";import{u as H}from"./useToast-DBCD-RTl.js";import{A as U}from"./arrow-left-CawIyKRQ.js";import{C as Q}from"./check-88cHZDY0.js";const V={class:"mb-6 p-4 bg-white rounded-lg shadow-md"},$={class:"flex justify-between items-center mb-4"},P={key:0},R={class:"overflow-y-auto max-h-[75vh]"},Y={key:0},W={__name:"Show",props:{schedule:{type:Object,required:!0},branch:{type:Object,required:!0},countItems:{type:Array,required:!0},canApproveLevel2:{type:Boolean,required:!0}},setup(f){const g=f,w=h(),{toast:k}=H(),A=d=>{const e=new Date;return e.setMonth(d-1),e.toLocaleString("en-US",{month:"long"})},B=d=>{if(!d)return"N/A";const e=new Date(d),p=e.getTimezoneOffset()*6e4,m=new Date(e.getTime()+p);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(m)},L=d=>{const e=parseFloat(d.bulk_qty)||0,p=parseFloat(d.loose_qty)||0,m=parseFloat(d.config)||1;return m===0?e+p:(e+p/m).toFixed(4)},x=()=>{w.require({message:"Are you sure you want to approve this count for Level 2?",header:"Confirm Level 2 Approval",icon:"pi pi-check-circle",rejectClass:"p-button-danger",accept:()=>{T.post(route("month-end-count-approvals-level2.approve",{schedule_id:g.schedule.id,branch_id:g.branch.id}),{},{onSuccess:()=>{k.add({severity:"success",summary:"Approved",detail:"Count has been approved for Level 2.",life:3e3})},onError:d=>{const e=Object.values(d)[0]||"An unknown error occurred.";k.add({severity:"error",summary:"Approval Failed",detail:e,life:5e3})}})}})},D=()=>{T.get(route("month-end-count-approvals-level2.index"))},N=_(()=>g.countItems.length>0?g.countItems[0].status:g.schedule.status),S=_(()=>g.countItems.some(d=>d.status==="level1_approved"));return(d,e)=>{const p=i("Badge"),m=i("Button"),a=i("TH"),I=i("TableHead"),r=i("TD"),q=i("TableBody"),F=i("Table"),M=i("TableContainer"),O=i("Layout");return c(),v(C,null,[t(y(j),{title:`MEC Level 2 Approval - ${f.branch.name}`},null,8,["title"]),t(O,{heading:`MEC Level 2 Approval - ${f.branch.name}`},{default:l(()=>[s("div",V,[e[5]||(e[5]=s("h3",{class:"text-lg font-semibold mb-2"},"Schedule Details",-1)),s("p",null,[e[0]||(e[0]=s("strong",null,"Year:",-1)),n(" "+o(f.schedule.year),1)]),s("p",null,[e[1]||(e[1]=s("strong",null,"Month:",-1)),n(" "+o(A(f.schedule.month)),1)]),s("p",null,[e[2]||(e[2]=s("strong",null,"MEC Schedule Date:",-1)),n(" "+o(B(f.schedule.calculated_date)),1)]),s("p",null,[e[3]||(e[3]=s("strong",null,"Branch:",-1)),n(" "+o(f.branch.name),1)]),s("p",null,[e[4]||(e[4]=s("strong",null,"Current Status:",-1)),t(p,{class:"capitalize bg-blue-500 text-white"},{default:l(()=>[n(o(N.value.replace(/_/g," ")),1)]),_:1})])]),s("div",$,[t(m,{onClick:D,variant:"outline"},{default:l(()=>[t(y(U),{class:"h-4 w-4 mr-2"}),e[6]||(e[6]=n(" Back "))]),_:1}),S.value?(c(),v("div",P,[f.canApproveLevel2?(c(),z(m,{key:0,onClick:x,variant:"success",class:"bg-green-600 hover:bg-green-700 text-white"},{default:l(()=>[t(y(Q),{class:"h-4 w-4 mr-2"}),e[7]||(e[7]=n(" Approve "))]),_:1})):b("",!0)])):b("",!0)]),t(M,null,{default:l(()=>[s("div",R,[t(F,null,{default:l(()=>[t(I,{class:"sticky top-0 z-10 bg-gray-100"},{default:l(()=>[t(a,null,{default:l(()=>e[8]||(e[8]=[n("Item Code")])),_:1}),t(a,null,{default:l(()=>e[9]||(e[9]=[n("Item Name")])),_:1}),t(a,null,{default:l(()=>e[10]||(e[10]=[n("Category 1")])),_:1}),t(a,null,{default:l(()=>e[11]||(e[11]=[n("Area")])),_:1}),t(a,null,{default:l(()=>e[12]||(e[12]=[n("Category 2")])),_:1}),t(a,null,{default:l(()=>e[13]||(e[13]=[n("Packaging")])),_:1}),t(a,null,{default:l(()=>e[14]||(e[14]=[n("Conversion")])),_:1}),t(a,null,{default:l(()=>e[15]||(e[15]=[n("Bulk UOM")])),_:1}),t(a,null,{default:l(()=>e[16]||(e[16]=[n("Loose UOM")])),_:1}),t(a,null,{default:l(()=>e[17]||(e[17]=[n("Current SOH")])),_:1}),t(a,null,{default:l(()=>e[18]||(e[18]=[n("Bulk Qty")])),_:1}),t(a,null,{default:l(()=>e[19]||(e[19]=[n("Loose Qty")])),_:1}),t(a,null,{default:l(()=>e[20]||(e[20]=[n("Remarks")])),_:1}),t(a,null,{default:l(()=>e[21]||(e[21]=[n("Total Qty")])),_:1}),t(a,null,{default:l(()=>e[22]||(e[22]=[n("Status")])),_:1}),t(a,null,{default:l(()=>e[23]||(e[23]=[n("Uploaded By")])),_:1})]),_:1}),t(q,null,{default:l(()=>[f.countItems.length?b("",!0):(c(),v("tr",Y,e[24]||(e[24]=[s("td",{colspan:"16",class:"text-center py-4"},"No items found for this count.",-1)]))),(c(!0),v(C,null,E(f.countItems,u=>(c(),v("tr",{key:u.id},[t(r,null,{default:l(()=>[n(o(u.item_code),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.item_name),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.category),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.area),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.category2),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.packaging_config),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.config),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.uom),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.loose_uom),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.current_soh),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.bulk_qty),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.loose_qty),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.remarks),1)]),_:2},1024),t(r,null,{default:l(()=>[n(o(L(u)),1)]),_:2},1024),t(r,null,{default:l(()=>[t(p,{class:"capitalize bg-blue-500 text-white"},{default:l(()=>[n(o(u.status.replace("_"," ")),1)]),_:2},1024)]),_:2},1024),t(r,null,{default:l(()=>[n(o(u.uploader?`${u.uploader.first_name} ${u.uploader.last_name}`:"N/A"),1)]),_:2},1024)]))),128))]),_:1})]),_:1})])]),_:1})]),_:1},8,["heading"])],64)}}};export{W as default};
