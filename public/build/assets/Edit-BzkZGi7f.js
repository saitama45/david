import{G as J,f as K,T as Q,l as U,r as u,o as b,c as W,w as t,a as s,b as o,g as f,u as r,t as i,d as V,e as w,F as O,N as Y}from"./app-Bp7xdNcv.js";import{u as k}from"./useSelectOptions-DNoqVwQ-.js";import{s as Z}from"./index-D8ayJ4Gh.js";import{s as L}from"./index-Bo396g4V.js";const ee={class:"grid sm:grid-cols-2 grid-cols-1 sm:gap-5 gap-3"},le={class:"flex items-center space-x-2 mb-2"},se={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},te={class:"text-xs text-gray-600"},re={class:"flex items-center space-x-2 mb-2"},ae={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ne={class:"text-xs text-gray-600"},me={__name:"Edit",props:{user:{type:Object,required:!0},roles:{type:Object,required:!0},branches:{type:Object,required:!0},suppliers:{type:Object,required:!0}},setup(F){const C=J(),q=K(),d=F,N=Array.isArray(d.user.roles)?d.user.roles.map(n=>String(n.id)):[],P=Array.isArray(d.user.suppliers)?d.user.suppliers.map(n=>n.supplier_code):[],l=Q({first_name:d.user.first_name,middle_name:d.user.middle_name,last_name:d.user.last_name,phone_number:d.user.phone_number,email:d.user.email,password:null,roles:N,remarks:d.user.remarks,assignedBranches:d.user.store_branches.map(n=>n.id),assignedSuppliers:P});console.log("form.assignedSuppliers (after form init):",l.assignedSuppliers);const{options:T}=k(d.roles),{options:x}=k(d.branches),{options:v}=k(d.suppliers);console.log("branchesOptions.value after composable:",x.value),console.log("suppliersOptions.value after composable:",v.value);const S=U({get:()=>{const n=x.value.filter(g=>g.value!=="all"),e=n.length;return l.assignedBranches.length===e&&n.every(g=>l.assignedBranches.includes(g.value))&&e>0},set:n=>{n?l.assignedBranches=x.value.filter(e=>e.value!=="all").map(e=>e.value):l.assignedBranches=[]}}),B=U({get:()=>{const n=v.value.length;return l.assignedSuppliers.length===n&&n>0},set:n=>{n?l.assignedSuppliers=v.value.map(e=>e.value):l.assignedSuppliers=[]}}),j=()=>{l.clearErrors();let n=!0;if(l.first_name||(l.setError("first_name","First name is required."),n=!1),l.last_name||(l.setError("last_name","Last name is required."),n=!1),l.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)||(l.setError("email","Invalid email format."),n=!1):(l.setError("email","Email is required."),n=!1),l.password&&l.password.length<8&&(l.setError("password","Password must be at least 8 characters if provided."),n=!1),(!l.phone_number||l.phone_number.replace(/[^0-9]/g,"").length!==11)&&(l.setError("phone_number","Phone number is required and must be 11 digits (e.g., 09xx xxx xxxx)."),n=!1),(!l.roles||l.roles.length===0)&&(l.setError("roles","At least one role must be assigned."),n=!1),(!l.assignedBranches||l.assignedBranches.length===0)&&(l.setError("assignedBranches","At least one branch must be assigned."),n=!1),!n){C.add({severity:"error",summary:"Validation Error",detail:"Please correct the highlighted fields.",life:3e3});return}q.require({message:"Are you sure you want to update the user details?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Update",severity:"success"},accept:()=>{console.log("Form data being submitted (Edit):",l.data()),l.post(route("users.update",d.user.id),{_method:"put",preserveScroll:!0,onSuccess:()=>{C.add({severity:"success",summary:"Success",detail:"User Details Updated Successfully.",life:3e3})},onError:e=>{console.log(e),C.add({severity:"error",summary:"Error",detail:"Failed to update user. Please check the form.",life:3e3})}})}})},D=()=>{Y.get(route("users.index"))};return(n,e)=>{const g=u("CardTitle"),I=u("CardDescription"),R=u("CardHeader"),c=u("Label"),_=u("Input"),m=u("FormError"),p=u("InputContainer"),M=u("MultiSelect"),H=u("Textarea"),E=u("LabelXS"),h=u("Checkbox"),X=u("CardContent"),A=u("Button"),$=u("CardFooter"),G=u("Card"),z=u("Layout");return b(),W(z,{heading:"Edit User Details"},{default:t(()=>[s(G,null,{default:t(()=>[s(R,null,{default:t(()=>[s(g,null,{default:t(()=>e[12]||(e[12]=[o("User Details")])),_:1}),s(I,null,{default:t(()=>e[13]||(e[13]=[o("Input all the important fields")])),_:1})]),_:1}),s(X,null,{default:t(()=>[f("section",ee,[s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[14]||(e[14]=[o("First Name")])),_:1}),s(_,{modelValue:r(l).first_name,"onUpdate:modelValue":e[0]||(e[0]=a=>r(l).first_name=a)},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.first_name),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[15]||(e[15]=[o("Middle Name")])),_:1}),s(_,{modelValue:r(l).middle_name,"onUpdate:modelValue":e[1]||(e[1]=a=>r(l).middle_name=a)},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.middle_name),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[16]||(e[16]=[o("Last Name")])),_:1}),s(_,{modelValue:r(l).last_name,"onUpdate:modelValue":e[2]||(e[2]=a=>r(l).last_name=a)},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.last_name),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[17]||(e[17]=[o("Phone Number")])),_:1}),s(r(Z),{modelValue:r(l).phone_number,"onUpdate:modelValue":e[3]||(e[3]=a=>r(l).phone_number=a),mask:"9999 999 9999",placeholder:"xxxx xxx xxxx"},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.phone_number),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[18]||(e[18]=[o("Email")])),_:1}),s(_,{modelValue:r(l).email,"onUpdate:modelValue":e[4]||(e[4]=a=>r(l).email=a),type:"email"},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.email),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[19]||(e[19]=[o("Password (Leave blank to keep current)")])),_:1}),s(_,{modelValue:r(l).password,"onUpdate:modelValue":e[5]||(e[5]=a=>r(l).password=a),type:"password"},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.password),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[20]||(e[20]=[o("Roles")])),_:1}),s(M,{filter:"",placeholder:"Assign Roles",modelValue:r(l).roles,"onUpdate:modelValue":e[6]||(e[6]=a=>r(l).roles=a),options:r(T),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),s(m,null,{default:t(()=>[o(i(r(l).errors.roles),1)]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(c,null,{default:t(()=>e[21]||(e[21]=[o("Remarks")])),_:1}),s(H,{modelValue:r(l).remarks,"onUpdate:modelValue":e[7]||(e[7]=a=>r(l).remarks=a)},null,8,["modelValue"]),s(m,null,{default:t(()=>[o(i(r(l).errors.remarks),1)]),_:1})]),_:1}),s(p,{class:"sm:col-span-2"},{default:t(()=>[f("div",le,[s(r(L),{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=a=>S.value=a),id:"editCheckAllBranches"},null,8,["modelValue"]),e[22]||(e[22]=f("label",{for:"editCheckAllBranches",class:"text-sm font-medium text-gray-700"},"Check All Branches",-1))]),s(E,null,{default:t(()=>e[23]||(e[23]=[o(" Assign Branches ")])),_:1}),f("div",se,[(b(!0),V(O,null,w(r(x).filter(a=>a.value!=="all"),a=>(b(),V("div",{key:a.value,class:"flex items-center space-x-2"},[s(h,{modelValue:r(l).assignedBranches,"onUpdate:modelValue":e[9]||(e[9]=y=>r(l).assignedBranches=y),value:a.value,name:"assignedBranches[]"},null,8,["modelValue","value"]),f("label",te,i(a.label),1)]))),128))]),s(m,null,{default:t(()=>[o(i(r(l).errors.assignedBranches),1)]),_:1})]),_:1}),s(p,{class:"sm:col-span-2"},{default:t(()=>[f("div",re,[s(r(L),{modelValue:B.value,"onUpdate:modelValue":e[10]||(e[10]=a=>B.value=a),id:"editCheckAllSuppliers"},null,8,["modelValue"]),e[24]||(e[24]=f("label",{for:"editCheckAllSuppliers",class:"text-sm font-medium text-gray-700"},"Check All Suppliers",-1))]),s(E,null,{default:t(()=>e[25]||(e[25]=[o(" Assign Suppliers ")])),_:1}),f("div",ae,[(b(!0),V(O,null,w(r(v),a=>(b(),V("div",{key:a.value,class:"flex items-center space-x-2"},[s(h,{modelValue:r(l).assignedSuppliers,"onUpdate:modelValue":e[11]||(e[11]=y=>r(l).assignedSuppliers=y),value:a.value,name:"assignedSuppliers[]"},null,8,["modelValue","value"]),f("label",ne,i(a.label),1)]))),128))]),s(m,null,{default:t(()=>[o(i(r(l).errors.assignedSuppliers),1)]),_:1})]),_:1})])]),_:1}),s($,{class:"justify-end gap-3"},{default:t(()=>[s(A,{onClick:D,variant:"outline"},{default:t(()=>e[26]||(e[26]=[o("Cancel")])),_:1}),s(A,{onClick:j,disabled:r(l).processing},{default:t(()=>e[27]||(e[27]=[o("Update")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})}}};export{me as default};
