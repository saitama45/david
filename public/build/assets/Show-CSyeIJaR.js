import{f as ue,x as S,y as de,T as ce,r as c,o as u,c as y,w as o,a as s,g as d,b as n,t as l,n as pe,u as p,h as P,d as b,e as M,m as R,A as V,X as z,F as L,N as fe}from"./app-DPA7xop8.js";import{u as ve}from"./useBackButton-DP22MaRs.js";import{u as me}from"./useToast-CL68v_82.js";import{u as ye}from"./useAuth-C8QnpB8L.js";import{S as Q}from"./save-CJIdHYvB.js";import{S as $}from"./square-pen-BBOZKqAa.js";const _e={class:"flex flex-col gap-5"},ge={class:"sm:flex-row flex flex-col gap-5"},be={class:"text-gray-700 text-sm"},xe={class:"font-bold"},ke={class:"text-gray-700 text-sm"},Se={class:"font-bold"},Ce={class:"text-gray-700 text-sm"},qe={class:"font-bold"},we={class:"sm:flex-row flex flex-col gap-5"},Te={class:"text-gray-700 text-sm"},he={class:"font-bold"},Ne={class:"text-gray-700 text-sm"},Ae={class:"sm:flex-row flex flex-col gap-5"},De={class:"text-gray-700 text-sm"},Oe={class:"font-bold"},Be={class:"text-gray-700 text-sm"},Pe={class:"font-bold"},Ve={key:0},Ee={key:1,class:"flex items-center gap-2"},Ie={key:0},He={key:0},Fe={key:1},$e={__name:"Show",props:{order:{type:Object,required:!0},items:{type:Object,required:!0}},setup(a){const I=ue(),{toast:h}=me(),{hasAccess:A}=ye(),{backButton:j}=ve(route("interco-approval.index")),E=a,K=t=>t?new Date(t).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"}):"N/A",X=t=>{var e,i,m;return t.from_store_name||((e=t.sending_store)==null?void 0:e.name)||((i=t.sending_store)==null?void 0:i.branch_name)||((m=t.sending_store)==null?void 0:m.brand_name)||"Unknown Sending Store"},G=t=>{var e,i;return t.to_store_name||((e=t.receiving_store)==null?void 0:e.name)||((i=t.receiving_store)==null?void 0:i.branch_name)||"Unknown Receiving Store"},J=t=>{switch(t.toUpperCase()){case"APPROVED":return"bg-green-500 text-white";case"OPEN":return"bg-blue-500 text-white";case"DISAPPROVED":return"bg-red-500 text-white";default:return"bg-yellow-500 text-white"}},v=S(!1),W=S(!1);S(!1);const f=S(null),_=S("");S(null);const H={mounted:t=>{const e=t.tagName==="INPUT"?t:t.querySelector("input");e&&(e.focus(),e.select())}};de(W,t=>{t||(v.value=!1,C.reset(),C.clearErrors())});const C=ce({order_id:null,remarks:null}),Y=t=>{I.require({message:"Are you sure you want to approve this interco order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{v.value=!0,C.order_id=t,C.post(route("interco-approval.approve"),{onSuccess:()=>{h.add({severity:"success",summary:"Success",detail:"Interco Order Approved Successfully.",life:3e3}),v.value=!1},onError:()=>{v.value=!1}})}})},Z=t=>{I.require({message:"Are you sure you want to disapprove this interco order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"danger"},accept:()=>{v.value=!0,C.order_id=t,C.post(route("interco-approval.disapprove"),{onSuccess:()=>{h.add({severity:"success",summary:"Success",detail:"Interco Order Disapproved Successfully.",life:3e3}),v.value=!1},onError:()=>{v.value=!1}})}})},q=S([]);E.items.forEach(t=>q.value.push({id:t.id,quantity_ordered:t.quantity_ordered,quantity_approved:t.quantity_approved||t.quantity_ordered,item_code:t.item_code,description:t.description,soh_stock:t.soh_stock,uom:t.uom}));const F=t=>{const e=q.value.find(i=>i.id===t);e&&(f.value={id:t,originalValue:e.quantity_approved},_.value=e.quantity_approved.toString())},D=()=>{if(!f.value)return;const t=parseFloat(_.value);if(isNaN(t)||t<0){h.add({severity:"error",summary:"Error",detail:"Please enter a valid quantity.",life:3e3});return}const e=Number(t.toFixed(2)),i=f.value.id;f.value.originalValue;const m=q.value.find(N=>N.id===i);m&&(m.quantity_approved=e);const w=E.items.find(N=>N.id===i);w&&(w.quantity_approved=e),ee(i,e),f.value=null,_.value=""},O=()=>{f.value=null,_.value=""},ee=(t,e)=>{fe.post(route("interco-approval.update-quantity",t),{quantity_approved:e},{preserveScroll:!0,onSuccess:()=>{h.add({severity:"success",summary:"Success",detail:"Quantity updated successfully.",life:2e3})},onError:()=>{q.value.find(i=>i.id===t),E.items.find(i=>i.id===t),h.add({severity:"error",summary:"Error",detail:"Failed to update quantity. Please refresh the page.",life:3e3})}})};return(t,e)=>{const i=c("Badge"),m=c("Button"),w=c("DivFlexCenter"),N=c("TableHeader"),x=c("TH"),te=c("TableHead"),k=c("TD"),U=c("Input"),oe=c("TableBody"),se=c("Table"),ne=c("MobileTableHeading"),B=c("LabelXS"),re=c("MobileTableRow"),ae=c("MobileTableContainer"),le=c("TableContainer"),ie=c("Layout");return u(),y(ie,{heading:"Interco Order Details"},{default:o(()=>[s(le,null,{default:o(()=>[d("section",_e,[d("section",ge,[d("span",be,[e[4]||(e[4]=n(" Interco Number: ")),d("span",xe,l(a.order.interco_number),1)]),d("span",ke,[e[5]||(e[5]=n(" Sending Store: ")),d("span",Se,l(X(a.order)),1)]),d("span",Ce,[e[6]||(e[6]=n(" Receiving Store: ")),d("span",qe,l(G(a.order)),1)])]),d("section",we,[d("span",Te,[e[7]||(e[7]=n(" Transfer Date: ")),d("span",he,l(K(a.order.transfer_date||a.order.order_date)),1)]),d("span",Ne,[e[8]||(e[8]=n(" Status: ")),s(i,{class:pe([J(a.order.interco_status),"font-bold"])},{default:o(()=>{var r;return[n(l(((r=a.order.interco_status)==null?void 0:r.toUpperCase())??"N/A"),1)]}),_:1},8,["class"])])]),d("section",Ae,[d("span",De,[e[9]||(e[9]=n(" Reason: ")),d("span",Oe,l(a.order.interco_reason??"N/A"),1)]),d("span",Be,[e[10]||(e[10]=n(" Remarks: ")),d("span",Pe,l(a.order.remarks??"N/A"),1)])]),s(w,{class:"gap-5"},{default:o(()=>[a.order.interco_status==="open"&&p(A)("approve interco requests")?(u(),y(m,{key:0,variant:"destructive",onClick:e[0]||(e[0]=r=>Z(a.order.id)),disabled:v.value},{default:o(()=>e[11]||(e[11]=[n(" Disapprove Order ")])),_:1},8,["disabled"])):P("",!0),a.order.interco_status==="open"&&p(A)("approve interco requests")?(u(),y(m,{key:1,class:"bg-green-500 hover:bg-green-300",onClick:e[1]||(e[1]=r=>Y(a.order.id)),disabled:v.value},{default:o(()=>e[12]||(e[12]=[n(" Approve Order ")])),_:1},8,["disabled"])):P("",!0)]),_:1})]),s(N),s(se,null,{default:o(()=>[s(te,null,{default:o(()=>[s(x,null,{default:o(()=>e[13]||(e[13]=[n(" Item Code ")])),_:1}),s(x,null,{default:o(()=>e[14]||(e[14]=[n(" Description ")])),_:1}),s(x,null,{default:o(()=>e[15]||(e[15]=[n(" UOM ")])),_:1}),s(x,null,{default:o(()=>e[16]||(e[16]=[n(" Ordered Qty ")])),_:1}),s(x,null,{default:o(()=>e[17]||(e[17]=[n(" SOH Stock ")])),_:1}),a.order.interco_status==="open"?(u(),y(x,{key:0},{default:o(()=>e[18]||(e[18]=[n("Approved Qty")])),_:1})):(u(),y(x,{key:1},{default:o(()=>e[19]||(e[19]=[n("Approved Qty")])),_:1}))]),_:1}),s(oe,null,{default:o(()=>[(u(!0),b(L,null,M(a.items,r=>(u(),b("tr",{key:r.id},[s(k,null,{default:o(()=>[n(l(r.item_code),1)]),_:2},1024),s(k,null,{default:o(()=>[n(l(r.description),1)]),_:2},1024),s(k,null,{default:o(()=>[n(l(r.uom??"N/A"),1)]),_:2},1024),s(k,null,{default:o(()=>[n(l(r.quantity_ordered),1)]),_:2},1024),s(k,null,{default:o(()=>[n(l(r.soh_stock??0),1)]),_:2},1024),a.order.interco_status==="open"?(u(),y(k,{key:0,class:"flex items-center gap-3"},{default:o(()=>{var g;return[f.value&&f.value.id===r.id?(u(),b("div",Ve,[R(s(U,{type:"number",modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=T=>_.value=T),class:"w-20 text-right",onKeyup:[V(D,["enter"]),V(O,["esc"])]},null,8,["modelValue"]),[[H]]),s(w,{class:"gap-1 ml-2"},{default:o(()=>[s(p(Q),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:D}),s(p(z),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:O})]),_:1})])):(u(),b("div",Ee,[n(l(((g=q.value.find(T=>T.id===r.id))==null?void 0:g.quantity_approved)||0)+" ",1),p(A)("approve interco requests")?(u(),y(p($),{key:0,class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:T=>F(r.id)},null,8,["onClick"])):P("",!0)]))]}),_:2},1024)):(u(),y(k,{key:1},{default:o(()=>[n(l(r.quantity_approved),1)]),_:2},1024))]))),128))]),_:1})]),_:1}),s(ae,null,{default:o(()=>[(u(!0),b(L,null,M(a.items,r=>(u(),y(re,{key:r.id},{default:o(()=>[s(ne,{title:`${r.description} (${r.item_code})`},{default:o(()=>[a.order.interco_status==="open"&&p(A)("approve interco requests")?(u(),b("div",Ie,[f.value&&f.value.id===r.id?(u(),b("div",He,[R(s(U,{type:"number",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=g=>_.value=g),class:"w-20 text-right",onKeyup:[V(D,["enter"]),V(O,["esc"])]},null,8,["modelValue"]),[[H]]),s(w,{class:"gap-1 ml-2"},{default:o(()=>[s(p(Q),{class:"size-4 text-green-500 cursor-pointer hover:text-green-600",onClick:D}),s(p(z),{class:"size-4 text-red-500 cursor-pointer hover:text-red-600",onClick:O})]),_:1})])):(u(),b("div",Fe,[s(p($),{class:"size-4 text-blue-500 cursor-pointer hover:text-blue-600",onClick:g=>F(r.id)},null,8,["onClick"])]))])):P("",!0)]),_:2},1032,["title"]),s(B,null,{default:o(()=>[n("UOM: "+l(r.uom??"N/A"),1)]),_:2},1024),s(B,null,{default:o(()=>[n("Ordered: "+l(r.quantity_ordered),1)]),_:2},1024),s(B,null,{default:o(()=>[n("SOH Stock: "+l(r.soh_stock??0),1)]),_:2},1024),s(B,null,{default:o(()=>{var g;return[n(" Approved: "+l(((g=q.value.find(T=>T.id===r.id))==null?void 0:g.quantity_approved)||0),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(m,{variant:"outline",class:"text-lg px-7",onClick:p(j)},{default:o(()=>e[20]||(e[20]=[n(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{$e as default};
