import{G as xe,x as y,Q as ye,N as j,y as U,W as we,r as d,o as v,d as c,a as s,u as f,Z as he,w as a,n as g,b as n,t as i,g as l,h as S,F as V,e as z,E as te,B as se,c as _e,j as Ce,s as De,m as ae,O as le,k as H}from"./app-p8ycGfai.js";import{l as Te}from"./lodash-Z9yJD-f9.js";import{u as ke}from"./useAuth-CsB0rIGq.js";import{C as oe}from"./calendar-BgyW0Gx5.js";const Se={class:"hidden md:block"},Me={key:0},Ee={class:"font-semibold text-blue-600"},$e=["onClick"],Fe=["onClick"],Ne=["onClick"],Oe=["onClick"],Ae={class:"font-semibold text-blue-600"},Be={class:"space-y-6"},Re={key:0,class:"relative"},Ve={class:"relative"},Le=["value","disabled"],Pe={class:"absolute z-[100] bg-white border border-gray-200 rounded-lg shadow-2xl p-4 w-full min-w-[320px] mt-2"},Ie={class:"flex justify-between items-center mb-4"},je={class:"text-lg font-semibold"},ze={class:"grid grid-cols-7 gap-2"},He=["onClick"],Qe={key:1,class:"relative"},Ye={class:"relative"},Ue=["value","disabled"],qe={class:"absolute z-[100] bg-white border border-gray-200 rounded-lg shadow-2xl p-4 w-full min-w-[320px] mt-2"},Je={class:"flex justify-between items-center mb-4"},We={class:"text-lg font-semibold"},Ge={class:"grid grid-cols-7 gap-2"},Xe=["onClick"],Ze={class:"flex gap-2 justify-end"},at={__name:"Index",props:{batches:{type:Object,default:()=>({data:[]})},variants:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},counts:{type:Object,default:()=>({})}},setup(b){var ee;const ne=b,{hasAccess:$}=ke(),L=xe();let P=y((((ee=ye().props.filters)==null?void 0:ee.filterQuery)||"approved").toString());const re=Te.throttle(()=>{j.get(route("dts-mass-orders.index"),{filterQuery:P.value},{preserveState:!0,preserveScroll:!0,replace:!0})},500);U(P,re);const F=o=>{P.value=o},w=o=>P.value===o?"bg-primary text-white":"",q=o=>{switch(o==null?void 0:o.toUpperCase()){case"APPROVED":return"bg-teal-500 text-white";case"COMMITTED":return"bg-blue-500 text-white";case"PARTIAL_RECEIVED":return"bg-purple-500 text-white";case"INCOMPLETE":return"bg-orange-500 text-white";case"RECEIVED":return"bg-green-500 text-white";case"PENDING":return"bg-yellow-500 text-white";case"COMPLETED":return"bg-green-500 text-white";case"CANCELLED":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},I=o=>{if(!o||!o.includes("-"))return"N/A";try{const[e,r,u]=o.substring(0,10).split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(r,10)-1]} ${parseInt(u,10)}, ${e}`}catch{return o}},J=o=>j.get(route("dts-mass-orders.show",o)),W=o=>j.get(route("dts-mass-orders.edit",o)),N=y(!1),x=y(null),h=y(null),_=y(null),O=y(!1),A=y(!1),D=y(new Date),T=y(new Date),B=y([]),M=y(!1),ie=()=>{x.value=null,h.value=null,_.value=null,B.value=[],N.value=!0};U([O,A],([o,e])=>{const r=o||e;we(()=>{const u=document.querySelector(".mass-order-dialog .p-dialog-content");u&&(u.style.overflow=r?"visible":"auto")})}),U(x,async o=>{if(M.value=!1,B.value=[],h.value=null,_.value=null,o){try{if(!(await(await fetch(route("dts-mass-orders.validate-cutoff",{variant:o}))).json()).exists){L.add({severity:"error",summary:"Missing Cutoff",detail:`No order cutoff is defined for the variant "${o}". Please define one before creating an order.`,life:6e3}),M.value=!0;return}}catch(e){console.error("Error checking cutoff:",e),L.add({severity:"error",summary:"Error",detail:"Could not verify order cutoff.",life:5e3}),M.value=!0;return}try{const r=await(await fetch(route("dts-mass-orders.get-available-dates",{variant:o}))).json();B.value=r}catch(e){console.error("Error fetching available dates:",e),B.value=[]}}});const ue=async()=>{if(!(!x.value||!h.value||!_.value))try{const e=await(await fetch(route("dts-mass-orders.validate-variant",{variant:x.value}))).json();if(!e.valid){L.add({severity:"error",summary:"Validation Error",detail:e.message,life:5e3});return}N.value=!1,j.get(route("dts-mass-orders.create"),{variant:x.value,date_from:h.value,date_to:_.value})}catch(o){console.error("Error validating variant:",o),L.add({severity:"error",summary:"Error",detail:"Failed to validate variant. Please try again.",life:5e3})}},G=o=>{const e=[],r=o.getFullYear(),u=o.getMonth(),E=new Date(r,u,1).getDay(),p=new Date(r,u+1,0).getDate();for(let m=0;m<E;m++)e.push(null);for(let m=1;m<=p;m++){const C=new Date(r,u,m),Q=`${r}-${String(u+1).padStart(2,"0")}-${String(m).padStart(2,"0")}`,Y=x.value&&!B.value.includes(Q);e.push({day:m,date:C,isDisabled:Y})}return e},X=o=>{o?D.value=new Date(D.value.getFullYear(),D.value.getMonth()-1,1):T.value=new Date(T.value.getFullYear(),T.value.getMonth()-1,1)},Z=o=>{o?D.value=new Date(D.value.getFullYear(),D.value.getMonth()+1,1):T.value=new Date(T.value.getFullYear(),T.value.getMonth()+1,1)},K=(o,e)=>{if(o&&!o.isDisabled){const r=o.date,u=r.getFullYear(),E=String(r.getMonth()+1).padStart(2,"0"),p=String(r.getDate()).padStart(2,"0"),m=`${u}-${E}-${p}`;e?(h.value=m,O.value=!1):(_.value=m,A.value=!1)}};return(o,e)=>{const r=d("Badge"),u=d("Button"),E=d("FilterTab"),p=d("TH"),m=d("TableHead"),C=d("TD"),Q=d("DivFlexCenter"),Y=d("TableBody"),de=d("Table"),ve=d("MobileTableHeading"),R=d("LabelXS"),ce=d("MobileTableRow"),fe=d("MobileTableContainer"),ge=d("Pagination"),me=d("TableContainer"),pe=d("Layout");return v(),c(V,null,[s(f(he),{title:"DTS Mass Orders"}),s(pe,{heading:"DTS Mass Orders",hasButton:f($)("create dts mass orders"),buttonName:"Create DTS Mass Order",handleClick:ie},{default:a(()=>[s(E,null,{default:a(()=>[s(u,{class:g(["sm:px-10 px-3 bg-white/10 text-gray-800 hover:text-white gap-5 sm:text-sm text-xs",w("all")]),onClick:e[0]||(e[0]=t=>F("all"))},{default:a(()=>[e[14]||(e[14]=n(" ALL ")),s(r,{class:g(["sm:flex hidden border border-gray bg-transparent text-gray-900 px-2",w("all")])},{default:a(()=>[n(i(b.counts.all||0),1)]),_:1},8,["class"])]),_:1},8,["class"]),s(u,{class:g(["sm:px-10 px-3 bg-white/10 text-gray-800 hover:text-white gap-5 sm:text-sm text-xs",w("approved")]),onClick:e[1]||(e[1]=t=>F("approved"))},{default:a(()=>[e[15]||(e[15]=n(" APPROVED ")),s(r,{class:g(["sm:flex hidden border border-gray bg-transparent text-gray-900 px-2",w("approved")])},{default:a(()=>[n(i(b.counts.approved||0),1)]),_:1},8,["class"])]),_:1},8,["class"]),s(u,{class:g(["sm:px-10 px-3 bg-white/10 text-gray-800 hover:text-white gap-5 sm:text-sm text-xs",w("committed")]),onClick:e[2]||(e[2]=t=>F("committed"))},{default:a(()=>[e[16]||(e[16]=n(" COMMITTED ")),s(r,{class:g(["sm:flex hidden border border-gray bg-transparent text-gray-900 px-2",w("committed")])},{default:a(()=>[n(i(b.counts.committed||0),1)]),_:1},8,["class"])]),_:1},8,["class"]),s(u,{class:g(["sm:px-10 px-3 bg-white/10 text-gray-800 hover:text-white gap-5 sm:text-sm text-xs",w("partial_received")]),onClick:e[3]||(e[3]=t=>F("partial_received"))},{default:a(()=>[e[17]||(e[17]=n(" PARTIAL RECEIVED ")),s(r,{class:g(["sm:flex hidden border border-gray bg-transparent text-gray-900 px-2",w("partial_received")])},{default:a(()=>[n(i(b.counts.partial_received||0),1)]),_:1},8,["class"])]),_:1},8,["class"]),s(u,{class:g(["sm:px-10 px-3 bg-white/10 text-gray-800 hover:text-white gap-5 sm:text-sm text-xs",w("received")]),onClick:e[4]||(e[4]=t=>F("received"))},{default:a(()=>[e[18]||(e[18]=n(" RECEIVED ")),s(r,{class:g(["sm:flex hidden border border-gray bg-transparent text-gray-900 px-2",w("received")])},{default:a(()=>[n(i(b.counts.received||0),1)]),_:1},8,["class"])]),_:1},8,["class"])]),_:1}),s(me,null,{default:a(()=>[l("div",Se,[s(de,null,{default:a(()=>[s(m,null,{default:a(()=>[s(p,null,{default:a(()=>e[19]||(e[19]=[n("Batch #")])),_:1}),s(p,null,{default:a(()=>e[20]||(e[20]=[n("Variant")])),_:1}),s(p,null,{default:a(()=>e[21]||(e[21]=[n("Delivery Dates")])),_:1}),s(p,null,{default:a(()=>e[22]||(e[22]=[n("Total Orders")])),_:1}),s(p,null,{default:a(()=>e[23]||(e[23]=[n("Total Quantity")])),_:1}),s(p,null,{default:a(()=>e[24]||(e[24]=[n("Status")])),_:1}),s(p,null,{default:a(()=>e[25]||(e[25]=[n("Actions")])),_:1})]),_:1}),s(Y,null,{default:a(()=>[!b.batches.data||b.batches.data.length===0?(v(),c("tr",Me,e[26]||(e[26]=[l("td",{colspan:"7",class:"text-center py-4"},"No mass orders found.",-1)]))):S("",!0),(v(!0),c(V,null,z(b.batches.data,t=>(v(),c("tr",{key:t.id},[s(C,null,{default:a(()=>[n(i(t.batch_number),1)]),_:2},1024),s(C,null,{default:a(()=>[l("span",Ee,i(t.variant),1)]),_:2},1024),s(C,null,{default:a(()=>[n(i(I(t.date_from))+" - "+i(I(t.date_to)),1)]),_:2},1024),s(C,null,{default:a(()=>[n(i(t.total_orders),1)]),_:2},1024),s(C,null,{default:a(()=>[n(i(t.total_quantity),1)]),_:2},1024),s(C,null,{default:a(()=>[s(r,{class:g([q(t.status),"font-bold"])},{default:a(()=>[n(i(t.status?t.status.toUpperCase():"N/A"),1)]),_:2},1032,["class"])]),_:2},1024),s(C,null,{default:a(()=>[s(Q,{class:"gap-3"},{default:a(()=>[f($)("view dts mass orders")?(v(),c("button",{key:0,onClick:k=>J(t.batch_number)},[s(f(te),{class:"size-5"})],8,$e)):S("",!0),f($)("edit dts mass orders")&&t.can_edit&&t.status==="approved"?(v(),c("button",{key:1,class:"text-blue-500",onClick:k=>W(t.batch_number)},[s(f(se),{class:"size-5"})],8,Fe)):S("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),s(fe,{class:"md:hidden"},{default:a(()=>[(v(!0),c(V,null,z(b.batches.data,t=>(v(),_e(ce,{key:t.id},{default:a(()=>[s(ve,{title:t.batch_number},{default:a(()=>[f($)("view dts mass orders")?(v(),c("button",{key:0,onClick:k=>J(t.batch_number)},[s(f(te),{class:"size-5"})],8,Ne)):S("",!0),f($)("edit dts mass orders")&&t.can_edit&&t.status==="approved"?(v(),c("button",{key:1,class:"text-blue-500",onClick:k=>W(t.batch_number)},[s(f(se),{class:"size-5"})],8,Oe)):S("",!0)]),_:2},1032,["title"]),s(R,null,{default:a(()=>[e[27]||(e[27]=n("Variant: ")),l("span",Ae,i(t.variant),1)]),_:2},1024),s(R,null,{default:a(()=>[n("Delivery Dates: "+i(I(t.date_from))+" - "+i(I(t.date_to)),1)]),_:2},1024),s(R,null,{default:a(()=>[n("Total Orders: "+i(t.total_orders),1)]),_:2},1024),s(R,null,{default:a(()=>[n("Total Quantity: "+i(t.total_quantity),1)]),_:2},1024),s(R,null,{default:a(()=>[e[28]||(e[28]=n("Status: ")),l("span",{class:g([q(t.status),"font-semibold p-1 rounded text-white"])},i(t.status?t.status.toUpperCase():"N/A"),3)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(ge,{data:b.batches},null,8,["data"])]),_:1}),s(f(Ce),{visible:N.value,"onUpdate:visible":e[13]||(e[13]=t=>N.value=t),modal:"",header:"Create DTS Mass Order",style:{width:"65rem",height:"90vh"},class:"mass-order-dialog"},{footer:a(()=>[l("div",Ze,[s(u,{variant:"destructive",onClick:e[12]||(e[12]=t=>N.value=!1)},{default:a(()=>e[34]||(e[34]=[n(" Cancel ")])),_:1}),s(u,{class:"bg-green-600 hover:bg-green-700 text-white",onClick:ue,disabled:!x.value||!h.value||!_.value||M.value},{default:a(()=>e[35]||(e[35]=[n(" Confirm ")])),_:1},8,["disabled"])])]),default:a(()=>[l("div",Be,[l("div",null,[e[29]||(e[29]=l("label",{for:"variant",class:"block text-sm font-medium text-gray-700 mb-2"},"Choose a variant:",-1)),s(f(De),{id:"variant",modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t),options:ne.variants,optionLabel:"label",optionValue:"value",placeholder:"Select a variant",class:"w-full"},null,8,["modelValue","options"])]),x.value?(v(),c("div",Re,[e[31]||(e[31]=l("label",{for:"date_from",class:"block text-sm font-medium text-gray-700 mb-2"},"Date From:",-1)),l("div",Ve,[l("input",{id:"date_from",type:"text",readonly:"",value:h.value,onClick:e[6]||(e[6]=t=>O.value=!O.value),disabled:M.value,class:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm shadow-sm transition-colors placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-400 cursor-pointer",placeholder:"Select start date"},null,8,Le),s(f(oe),{class:"absolute right-3 top-1/2 -translate-y-1/2 size-4 text-gray-500 pointer-events-none"})]),ae(l("div",Pe,[l("div",Ie,[l("button",{type:"button",onClick:e[7]||(e[7]=H(t=>X(!0),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},"<"),l("h2",je,i(D.value.toLocaleString("default",{month:"long",year:"numeric"})),1),l("button",{type:"button",onClick:e[8]||(e[8]=H(t=>Z(!0),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},">")]),e[30]||(e[30]=l("div",{class:"grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 mb-2"},[l("span",null,"Su"),l("span",null,"Mo"),l("span",null,"Tu"),l("span",null,"We"),l("span",null,"Th"),l("span",null,"Fr"),l("span",null,"Sa")],-1)),l("div",ze,[(v(!0),c(V,null,z(G(D.value),(t,k)=>(v(),c("div",{key:k,class:g(["text-center py-1.5 rounded-full text-sm",[t?t.isDisabled?"bg-gray-200 text-gray-400 cursor-not-allowed":h.value&&t.date.toDateString()===new Date(h.value+"T00:00:00").toDateString()?"bg-blue-600 text-white font-bold shadow-md cursor-pointer":"bg-gray-100 text-gray-800 font-semibold hover:bg-blue-100 cursor-pointer":""]]),onClick:be=>K(t,!0)},i(t?t.day:""),11,He))),128))])],512),[[le,O.value]])])):S("",!0),x.value?(v(),c("div",Qe,[e[33]||(e[33]=l("label",{for:"date_to",class:"block text-sm font-medium text-gray-700 mb-2"},"Date To:",-1)),l("div",Ye,[l("input",{id:"date_to",type:"text",readonly:"",value:_.value,onClick:e[9]||(e[9]=t=>A.value=!A.value),disabled:M.value,class:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm shadow-sm transition-colors placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-400 cursor-pointer",placeholder:"Select end date"},null,8,Ue),s(f(oe),{class:"absolute right-3 top-1/2 -translate-y-1/2 size-4 text-gray-500 pointer-events-none"})]),ae(l("div",qe,[l("div",Je,[l("button",{type:"button",onClick:e[10]||(e[10]=H(t=>X(!1),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},"<"),l("h2",We,i(T.value.toLocaleString("default",{month:"long",year:"numeric"})),1),l("button",{type:"button",onClick:e[11]||(e[11]=H(t=>Z(!1),["stop"])),class:"p-2 rounded-full hover:bg-gray-100"},">")]),e[32]||(e[32]=l("div",{class:"grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 mb-2"},[l("span",null,"Su"),l("span",null,"Mo"),l("span",null,"Tu"),l("span",null,"We"),l("span",null,"Th"),l("span",null,"Fr"),l("span",null,"Sa")],-1)),l("div",Ge,[(v(!0),c(V,null,z(G(T.value),(t,k)=>(v(),c("div",{key:k,class:g(["text-center py-1.5 rounded-full text-sm",[t?t.isDisabled?"bg-gray-200 text-gray-400 cursor-not-allowed":_.value&&t.date.toDateString()===new Date(_.value+"T00:00:00").toDateString()?"bg-blue-600 text-white font-bold shadow-md cursor-pointer":"bg-gray-100 text-gray-800 font-semibold hover:bg-blue-100 cursor-pointer":""]]),onClick:be=>K(t,!1)},i(t?t.day:""),11,Xe))),128))])],512),[[le,A.value]])])):S("",!0)])]),_:1},8,["visible"])]),_:1},8,["hasButton"])],64)}}};export{at as default};
