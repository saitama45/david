import{f as Pe,T as $,r,o as k,c as ne,w as o,g as u,a as t,b as n,u as a,s as A,t as c,i as R,d as B,e as ae,F as se,h as re}from"./app-Drfr7wPO.js";import{u as Me}from"./useBackButton-CnvTWR2a.js";import{u as z}from"./useSelectOptions-BWAyP7Dg.js";import{u as Ue}from"./useToast-Blb7EynO.js";import{u as Qe}from"./useEditQuantity-BjinyBMs.js";const je={class:"grid sm:grid-cols-3 gap-5 grid-cols-1"},Ne={class:"grid gap-5"},He={class:"flex flex-col space-y-1"},$e={class:"flex flex-col space-y-1"},Ae={class:"flex flex-col space-y-1"},Re={class:"flex flex-col space-y-1"},ze={class:"flex flex-col space-y-1"},Ye={class:"flex flex-col space-y-1"},Ge={class:"flex flex-col space-y-1"},Je=["onClick"],Xe=["onClick"],Ke=["onClick"],We=["onClick"],Ze={key:0},he={class:"space-y-5"},et={class:"flex flex-col space-y-1"},tt={class:"flex flex-col space-y-1"},ot={key:0},it={__name:"Create",props:{products:{type:Object,required:!1},branches:{type:Object,required:!0},suppliers:{type:Object,required:!0},previousOrder:{type:Object,required:!1}},setup(ie){const{backButton:de}=Me(route("store-orders.index")),M=Pe(),{toast:x}=Ue(),b=ref(null);onBeforeMount(()=>{const i=localStorage.getItem("storeStoreOrderDraft");i&&(b.value=JSON.parse(i))}),onMounted(()=>{console.log(b.value),b.value!=null&&M.require({message:"You have an unfinished draft. Would you like to continue where you left off or discard the draft?",header:"Unfinished Draft Detected",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Discard",severity:"danger"},acceptProps:{label:"Continue",severity:"primary"},accept:()=>{l.supplier_id=b.value.supplier_id,l.branch_id=b.value.branch_id,l.order_date=b.value.order_date,l.orders=b.value.orders}})});const E=ie,I=E.previousOrder,{options:ue}=z(E.branches),{options:pe}=z(E.products),{options:ce}=z(E.suppliers),T=ref(null),q=ref(!1),y=ref(!1);watch(q,i=>{i||(v.reset(),v.clearErrors())});const d=reactive({id:null,inventory_code:null,name:null,unit_of_measurement:null,quantity:null,cost:null,total_cost:null,uom:null}),v=$({orders_file:null}),l=$({branch_id:(I==null?void 0:I.store_branch_id)+"",supplier_id:(I==null?void 0:I.supplier_id)+"",order_date:null,orders:[],variant:"additional_order"}),fe=computed(()=>l.orders.reduce((i,e)=>i+parseFloat(e.total_cost),0).toFixed(2)),m=$({item:null}),me=()=>{if(l.orders.length<1){x.add({severity:"error",summary:"Error",detail:"Please select at least one item before proceeding.",life:5e3});return}if(!l.order_date){l.setError("order_date","Order date is required.");return}const i=e=>{const p=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${e.getFullYear()}-${p}-${f}`};l.order_date=i(new Date(l.order_date)),M.require({message:"Are you sure you want to place this order?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Confirm",severity:"info"},accept:()=>{l.post(route("additional-orders.store"),{onSuccess:()=>{x.add({severity:"success",summary:"Success",detail:"Order Created Successfully.",life:5e3}),localStorage.removeItem("storeStoreOrderDraft")},onError:e=>{x.add({severity:"error",summary:"Error",detail:"Can't place the order.",life:5e3})}})}})};watch(T,i=>{i&&(y.value=!0,m.item=i,axios.get(route("product.show",i)).then(e=>e.data).then(e=>{d.id=e.id,d.name=e.name,d.inventory_code=e.inventory_code,d.unit_of_measurement=e.unit_of_measurement,d.cost=e.cost,d.uom=e.uom}).catch(e=>console.log(e)).finally(()=>y.value=!1))});const _e=()=>{q.value=!0},ye=()=>{if(m.clearErrors(),!m.item){m.setError("item","Item field is required");return}if(Number(d.quantity)<.1){m.setError("quantity","Quantity must be at least 0.1");return}if(!d.inventory_code||!d.name||!d.unit_of_measurement||!d.quantity)return;const i=l.orders.findIndex(e=>e.id===d.id);if(i!==-1){const e=l.orders[i].quantity+=Number(d.quantity);l.orders[i].total_cost=parseFloat(d.cost*e).toFixed(2)}else d.total_cost=parseFloat(d.cost*d.quantity).toFixed(2),l.orders.push({...d});Object.keys(d).forEach(e=>{d[e]=null}),T.value=null,x.add({severity:"success",summary:"Success",detail:"Item added successfully.",life:5e3}),m.item=null,m.clearErrors()},xe=()=>{y.value=!0;const i=new FormData;i.append("orders_file",v.orders_file),axios.post(route("store-orders.imported-file"),i,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e.data.orders.forEach(p=>{const f=l.orders.findIndex(_=>_.id===p.id);if(f!==-1){const _=l.orders[f].quantity+Number(p.quantity);l.orders[f].quantity=_,l.orders[f].total_cost=parseFloat(_*l.orders[f].cost).toFixed(2)}else l.orders.push({...p,total_cost:parseFloat(p.quantity*p.cost).toFixed(2)})}),q.value=!1,x.add({severity:"success",summary:"Success",detail:"Items added successfully.",life:5e3}),v.orders_file=null}).catch(e=>{x.add({severity:"error",summary:"Error",detail:"An error occured while trying to get the imported orders. Please make sure that you are using the correct format.",life:5e3}),v.setError("orders_file",e.response.data.message),console.log(e)}).finally(()=>y.value=!1)},be=i=>{const e=l.orders.findIndex(p=>p.id===i);l.orders[e].quantity=parseFloat((l.orders[e].quantity+.1).toFixed(2)),l.orders[e].total_cost=parseFloat(l.orders[e].quantity*l.orders[e].cost).toFixed(2)},ve=i=>{const e=l.orders.findIndex(p=>p.id===i);if(l.orders[e].quantity=parseFloat((l.orders[e].quantity-.1).toFixed(2)),l.orders[e].quantity<.1){l.orders=l.orders.filter(p=>p.id!==i);return}l.orders[e].total_cost=parseFloat(l.orders[e].quantity*l.orders[e].cost).toFixed(2)},Y=i=>{M.require({message:"Are you sure you want to remove this item from your orders?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Remove",severity:"danger"},accept:()=>{l.orders=l.orders.filter(e=>e.id!==i),x.add({severity:"success",summary:"Confirmed",detail:"Item Removed",life:3e3})}})},L=reactive({minDate:null,maxDate:null}),G=new Date;let F=new Date(G);F.setDate(G.getDate()+3),F.getDay()===0&&F.setDate(F.getDate()+1),L.minDate=F,L.maxDate=F;const{isEditQuantityModalOpen:U,formQuantity:Q,openEditQuantityModal:ge,editQuantity:Ce}=Qe(l);return watch(l,i=>{localStorage.setItem("storeStoreOrderDraft",JSON.stringify(i))}),(i,e)=>{const p=r("CardTitle"),f=r("CardDescription"),_=r("CardHeader"),j=r("InputLabel"),g=r("FormError"),De=r("DatePicker"),N=r("CardContent"),H=r("Card"),S=r("Label"),O=r("Input"),V=r("Button"),J=r("CardFooter"),w=r("LabelXS"),ke=r("SpanBold"),X=r("DivFlexCenter"),C=r("TH"),Ie=r("TableHead"),D=r("TD"),qe=r("LinkButton"),K=r("Trash2"),Fe=r("TableBody"),Se=r("Table"),Te=r("Minus"),Oe=r("Plus"),Ve=r("MobileTableHeading"),we=r("MobileTableRow"),Be=r("MobileTableContainer"),W=r("DialogTitle"),Z=r("DialogDescription"),h=r("DialogHeader"),Ee=r("InputContainer"),ee=r("Loading"),te=r("DialogFooter"),oe=r("DialogContent"),le=r("Dialog"),Le=r("Layout");return k(),ne(Le,{heading:"Additional Store Order > Create",hasButton:!0,buttonName:"Import Orders",handleClick:_e},{default:o(()=>[u("div",je,[u("section",Ne,[t(H,null,{default:o(()=>[t(_,null,{default:o(()=>[t(p,null,{default:o(()=>e[11]||(e[11]=[n("Order Details")])),_:1}),t(f,null,{default:o(()=>e[12]||(e[12]=[n("Please input all the fields")])),_:1})]),_:1}),t(N,{class:"space-y-3"},{default:o(()=>[u("div",He,[t(j,{label:"Supplier"}),t(a(A),{filter:"",placeholder:"Select a Supplier",modelValue:a(l).supplier_id,"onUpdate:modelValue":e[0]||(e[0]=s=>a(l).supplier_id=s),options:a(ce),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(g,null,{default:o(()=>[n(c(a(l).errors.supplier_id),1)]),_:1})]),u("div",$e,[t(j,{label:"Store Branch"}),t(a(A),{filter:"",placeholder:"Select a Store",modelValue:a(l).branch_id,"onUpdate:modelValue":e[1]||(e[1]=s=>a(l).branch_id=s),options:a(ue),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(g,null,{default:o(()=>[n(c(a(l).errors.branch_id),1)]),_:1})]),u("div",Ae,[t(j,{label:"Order Date"}),t(De,{showIcon:"",fluid:"",dateFormat:"yy/mm/dd",modelValue:a(l).order_date,"onUpdate:modelValue":e[2]||(e[2]=s=>a(l).order_date=s),showOnFocus:!1,manualInput:!0,minDate:a(L).minDate,maxDate:a(L).maxDate},null,8,["modelValue","minDate","maxDate"]),t(g,null,{default:o(()=>[n(c(a(l).errors.order_date),1)]),_:1})])]),_:1})]),_:1}),t(H,null,{default:o(()=>[t(_,null,{default:o(()=>[t(p,null,{default:o(()=>e[13]||(e[13]=[n("Add Item")])),_:1}),t(f,null,{default:o(()=>e[14]||(e[14]=[n("Please input all the fields")])),_:1})]),_:1}),t(N,{class:"space-y-3"},{default:o(()=>[u("div",Re,[t(S,null,{default:o(()=>e[15]||(e[15]=[n("Item")])),_:1}),t(a(A),{filter:"",placeholder:"Select an Item",modelValue:a(T),"onUpdate:modelValue":e[3]||(e[3]=s=>R(T)?T.value=s:null),options:a(pe),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),t(g,null,{default:o(()=>[n(c(a(m).errors.item),1)]),_:1})]),u("div",ze,[t(S,null,{default:o(()=>e[16]||(e[16]=[n("Unit Of Measurement (UOM)")])),_:1}),t(O,{type:"text",disabled:"",modelValue:a(d).unit_of_measurement,"onUpdate:modelValue":e[4]||(e[4]=s=>a(d).unit_of_measurement=s)},null,8,["modelValue"])]),u("div",Ye,[t(S,null,{default:o(()=>e[17]||(e[17]=[n("Cost")])),_:1}),t(O,{type:"text",disabled:"",modelValue:a(d).cost,"onUpdate:modelValue":e[5]||(e[5]=s=>a(d).cost=s)},null,8,["modelValue"])]),u("div",Ge,[t(S,null,{default:o(()=>e[18]||(e[18]=[n("Quantity")])),_:1}),t(O,{type:"number",modelValue:a(d).quantity,"onUpdate:modelValue":e[6]||(e[6]=s=>a(d).quantity=s)},null,8,["modelValue"]),t(g,null,{default:o(()=>[n(c(a(m).errors.quantity),1)]),_:1})])]),_:1}),t(J,{class:"flex justify-end"},{default:o(()=>[t(V,{onClick:ye},{default:o(()=>e[19]||(e[19]=[n(" Add to Orders ")])),_:1})]),_:1})]),_:1})]),t(H,{class:"col-span-2 flex flex-col"},{default:o(()=>[t(_,{class:"flex justify-between"},{default:o(()=>[t(X,{class:"justify-between"},{default:o(()=>[t(p,null,{default:o(()=>e[20]||(e[20]=[n("Items List")])),_:1}),t(X,{class:"gap-2"},{default:o(()=>[t(w,null,{default:o(()=>e[21]||(e[21]=[n(" Overall Total:")])),_:1}),t(ke,null,{default:o(()=>[n(c(a(fe)),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"flex-1"},{default:o(()=>[t(Se,null,{default:o(()=>[t(Ie,null,{default:o(()=>[t(C,null,{default:o(()=>e[22]||(e[22]=[n(" Name ")])),_:1}),t(C,null,{default:o(()=>e[23]||(e[23]=[n(" Code ")])),_:1}),t(C,null,{default:o(()=>e[24]||(e[24]=[n(" Quantity ")])),_:1}),t(C,null,{default:o(()=>e[25]||(e[25]=[n(" Unit ")])),_:1}),t(C,null,{default:o(()=>e[26]||(e[26]=[n(" Cost ")])),_:1}),t(C,null,{default:o(()=>e[27]||(e[27]=[n(" Total Cost ")])),_:1}),t(C,null,{default:o(()=>e[28]||(e[28]=[n(" Action ")])),_:1})]),_:1}),t(Fe,null,{default:o(()=>[(k(!0),B(se,null,ae(a(l).orders,s=>(k(),B("tr",{key:s.item_code},[t(D,null,{default:o(()=>[n(c(s.name),1)]),_:2},1024),t(D,null,{default:o(()=>[n(c(s.inventory_code),1)]),_:2},1024),t(D,null,{default:o(()=>[n(c(s.quantity),1)]),_:2},1024),t(D,null,{default:o(()=>[n(c(s.unit_of_measurement),1)]),_:2},1024),t(D,null,{default:o(()=>[n(c(s.cost),1)]),_:2},1024),t(D,null,{default:o(()=>[n(c(s.total_cost),1)]),_:2},1024),t(D,{class:"flex gap-3"},{default:o(()=>[t(qe,{onClick:P=>a(ge)(s.id,s.quantity)},{default:o(()=>e[29]||(e[29]=[n(" Edit Quantity ")])),_:2},1032,["onClick"]),u("button",{onClick:P=>Y(s.id),variant:"outline",class:"text-red-500"},[t(K)],8,Je)]),_:2},1024)]))),128))]),_:1})]),_:1}),t(Be,null,{default:o(()=>[(k(!0),B(se,null,ae(a(l).orders,s=>(k(),ne(we,{key:s.item_code},{default:o(()=>[t(Ve,{title:`${s.name} (${s.inventory_code})`},{default:o(()=>[u("button",{class:"text-red-500 size-5",onClick:P=>ve(s.id)},[t(Te)],8,Xe),u("button",{class:"text-green-500 size-5",onClick:P=>be(s.id)},[t(Oe)],8,Ke),u("button",{onClick:P=>Y(s.id),variant:"outline",class:"text-red-500 size-5"},[t(K)],8,We)]),_:2},1032,["title"]),t(w,null,{default:o(()=>[n("UOM: "+c(s.unit_of_measurement),1)]),_:2},1024),t(w,null,{default:o(()=>[n("Quantity: "+c(s.quantity),1)]),_:2},1024),t(w,null,{default:o(()=>[n("Cost: "+c(s.cost),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(J,{class:"flex justify-end"},{default:o(()=>[t(V,{onClick:me},{default:o(()=>e[30]||(e[30]=[n("Place Order")])),_:1})]),_:1})]),_:1})]),t(le,{open:a(U),"onUpdate:open":e[8]||(e[8]=s=>R(U)?U.value=s:null)},{default:o(()=>[t(oe,{class:"sm:max-w-[600px]"},{default:o(()=>[t(h,null,{default:o(()=>[t(W,null,{default:o(()=>e[31]||(e[31]=[n("Edit Quantity")])),_:1}),t(Z,null,{default:o(()=>e[32]||(e[32]=[n(" Please input all the required fields. ")])),_:1})]),_:1}),t(Ee,null,{default:o(()=>[t(w,null,{default:o(()=>e[33]||(e[33]=[n("Quantity")])),_:1}),t(O,{type:"number",modelValue:a(Q).quantity,"onUpdate:modelValue":e[7]||(e[7]=s=>a(Q).quantity=s)},null,8,["modelValue"]),t(g,null,{default:o(()=>[n(c(a(Q).errors.quantity),1)]),_:1})]),_:1}),t(te,null,{default:o(()=>[t(V,{onClick:a(Ce),disabled:a(y),type:"submit",class:"gap-2"},{default:o(()=>[e[34]||(e[34]=n(" Confirm ")),a(y)?(k(),B("span",Ze,[t(ee)])):re("",!0)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(le,{open:a(q),"onUpdate:open":e[10]||(e[10]=s=>R(q)?q.value=s:null)},{default:o(()=>[t(oe,{class:"sm:max-w-[600px]"},{default:o(()=>[t(h,null,{default:o(()=>[t(W,null,{default:o(()=>e[35]||(e[35]=[n("Import Orders")])),_:1}),t(Z,null,{default:o(()=>e[36]||(e[36]=[n(" Import the excel file of your orders. ")])),_:1})]),_:1}),u("div",he,[u("div",et,[t(S,null,{default:o(()=>e[37]||(e[37]=[n("Orders")])),_:1}),t(O,{type:"file",onInput:e[9]||(e[9]=s=>a(v).orders_file=s.target.files[0])}),t(g,null,{default:o(()=>[n(c(a(v).errors.orders_file),1)]),_:1})]),u("div",tt,[t(S,{class:"text-xs"},{default:o(()=>e[38]||(e[38]=[n("Order Templates")])),_:1}),e[39]||(e[39]=u("ul",null,[u("li",{class:"text-xs"},[n(" GSI BAKERY: "),u("a",{class:"text-blue-500 underline",href:"/excel/gsi-bakery-template"},"Click to download")]),u("li",{class:"text-xs"},[n(" GSI OT: "),u("a",{class:"text-blue-500 underline",href:"/excel/gsi-pr-template"},"Click to download")]),u("li",{class:"text-xs"},[n(" PUL: "),u("a",{class:"text-blue-500 underline",href:"/excel/pul-template"},"Click to download")])],-1))])]),t(te,null,{default:o(()=>[t(V,{disabled:a(y),onClick:xe,type:"submit",class:"gap-2"},{default:o(()=>[e[40]||(e[40]=n(" Proceed ")),a(y)?(k(),B("span",ot,[t(ee)])):re("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(V,{variant:"outline",class:"text-lg px-7",onClick:a(de)},{default:o(()=>e[41]||(e[41]=[n(" Back ")])),_:1},8,["onClick"])]),_:1})}}};export{it as default};
